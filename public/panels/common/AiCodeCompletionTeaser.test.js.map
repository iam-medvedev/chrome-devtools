{"version":3,"file":"AiCodeCompletionTeaser.test.js","sourceRoot":"","sources":["../../../../../../front_end/panels/common/AiCodeCompletionTeaser.test.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright 2025 The Chromium Authors. All rights reserved.\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport * as Common from '../../core/common/common.js';\nimport * as Host from '../../core/host/host.js';\nimport {assertNotNullOrUndefined} from '../../core/platform/platform.js';\nimport * as Root from '../../core/root/root.js';\nimport {renderElementIntoDOM} from '../../testing/DOMHelpers.js';\nimport {describeWithEnvironment, updateHostConfig} from '../../testing/EnvironmentHelpers.js';\nimport {createViewFunctionStub} from '../../testing/ViewFunctionHelpers.js';\nimport * as Snackbars from '../../ui/components/snackbars/snackbars.js';\nimport * as UI from '../../ui/legacy/legacy.js';\n\nimport * as AiCodeCompletionTeaser from './AiCodeCompletionTeaser.js';\nimport * as FreDialog from './FreDialog.js';\n\ndescribeWithEnvironment('AiCodeCompletionTeaser', () => {\n  let showFreDialogStub: sinon.SinonStub<Parameters<typeof FreDialog.FreDialog.show>, Promise<boolean>>;\n\n  beforeEach(() => {\n    showFreDialogStub = sinon.stub(FreDialog.FreDialog, 'show');\n    sinon.stub(Host.AidaClient.AidaClient, 'checkAccessPreconditions')\n        .resolves(Host.AidaClient.AidaAccessPreconditions.AVAILABLE);\n  });\n\n  async function createTeaser() {\n    const view = createViewFunctionStub(AiCodeCompletionTeaser.AiCodeCompletionTeaser);\n    const widget = new AiCodeCompletionTeaser.AiCodeCompletionTeaser(view);\n    widget.markAsRoot();\n    renderElementIntoDOM(widget);\n    await view.nextInput;\n    return {view, widget};\n  }\n\n  afterEach(() => {\n    Common.Settings.Settings.instance().settingForTest('ai-code-completion-teaser-dismissed').set(false);\n    Common.Settings.Settings.instance().settingForTest('ai-code-completion-fre-completed').set(false);\n    sinon.restore();\n  });\n\n  it('should dismiss and open snackbar on dismiss click', async () => {\n    const {view, widget} = await createTeaser();\n    const showSnackbar = sinon.stub(Snackbars.Snackbar.Snackbar, 'show');\n\n    assert.isTrue(widget.isShowing());\n    assertNotNullOrUndefined(view.input.onDismiss);\n    view.input.onDismiss(new Event('click'));\n\n    sinon.assert.calledOnce(showSnackbar);\n    assert.isFalse(widget.isShowing());\n    widget.detach();\n  });\n\n  it('should open settings on snackbar action click', async () => {\n    const {view, widget} = await createTeaser();\n    const showSnackbar = sinon.stub(Snackbars.Snackbar.Snackbar, 'show');\n    const showViewStub = sinon.stub(UI.ViewManager.ViewManager.instance(), 'showView');\n    assertNotNullOrUndefined(view.input.onDismiss);\n    view.input.onDismiss(new Event('click'));\n\n    sinon.assert.calledOnce(showSnackbar);\n    const snackbarOptions = showSnackbar.firstCall.args[0];\n    assertNotNullOrUndefined(snackbarOptions.actionProperties);\n    snackbarOptions.actionProperties.onClick();\n\n    assert.isTrue(showViewStub.calledOnceWith('chrome-ai'));\n    widget.detach();\n  });\n\n  it('should open FRE dialog on ctrl+i', async () => {\n    const {widget} = await createTeaser();\n    const onActionSpy = sinon.spy(widget, 'onAction');\n\n    const event = Host.Platform.isMac() ? new KeyboardEvent('keydown', {key: 'i', metaKey: true}) :\n                                          new KeyboardEvent('keydown', {key: 'i', ctrlKey: true});\n    document.body.dispatchEvent(event);\n\n    sinon.assert.calledOnce(onActionSpy);\n    sinon.assert.called(showFreDialogStub);\n    widget.detach();\n  });\n\n  it('should FRE text include no logging case when the enterprise policy value is ALLOW_WITHOUT_LOGGING', async () => {\n    updateHostConfig(\n        {aidaAvailability: {enterprisePolicyValue: Root.Runtime.GenAiEnterprisePolicyValue.ALLOW_WITHOUT_LOGGING}});\n\n    const {widget} = await createTeaser();\n    const event = Host.Platform.isMac() ? new KeyboardEvent('keydown', {key: 'i', metaKey: true}) :\n                                          new KeyboardEvent('keydown', {key: 'i', ctrlKey: true});\n    document.body.dispatchEvent(event);\n\n    sinon.assert.called(showFreDialogStub);\n    assert.exists(showFreDialogStub.lastCall.args[0].reminderItems.find(\n        reminderItem =>\n            reminderItem.content.toString().includes('This data will not be used to improve Google’s AI models.')));\n    widget.detach();\n  });\n\n  it('should FRE text not include no logging case when the enterprise policy value is ALLOW', async () => {\n    updateHostConfig({aidaAvailability: {enterprisePolicyValue: Root.Runtime.GenAiEnterprisePolicyValue.ALLOW}});\n\n    const {widget} = await createTeaser();\n    const event = Host.Platform.isMac() ? new KeyboardEvent('keydown', {key: 'i', metaKey: true}) :\n                                          new KeyboardEvent('keydown', {key: 'i', ctrlKey: true});\n    document.body.dispatchEvent(event);\n\n    sinon.assert.called(showFreDialogStub);\n    assert.notExists(showFreDialogStub.lastCall.args[0].reminderItems.find(\n        reminderItem =>\n            reminderItem.content.toString().includes('This data will not be used to improve Google’s AI models.')));\n    widget.detach();\n  });\n\n  it('should call dismiss on ctrl+x', async () => {\n    const {widget} = await createTeaser();\n    const onDismissSpy = sinon.spy(widget, 'onDismiss');\n    const showSnackbar = sinon.stub(Snackbars.Snackbar.Snackbar, 'show');\n\n    assert.isTrue(widget.isShowing());\n\n    const event = Host.Platform.isMac() ? new KeyboardEvent('keydown', {key: 'x', metaKey: true}) :\n                                          new KeyboardEvent('keydown', {key: 'x', ctrlKey: true});\n    document.body.dispatchEvent(event);\n\n    sinon.assert.calledOnce(onDismissSpy);\n    sinon.assert.calledOnce(showSnackbar);\n    assert.isFalse(widget.isShowing());\n    widget.detach();\n  });\n});\n"]}