{"version":3,"file":"DrJonesFileAgent.js","sourceRoot":"","sources":["../../../../../../front_end/panels/freestyler/DrJonesFileAgent.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright 2024 The Chromium Authors. All rights reserved.\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport * as Common from '../../core/common/common.js';\nimport * as Host from '../../core/host/host.js';\nimport * as i18n from '../../core/i18n/i18n.js';\nimport type * as Workspace from '../../models/workspace/workspace.js';\n\nimport {\n  AiAgent,\n  type AidaRequestOptions,\n  type ContextDetail,\n  type ContextResponse,\n  type ParsedResponse,\n  ResponseType,\n} from './AiAgent.js';\n\nconst preamble =\n    `You are a highly skilled software engineer with expertise in various programming languages and frameworks.\nYou are provided with the content of a file from the Chrome DevTools Sources panel.\n\n**Important Note:** The provided code may represent an incomplete fragment of a larger file.\n\nAnalyze the code and provide the following information:\n* Describe the primary functionality of the code. What does it do? Be specific and concise.\n* If possible, identify the framework or library the code is associated with (e.g., React, Angular, jQuery). List any key technologies, APIs, or patterns used in the code (e.g., Fetch API, WebSockets, object-oriented programming).\n* (Only provide if available and accessible externally) External Resources: Suggest relevant documentation that could help a developer understand the code better. Prioritize official documentation if available. Do not provide any internal resources.\n\n# Considerations\n* Keep your analysis concise and focused, highlighting only the most critical aspects for a software engineer.\n* **CRITICAL** If the user asks a question about religion, race, politics, sexuality, gender, or other sensitive topics, answer with \"Sorry, I can't answer that. I'm best at questions about files.\"\n\n## Example session\n\n**User:** (Selects a file containing the following JavaScript code)\n\nfunction calculateTotal(price, quantity) {\n  const total = price * quantity;\n  return total;\n}\nExplain this file.\n\n\nThis code defines a function called calculateTotal that calculates the total cost by multiplying the price and quantity arguments.\nThis code is written in JavaScript and doesn't seem to be associated with a specific framework. It's likely a utility function.\nRelevant Technologies: JavaScript, functions, arithmetic operations.\nExternal Resources:\nMDN Web Docs: JavaScript Functions: https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Functions\n`;\n\n/*\n* Strings that don't need to be translated at this time.\n*/\nconst UIStringsNotTranslate = {\n  /**\n   *@description Title for thinking step of DrJones File agent.\n   */\n  analyzingFile: 'Analyzing file',\n};\n\nconst lockedString = i18n.i18n.lockedString;\n\nconst MAX_FILE_SIZE = 50000;\n\n/**\n * One agent instance handles one conversation. Create a new agent\n * instance for a new conversation.\n */\nexport class DrJonesFileAgent extends AiAgent<Workspace.UISourceCode.UISourceCode> {\n  readonly preamble = preamble;\n  readonly clientFeature = Host.AidaClient.ClientFeature.CHROME_DRJONES_FILE_AGENT;\n  get userTier(): string|undefined {\n    const config = Common.Settings.Settings.instance().getHostConfig();\n    return config.devToolsAiAssistanceFileAgentDogfood?.userTier;\n  }\n  get options(): AidaRequestOptions {\n    const config = Common.Settings.Settings.instance().getHostConfig();\n    const temperature = AiAgent.validTemperature(config.devToolsAiAssistanceFileAgentDogfood?.temperature);\n    const modelId = config.devToolsAiAssistanceFileAgentDogfood?.modelId;\n\n    return {\n      temperature,\n      model_id: modelId,\n    };\n  }\n\n  async *\n      handleContextDetails(selectedFile: Workspace.UISourceCode.UISourceCode|null):\n          AsyncGenerator<ContextResponse, void, void> {\n    if (!selectedFile) {\n      return;\n    }\n\n    yield {\n      type: ResponseType.CONTEXT,\n      title: lockedString(UIStringsNotTranslate.analyzingFile),\n      details: createContextDetailsForDrJonesFileAgent(selectedFile),\n    };\n  }\n\n  override async enhanceQuery(query: string, selectedFile: Workspace.UISourceCode.UISourceCode|null): Promise<string> {\n    const fileEnchantmentQuery =\n        selectedFile ? `# Selected file\\n${formatFile(selectedFile)}\\n\\n# User request\\n\\n` : '';\n    return `${fileEnchantmentQuery}${query}`;\n  }\n\n  override parseResponse(response: string): ParsedResponse {\n    return {\n      answer: response,\n    };\n  }\n}\n\nfunction createContextDetailsForDrJonesFileAgent(selectedFile: Workspace.UISourceCode.UISourceCode):\n    [ContextDetail, ...ContextDetail[]] {\n  return [\n    {\n      title: 'Selected file',\n      text: formatFile(selectedFile),\n    },\n  ];\n}\n\nfunction formatFile(selectedFile: Workspace.UISourceCode.UISourceCode): string {\n  return `File Name: ${selectedFile.displayName()}\nURL: ${selectedFile.url()}\nFile Content:\n${selectedFile.content().slice(0, MAX_FILE_SIZE)}`;\n}\n\nfunction setDebugFreestylerEnabled(enabled: boolean): void {\n  if (enabled) {\n    localStorage.setItem('debugFreestylerEnabled', 'true');\n  } else {\n    localStorage.removeItem('debugFreestylerEnabled');\n  }\n}\n\n// @ts-ignore\nglobalThis.setDebugFreestylerEnabled = setDebugFreestylerEnabled;\n"]}