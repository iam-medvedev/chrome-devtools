{"version":3,"file":"ChangeManager.test.js","sourceRoot":"","sources":["../../../../../../front_end/panels/freestyler/ChangeManager.test.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright 2024 The Chromium Authors. All rights reserved.\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport * as SDK from '../../core/sdk/sdk.js';\nimport type * as Protocol from '../../generated/protocol.js';\n\nimport * as Freestyler from './freestyler.js';\n\ndescribe('ChangeManager', () => {\n  const styleSheetId = '1' as Protocol.CSS.StyleSheetId;\n  const frameId = '1' as Protocol.Page.FrameId;\n\n  function createModel() {\n    const cssModel = sinon.createStubInstance(SDK.CSSModel.CSSModel, {\n      // @ts-expect-error stub types\n      createInspectorStylesheet: sinon.stub().callsFake(() => {\n        return new SDK.CSSStyleSheetHeader.CSSStyleSheetHeader(cssModel, {\n          styleSheetId,\n          frameId,\n          sourceURL: '',\n          origin: 'inspector' as Protocol.CSS.StyleSheetOrigin,\n          title: 'style.css',\n          disabled: false,\n          isInline: false,\n          isMutable: false,\n          isConstructed: false,\n          startLine: 0,\n          startColumn: 0,\n          length: 10,\n          endLine: 1,\n          endColumn: 8,\n        });\n      }),\n    });\n\n    return cssModel;\n  }\n\n  it('can register a change', async () => {\n    const changeManager = new Freestyler.ChangeManager();\n    const cssModel = createModel();\n    await changeManager.addChange(cssModel, frameId, {\n      selector: 'div',\n      className: 'ai-assistant-change-1',\n      styles: {\n        color: 'blue',\n      },\n    });\n    assert(cssModel.setStyleSheetText.calledOnce);\n    assert.deepStrictEqual(cssModel.setStyleSheetText.args, [\n      [styleSheetId, '.ai-assistant-change-1 {\\n  div& {\\n    color: blue;\\n  }\\n}', true],\n    ]);\n  });\n\n  it('can merge multiple changes with same className', async () => {\n    const changeManager = new Freestyler.ChangeManager();\n    const cssModel = createModel();\n    await changeManager.addChange(cssModel, frameId, {\n      selector: 'div',\n      className: 'ai-assistant-change-1',\n      styles: {\n        color: 'blue',\n      },\n    });\n    await changeManager.addChange(cssModel, frameId, {\n      selector: 'span',\n      className: 'ai-assistant-change-1',\n      styles: {\n        color: 'green',\n      },\n    });\n    assert(cssModel.setStyleSheetText.calledTwice);\n    assert.deepStrictEqual(cssModel.setStyleSheetText.args, [\n      [styleSheetId, '.ai-assistant-change-1 {\\n  div& {\\n    color: blue;\\n  }\\n}', true],\n      [styleSheetId, '.ai-assistant-change-1 {\\n  div& {\\n    color: green;\\n  }\\n}', true],\n    ]);\n  });\n\n  it('can register multiple changes with the same selector', async () => {\n    const changeManager = new Freestyler.ChangeManager();\n    const cssModel = createModel();\n    await changeManager.addChange(cssModel, frameId, {\n      selector: 'div',\n      className: 'ai-assistant-change-1',\n      styles: {\n        color: 'blue',\n      },\n    });\n    await changeManager.addChange(cssModel, frameId, {\n      selector: 'div',\n      className: 'ai-assistant-change-1',\n      styles: {\n        color: 'green',\n      },\n    });\n    assert(cssModel.setStyleSheetText.calledTwice);\n    assert.deepStrictEqual(cssModel.setStyleSheetText.args, [\n      [styleSheetId, '.ai-assistant-change-1 {\\n  div& {\\n    color: blue;\\n  }\\n}', true],\n      [styleSheetId, '.ai-assistant-change-1 {\\n  div& {\\n    color: green;\\n  }\\n}', true],\n    ]);\n  });\n\n  it('can clear changes', async () => {\n    const changeManager = new Freestyler.ChangeManager();\n    const cssModel = createModel();\n    await changeManager.addChange(cssModel, frameId, {\n      selector: 'div',\n      className: 'ai-assistant-change-1',\n      styles: {\n        color: 'blue',\n      },\n    });\n    assert(cssModel.setStyleSheetText.calledOnce);\n    assert.deepStrictEqual(cssModel.setStyleSheetText.args, [\n      [styleSheetId, '.ai-assistant-change-1 {\\n  div& {\\n    color: blue;\\n  }\\n}', true],\n    ]);\n    await changeManager.clear();\n    await changeManager.addChange(cssModel, frameId, {\n      selector: 'body',\n      className: 'ai-assistant-change-1',\n      styles: {\n        color: 'green',\n      },\n    });\n    assert(cssModel.setStyleSheetText.calledTwice);\n    assert.deepStrictEqual(cssModel.setStyleSheetText.args, [\n      [styleSheetId, '.ai-assistant-change-1 {\\n  div& {\\n    color: blue;\\n  }\\n}', true],  // before clear().\n      [styleSheetId, '.ai-assistant-change-1 {\\n  body& {\\n    color: green;\\n  }\\n}', true],\n    ]);\n  });\n});\n"]}