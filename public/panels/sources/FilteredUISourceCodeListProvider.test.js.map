{"version":3,"file":"FilteredUISourceCodeListProvider.test.js","sourceRoot":"","sources":["../../../../../../front_end/panels/sources/FilteredUISourceCodeListProvider.test.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright 2023 The Chromium Authors\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport * as Common from '../../core/common/common.js';\nimport * as Platform from '../../core/platform/platform.js';\nimport * as Root from '../../core/root/root.js';\nimport * as Workspace from '../../models/workspace/workspace.js';\nimport {describeWithEnvironment} from '../../testing/EnvironmentHelpers.js';\nimport {setUpEnvironment} from '../../testing/OverridesHelpers.js';\nimport {createContentProviderUISourceCodes} from '../../testing/UISourceCodeHelpers.js';\nimport {render, type TemplateResult} from '../../ui/lit/lit.js';\n\nimport * as Sources from './sources.js';\n\nconst {urlString} = Platform.DevToolsPath;\n\nconst setUpEnvironmentWithUISourceCode =\n    (url: string, resourceType: Common.ResourceType.ResourceType, project?: Workspace.Workspace.Project) => {\n      const {workspace} = setUpEnvironment();\n      Workspace.IgnoreListManager.IgnoreListManager.instance({forceNew: false});\n\n      if (!project) {\n        project = {id: () => url, type: () => Workspace.Workspace.projectTypes.Network} as Workspace.Workspace.Project;\n      }\n\n      const uiSourceCode = new Workspace.UISourceCode.UISourceCode(project, urlString`${url}`, resourceType);\n\n      project.uiSourceCodes = () => [uiSourceCode];\n\n      workspace.addProject(project);\n\n      return {workspace, project, uiSourceCode};\n    };\n\ndescribeWithEnvironment('FilteredUISourceCodeListProvider', () => {\n  before(() => {\n    Root.Runtime.experiments.register(Root.ExperimentNames.ExperimentName.JUST_MY_CODE, '');\n  });\n\n  it('should exclude Fetch requests in the result', () => {\n    const url = 'http://www.example.com/list-fetch.json';\n    const resourceType = Common.ResourceType.resourceTypes.Fetch;\n\n    const {workspace, project} = setUpEnvironmentWithUISourceCode(url, resourceType);\n\n    const filteredUISourceCodeListProvider =\n        new Sources.FilteredUISourceCodeListProvider.FilteredUISourceCodeListProvider('test');\n    filteredUISourceCodeListProvider.attach();\n\n    const result = filteredUISourceCodeListProvider.itemCount();\n\n    workspace.removeProject(project);\n\n    assert.strictEqual(result, 0);\n  });\n\n  it('should exclude XHR requests in the result', () => {\n    const url = 'http://www.example.com/list-xhr.json';\n    const resourceType = Common.ResourceType.resourceTypes.XHR;\n\n    const {workspace, project} = setUpEnvironmentWithUISourceCode(url, resourceType);\n\n    const filteredUISourceCodeListProvider =\n        new Sources.FilteredUISourceCodeListProvider.FilteredUISourceCodeListProvider('test');\n    filteredUISourceCodeListProvider.attach();\n\n    const result = filteredUISourceCodeListProvider.itemCount();\n\n    workspace.removeProject(project);\n\n    assert.strictEqual(result, 0);\n  });\n\n  it('should include Document requests in the result', () => {\n    const url = 'http://www.example.com/index.html';\n    const resourceType = Common.ResourceType.resourceTypes.Document;\n\n    const {workspace, project} = setUpEnvironmentWithUISourceCode(url, resourceType);\n\n    const filteredUISourceCodeListProvider =\n        new Sources.FilteredUISourceCodeListProvider.FilteredUISourceCodeListProvider('test');\n    filteredUISourceCodeListProvider.attach();\n\n    const resultUrl = filteredUISourceCodeListProvider.itemKeyAt(0);\n    const resultCount = filteredUISourceCodeListProvider.itemCount();\n\n    workspace.removeProject(project);\n\n    assert.strictEqual(resultUrl, url);\n    assert.strictEqual(resultCount, 1);\n  });\n\n  it('should exclude ignored script requests in the result', () => {\n    const url = 'http://www.example.com/some-script.js';\n    const resourceType = Common.ResourceType.resourceTypes.Script;\n\n    const {workspace, project, uiSourceCode} = setUpEnvironmentWithUISourceCode(url, resourceType);\n\n    // ignore the uiSourceCode\n    Root.Runtime.experiments.setEnabled(Root.ExperimentNames.ExperimentName.JUST_MY_CODE, true);\n    Workspace.IgnoreListManager.IgnoreListManager.instance().ignoreListUISourceCode(uiSourceCode);\n\n    const filteredUISourceCodeListProvider =\n        new Sources.FilteredUISourceCodeListProvider.FilteredUISourceCodeListProvider('test');\n    filteredUISourceCodeListProvider.attach();\n\n    const result = filteredUISourceCodeListProvider.itemCount();\n\n    workspace.removeProject(project);\n    Root.Runtime.experiments.setEnabled(Root.ExperimentNames.ExperimentName.JUST_MY_CODE, false);\n\n    assert.strictEqual(result, 0);\n  });\n\n  it('should include Image requests in the result', () => {\n    const url = 'http://www.example.com/img.png';\n    const resourceType = Common.ResourceType.resourceTypes.Image;\n\n    const {workspace, project} = setUpEnvironmentWithUISourceCode(url, resourceType);\n\n    const filteredUISourceCodeListProvider =\n        new Sources.FilteredUISourceCodeListProvider.FilteredUISourceCodeListProvider('test');\n    filteredUISourceCodeListProvider.attach();\n\n    const resultUrl = filteredUISourceCodeListProvider.itemKeyAt(0);\n    const resultCount = filteredUISourceCodeListProvider.itemCount();\n\n    workspace.removeProject(project);\n\n    assert.strictEqual(resultCount, 1);\n    assert.strictEqual(resultUrl, url);\n  });\n\n  it('should include Script requests in the result', () => {\n    const url = 'http://www.example.com/some-script.js';\n    const resourceType = Common.ResourceType.resourceTypes.Script;\n\n    const {workspace, project} = setUpEnvironmentWithUISourceCode(url, resourceType);\n\n    const filteredUISourceCodeListProvider =\n        new Sources.FilteredUISourceCodeListProvider.FilteredUISourceCodeListProvider('test');\n    filteredUISourceCodeListProvider.attach();\n\n    const resultUrl = filteredUISourceCodeListProvider.itemKeyAt(0);\n    const resultCount = filteredUISourceCodeListProvider.itemCount();\n\n    workspace.removeProject(project);\n\n    assert.strictEqual(resultCount, 1);\n    assert.strictEqual(resultUrl, url);\n  });\n\n  describe('renderItem', () => {\n    const url1 = urlString`http://test/helloWorld12.js`;\n    const url2 =\n        urlString`http://test/some/very-long-url/which/usually/breaks-rendering/due-to/trancation/so/that/the-path-is-cut-appropriately/and-no-horizontal-scrollbars/are-shown.js`;\n    let provider: Sources.FilteredUISourceCodeListProvider.FilteredUISourceCodeListProvider;\n    let itemIndex1: number;\n    let itemIndex2: number;\n\n    function getHighlightedText(h: HTMLElement): string {\n      let text = '';\n      for (const node of h.childNodes) {\n        if (node instanceof HTMLElement) {\n          if (node.classList.contains('highlight')) {\n            text += `[${node.deepInnerText()}]`;\n          } else {\n            text += getHighlightedText(node);\n          }\n        } else {\n          text += node.deepInnerText();\n        }\n      }\n      return text;\n    }\n\n    async function getRenderedText(template: TemplateResult): Promise<{title: string, subtitle: string}> {\n      const container = document.createElement('div');\n      render(template, container);\n      await new Promise<void>(resolve => queueMicrotask(resolve));\n      const titleHighlight = container.querySelector<HTMLElement>('devtools-highlight.filtered-ui-source-code-title');\n      const subtitleHighlight =\n          container.querySelector<HTMLElement>('devtools-highlight.filtered-ui-source-code-subtitle');\n      assert.isNotNull(titleHighlight);\n      assert.isNotNull(subtitleHighlight);\n\n      const title = getHighlightedText(titleHighlight);\n      const subtitle = getHighlightedText(subtitleHighlight);\n      return {title, subtitle};\n    }\n\n    beforeEach(() => {\n      createContentProviderUISourceCodes(\n          {items: [{url: url1, mimeType: 'text/javascript'}, {url: url2, mimeType: 'text/javascript'}]});\n\n      provider = new Sources.FilteredUISourceCodeListProvider.FilteredUISourceCodeListProvider('test');\n      provider.attach();\n\n      assert.strictEqual(provider.itemCount(), 2, 'Provider should have two items');\n\n      if (provider.itemKeyAt(0) === url1) {\n        itemIndex1 = 0;\n        itemIndex2 = 1;\n      } else {\n        itemIndex1 = 1;\n        itemIndex2 = 0;\n      }\n    });\n\n    it('renders correct highlight for query \"12\"', async () => {\n      const query = '12';\n      const {title, subtitle} = await getRenderedText(provider.renderItem(itemIndex1, query));\n      assert.strictEqual(title, 'helloWorld[12].js');\n      assert.strictEqual(subtitle, 'test/');\n    });\n\n    it('renders correct highlight for query \"te12\"', async () => {\n      const query = 'te12';\n      const {title, subtitle} = await getRenderedText(provider.renderItem(itemIndex1, query));\n      // This could be helloWorld[12].js, but current implementation doesn't support it.\n      assert.strictEqual(title, 'helloWorld12.js');\n      assert.strictEqual(subtitle, '[te]st/');\n    });\n\n    it('renders correct highlight for query \"shown.js\"', async () => {\n      const query = 'shown.js';\n      const {title} = await getRenderedText(provider.renderItem(itemIndex2, query));\n      assert.strictEqual(title, 'are-[shown.js]');\n    });\n\n    it('renders correct highlight for query \"usually-shown.js\"', async () => {\n      const query = 'usually-shown.js';\n      const {title, subtitle} = await getRenderedText(provider.renderItem(itemIndex2, query));\n      // This could be are-[shown.js], but current implementation doesn't support it.\n      assert.strictEqual(title, 'are-shown.js');\n      assert.include(subtitle, '[usually]');\n    });\n  });\n});\n"]}