{"version":3,"file":"GoToLineQuickOpen.js","sourceRoot":"","sources":["../../../../../../front_end/panels/sources/GoToLineQuickOpen.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright 2016 The Chromium Authors. All rights reserved.\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport * as i18n from '../../core/i18n/i18n.js';\nimport * as IconButton from '../../ui/components/icon_button/icon_button.js';\nimport * as QuickOpen from '../../ui/legacy/components/quick_open/quick_open.js';\nimport * as UI from '../../ui/legacy/legacy.js';\n\nimport {SourcesView} from './SourcesView.js';\nimport type {UISourceCodeFrame} from './UISourceCodeFrame.js';\n\nconst UIStrings = {\n  /**\n   *@description Text in Go To Line Quick Open of the Sources panel\n   */\n  noFileSelected: 'No file selected',\n  /**\n   *@description Text to show no results have been found\n   */\n  noResultsFound: 'No results found',\n  /**\n   *@description Text in Go To Line Quick Open of the Sources panel\n   */\n  typeANumberToGoToThatLine: 'Type a number to go to that line',\n  /**\n   *@description Text in Go To Line Quick Open of the Sources panel\n   *@example {000} PH1\n   *@example {bbb} PH2\n   */\n  currentPositionXsTypeAnOffset: 'Type an offset between 0x{PH1} and 0x{PH2} to navigate to',\n  /**\n   *@description Text in the GoToLine dialog of the Sources pane that describes the current line number, file line number range, and use of the GoToLine dialog\n   *@example {100} PH1\n   */\n  currentLineSTypeALineNumber: 'Type a line number between 1 and {PH1} to navigate to',\n  /**\n   *@description Text in Go To Line Quick Open of the Sources panel\n   *@example {abc} PH1\n   */\n  goToOffsetXs: 'Go to offset 0x{PH1}',\n  /**\n   *@description Text in Go To Line Quick Open of the Sources panel\n   *@example {2} PH1\n   *@example {2} PH2\n   */\n  goToLineSAndColumnS: 'Go to line {PH1} and column {PH2}',\n  /**\n   *@description Text in Go To Line Quick Open of the Sources panel\n   *@example {2} PH1\n   */\n  goToLineS: 'Go to line {PH1}',\n} as const;\nconst str_ = i18n.i18n.registerUIStrings('panels/sources/GoToLineQuickOpen.ts', UIStrings);\nconst i18nString = i18n.i18n.getLocalizedString.bind(undefined, str_);\n\nexport class GoToLineQuickOpen extends QuickOpen.FilteredListWidget.Provider {\n  #goToLineStrings: string[] = [];\n\n  constructor() {\n    super('source-line');\n  }\n\n  override selectItem(_itemIndex: number|null, promptValue: string): void {\n    const sourceFrame = this.currentSourceFrame();\n    if (!sourceFrame) {\n      return;\n    }\n    const position = this.parsePosition(promptValue);\n    if (!position) {\n      return;\n    }\n    sourceFrame.revealPosition({lineNumber: position.line - 1, columnNumber: position.column - 1});\n  }\n\n  override itemCount(): number {\n    return this.#goToLineStrings.length;\n  }\n\n  override renderItem(itemIndex: number, _query: string, titleElement: Element, _subtitleElement: Element): void {\n    const icon = IconButton.Icon.create('colon');\n    titleElement.parentElement?.parentElement?.insertBefore(icon, titleElement.parentElement);\n    UI.UIUtils.createTextChild(titleElement, this.#goToLineStrings[itemIndex]);\n  }\n\n  override rewriteQuery(_query: string): string {\n    // For Go to Line Quick Open, we don't need to filter any item, set query to empty string, so the filter regex matching will be skipped\n    return '';\n  }\n\n  override queryChanged(query: string): void {\n    this.#goToLineStrings = [];\n    const position = this.parsePosition(query);\n    const sourceFrame = this.currentSourceFrame();\n    if (!position) {\n      if (!sourceFrame) {\n        this.#goToLineStrings.push(i18nString(UIStrings.typeANumberToGoToThatLine));\n        return;\n      }\n      const editorState = sourceFrame.textEditor.state;\n      const disassembly = sourceFrame.wasmDisassembly;\n      if (disassembly) {\n        const lastBytecodeOffset = disassembly.lineNumberToBytecodeOffset(disassembly.lineNumbers - 1);\n        const bytecodeOffsetDigits = lastBytecodeOffset.toString(16).length;\n        this.#goToLineStrings.push(i18nString(UIStrings.currentPositionXsTypeAnOffset, {\n          PH1: '0'.padStart(bytecodeOffsetDigits, '0'),\n          PH2: lastBytecodeOffset.toString(16),\n        }));\n        return;\n      }\n      const linesCount = sourceFrame.editorLocationToUILocation(editorState.doc.lines - 1).lineNumber + 1;\n      this.#goToLineStrings.push(i18nString(UIStrings.currentLineSTypeALineNumber, {PH1: linesCount}));\n      return;\n    }\n\n    if (sourceFrame?.wasmDisassembly) {\n      this.#goToLineStrings.push(i18nString(UIStrings.goToOffsetXs, {PH1: (position.column - 1).toString(16)}));\n      return;\n    }\n    if (position.column && position.column > 1) {\n      this.#goToLineStrings.push(i18nString(UIStrings.goToLineSAndColumnS, {PH1: position.line, PH2: position.column}));\n      return;\n    }\n    if (sourceFrame && position.line > sourceFrame.textEditor.state.doc.lines) {\n      return;\n    }\n    this.#goToLineStrings.push(i18nString(UIStrings.goToLineS, {PH1: position.line}));\n  }\n\n  override notFoundText(_query: string): string {\n    if (!this.currentSourceFrame()) {\n      return i18nString(UIStrings.noFileSelected);\n    }\n    return i18nString(UIStrings.noResultsFound);\n  }\n\n  private parsePosition(query: string): {\n    line: number,\n    column: number,\n  }|null {\n    const sourceFrame = this.currentSourceFrame();\n    if (sourceFrame?.wasmDisassembly) {\n      const parts = query.match(/0x([0-9a-fA-F]+)/);\n      if (!parts?.[0] || parts[0].length !== query.length) {\n        return null;\n      }\n\n      const column = parseInt(parts[0], 16) + 1;\n      return {line: 0, column};\n    }\n\n    const parts = query.match(/([0-9]+)(\\:[0-9]*)?/);\n    if (!parts?.[0] || parts[0].length !== query.length) {\n      return null;\n    }\n    const line = parseInt(parts[1], 10);\n    let column = 0;\n    if (parts[2]) {\n      column = parseInt(parts[2].substring(1), 10);\n    }\n    return {line: Math.max(line | 0, 1), column: Math.max(column | 0, 1)};\n  }\n\n  private currentSourceFrame(): UISourceCodeFrame|null {\n    const sourcesView = UI.Context.Context.instance().flavor(SourcesView);\n    if (!sourcesView) {\n      return null;\n    }\n    return sourcesView.currentSourceFrame();\n  }\n}\n"]}