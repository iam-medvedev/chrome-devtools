{"version":3,"file":"CoveragePlugin.test.js","sourceRoot":"","sources":["../../../../../../front_end/panels/sources/CoveragePlugin.test.ts"],"names":[],"mappings":"AAAA,4DAA4D;AAC5D,yEAAyE;AACzE,6BAA6B;AAG7B,OAAO,KAAK,GAAG,MAAM,uBAAuB,CAAC;AAC7C,OAAO,KAAK,QAAQ,MAAM,mCAAmC,CAAC;AAC9D,OAAO,KAAK,SAAS,MAAM,qCAAqC,CAAC;AACjE,OAAO,EAAC,YAAY,EAAC,MAAM,qCAAqC,CAAC;AACjE,OAAO,EAAC,0BAA0B,EAAC,MAAM,iCAAiC,CAAC;AAC3E,OAAO,EAAC,iCAAiC,EAAC,MAAM,sCAAsC,CAAC;AAEvF,OAAO,KAAK,QAAQ,MAAM,yBAAyB,CAAC;AAEpD,OAAO,KAAK,OAAO,MAAM,cAAc,CAAC;AAExC,0BAA0B,CAAC,gBAAgB,EAAE,GAAG,EAAE;IAChD,MAAM,KAAK,GAAG,CAAC,aAAsC,EAAE,EAAE;QACvD,IAAI,MAAyB,CAAC;QAC9B,IAAI,YAAiD,CAAC;QACtD,IAAI,KAA2C,CAAC;QAChD,IAAI,YAAoD,CAAC;QACzD,MAAM,GAAG,GAAG,SAA4C,CAAC;QAEzD,UAAU,CAAC,GAAG,EAAE;YACd,MAAM,GAAG,aAAa,EAAE,CAAC;YACzB,MAAM,SAAS,GAAG,SAAS,CAAC,SAAS,CAAC,aAAa,CAAC,QAAQ,EAAE,CAAC;YAC/D,MAAM,aAAa,GAAG,GAAG,CAAC,aAAa,CAAC,aAAa,CAAC,QAAQ,EAAE,CAAC;YACjE,MAAM,eAAe,GAAG,IAAI,QAAQ,CAAC,eAAe,CAAC,eAAe,CAAC,aAAa,EAAE,SAAS,CAAC,CAAC;YAC/F,QAAQ,CAAC,wBAAwB,CAAC,wBAAwB,CAAC,QAAQ,CAAC;gBAClE,QAAQ,EAAE,IAAI;gBACd,eAAe;gBACf,aAAa;aACd,CAAC,CAAC;YACH,QAAQ,CAAC,mBAAmB,CAAC,mBAAmB,CAAC,QAAQ,CAAC;gBACxD,QAAQ,EAAE,IAAI;gBACd,eAAe;gBACf,aAAa;aACd,CAAC,CAAC;YAEH,KAAK,GAAG,MAAM,CAAC,KAAK,CAAC,QAAQ,CAAC,aAAa,CAAC,aAAa,CAAyC,CAAC;YACnG,YAAY,GAAG,IAAI,QAAQ,CAAC,aAAa,CAAC,eAAe,CAAC,GAAG,CAAC,CAAC;YAC/D,YAAY,CAAC,UAAU,CAAC,CAAC,EAAE,EAAE,CAAC,CAAC;YAC/B,KAAK,CAAC,IAAI,CAAC,KAAK,EAAE,mBAAmB,CAAC,CAAC,QAAQ,CAAC,GAAG,CAAC,CAAC,OAAO,CAAC,YAAY,CAAC,CAAC;YAC3E,CAAC,EAAC,YAAY,EAAC,GAAG,iCAAiC,CAAC,EAAC,GAAG,EAAE,GAAG,EAAE,QAAQ,EAAE,iBAAiB,EAAC,CAAC,CAAC,CAAC;QAChG,CAAC,CAAC,CAAC;QAEH,EAAE,CAAC,aAAa,EAAE,KAAK,IAAI,EAAE;YAC3B,MAAM,cAAc,GAChB,IAAI,OAAO,CAAC,cAAc,CAAC,cAAc,CAAC,YAAY,EAAuC,EAAE,CAAC,CAAC;YACrG,MAAM,CAAC,WAAW,CAAC,GAAG,cAAc,CAAC,iBAAiB,EAAE,CAAC;YACzD,MAAM,CAAC,WAAW,CAAC,cAAc,EAAE,WAAW,CAAC,OAAO,CAAC,KAAK,CAAC,CAAC;YAC9D,MAAM,CAAC,WAAW,CACd,iBAAiB,EAAE,WAAW,CAAC,OAAO,CAAC,aAAa,CAAC,4BAA4B,CAAC,EAAE,WAAW,CAAC,CAAC;QACvG,CAAC,CAAC,CAAC;QAEH,EAAE,CAAC,eAAe,EAAE,KAAK,IAAI,EAAE;YAC7B,MAAM,cAAc,GAChB,IAAI,OAAO,CAAC,cAAc,CAAC,cAAc,CAAC,YAAY,EAAuC,EAAE,CAAC,CAAC;YACrG,MAAM,CAAC,WAAW,CAAC,GAAG,cAAc,CAAC,iBAAiB,EAAE,CAAC;YACzD,MAAM,CAAC,WAAW,CACd,iBAAiB,EAAE,WAAW,CAAC,OAAO,CAAC,aAAa,CAAC,4BAA4B,CAAC,EAAE,WAAW,CAAC,CAAC;YAErG,YAAY,CAAC,UAAU,CAAC,EAAE,EAAE,CAAC,CAAC,CAAC;YAC/B,MAAM,CAAC,WAAW,CACd,iBAAiB,EAAE,WAAW,CAAC,OAAO,CAAC,aAAa,CAAC,4BAA4B,CAAC,EAAE,WAAW,CAAC,CAAC;QACvG,CAAC,CAAC,CAAC;QAEH,EAAE,CAAC,cAAc,EAAE,KAAK,IAAI,EAAE;YAC5B,MAAM,cAAc,GAChB,IAAI,OAAO,CAAC,cAAc,CAAC,cAAc,CAAC,YAAY,EAAuC,EAAE,CAAC,CAAC;YACrG,MAAM,CAAC,WAAW,CAAC,GAAG,cAAc,CAAC,iBAAiB,EAAE,CAAC;YACzD,MAAM,CAAC,WAAW,CACd,iBAAiB,EAAE,WAAW,CAAC,OAAO,CAAC,aAAa,CAAC,4BAA4B,CAAC,EAAE,WAAW,CAAC,CAAC;YAErG,KAAK,CAAC,wBAAwB,CAAC,QAAQ,CAAC,aAAa,CAAC,MAAM,CAAC,aAAa,CAAC,CAAC;YAC5E,MAAM,CAAC,WAAW,CAAC,8BAA8B,EAAE,WAAW,CAAC,OAAO,CAAC,KAAK,CAAC,CAAC;YAC9E,MAAM,CAAC,WAAW,CAAC,eAAe,EAAE,WAAW,CAAC,OAAO,CAAC,aAAa,CAAC,4BAA4B,CAAC,EAAE,WAAW,CAAC,CAAC;QACpH,CAAC,CAAC,CAAC;IACL,CAAC,CAAC;IACF,QAAQ,CAAC,mBAAmB,EAAE,GAAG,EAAE,CAAC,KAAK,CAAC,GAAG,EAAE,CAAC,YAAY,EAAE,CAAC,CAAC,CAAC;IACjE,QAAQ,CAAC,gBAAgB,EAAE,GAAG,EAAE,CAAC,KAAK,CAAC,GAAG,EAAE;QACf,MAAM,SAAS,GAAG,YAAY,CAAC,EAAC,IAAI,EAAE,GAAG,CAAC,MAAM,CAAC,IAAI,CAAC,GAAG,EAAC,CAAC,CAAC;QAC5D,YAAY,CAAC,EAAC,YAAY,EAAE,SAAS,EAAE,OAAO,EAAE,WAAW,EAAC,CAAC,CAAC;QAC9D,OAAO,YAAY,CAAC,EAAC,YAAY,EAAE,SAAS,EAAC,CAAC,CAAC;IACjD,CAAC,CAAC,CAAC,CAAC;AACjC,CAAC,CAAC,CAAC","sourcesContent":["// Copyright 2022 The Chromium Authors. All rights reserved.\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport type * as Platform from '../../core/platform/platform.js';\nimport * as SDK from '../../core/sdk/sdk.js';\nimport * as Bindings from '../../models/bindings/bindings.js';\nimport * as Workspace from '../../models/workspace/workspace.js';\nimport {createTarget} from '../../testing/EnvironmentHelpers.js';\nimport {describeWithMockConnection} from '../../testing/MockConnection.js';\nimport {createContentProviderUISourceCode} from '../../testing/UISourceCodeHelpers.js';\nimport type * as SourceFrame from '../../ui/legacy/components/source_frame/source_frame.js';\nimport * as Coverage from '../coverage/coverage.js';\n\nimport * as Sources from './sources.js';\n\ndescribeWithMockConnection('CoveragePlugin', () => {\n  const tests = (targetFactory: () => SDK.Target.Target) => {\n    let target: SDK.Target.Target;\n    let uiSourceCode: Workspace.UISourceCode.UISourceCode;\n    let model: Coverage.CoverageModel.CoverageModel;\n    let coverageInfo: Coverage.CoverageModel.URLCoverageInfo;\n    const URL = 'test.js' as Platform.DevToolsPath.UrlString;\n\n    beforeEach(() => {\n      target = targetFactory();\n      const workspace = Workspace.Workspace.WorkspaceImpl.instance();\n      const targetManager = SDK.TargetManager.TargetManager.instance();\n      const resourceMapping = new Bindings.ResourceMapping.ResourceMapping(targetManager, workspace);\n      Bindings.DebuggerWorkspaceBinding.DebuggerWorkspaceBinding.instance({\n        forceNew: true,\n        resourceMapping,\n        targetManager,\n      });\n      Bindings.CSSWorkspaceBinding.CSSWorkspaceBinding.instance({\n        forceNew: true,\n        resourceMapping,\n        targetManager,\n      });\n\n      model = target.model(Coverage.CoverageModel.CoverageModel) as Coverage.CoverageModel.CoverageModel;\n      coverageInfo = new Coverage.CoverageModel.URLCoverageInfo(URL);\n      coverageInfo.addToSizes(9, 28);\n      sinon.stub(model, 'getCoverageForUrl').withArgs(URL).returns(coverageInfo);\n      ({uiSourceCode} = createContentProviderUISourceCode({url: URL, mimeType: 'text/javascript'}));\n    });\n\n    it('shows stats', async () => {\n      const coveragePlugin =\n          new Sources.CoveragePlugin.CoveragePlugin(uiSourceCode, <SourceFrame.SourceFrame.Transformer>{});\n      const [toolbarItem] = coveragePlugin.rightToolbarItems();\n      assert.strictEqual('Show Details', toolbarItem.element.title);\n      assert.strictEqual(\n          'Coverage: 32.1%', toolbarItem.element.querySelector('.toolbar-text:not(.hidden)')?.textContent);\n    });\n\n    it('updates stats', async () => {\n      const coveragePlugin =\n          new Sources.CoveragePlugin.CoveragePlugin(uiSourceCode, <SourceFrame.SourceFrame.Transformer>{});\n      const [toolbarItem] = coveragePlugin.rightToolbarItems();\n      assert.strictEqual(\n          'Coverage: 32.1%', toolbarItem.element.querySelector('.toolbar-text:not(.hidden)')?.textContent);\n\n      coverageInfo.addToSizes(10, 2);\n      assert.strictEqual(\n          'Coverage: 63.3%', toolbarItem.element.querySelector('.toolbar-text:not(.hidden)')?.textContent);\n    });\n\n    it('resets stats', async () => {\n      const coveragePlugin =\n          new Sources.CoveragePlugin.CoveragePlugin(uiSourceCode, <SourceFrame.SourceFrame.Transformer>{});\n      const [toolbarItem] = coveragePlugin.rightToolbarItems();\n      assert.strictEqual(\n          'Coverage: 32.1%', toolbarItem.element.querySelector('.toolbar-text:not(.hidden)')?.textContent);\n\n      model.dispatchEventToListeners(Coverage.CoverageModel.Events.CoverageReset);\n      assert.strictEqual('Click to show Coverage Panel', toolbarItem.element.title);\n      assert.strictEqual('Coverage: n/a', toolbarItem.element.querySelector('.toolbar-text:not(.hidden)')?.textContent);\n    });\n  };\n  describe('without tab taget', () => tests(() => createTarget()));\n  describe('with tab taget', () => tests(() => {\n                               const tabTarget = createTarget({type: SDK.Target.Type.Tab});\n                               createTarget({parentTarget: tabTarget, subtype: 'prerender'});\n                               return createTarget({parentTarget: tabTarget});\n                             }));\n});\n"]}