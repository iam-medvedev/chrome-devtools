{"version":3,"file":"SourcesPanel.test.js","sourceRoot":"","sources":["../../../../../../front_end/panels/sources/SourcesPanel.test.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright 2025 The Chromium Authors\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport * as Common from '../../core/common/common.js';\nimport type * as Platform from '../../core/platform/platform.js';\nimport * as SDK from '../../core/sdk/sdk.js';\nimport * as Bindings from '../../models/bindings/bindings.js';\nimport * as Breakpoints from '../../models/breakpoints/breakpoints.js';\nimport * as Persistence from '../../models/persistence/persistence.js';\nimport * as Workspace from '../../models/workspace/workspace.js';\nimport {\n  describeWithEnvironment,\n  registerActions,\n  registerNoopActions,\n  updateHostConfig\n} from '../../testing/EnvironmentHelpers.js';\nimport * as UI from '../../ui/legacy/legacy.js';\n\nimport * as Sources from './sources.js';\n\ndescribeWithEnvironment('SourcesPanel', () => {\n  function setUpEnvironment() {\n    const workspace = Workspace.Workspace.WorkspaceImpl.instance({forceNew: true});\n    const debuggerWorkspaceBinding = Bindings.DebuggerWorkspaceBinding.DebuggerWorkspaceBinding.instance({\n      forceNew: true,\n      targetManager: SDK.TargetManager.TargetManager.instance(),\n      resourceMapping:\n          new Bindings.ResourceMapping.ResourceMapping(SDK.TargetManager.TargetManager.instance(), workspace),\n      ignoreListManager: Workspace.IgnoreListManager.IgnoreListManager.instance({forceNew: true}),\n    });\n    const breakpointManager = Breakpoints.BreakpointManager.BreakpointManager.instance({\n      forceNew: true,\n      targetManager: SDK.TargetManager.TargetManager.instance(),\n      workspace,\n      debuggerWorkspaceBinding,\n    });\n    Persistence.Persistence.PersistenceImpl.instance({forceNew: true, workspace, breakpointManager});\n    const networkPersistenceManager =\n        sinon.createStubInstance(Persistence.NetworkPersistenceManager.NetworkPersistenceManager);\n    sinon.stub(Persistence.NetworkPersistenceManager.NetworkPersistenceManager, 'instance')\n        .returns(networkPersistenceManager);\n    sinon.stub(UI.ViewManager.ViewManager.instance(), 'view')\n        .callsFake(() => sinon.createStubInstance(UI.View.SimpleView));\n  }\n\n  function createStubUISourceCode() {\n    const uiSourceCode = sinon.createStubInstance(Workspace.UISourceCode.UISourceCode);\n    uiSourceCode.contentType.returns(Common.ResourceType.resourceTypes.Script);\n    const stubProject = sinon.createStubInstance(Bindings.ContentProviderBasedProject.ContentProviderBasedProject);\n    uiSourceCode.project.returns(stubProject);\n    stubProject.isServiceProject.returns(true);\n    return uiSourceCode;\n  }\n\n  it('Shows Debug with Ai menu and submenu items', () => {\n    updateHostConfig({\n      devToolsAiSubmenuPrompts: {\n        enabled: true,\n      },\n    });\n\n    registerNoopActions([\n      'debugger.toggle-pause', 'debugger.step-over', 'debugger.step-into', 'debugger.step-out', 'debugger.step',\n      'debugger.toggle-breakpoints-active'\n    ]);\n    registerActions([{\n      actionId: 'drjones.sources-panel-context',\n      title: () => 'Debug with AI' as Platform.UIString.LocalizedString,\n      category: UI.ActionRegistration.ActionCategory.GLOBAL,\n    }]);\n\n    setUpEnvironment();\n\n    const sources = new Sources.SourcesPanel.SourcesPanel();\n\n    const event = new Event('contextmenu');\n    sinon.stub(event, 'target').value(document);\n    const contextMenu = new UI.ContextMenu.ContextMenu(event);\n\n    const uiSourceCode = createStubUISourceCode();\n    sources.appendApplicableItems(event, contextMenu, uiSourceCode);\n\n    const debugWithAiItem = contextMenu.buildDescriptor().subItems?.find(item => item.label === 'Debug with AI');\n    assert.exists(debugWithAiItem);\n    assert.deepEqual(\n        debugWithAiItem.subItems?.map(item => item.label),\n        ['Start a chat', 'Assess performance', 'Explain this script', 'Explain input handling']);\n  });\n});\n"]}