{"version":3,"file":"ChangesView.js","sourceRoot":"","sources":["../../../../../../front_end/panels/changes/ChangesView.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright 2017 The Chromium Authors\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n/* eslint-disable rulesdir/no-imperative-dom-api */\n\nimport '../../ui/legacy/legacy.js';\n\nimport * as i18n from '../../core/i18n/i18n.js';\nimport type * as Platform from '../../core/platform/platform.js';\nimport type * as Workspace from '../../models/workspace/workspace.js';\nimport * as WorkspaceDiff from '../../models/workspace_diff/workspace_diff.js';\nimport * as UI from '../../ui/legacy/legacy.js';\nimport * as VisualLogging from '../../ui/visual_logging/visual_logging.js';\n\nimport {ChangesSidebar, Events} from './ChangesSidebar.js';\nimport changesViewStyles from './changesView.css.js';\nimport * as CombinedDiffView from './CombinedDiffView.js';\n\nconst CHANGES_VIEW_URL = 'https://developer.chrome.com/docs/devtools/changes' as Platform.DevToolsPath.UrlString;\n\nconst UIStrings = {\n  /**\n   * @description Text in Changes View of the Changes tab if no change has been made so far.\n   */\n  noChanges: 'No changes yet',\n  /**\n   * @description Text in Changes View of the Changes tab to explain the Changes panel.\n   */\n  changesViewDescription: 'On this page you can track code changes made within DevTools.',\n} as const;\nconst str_ = i18n.i18n.registerUIStrings('panels/changes/ChangesView.ts', UIStrings);\nconst i18nString = i18n.i18n.getLocalizedString.bind(undefined, str_);\n\nexport class ChangesView extends UI.Widget.VBox {\n  private emptyWidget: UI.EmptyWidget.EmptyWidget;\n  private readonly workspaceDiff: WorkspaceDiff.WorkspaceDiff.WorkspaceDiffImpl;\n  readonly changesSidebar: ChangesSidebar;\n  private selectedUISourceCode: Workspace.UISourceCode.UISourceCode|null;\n  private readonly diffContainer: HTMLElement;\n  private readonly combinedDiffView: CombinedDiffView.CombinedDiffView;\n\n  constructor() {\n    super({\n      jslog: `${VisualLogging.panel('changes').track({resize: true})}`,\n      useShadowDom: true,\n    });\n    this.registerRequiredCSS(changesViewStyles);\n\n    const splitWidget = new UI.SplitWidget.SplitWidget(true /* vertical */, false /* sidebar on left */);\n    const mainWidget = new UI.Widget.VBox();\n    splitWidget.setMainWidget(mainWidget);\n    splitWidget.show(this.contentElement);\n\n    this.emptyWidget = new UI.EmptyWidget.EmptyWidget('', '');\n    this.emptyWidget.show(mainWidget.element);\n\n    this.workspaceDiff = WorkspaceDiff.WorkspaceDiff.workspaceDiff();\n    this.changesSidebar = new ChangesSidebar(this.workspaceDiff);\n    this.changesSidebar.addEventListener(\n        Events.SELECTED_UI_SOURCE_CODE_CHANGED, this.selectedUISourceCodeChanged, this);\n    splitWidget.setSidebarWidget(this.changesSidebar);\n\n    this.selectedUISourceCode = null;\n\n    this.diffContainer = mainWidget.element.createChild('div', 'diff-container');\n    UI.ARIAUtils.markAsTabpanel(this.diffContainer);\n    this.combinedDiffView = new CombinedDiffView.CombinedDiffView();\n    this.combinedDiffView.workspaceDiff = this.workspaceDiff;\n    this.combinedDiffView.show(this.diffContainer);\n\n    this.hideDiff();\n    this.selectedUISourceCodeChanged();\n  }\n\n  private renderDiffOrEmptyState(): void {\n    // There are modified UI source codes, we should render the combined diff view.\n    if (this.workspaceDiff.modifiedUISourceCodes().length > 0) {\n      this.showDiff();\n    } else {\n      this.hideDiff();\n    }\n  }\n\n  private selectedUISourceCodeChanged(): void {\n    const selectedUISourceCode = this.changesSidebar.selectedUISourceCode();\n    if (!selectedUISourceCode || this.selectedUISourceCode === selectedUISourceCode) {\n      return;\n    }\n\n    this.selectedUISourceCode = selectedUISourceCode;\n    this.combinedDiffView.selectedFileUrl = selectedUISourceCode.url();\n  }\n\n  override wasShown(): void {\n    UI.Context.Context.instance().setFlavor(ChangesView, this);\n    super.wasShown();\n    this.renderDiffOrEmptyState();\n    this.workspaceDiff.addEventListener(\n        WorkspaceDiff.WorkspaceDiff.Events.MODIFIED_STATUS_CHANGED, this.renderDiffOrEmptyState, this);\n  }\n\n  override willHide(): void {\n    super.willHide();\n    UI.Context.Context.instance().setFlavor(ChangesView, null);\n    this.workspaceDiff.removeEventListener(\n        WorkspaceDiff.WorkspaceDiff.Events.MODIFIED_STATUS_CHANGED, this.renderDiffOrEmptyState, this);\n  }\n\n  private hideDiff(): void {\n    this.diffContainer.style.display = 'none';\n    this.emptyWidget.header = i18nString(UIStrings.noChanges);\n    this.emptyWidget.text = i18nString(UIStrings.changesViewDescription);\n\n    this.emptyWidget.link = CHANGES_VIEW_URL;\n    this.emptyWidget.showWidget();\n  }\n\n  private showDiff(): void {\n    this.emptyWidget.hideWidget();\n    this.diffContainer.style.display = 'block';\n  }\n}\n"]}