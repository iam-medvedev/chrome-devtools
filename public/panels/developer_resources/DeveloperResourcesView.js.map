{"version":3,"file":"DeveloperResourcesView.js","sourceRoot":"","sources":["../../../../../../front_end/panels/developer_resources/DeveloperResourcesView.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright (c) 2016 The Chromium Authors. All rights reserved.\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport '../../ui/legacy/legacy.js';\n\nimport type * as Common from '../../core/common/common.js';\nimport * as i18n from '../../core/i18n/i18n.js';\nimport * as Platform from '../../core/platform/platform.js';\nimport * as SDK from '../../core/sdk/sdk.js';\nimport type * as TextUtils from '../../models/text_utils/text_utils.js';\nimport * as UI from '../../ui/legacy/legacy.js';\nimport {html, render} from '../../ui/lit/lit.js';\nimport * as VisualLogging from '../../ui/visual_logging/visual_logging.js';\n\nimport {DeveloperResourcesListView} from './DeveloperResourcesListView.js';\nimport developerResourcesViewStyles from './developerResourcesView.css.js';\n\nconst {widgetConfig} = UI.Widget;\nconst {bindToSetting} = UI.SettingsUI;\n\nconst UIStrings = {\n  /**\n   * @description Placeholder for a search field in a toolbar\n   */\n  filterByText: 'Filter by URL and error',\n  /**\n   * @description Tooltip for a checkbox in the toolbar of the developer resources view. The\n   * inspected target is the webpage that DevTools is debugging/inspecting/attached to.\n   */\n  loadHttpsDeveloperResources:\n      'Load `HTTP(S)` developer resources through the website you inspect, not through DevTools',\n  /**\n   * @description Text for a checkbox in the toolbar of the developer resources view. The target is\n   * the webpage that DevTools is debugging/inspecting/attached to. This setting makes it so\n   * developer resources are requested from the webpage itself, and not from the DevTools\n   * application.\n   */\n  enableLoadingThroughTarget: 'Load through website',\n  /**\n   * @description Text for resources load status\n   * @example {1} PH1\n   * @example {1} PH2\n   */\n  resourcesCurrentlyLoading: '{PH1} resources, {PH2} currently loading',\n  /**\n   * @description Status text that appears to tell the developer how many resources were loaded in\n   * total. Resources are files related to the webpage.\n   */\n  resources: '{n, plural, =1 {# resource} other {# resources}}',\n} as const;\nconst str_ = i18n.i18n.registerUIStrings('panels/developer_resources/DeveloperResourcesView.ts', UIStrings);\nconst i18nString = i18n.i18n.getLocalizedString.bind(undefined, str_);\nexport class DeveloperResourcesRevealer implements Common.Revealer.Revealer<SDK.PageResourceLoader.ResourceKey> {\n  async reveal(resourceInitiatorKey: SDK.PageResourceLoader.ResourceKey): Promise<void> {\n    const loader = SDK.PageResourceLoader.PageResourceLoader.instance();\n    const resource = loader.getResourcesLoaded().get(resourceInitiatorKey.key);\n    if (resource) {\n      await UI.ViewManager.ViewManager.instance().showView('developer-resources');\n      const developerResourcesView =\n          await UI.ViewManager.ViewManager.instance().view('developer-resources').widget() as DeveloperResourcesView;\n      return await developerResourcesView.select(resource);\n    }\n  }\n}\n\ninterface ViewInput {\n  onFilterChanged: (e: CustomEvent<string>) => void;\n  items: Iterable<SDK.PageResourceLoader.PageResource>;\n  selectedItem: SDK.PageResourceLoader.PageResource|null;\n  onSelect: (resource: SDK.PageResourceLoader.PageResource|null) => void;\n  filters: TextUtils.TextUtils.ParsedFilter[];\n  numResources: number;\n  numLoading: number;\n}\n\ntype View = (input: ViewInput, output: object, target: HTMLElement) => void;\n\nexport const DEFAULT_VIEW: View = (input, _output, target) => {\n  // clang-format off\n  render(html`\n    <style>\n      ${developerResourcesViewStyles}\n    </style>\n    <div class=\"vbox flex-auto\" jslog=${VisualLogging.panel('developer-resources').track({resize: true})}>\n      <div class=\"developer-resource-view-toolbar-container\" jslog=${VisualLogging.toolbar()}\n          role=\"toolbar\">\n        <devtools-toolbar class=\"developer-resource-view-toolbar\" role=\"presentation\">\n          <devtools-toolbar-input type=\"filter\" placeholder=${i18nString(UIStrings.filterByText)}\n              @change=${input.onFilterChanged} style=\"flex-grow:1\">\n          </devtools-toolbar-input>\n          <devtools-checkbox\n              title=${i18nString(UIStrings.loadHttpsDeveloperResources)}\n              ${bindToSetting(SDK.PageResourceLoader.getLoadThroughTargetSetting())}>\n            ${i18nString(UIStrings.enableLoadingThroughTarget)}\n          </devtools-checkbox>\n        </devtools-toolbar>\n      </div>\n      <div class=\"developer-resource-view-results\">\n        <devtools-widget\n          .widgetConfig=${widgetConfig(DeveloperResourcesListView, {\n            items: input.items,\n            selectedItem: input.selectedItem,\n            onSelect: input.onSelect,\n            filters: input.filters\n          })}>\n        </devtools-widget>\n      </div>\n      <div class=\"developer-resource-view-toolbar-summary\">\n        <div class=\"developer-resource-view-message\">\n          ${input.numLoading > 0 ?\n              i18nString(UIStrings.resourcesCurrentlyLoading, {PH1: input.numResources, PH2: input.numLoading}) :\n              i18nString(UIStrings.resources, {n: input.numResources})}\n         </div>\n      </div>\n    </div>`, target);\n  // clang-format on\n};\n\nexport class DeveloperResourcesView extends UI.ThrottledWidget.ThrottledWidget {\n  readonly #loader: SDK.PageResourceLoader.PageResourceLoader;\n  readonly #view: View;\n  #selectedItem: SDK.PageResourceLoader.PageResource|null = null;\n  #filters: TextUtils.TextUtils.ParsedFilter[] = [];\n\n  constructor(view: View = DEFAULT_VIEW) {\n    super(true);\n    this.#view = view;\n\n    this.#loader = SDK.PageResourceLoader.PageResourceLoader.instance();\n    this.#loader.addEventListener(SDK.PageResourceLoader.Events.UPDATE, this.update, this);\n    this.update();\n  }\n\n  override async doUpdate(): Promise<void> {\n    const {loading, resources} = this.#loader.getScopedNumberOfResources();\n    const input = {\n      onFilterChanged: (e: CustomEvent<string>) => {\n        this.onFilterChanged(e.detail);\n      },\n      items: this.#loader.getResourcesLoaded().values(),\n      selectedItem: this.#selectedItem,\n      onSelect: (item: SDK.PageResourceLoader.PageResource|null) => {\n        this.#selectedItem = item;\n      },\n      filters: this.#filters,\n      numResources: resources,\n      numLoading: loading,\n    };\n    const output = {};\n    this.#view(input, output, this.contentElement);\n  }\n\n  async select(resource: SDK.PageResourceLoader.PageResource): Promise<void> {\n    await this.lastUpdatePromise;\n    this.#selectedItem = resource;\n    this.update();\n  }\n\n  async selectedItem(): Promise<SDK.PageResourceLoader.PageResource|null> {\n    await this.lastUpdatePromise;\n    return this.#selectedItem;\n  }\n\n  private onFilterChanged(text: string): void {\n    const textFilterRegExp = text ? Platform.StringUtilities.createPlainTextSearchRegex(text, 'i') : null;\n    if (textFilterRegExp) {\n      this.#filters = [\n        {key: 'url,error-message', regex: textFilterRegExp, negative: false},\n      ];\n    } else {\n      this.#filters = [];\n    }\n    this.update();\n  }\n}\n"]}