{"version":3,"file":"RequestCookiesView.test.js","sourceRoot":"","sources":["../../../../../../front_end/panels/network/RequestCookiesView.test.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright 2024 The Chromium Authors\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport * as Platform from '../../core/platform/platform.js';\nimport * as SDK from '../../core/sdk/sdk.js';\nimport * as Protocol from '../../generated/protocol.js';\nimport {\n  assertScreenshot,\n  renderElementIntoDOM,\n} from '../../testing/DOMHelpers.js';\nimport {setupLocaleHooks} from '../../testing/LocaleHelpers.js';\nimport {describeWithMockConnection} from '../../testing/MockConnection.js';\nimport {createViewFunctionStub} from '../../testing/ViewFunctionHelpers.js';\n\nimport * as Network from './network.js';\n\nconst {RequestCookiesView} = Network;\nconst {urlString} = Platform.DevToolsPath;\n\ndescribeWithMockConnection('RequestCookiesView', () => {\n  setupLocaleHooks();\n\n  const mockCookie = (name: string, value: string): SDK.Cookie.Cookie => {\n    return new SDK.Cookie.Cookie(name, value);\n  };\n\n  it('renders correctly with no cookies', async () => {\n    const container = document.createElement('div');\n    renderElementIntoDOM(container);\n    RequestCookiesView.DEFAULT_VIEW(\n        {\n          requestCookies: {cookies: [], cookieToBlockedReasons: new Map(), cookieToExemptionReason: new Map()},\n          responseCookies: {cookies: [], cookieToBlockedReasons: new Map(), cookieToExemptionReason: new Map()},\n          malformedResponseCookies: [],\n          showFilteredOutCookies: false,\n          hasBlockedCookies: false,\n          gotCookies: false,\n          onShowFilteredOutCookiesChange: () => {},\n          siteHasCookieInOtherPartition: false,\n        },\n        undefined, container);\n    await assertScreenshot('network/request_cookies_view_no_cookies.png');\n  });\n\n  it('renders correctly with request and response cookies', async () => {\n    const container = document.createElement('div');\n    renderElementIntoDOM(container);\n    RequestCookiesView.DEFAULT_VIEW(\n        {\n          requestCookies: {\n            cookies: [mockCookie('request-cookie', 'val1')],\n            cookieToBlockedReasons: new Map(),\n            cookieToExemptionReason: new Map(),\n          },\n          responseCookies: {\n            cookies: [mockCookie('response-cookie', 'val2')],\n            cookieToBlockedReasons: new Map(),\n            cookieToExemptionReason: new Map(),\n          },\n          malformedResponseCookies: [],\n          showFilteredOutCookies: false,\n          hasBlockedCookies: true,\n          gotCookies: true,\n          onShowFilteredOutCookiesChange: () => {},\n          siteHasCookieInOtherPartition: true,\n        },\n        undefined, container);\n    await assertScreenshot('network/request_cookies_view_req_and_res_cookies.png');\n  });\n\n  it('renders correctly with malformed response cookies', async () => {\n    const container = document.createElement('div');\n    renderElementIntoDOM(container);\n    RequestCookiesView.DEFAULT_VIEW(\n        {\n          requestCookies: {cookies: [], cookieToBlockedReasons: new Map(), cookieToExemptionReason: new Map()},\n          responseCookies: {cookies: [], cookieToBlockedReasons: new Map(), cookieToExemptionReason: new Map()},\n          malformedResponseCookies: [{\n            cookie: mockCookie('malformed-cookie', 'val'),\n            cookieLine: 'malformed-cookie=val; SameSite=Invalid',\n            blockedReasons: [Protocol.Network.SetCookieBlockedReason.SyntaxError],\n          }],\n          showFilteredOutCookies: false,\n          hasBlockedCookies: false,\n          gotCookies: true,\n          onShowFilteredOutCookiesChange: () => {},\n          siteHasCookieInOtherPartition: false,\n        },\n        undefined, container);\n    await assertScreenshot('network/request_cookies_view_malformed_cookies.png');\n  });\n\n  it('shows a message when request site has cookies in another partition', async () => {\n    const request = SDK.NetworkRequest.NetworkRequest.create(\n        'requestId' as Protocol.Network.RequestId, urlString`https://www.example.com/foo.html`, urlString``, null, null,\n        null);\n    request.addExtraRequestInfo({\n      siteHasCookieInOtherPartition: true,\n      includedRequestCookies: [],\n      blockedRequestCookies: [],\n      connectTiming: {requestTime: 0},\n      requestHeaders: [],\n    } as SDK.NetworkRequest.ExtraRequestInfo);\n    const view = createViewFunctionStub(RequestCookiesView.RequestCookiesView);\n    const component = new RequestCookiesView.RequestCookiesView(request, view);\n    renderElementIntoDOM(component);\n    component.wasShown();\n\n    const input = await view.nextInput;\n    assert.isTrue(input.siteHasCookieInOtherPartition);\n  });\n\n  it('shows filtered out cookies when checkbox is ticked', async () => {\n    const request = SDK.NetworkRequest.NetworkRequest.create(\n        'requestId' as Protocol.Network.RequestId, urlString`https://www.example.com/foo.html`, urlString``, null, null,\n        null);\n\n    const view = createViewFunctionStub(RequestCookiesView.RequestCookiesView);\n    const component = new RequestCookiesView.RequestCookiesView(request, view);\n    renderElementIntoDOM(component);\n    component.wasShown();\n\n    let input = await view.nextInput;\n    assert.isFalse(input.showFilteredOutCookies);\n\n    input.onShowFilteredOutCookiesChange(true);\n\n    input = await view.nextInput;\n    assert.isTrue(input.showFilteredOutCookies);\n  });\n});\n"]}