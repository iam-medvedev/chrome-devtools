{"version":3,"file":"NetworkItemView.test.js","sourceRoot":"","sources":["../../../../../../front_end/panels/network/NetworkItemView.test.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright 2022 The Chromium Authors. All rights reserved.\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport * as Common from '../../core/common/common.js';\nimport * as Platform from '../../core/platform/platform.js';\nimport * as SDK from '../../core/sdk/sdk.js';\nimport type * as Protocol from '../../generated/protocol.js';\nimport {renderElementIntoDOM} from '../../testing/DOMHelpers.js';\nimport {\n  deinitializeGlobalVars,\n  describeWithEnvironment,\n} from '../../testing/EnvironmentHelpers.js';\nimport {describeWithMockConnection} from '../../testing/MockConnection.js';\nimport {setUpEnvironment} from '../../testing/OverridesHelpers.js';\nimport type * as UI from '../../ui/legacy/legacy.js';\n\nimport * as NetworkForward from './forward/forward.js';\nimport * as Network from './network.js';\n\nconst {urlString} = Platform.DevToolsPath;\n\nfunction renderNetworkItemView(request?: SDK.NetworkRequest.NetworkRequest): Network.NetworkItemView.NetworkItemView {\n  if (!request) {\n    request = SDK.NetworkRequest.NetworkRequest.create(\n        'requestId' as Protocol.Network.RequestId, urlString`https://www.example.com/foo.html`, urlString``, null, null,\n        null);\n  }\n  const networkItemView =\n      new Network.NetworkItemView.NetworkItemView(request, {} as Network.NetworkTimeCalculator.NetworkTimeCalculator);\n  const div = document.createElement('div');\n  renderElementIntoDOM(div);\n  networkItemView.markAsRoot();\n  networkItemView.show(div);\n  return networkItemView;\n}\n\nfunction getOverrideIndicator(tabs: UI.TabbedPane.TabbedPaneTab[], tabId: string): HTMLElement|null {\n  const tab = tabs.find(tab => tab.id === tabId)?.tabElement;\n  const statusDot = tab?.querySelector('.status-dot');\n\n  return statusDot ? statusDot as HTMLElement : null;\n}\n\ndescribeWithMockConnection('NetworkItemView', () => {\n  beforeEach(() => {\n    setUpEnvironment();\n  });\n\n  afterEach(async () => {\n    await deinitializeGlobalVars();\n  });\n\n  it('reveals header in RequestHeadersView', async () => {\n    const networkItemView = renderNetworkItemView();\n    const headersViewComponent = networkItemView.getHeadersViewComponent();\n    assert.exists(headersViewComponent);\n    const headersViewComponentSpy = sinon.spy(headersViewComponent, 'revealHeader');\n\n    assert.isTrue(headersViewComponentSpy.notCalled);\n\n    networkItemView.revealHeader(NetworkForward.UIRequestLocation.UIHeaderSection.RESPONSE, 'headerName');\n\n    assert.isTrue(\n        headersViewComponentSpy.calledWith(NetworkForward.UIRequestLocation.UIHeaderSection.RESPONSE, 'headerName'));\n    networkItemView.detach();\n  });\n});\n\ndescribeWithEnvironment('NetworkItemView', () => {\n  let request: SDK.NetworkRequest.NetworkRequest;\n\n  beforeEach(async () => {\n    request = SDK.NetworkRequest.NetworkRequest.create(\n        'requestId' as Protocol.Network.RequestId, urlString`https://www.example.com`, urlString``, null, null, null);\n    request.statusCode = 200;\n  });\n\n  it('shows indicator for overriden headers and responses', () => {\n    request.setWasIntercepted(true);\n    request.hasOverriddenContent = true;\n    request.responseHeaders = [{name: 'foo', value: 'overridden'}];\n    request.originalResponseHeaders = [{name: 'foo', value: 'original'}];\n\n    const networkItemView = renderNetworkItemView(request);\n    const headersIndicator = getOverrideIndicator(networkItemView['tabs'], 'headers-component');\n    const responseIndicator = getOverrideIndicator(networkItemView['tabs'], 'response');\n\n    networkItemView.detach();\n\n    assert.isNotNull(headersIndicator);\n    assert.isNotNull(responseIndicator);\n  });\n\n  it('shows indicator for overriden headers', () => {\n    request.setWasIntercepted(true);\n    request.responseHeaders = [{name: 'foo', value: 'overridden'}];\n    request.originalResponseHeaders = [{name: 'foo', value: 'original'}];\n\n    const networkItemView = renderNetworkItemView(request);\n    const headersIndicator = getOverrideIndicator(networkItemView['tabs'], 'headers-component');\n    const responseIndicator = getOverrideIndicator(networkItemView['tabs'], 'response');\n\n    networkItemView.detach();\n\n    assert.isNotNull(headersIndicator);\n    assert.isNull(responseIndicator);\n  });\n\n  it('shows indicator for overriden content', () => {\n    request.setWasIntercepted(true);\n    request.hasOverriddenContent = true;\n\n    const networkItemView = renderNetworkItemView(request);\n    const headersIndicator = getOverrideIndicator(networkItemView['tabs'], 'headers-component');\n    const responseIndicator = getOverrideIndicator(networkItemView['tabs'], 'response');\n\n    networkItemView.detach();\n\n    assert.isNull(headersIndicator);\n    assert.isNotNull(responseIndicator);\n  });\n\n  it('does not show indicator for unoverriden request', () => {\n    const networkItemView = renderNetworkItemView(request);\n    const headersIndicator = getOverrideIndicator(networkItemView['tabs'], 'headers-component');\n    const responseIndicator = getOverrideIndicator(networkItemView['tabs'], 'response');\n\n    networkItemView.detach();\n\n    assert.isNull(headersIndicator);\n    assert.isNull(responseIndicator);\n  });\n\n  it('shows the Response and EventSource tab for text/event-stream requests', () => {\n    request.mimeType = 'text/event-stream';\n    const networkItemView = renderNetworkItemView(request);\n\n    assert.isTrue(networkItemView.hasTab(NetworkForward.UIRequestLocation.UIRequestTabs.EVENT_SOURCE));\n    assert.isTrue(networkItemView.hasTab(NetworkForward.UIRequestLocation.UIRequestTabs.RESPONSE));\n\n    networkItemView.detach();\n  });\n\n  it('shows the ConnectionInfo tab for DirectSocket requests', () => {\n    request.setResourceType(Common.ResourceType.resourceTypes.DirectSocket);\n    request.directSocketInfo = {\n      type: SDK.NetworkRequest.DirectSocketType.TCP,\n      status: SDK.NetworkRequest.DirectSocketStatus.OPENING,\n      createOptions: {\n        remoteAddr: '127.0.0.1',\n        remotePort: 2545,\n        noDelay: false,\n        keepAliveDelay: 1000,\n        sendBufferSize: 1002,\n        receiveBufferSize: 1003,\n        dnsQueryType: undefined,\n      }\n    };\n\n    const networkItemView = renderNetworkItemView(request);\n\n    assert.isTrue(networkItemView.hasTab(NetworkForward.UIRequestLocation.UIRequestTabs.DIRECT_SOCKET_CONNECTION));\n    assert.isTrue(networkItemView.hasTab(NetworkForward.UIRequestLocation.UIRequestTabs.INITIATOR));\n    assert.isTrue(networkItemView.hasTab(NetworkForward.UIRequestLocation.UIRequestTabs.TIMING));\n\n    networkItemView.detach();\n  });\n});\n"]}