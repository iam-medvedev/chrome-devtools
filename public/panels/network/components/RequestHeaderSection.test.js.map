{"version":3,"file":"RequestHeaderSection.test.js","sourceRoot":"","sources":["../../../../../../../front_end/panels/network/components/RequestHeaderSection.test.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright 2022 The Chromium Authors\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport * as Platform from '../../../core/platform/platform.js';\nimport type * as SDK from '../../../core/sdk/sdk.js';\nimport {\n  assertScreenshot,\n  renderElementIntoDOM,\n} from '../../../testing/DOMHelpers.js';\nimport {describeWithEnvironment} from '../../../testing/EnvironmentHelpers.js';\nimport {createViewFunctionStub} from '../../../testing/ViewFunctionHelpers.js';\nimport * as NetworkForward from '../forward/forward.js';\n\nimport * as NetworkComponents from './components.js';\n\nasync function renderRequestHeaderSection(request: SDK.NetworkRequest.NetworkRequest) {\n  const view = createViewFunctionStub(NetworkComponents.RequestHeaderSection.RequestHeaderSection);\n  const widget = new NetworkComponents.RequestHeaderSection.RequestHeaderSection(undefined, view);\n  renderElementIntoDOM(widget.contentElement);\n  widget.request = request;\n  await view.nextInput;\n  return {view, widget};\n}\n\ndescribeWithEnvironment('RequestHeaderSection', () => {\n  it('renders provisional headers warning', async () => {\n    const request = {\n      cachedInMemory: () => true,\n      cached: () => false,\n      requestHeaders: () =>\n          [{name: ':method', value: 'GET'},\n           {name: 'accept-encoding', value: 'gzip, deflate, br'},\n           {name: 'cache-control', value: 'no-cache'},\n    ],\n      requestHeadersText: () => undefined,\n    } as unknown as SDK.NetworkRequest.NetworkRequest;\n\n    const {view} = await renderRequestHeaderSection(request);\n    const input = view.input;\n    assert.isTrue(input.isProvisionalHeaders);\n  });\n\n  it('sorts headers alphabetically', async () => {\n    const request = {\n      cachedInMemory: () => true,\n      cached: () => false,\n      requestHeaders: () =>\n          [{name: 'Ab', value: 'second'},\n           {name: 'test', value: 'fifth'},\n           {name: 'name', value: 'fourth'},\n           {name: 'abc', value: 'third'},\n           {name: 'aa', value: 'first'},\n    ],\n      requestHeadersText: () => 'placeholderText',\n    } as unknown as SDK.NetworkRequest.NetworkRequest;\n\n    const {view} = await renderRequestHeaderSection(request);\n    const headers = view.input.headers.map(header => [header.name, header.value]);\n    assert.deepEqual(headers, [\n      ['aa', 'first'],\n      ['ab', 'second'],\n      ['abc', 'third'],\n      ['name', 'fourth'],\n      ['test', 'fifth'],\n    ]);\n  });\n\n  it('highlights the requested header', async () => {\n    const request = {\n      cachedInMemory: () => true,\n      cached: () => false,\n      requestHeaders: () =>\n          [{name: 'Ab', value: 'second'},\n           {name: 'test', value: 'fifth'},\n           {name: 'name', value: 'fourth'},\n           {name: 'abc', value: 'third'},\n           {name: 'aa', value: 'first'},\n    ],\n      requestHeadersText: () => 'placeholderText',\n    } as unknown as SDK.NetworkRequest.NetworkRequest;\n\n    const {view, widget} = await renderRequestHeaderSection(request);\n    widget.toReveal = {section: NetworkForward.UIRequestLocation.UIHeaderSection.REQUEST, header: 'Ab'};\n    await view.nextInput;\n\n    const headers = view.input.headers;\n    const highlightedHeader = headers.find(header => header.name === 'ab');\n    assert.isTrue(highlightedHeader?.highlight);\n  });\n\n  it('correctly sets cached state', async () => {\n    const request = {\n      cachedInMemory: () => true,\n      cached: () => false,\n      requestHeaders: () => [],\n      requestHeadersText: () => undefined,\n    } as unknown as SDK.NetworkRequest.NetworkRequest;\n    const {view, widget} = await renderRequestHeaderSection(request);\n    assert.isTrue(view.input.isRequestCached);\n\n    const request2 = {\n      ...request,\n      cachedInMemory: () => false,\n      cached: () => true,\n    } as unknown as SDK.NetworkRequest.NetworkRequest;\n    widget.request = request2;\n    const input2 = await view.nextInput;\n    assert.isTrue(input2.isRequestCached);\n\n    const request3 = {\n      ...request,\n      cachedInMemory: () => false,\n      cached: () => false,\n    } as unknown as SDK.NetworkRequest.NetworkRequest;\n    widget.request = request3;\n    const input3 = await view.nextInput;\n    assert.isFalse(input3.isRequestCached);\n  });\n\n  it('renders correctly', async () => {\n    const container = document.createElement('div');\n    renderElementIntoDOM(container);\n    NetworkComponents.RequestHeaderSection.DEFAULT_VIEW(\n        {\n          headers: [\n            {\n              name: Platform.StringUtilities.toLowerCaseString('Referer'),\n              value: 'https://example.com',\n              valueEditable: NetworkComponents.HeaderSectionRow.EditingAllowedStatus.FORBIDDEN,\n            },\n            {\n              name: Platform.StringUtilities.toLowerCaseString('User-agent'),\n              value: 'Chrome',\n              valueEditable: NetworkComponents.HeaderSectionRow.EditingAllowedStatus.ENABLED,\n            }\n          ],\n          isProvisionalHeaders: true,\n          isRequestCached: true,\n        },\n        undefined, container);\n    await assertScreenshot('network/request_header_section_default.png');\n  });\n});\n"]}