{"version":3,"file":"RequestTrustTokensView.test.js","sourceRoot":"","sources":["../../../../../../../front_end/panels/network/components/RequestTrustTokensView.test.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright 2020 The Chromium Authors\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport type * as SDK from '../../../core/sdk/sdk.js';\nimport * as Protocol from '../../../generated/protocol.js';\nimport {\n  assertScreenshot,\n  renderElementIntoDOM,\n} from '../../../testing/DOMHelpers.js';\nimport {setupLocaleHooks} from '../../../testing/LocaleHelpers.js';\nimport {createViewFunctionStub} from '../../../testing/ViewFunctionHelpers.js';\n\nimport * as NetworkComponents from './components.js';\n\ndescribe('RequestTrustTokensView', () => {\n  setupLocaleHooks();\n\n  const makeRequest =\n      (params?: Protocol.Network.TrustTokenParams, result?: Protocol.Network.TrustTokenOperationDoneEvent) => {\n        return {\n          trustTokenParams: () => params,\n          trustTokenOperationDoneEvent: () => result,\n          addEventListener: () => {},\n          removeEventListener: () => {},\n        } as unknown as SDK.NetworkRequest.NetworkRequest;\n      };\n\n  it('renders the success state correctly', async () => {\n    const container = document.createElement('div');\n    renderElementIntoDOM(container);\n    NetworkComponents.RequestTrustTokensView.DEFAULT_VIEW(\n        {\n          status: 'Success',\n          description: 'The operations result was served from cache.',\n          issuedTokenCount: 5,\n          params: [\n            {name: 'Type', value: 'Issuance', isCode: true},\n            {name: 'Refresh policy', value: 'UseCached', isCode: true},\n            {name: 'Issuers', value: ['example.org', 'foo.dev']},\n            {name: 'Top level origin', value: 'foo.dev'},\n            {name: 'Issuer', value: 'example.org'},\n          ],\n        },\n        undefined, container);\n    await assertScreenshot('network/request_trust_tokens_view_success.png');\n  });\n\n  it('renders the failure state correctly', async () => {\n    const container = document.createElement('div');\n    renderElementIntoDOM(container);\n    NetworkComponents.RequestTrustTokensView.DEFAULT_VIEW(\n        {\n          status: 'Failure',\n          description: 'The servers response was malformed or otherwise invalid.',\n          params: [\n            {name: 'Type', value: 'Redemption', isCode: true},\n          ],\n        },\n        undefined, container);\n    await assertScreenshot('network/request_trust_tokens_view_failure.png');\n  });\n\n  it('adds refreshPolicy for Redemption request params', async () => {\n    const view = createViewFunctionStub(NetworkComponents.RequestTrustTokensView.RequestTrustTokensView);\n    const component = new NetworkComponents.RequestTrustTokensView.RequestTrustTokensView(undefined, view);\n    const request = makeRequest({\n      operation: Protocol.Network.TrustTokenOperationType.Redemption,\n      refreshPolicy: Protocol.Network.TrustTokenParamsRefreshPolicy.UseCached,\n    });\n    component.request = request;\n\n    const input = await view.nextInput;\n    assert.deepEqual(input.params, [\n      {name: 'Type', value: 'Redemption', isCode: true},\n      {name: 'Refresh policy', value: 'UseCached', isCode: true},\n    ]);\n  });\n\n  it('adds issuedTokenCount an Issuance request result section', async () => {\n    const view = createViewFunctionStub(NetworkComponents.RequestTrustTokensView.RequestTrustTokensView);\n    const component = new NetworkComponents.RequestTrustTokensView.RequestTrustTokensView(undefined, view);\n    const request = makeRequest(\n        {\n          operation: Protocol.Network.TrustTokenOperationType.Issuance,\n          refreshPolicy: Protocol.Network.TrustTokenParamsRefreshPolicy.UseCached,\n        },\n        {\n          status: Protocol.Network.TrustTokenOperationDoneEventStatus.Ok,\n          type: Protocol.Network.TrustTokenOperationType.Issuance,\n          requestId: 'mockId' as Protocol.Network.RequestId,\n          issuedTokenCount: 5,\n        });\n    component.request = request;\n\n    const input = await view.nextInput;\n    assert.deepEqual(input.params, [\n      {name: 'Type', value: 'Issuance', isCode: true},\n    ]);\n    assert.strictEqual(input.issuedTokenCount, 5);\n  });\n\n  it('adds topLevelOrigin and issuerOrigin to params if present in result', async () => {\n    const view = createViewFunctionStub(NetworkComponents.RequestTrustTokensView.RequestTrustTokensView);\n    const component = new NetworkComponents.RequestTrustTokensView.RequestTrustTokensView(undefined, view);\n    const request = makeRequest(\n        {\n          operation: Protocol.Network.TrustTokenOperationType.Redemption,\n          refreshPolicy: Protocol.Network.TrustTokenParamsRefreshPolicy.UseCached,\n        },\n        {\n          status: Protocol.Network.TrustTokenOperationDoneEventStatus.Ok,\n          type: Protocol.Network.TrustTokenOperationType.Redemption,\n          requestId: 'mockId' as Protocol.Network.RequestId,\n          topLevelOrigin: 'https://toplevel.com',\n          issuerOrigin: 'https://issuer.com',\n        });\n    component.request = request;\n\n    const input = await view.nextInput;\n    assert.deepEqual(input.params, [\n      {name: 'Type', value: 'Redemption', isCode: true},\n      {name: 'Refresh policy', value: 'UseCached', isCode: true},\n      {name: 'Top level origin', value: 'https://toplevel.com'},\n      {name: 'Issuer', value: 'https://issuer.com'},\n    ]);\n  });\n});\n"]}