{"version":3,"file":"FrameDetailsView.test.js","sourceRoot":"","sources":["../../../../../../front_end/panels/application/FrameDetailsView.test.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright 2021 The Chromium Authors\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport * as SDK from '../../core/sdk/sdk.js';\nimport * as Protocol from '../../generated/protocol.js';\nimport * as Bindings from '../../models/bindings/bindings.js';\nimport * as Workspace from '../../models/workspace/workspace.js';\nimport {\n  raf,\n  renderElementIntoDOM,\n} from '../../testing/DOMHelpers.js';\nimport {createTarget} from '../../testing/EnvironmentHelpers.js';\nimport {\n  describeWithMockConnection,\n  dispatchEvent,\n} from '../../testing/MockConnection.js';\nimport type * as ReportView from '../../ui/components/report_view/report_view.js';\n\nimport * as Application from './application.js';\n\nconst makeFrame = (target: SDK.Target.Target) => {\n  const newFrame: SDK.ResourceTreeModel.ResourceTreeFrame = {\n    url: 'https://www.example.com/path/page.html',\n    securityOrigin: 'https://www.example.com',\n    displayName: () => 'TestTitle',\n    unreachableUrl: () => '',\n    adFrameType: () => Protocol.Page.AdFrameType.None,\n    adFrameStatus: () => undefined,\n    getAdScriptAncestry: () => null,\n    resourceForURL: () => null,\n    isSecureContext: () => true,\n    isCrossOriginIsolated: () => true,\n    getCrossOriginIsolatedContextType: () => Protocol.Page.CrossOriginIsolatedContextType.NotIsolatedFeatureDisabled,\n    getSecureContextType: () => Protocol.Page.SecureContextType.SecureLocalhost,\n    getGatedAPIFeatures: () =>\n        [Protocol.Page.GatedAPIFeatures.SharedArrayBuffers,\n         Protocol.Page.GatedAPIFeatures.SharedArrayBuffersTransferAllowed],\n    getOwnerDOMNodeOrDocument: () => Promise.resolve({\n      nodeName: () => 'iframe',\n      nodeType: () => Node.ELEMENT_NODE,\n      pseudoType: () => undefined,\n      isViewTransitionPseudoNode: () => false,\n      nodeNameInCorrectCase: () => 'iframe',\n      getAttribute: () => null,\n    }),\n    resourceTreeModel: () => target.model(SDK.ResourceTreeModel.ResourceTreeModel),\n    getCreationStackTraceData: () => ({\n      creationStackTrace: {\n        callFrames: [{\n          functionName: 'function1',\n          url: 'http://www.example.com/script.js',\n          lineNumber: 15,\n          columnNumber: 10,\n          scriptId: 'someScriptId',\n        }],\n      },\n      creationStackTraceTarget: target,\n    }),\n    getOriginTrials: async () => ([\n      {\n        trialName: 'AppCache',\n        status: 'Enabled',\n        tokensWithStatus: [{\n          status: 'Success',\n          rawTokenText: 'Text',\n          parsedToken: {\n            trialName: 'AppCache',\n            origin: 'https://foo.com',\n            expiryTime: 1000,\n            usageRestriction: 'None',\n            isThirdParty: false,\n            matchSubDomains: false,\n          },\n        }],\n      },\n    ]),\n    getPermissionsPolicyState: () => Promise.resolve(null),\n    parentFrame: () => null,\n  } as unknown as SDK.ResourceTreeModel.ResourceTreeFrame;\n  return newFrame;\n};\n\ndescribeWithMockConnection('FrameDetailsView', () => {\n  beforeEach(() => {\n    const workspace = Workspace.Workspace.WorkspaceImpl.instance({forceNew: true});\n    const targetManager = SDK.TargetManager.TargetManager.instance();\n    const ignoreListManager = Workspace.IgnoreListManager.IgnoreListManager.instance({forceNew: true});\n    Bindings.DebuggerWorkspaceBinding.DebuggerWorkspaceBinding.instance({\n      forceNew: true,\n      resourceMapping: new Bindings.ResourceMapping.ResourceMapping(targetManager, workspace),\n      targetManager,\n      ignoreListManager,\n      workspace,\n    });\n  });\n\n  it('renders with a title', async () => {\n    const frame = makeFrame(createTarget());\n    const component = new Application.FrameDetailsView.FrameDetailsReportView();\n    component.frame = frame;\n    renderElementIntoDOM(component);\n\n    await component.updateComplete;\n\n    const report = component.contentElement.querySelector('devtools-report') as ReportView.ReportView.Report;\n\n    const titleElement = report.shadowRoot!.querySelector('.report-title');\n    assert.strictEqual(titleElement?.textContent, frame.displayName());\n  });\n\n  it('renders report keys and values', async () => {\n\n    const target = createTarget();\n    const debuggerModel = target.model(SDK.DebuggerModel.DebuggerModel);\n    assert.exists(debuggerModel);\n    sinon.stub(SDK.DebuggerModel.DebuggerModel, 'modelForDebuggerId').resolves(debuggerModel);\n\n    const scriptParsedEvent1: Protocol.Debugger.ScriptParsedEvent = {\n      scriptId: '123' as Protocol.Runtime.ScriptId,\n      url: 'https://www.google.com/ad-script1.js',\n      startLine: 0,\n      startColumn: 0,\n      endLine: 10,\n      endColumn: 10,\n      executionContextId: 1234 as Protocol.Runtime.ExecutionContextId,\n      hash: '',\n      buildId: '',\n    };\n    dispatchEvent(target, 'Debugger.scriptParsed', scriptParsedEvent1);\n\n    const scriptParsedEvent2: Protocol.Debugger.ScriptParsedEvent = {\n      scriptId: '456' as Protocol.Runtime.ScriptId,\n      url: 'https://www.google.com/ad-script2.js',\n      startLine: 0,\n      startColumn: 0,\n      endLine: 10,\n      endColumn: 10,\n      executionContextId: 1234 as Protocol.Runtime.ExecutionContextId,\n      hash: '',\n      buildId: '',\n    };\n    dispatchEvent(target, 'Debugger.scriptParsed', scriptParsedEvent2);\n\n    const frame = makeFrame(target);\n    frame.adFrameType = () => Protocol.Page.AdFrameType.Root;\n    frame.parentFrame = () => ({\n      getAdScriptAncestry: () => ({\n        ancestryChain: [\n          {\n            scriptId: '123' as Protocol.Runtime.ScriptId,\n            debuggerId: '42' as Protocol.Runtime.UniqueDebuggerId,\n          },\n          {\n            scriptId: '456' as Protocol.Runtime.ScriptId,\n            debuggerId: '42' as Protocol.Runtime.UniqueDebuggerId,\n          }\n        ],\n        rootScriptFilterlistRule: '/ad-script2.$script',\n      }),\n    } as unknown as SDK.ResourceTreeModel.ResourceTreeFrame);\n    const networkManager = target.model(SDK.NetworkManager.NetworkManager);\n    assert.exists(networkManager);\n    sinon.stub(networkManager, 'getSecurityIsolationStatus').resolves({\n      coep: {\n        value: Protocol.Network.CrossOriginEmbedderPolicyValue.None,\n        reportOnlyValue: Protocol.Network.CrossOriginEmbedderPolicyValue.None,\n      },\n      coop: {\n        value: Protocol.Network.CrossOriginOpenerPolicyValue.SameOrigin,\n        reportOnlyValue: Protocol.Network.CrossOriginOpenerPolicyValue.SameOrigin,\n      },\n      csp: [{\n        source: Protocol.Network.ContentSecurityPolicySource.HTTP,\n        isEnforced: true,\n        effectiveDirectives:\n            'base-uri \\'self\\'; object-src \\'none\\'; script-src \\'strict-dynamic\\' \\'unsafe-inline\\' https: http: \\'nonce-GsVjHiIoejpPhMPOHDQZ90yc9eJn1s\\' \\'unsafe-eval\\'; report-uri https://www.example.com/csp',\n      }],\n    });\n\n    const component = new Application.FrameDetailsView.FrameDetailsReportView();\n    component.frame = frame;\n    renderElementIntoDOM(component);\n\n    await component.updateComplete;\n\n    await raf();\n\n    const keys = [...component.contentElement.querySelectorAll('devtools-report-key')].map(k => k.deepInnerText());\n    assert.deepEqual(keys, [\n      'URL',\n      'Origin',\n      'Owner Element',\n      'Frame Creation Stack Trace',\n      'Ad Status',\n      'Creator Ad Script Ancestry',\n      'Root Script Filterlist Rule',\n      'Secure Context',\n      'Cross-Origin Isolated',\n      'Cross-Origin Embedder Policy (COEP)',\n      'Cross-Origin Opener Policy (COOP)',\n      'Content-Security-Policy',\n      'SharedArrayBuffers',\n      'Measure Memory',\n    ]);\n\n    const values = [...component.contentElement.querySelectorAll('devtools-report-value')].map(v => v.deepInnerText());\n    assert.deepEqual(values, [\n      'https://www.example.com/path/page.html',\n      'https://www.example.com',\n      'iframe',\n      '\\tfunction1\\t@\\twww.example.com/script.js:16',\n      'root',\n      'ad-script1.js:1',\n      '/ad-script2.$script',\n      'Yes\\nLocalhost is always a secure context',\n      'Yes',\n      'none',\n      'same-origin',\n      `HTTP header\nbase-uri: 'self'\nobject-src: 'none'\nscript-src: 'strict-dynamic', 'unsafe-inline', https:, http:, 'nonce-GsVjHiIoejpPhMPOHDQZ90yc9eJn1s', 'unsafe-eval'\nreport-uri: https://www.example.com/csp`,\n      'available, transferable',\n      'available\\nLearn more',\n    ]);\n\n    const stackTrace = component.contentElement.querySelector(\n        'devtools-report-value[jslog=\"Section; context: frame-creation-stack-trace\"] devtools-widget')!;\n\n    const stackTraceText = stackTrace.deepInnerText().split('\\n');\n\n    assert.deepEqual(stackTraceText[0], '\\tfunction1\\t@\\twww.example.com/script.js:16');\n\n    const adStatusList =\n        component.contentElement.querySelector('devtools-report-value.ad-status-list devtools-expandable-list');\n    assert.exists(adStatusList);\n    const adStatusExpandableButton = adStatusList.shadowRoot!.querySelector('button');\n    assert.notExists(adStatusExpandableButton);\n    const adStatusItem = adStatusList.shadowRoot!.querySelector('.expandable-list-items');\n    assert.exists(adStatusItem);\n    assert.strictEqual(adStatusItem.textContent?.trim(), 'root');\n\n    const adScriptAncestryList = component.contentElement.querySelector(\n        'devtools-report-value.creator-ad-script-ancestry-list devtools-expandable-list');\n    assert.exists(adScriptAncestryList);\n    const adScriptAncestryExpandableButton = adScriptAncestryList.shadowRoot!.querySelector('button');\n    assert.exists(adScriptAncestryExpandableButton);\n    adScriptAncestryExpandableButton!.click();\n    await raf();\n\n    const adScriptAncestryItems =\n        adScriptAncestryList!.shadowRoot!.querySelectorAll('.expandable-list-items .devtools-link');\n    const adScriptsText = Array.from(adScriptAncestryItems).map(adScript => adScript.textContent?.trim());\n\n    assert.deepEqual(adScriptsText, ['ad-script1.js:1', 'ad-script2.js:1']);\n  });\n});\n"]}