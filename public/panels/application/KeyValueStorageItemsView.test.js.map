{"version":3,"file":"KeyValueStorageItemsView.test.js","sourceRoot":"","sources":["../../../../../../front_end/panels/application/KeyValueStorageItemsView.test.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright 2024 The Chromium Authors. All rights reserved.\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport {\n  raf,\n  renderElementIntoDOM,\n} from '../../testing/DOMHelpers.js';\nimport {describeWithEnvironment} from '../../testing/EnvironmentHelpers.js';\nimport {expectCalled} from '../../testing/ExpectStubCall.js';\nimport {createViewFunctionStub, type ViewFunctionStub} from '../../testing/ViewFunctionHelpers.js';\nimport * as UI from '../../ui/legacy/legacy.js';\n\nimport * as Application from './application.js';\n\ndescribeWithEnvironment('KeyValueStorageItemsView', () => {\n  let keyValueStorageItemsView: Application.KeyValueStorageItemsView.KeyValueStorageItemsView;\n  let viewFunction: ViewFunctionStub<typeof Application.KeyValueStorageItemsView.KeyValueStorageItemsView>;\n\n  const MOCK_ITEMS = [\n    {key: 'foo', value: 'value1'},\n    {key: 'bar', value: 'value2'},\n  ];\n\n  const createPreviewFunc = sinon.stub<[string, string]>();\n\n  const expectCreatePreviewCalled = async (expectedKey: string, expectedValue: string) => {\n    createPreviewFunc.resetHistory();\n    await expectCalled(createPreviewFunc, {\n      fakeFn: async (key: string, value: string) => {\n        assert.strictEqual(key, expectedKey);\n        assert.strictEqual(value, expectedValue);\n        return new UI.EmptyWidget.EmptyWidget(`${key}:${value}`, '');\n      },\n    });\n  };\n\n  class TestKeyValueStorageItemsView extends Application.KeyValueStorageItemsView.KeyValueStorageItemsView {\n    override setItem(_key: string, _value: string): void {\n      // Do nothing.\n    }\n    override removeItem(_key: string): void {\n      // Do nothing.\n    }\n    override createPreview(key: string, value: string): Promise<UI.Widget.Widget|null> {\n      return createPreviewFunc(key, value);\n    }\n  }\n\n  beforeEach(() => {\n    const container = new UI.Widget.VBox();\n    const div = document.createElement('div');\n    renderElementIntoDOM(div);\n    container.markAsRoot();\n    container.show(div);\n\n    viewFunction = createViewFunctionStub(Application.KeyValueStorageItemsView.KeyValueStorageItemsView);\n    keyValueStorageItemsView =\n        new TestKeyValueStorageItemsView('Items', 'key-value-storage-items-view', true, viewFunction);\n\n    keyValueStorageItemsView.showItems(MOCK_ITEMS);\n  });\n\n  afterEach(() => {\n    keyValueStorageItemsView.detach();\n  });\n\n  function createSelectEvent(key: string, value?: string): CustomEvent<HTMLElement|null> {\n    return new CustomEvent('select', {detail: {dataset: {key, value}} as unknown as HTMLElement});\n  }\n\n  it('updates preview when key selected', async () => {\n    const {key, value} = MOCK_ITEMS[0];\n\n    const createPreviewPromise = expectCreatePreviewCalled(key, value);\n\n    // Select the first item by key.\n    viewFunction.input.onSelect(createSelectEvent(key, value));\n\n    // Check createPreview function was called.\n    await createPreviewPromise;\n    assert.include(viewFunction.input.preview.element.innerText, `${key}:${value}`);\n  });\n\n  it('shows empty preview when no row is selected', async () => {\n    viewFunction.input.onSelect(createSelectEvent(MOCK_ITEMS[0].key));\n    await raf();\n    viewFunction.input.onSelect(new CustomEvent('select', {detail: null}));\n    // Check preview was updated.\n    assert.include(viewFunction.input.preview.element.innerText, 'No value selectedSelect a value to preview');\n  });\n\n  it('preview changed when value changes', async () => {\n    const {key, value} = MOCK_ITEMS[0];\n\n    let createPreviewPromise = expectCreatePreviewCalled(key, value);\n\n    // Select the first item.\n    viewFunction.input.onSelect(createSelectEvent(key, value));\n\n    // Check createPreview function was called.\n    await createPreviewPromise;\n\n    // Update the item data (in reality, this would happen since a user edit\n    // would trigger the refreshItems callback - which would fetch new data and\n    // call showItems again).\n    const updatedItems = structuredClone(MOCK_ITEMS);\n    updatedItems[0].value = 'newValue';\n\n    createPreviewPromise = expectCreatePreviewCalled(key, 'newValue');\n    keyValueStorageItemsView.showItems(updatedItems);\n\n    // Check createPreview function was called.\n    await createPreviewPromise;\n\n    // Check preview was updated.\n    await raf();\n    assert.include(viewFunction.input.preview.element.innerText, `${key}:newValue`);\n  });\n});\n"]}