{"version":3,"file":"DeviceBoundSessionsModel.test.js","sourceRoot":"","sources":["../../../../../../front_end/panels/application/DeviceBoundSessionsModel.test.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright 2026 The Chromium Authors\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport * as Common from '../../core/common/common.js';\nimport * as SDK from '../../core/sdk/sdk.js';\nimport * as Protocol from '../../generated/protocol.js';\nimport {createTarget} from '../../testing/EnvironmentHelpers.js';\nimport {describeWithMockConnection} from '../../testing/MockConnection.js';\n\nimport * as Application from './application.js';\n\ndescribeWithMockConnection('DeviceBoundSessionsModel', () => {\n  let model: Application.DeviceBoundSessionsModel.DeviceBoundSessionsModel;\n  let target: SDK.Target.Target;\n  let networkManager: SDK.NetworkManager.NetworkManager;\n\n  function makeSession(site: string, sessionId: string): Protocol.Network.DeviceBoundSession {\n    return {\n      key: {site, id: sessionId},\n      refreshUrl: 'https://example1.com/refresh',\n      inclusionRules: {origin: 'https://example1.com', includeSite: true, urlRules: []},\n      cookieCravings: [],\n      expiryDate: 1767225600,\n      allowedRefreshInitiators: [],\n    };\n  }\n\n  beforeEach(() => {\n    target = createTarget();\n    networkManager = target.model(SDK.NetworkManager.NetworkManager)!;\n    model = new Application.DeviceBoundSessionsModel.DeviceBoundSessionsModel();\n  });\n\n  it('enables device bound sessions agent on model added', () => {\n    const enableSpy = sinon.spy(networkManager, 'enableDeviceBoundSessions');\n    new Application.DeviceBoundSessionsModel.DeviceBoundSessionsModel();\n\n    sinon.assert.calledOnce(enableSpy);\n  });\n\n  it('stores sessions and dispatches INITIALIZE_SESSIONS event when onSessionsSet is called', () => {\n    const expectedSessionAndEvents1 = makeSession('example1.com', 'session_1');\n    const expectedSessionAndEvents2 = makeSession('example2.com', 'session_2');\n    const sessions = [expectedSessionAndEvents1, expectedSessionAndEvents2];\n\n    const listener = sinon.spy();\n    model.addEventListener(\n        Application.DeviceBoundSessionsModel.DeviceBoundSessionModelEvents.INITIALIZE_SESSIONS, listener);\n\n    networkManager.dispatchEventToListeners(SDK.NetworkManager.Events.DeviceBoundSessionsAdded, sessions);\n\n    sinon.assert.calledOnce(listener);\n    const eventData = listener.firstCall.args[0].data;\n    assert.deepEqual(eventData.sessions, sessions);\n\n    // Verify known sessions.\n    const sessionAndEvents1 = model.getSession('example1.com', 'session_1');\n    assert.exists(sessionAndEvents1);\n    assert.deepEqual(sessionAndEvents1?.session, expectedSessionAndEvents1);\n\n    const sessionAndEvents2 = model.getSession('example2.com', 'session_2');\n    assert.exists(sessionAndEvents2);\n    assert.deepEqual(sessionAndEvents2?.session, expectedSessionAndEvents2);\n\n    // Confirm returning undefined for unknown sessions.\n    assert.isUndefined(model.getSession('unknown.com', 'session_1'));\n    assert.isUndefined(model.getSession('example1.com', 'unknown_session'));\n  });\n\n  it('adds visible sites and dispatches ADD_VISIBLE_SITE event', () => {\n    const listener = sinon.spy();\n    model.addEventListener(\n        Application.DeviceBoundSessionsModel.DeviceBoundSessionModelEvents.ADD_VISIBLE_SITE, listener);\n    model.addVisibleSite('example.com');\n    assert.isTrue(model.isSiteVisible('example.com'));\n    assert.isFalse(model.isSiteVisible('other.com'));\n    sinon.assert.calledOnce(listener);\n    assert.deepEqual(listener.firstCall.args[0].data, {site: 'example.com'});\n  });\n\n  it('does not dispatch ADD_VISIBLE_SITE event if site is already visible', () => {\n    model.addVisibleSite('example.com');\n    const listener = sinon.spy();\n    model.addEventListener(\n        Application.DeviceBoundSessionsModel.DeviceBoundSessionModelEvents.ADD_VISIBLE_SITE, listener);\n    model.addVisibleSite('example.com');\n    sinon.assert.notCalled(listener);\n  });\n\n  it('clears visible sites and dispatches CLEAR_VISIBLE_SITES event if preserving log', () => {\n    // Not cleared when preserving the log.\n    Common.Settings.moduleSetting('device-bound-sessions-preserve-log').set(true);\n    model.addVisibleSite('example.com');\n    assert.isTrue(model.isSiteVisible('example.com'));\n    const listener = sinon.spy();\n    model.addEventListener(\n        Application.DeviceBoundSessionsModel.DeviceBoundSessionModelEvents.CLEAR_VISIBLE_SITES, listener);\n    model.clearVisibleSites();\n    assert.isTrue(model.isSiteVisible('example.com'));\n    sinon.assert.notCalled(listener);\n\n    // Cleared when not preserving the log.\n    Common.Settings.moduleSetting('device-bound-sessions-preserve-log').set(false);\n    assert.isTrue(model.isSiteVisible('example.com'));\n    model.clearVisibleSites();\n    assert.isFalse(model.isSiteVisible('example.com'));\n    sinon.assert.calledOnce(listener);\n  });\n\n  it('clears events and dispatches CLEAR_EVENTS event if preserving log', () => {\n    const site = 'example.com';\n    const event1: Protocol.Network.DeviceBoundSessionEventOccurredEvent = {\n      eventId: 'event_1' as Protocol.Network.DeviceBoundSessionEventId,\n      site,\n      succeeded: false,\n      creationEventDetails: {fetchResult: Protocol.Network.DeviceBoundSessionFetchResult.InvalidConfigJson}\n    };\n    const event2: Protocol.Network.DeviceBoundSessionEventOccurredEvent = {\n      eventId: 'event_2' as Protocol.Network.DeviceBoundSessionEventId,\n      sessionId: 'sessionId',\n      site,\n      succeeded: false,\n      creationEventDetails: {fetchResult: Protocol.Network.DeviceBoundSessionFetchResult.InvalidConfigJson}\n    };\n    const event3: Protocol.Network.DeviceBoundSessionEventOccurredEvent = {\n      eventId: 'event_3' as Protocol.Network.DeviceBoundSessionEventId,\n      sessionId: 'otherSessionId',\n      site,\n      succeeded: true,\n      creationEventDetails: {\n        newSession: makeSession(site, 'otherSessionId'),\n        fetchResult: Protocol.Network.DeviceBoundSessionFetchResult.Success\n      }\n\n    };\n    const event4: Protocol.Network.DeviceBoundSessionEventOccurredEvent = {\n      eventId: 'event_4' as Protocol.Network.DeviceBoundSessionEventId,\n      sessionId: undefined,\n      site: 'otherSite.com',\n      succeeded: false,\n      creationEventDetails: {fetchResult: Protocol.Network.DeviceBoundSessionFetchResult.InvalidConfigJson}\n    };\n    networkManager.dispatchEventToListeners(SDK.NetworkManager.Events.DeviceBoundSessionEventOccurred, event1);\n    networkManager.dispatchEventToListeners(SDK.NetworkManager.Events.DeviceBoundSessionEventOccurred, event2);\n    networkManager.dispatchEventToListeners(SDK.NetworkManager.Events.DeviceBoundSessionEventOccurred, event3);\n    networkManager.dispatchEventToListeners(SDK.NetworkManager.Events.DeviceBoundSessionEventOccurred, event4);\n\n    // Ensure sessions exist.\n    const session1 = model.getSession(site, undefined);\n    assert.exists(session1);\n    const session2 = model.getSession(site, 'sessionId');\n    assert.exists(session2);\n    const session3 = model.getSession(site, 'otherSessionId');\n    assert.exists(session3);\n    const session4 = model.getSession('otherSite.com', undefined);\n    assert.exists(session4);\n\n    const listener = sinon.spy();\n    model.addEventListener(Application.DeviceBoundSessionsModel.DeviceBoundSessionModelEvents.CLEAR_EVENTS, listener);\n\n    // Events are not cleared when preserving the log.\n    Common.Settings.moduleSetting('device-bound-sessions-preserve-log').set(true);\n    model.clearEvents();\n    sinon.assert.notCalled(listener);\n    assert.exists(model.getSession(site, undefined));\n    assert.exists(model.getSession(site, 'sessionId'));\n    assert.exists(model.getSession(site, 'otherSessionId'));\n    assert.exists(model.getSession('otherSite.com', undefined));\n    assert.strictEqual(session1.eventsById.size, 1);\n    assert.strictEqual(session2.eventsById.size, 1);\n    assert.strictEqual(session3.eventsById.size, 1);\n    assert.strictEqual(session4.eventsById.size, 1);\n\n    // Events are cleared when not preserving the log.\n    Common.Settings.moduleSetting('device-bound-sessions-preserve-log').set(false);\n    model.clearEvents();\n    sinon.assert.calledOnce(listener);\n    assert.isUndefined(model.getSession(site, undefined));\n    assert.isUndefined(model.getSession(site, 'sessionId'));\n    const session = model.getSession(site, 'otherSessionId');\n    assert.exists(session);\n    assert.isEmpty(session.eventsById);\n    assert.isUndefined(model.getSession('otherSite.com', undefined));\n    const emptySessions = listener.firstCall.args[0].data.emptySessions;\n    assert.strictEqual(emptySessions.size, 2);\n    assert.deepEqual(emptySessions.get(site), [undefined, 'sessionId']);\n    assert.deepEqual(emptySessions.get('otherSite.com'), [undefined]);\n    const emptySites = listener.firstCall.args[0].data.emptySites;\n    assert.strictEqual(emptySites.size, 1);\n    assert.isTrue(emptySites.has('otherSite.com'));\n  });\n\n  it('handles storing events and subsequent EVENT_OCCURRED dispatches', () => {\n    const site = 'example.com';\n    const sessionId1 = 'session_1';\n    const sessionId2 = 'session_2';\n\n    const listener = sinon.spy();\n    model.addEventListener(Application.DeviceBoundSessionsModel.DeviceBoundSessionModelEvents.EVENT_OCCURRED, listener);\n\n    // Trigger event 1.\n    const creationSession = makeSession(site, sessionId1);\n    creationSession.refreshUrl = 'https://example.com/original';\n    const event1: Protocol.Network.DeviceBoundSessionEventOccurredEvent = {\n      eventId: 'event_1' as Protocol.Network.DeviceBoundSessionEventId,\n      site,\n      sessionId: sessionId1,\n      succeeded: true,\n      creationEventDetails:\n          {newSession: creationSession, fetchResult: Protocol.Network.DeviceBoundSessionFetchResult.Success}\n    };\n    networkManager.dispatchEventToListeners(SDK.NetworkManager.Events.DeviceBoundSessionEventOccurred, event1);\n    // Verify event 1 has created the session.\n    let sessionAndEvents1 = model.getSession(site, sessionId1);\n    assert.exists(sessionAndEvents1);\n    assert.exists(sessionAndEvents1.session);\n    assert.strictEqual(sessionAndEvents1.session.refreshUrl, 'https://example.com/original');\n    assert.isTrue(sessionAndEvents1.eventsById.has('event_1'));\n    sinon.assert.calledOnce(listener);\n    assert.deepEqual(listener.lastCall.args[0].data, {site, sessionId: sessionId1});\n\n    // Trigger event 2 for the same site + session with a new refresh URL.\n    const refreshSession = makeSession(site, sessionId1);\n    refreshSession.refreshUrl = 'https://example.com/refreshed';\n    const event2: Protocol.Network.DeviceBoundSessionEventOccurredEvent = {\n      eventId: 'event_2' as Protocol.Network.DeviceBoundSessionEventId,\n      site,\n      sessionId: sessionId1,\n      succeeded: true,\n      refreshEventDetails: {\n        refreshResult: Protocol.Network.RefreshEventDetailsRefreshResult.Refreshed,\n        wasFullyProactiveRefresh: false,\n        newSession: refreshSession\n      }\n    };\n    networkManager.dispatchEventToListeners(SDK.NetworkManager.Events.DeviceBoundSessionEventOccurred, event2);\n    // Verify event 2 has updated the session.\n    sessionAndEvents1 = model.getSession(site, sessionId1);\n    assert.exists(sessionAndEvents1);\n    assert.exists(sessionAndEvents1.session);\n    assert.strictEqual(sessionAndEvents1.session.refreshUrl, 'https://example.com/refreshed');\n    assert.isTrue(sessionAndEvents1.eventsById.has('event_2'));\n    sinon.assert.calledTwice(listener);\n\n    // Trigger event 3 for the same site but a new sessionId.\n    const session2 = makeSession(site, sessionId2);\n    const event3: Protocol.Network.DeviceBoundSessionEventOccurredEvent = {\n      eventId: 'event_3' as Protocol.Network.DeviceBoundSessionEventId,\n      site,\n      sessionId: sessionId2,\n      succeeded: true,\n      creationEventDetails: {fetchResult: Protocol.Network.DeviceBoundSessionFetchResult.Success, newSession: session2}\n    };\n    networkManager.dispatchEventToListeners(SDK.NetworkManager.Events.DeviceBoundSessionEventOccurred, event3);\n    // Verify event 3 has created the new session.\n    const sessionAndEvents2 = model.getSession(site, sessionId2);\n    assert.exists(sessionAndEvents2);\n    assert.exists(sessionAndEvents2.session);\n    assert.strictEqual(sessionAndEvents2.session.key.id, sessionId2);\n    sinon.assert.calledThrice(listener);\n    assert.deepEqual(listener.lastCall.args[0].data, {site, sessionId: sessionId2});\n\n    // Trigger event 4 for the same session which sets the cached challenge.\n    const challengeString = 'custom-challenge-string';\n    const event4: Protocol.Network.DeviceBoundSessionEventOccurredEvent = {\n      eventId: 'event_4' as Protocol.Network.DeviceBoundSessionEventId,\n      site,\n      sessionId: sessionId2,\n      succeeded: true,\n      challengeEventDetails:\n          {challenge: challengeString, challengeResult: Protocol.Network.ChallengeEventDetailsChallengeResult.Success}\n    };\n    networkManager.dispatchEventToListeners(SDK.NetworkManager.Events.DeviceBoundSessionEventOccurred, event4);\n    // Verify event 4 has set the session's cached challenge.\n    assert.strictEqual(sessionAndEvents2.session.cachedChallenge, challengeString);\n    assert.isTrue(sessionAndEvents2.eventsById.has('event_4'));\n    sinon.assert.callCount(listener, 4);\n\n    // Trigger event 5 for the same site + no session. This has no new session.\n    const event5: Protocol.Network.DeviceBoundSessionEventOccurredEvent = {\n      eventId: 'event_5' as Protocol.Network.DeviceBoundSessionEventId,\n      site,\n      succeeded: false,\n      challengeEventDetails:\n          {challenge: challengeString, challengeResult: Protocol.Network.ChallengeEventDetailsChallengeResult.Success}\n    };\n    networkManager.dispatchEventToListeners(SDK.NetworkManager.Events.DeviceBoundSessionEventOccurred, event5);\n    // Verify event 2 has updated the session.\n    const noSession = model.getSession(site, undefined);\n    assert.exists(noSession);\n    assert.notExists(noSession.session);\n    assert.isTrue(noSession.eventsById.has('event_5'));\n    sinon.assert.callCount(listener, 5);\n\n    // Dispatch all events again and confirm there are no changes.\n    networkManager.dispatchEventToListeners(SDK.NetworkManager.Events.DeviceBoundSessionEventOccurred, event1);\n    networkManager.dispatchEventToListeners(SDK.NetworkManager.Events.DeviceBoundSessionEventOccurred, event2);\n    networkManager.dispatchEventToListeners(SDK.NetworkManager.Events.DeviceBoundSessionEventOccurred, event3);\n    networkManager.dispatchEventToListeners(SDK.NetworkManager.Events.DeviceBoundSessionEventOccurred, event4);\n    networkManager.dispatchEventToListeners(SDK.NetworkManager.Events.DeviceBoundSessionEventOccurred, event5);\n    sinon.assert.callCount(listener, 5);\n    assert.strictEqual(sessionAndEvents1.eventsById.size, 2);\n    assert.strictEqual(sessionAndEvents2.eventsById.size, 2);\n    assert.strictEqual(noSession.eventsById.size, 1);\n  });\n\n  it('updates isSessionTerminated status correctly on termination and recreation', () => {\n    const site = 'example.com';\n    const sessionId = 'session_term_test';\n    const listener = sinon.spy();\n    model.addEventListener(Application.DeviceBoundSessionsModel.DeviceBoundSessionModelEvents.EVENT_OCCURRED, listener);\n\n    // New session is not marked as terminated.\n    const creationSession = makeSession(site, sessionId);\n    const createEvent: Protocol.Network.DeviceBoundSessionEventOccurredEvent = {\n      eventId: 'event1' as Protocol.Network.DeviceBoundSessionEventId,\n      site,\n      sessionId,\n      succeeded: true,\n      creationEventDetails:\n          {newSession: creationSession, fetchResult: Protocol.Network.DeviceBoundSessionFetchResult.Success}\n    };\n    networkManager.dispatchEventToListeners(SDK.NetworkManager.Events.DeviceBoundSessionEventOccurred, createEvent);\n\n    assert.isFalse(model.isSessionTerminated(site, sessionId));\n    const session = model.getSession(site, sessionId);\n    assert.isFalse(session?.isSessionTerminated);\n\n    // It is marked as terminated for a successful termination event.\n    const terminationEvent: Protocol.Network.DeviceBoundSessionEventOccurredEvent = {\n      eventId: 'event2' as Protocol.Network.DeviceBoundSessionEventId,\n      site,\n      sessionId,\n      succeeded: true,\n      terminationEventDetails: {deletionReason: Protocol.Network.TerminationEventDetailsDeletionReason.Expired}\n    };\n    networkManager.dispatchEventToListeners(\n        SDK.NetworkManager.Events.DeviceBoundSessionEventOccurred, terminationEvent);\n\n    assert.isTrue(model.isSessionTerminated(site, sessionId));\n    assert.isTrue(session?.isSessionTerminated);\n\n    // It is not unmarked as terminated if there's a failed attempt to recreate it.\n    const failedRecreateEvent: Protocol.Network.DeviceBoundSessionEventOccurredEvent = {\n      eventId: 'event3' as Protocol.Network.DeviceBoundSessionEventId,\n      site,\n      sessionId,\n      succeeded: false,\n      creationEventDetails:\n          {newSession: creationSession, fetchResult: Protocol.Network.DeviceBoundSessionFetchResult.Success}\n    };\n    networkManager.dispatchEventToListeners(\n        SDK.NetworkManager.Events.DeviceBoundSessionEventOccurred, failedRecreateEvent);\n\n    assert.isTrue(model.isSessionTerminated(site, sessionId));\n    assert.isTrue(session?.isSessionTerminated);\n\n    // It is unmarked as terminated if there's a successful attempt to recreate it.\n    const recreateEvent: Protocol.Network.DeviceBoundSessionEventOccurredEvent = {\n      eventId: 'event4' as Protocol.Network.DeviceBoundSessionEventId,\n      site,\n      sessionId,\n      succeeded: true,\n      creationEventDetails:\n          {newSession: creationSession, fetchResult: Protocol.Network.DeviceBoundSessionFetchResult.Success}\n    };\n    networkManager.dispatchEventToListeners(SDK.NetworkManager.Events.DeviceBoundSessionEventOccurred, recreateEvent);\n\n    assert.isFalse(model.isSessionTerminated(site, sessionId));\n    assert.isFalse(session?.isSessionTerminated);\n  });\n\n  it('updates hasErrors status correctly on failed events and clear events', () => {\n    const site = 'example.com';\n    const sessionId = 'session_error_test';\n\n    // New session does not have errors.\n    const createEvent: Protocol.Network.DeviceBoundSessionEventOccurredEvent = {\n      eventId: 'event1' as Protocol.Network.DeviceBoundSessionEventId,\n      site,\n      sessionId,\n      succeeded: true,\n      creationEventDetails: {\n        newSession: makeSession(site, sessionId),\n        fetchResult: Protocol.Network.DeviceBoundSessionFetchResult.Success\n      }\n    };\n    networkManager.dispatchEventToListeners(SDK.NetworkManager.Events.DeviceBoundSessionEventOccurred, createEvent);\n\n    assert.isFalse(model.sessionHasErrors(site, sessionId));\n    const session = model.getSession(site, sessionId);\n    assert.isFalse(session?.hasErrors);\n\n    // It has errors for a failed event.\n    const failedEvent: Protocol.Network.DeviceBoundSessionEventOccurredEvent = {\n      eventId: 'event2' as Protocol.Network.DeviceBoundSessionEventId,\n      site,\n      sessionId,\n      succeeded: false,\n      creationEventDetails: {fetchResult: Protocol.Network.DeviceBoundSessionFetchResult.InvalidConfigJson}\n    };\n    networkManager.dispatchEventToListeners(SDK.NetworkManager.Events.DeviceBoundSessionEventOccurred, failedEvent);\n\n    assert.isTrue(model.sessionHasErrors(site, sessionId));\n    assert.isTrue(session?.hasErrors);\n\n    // It still has errors after a subsequent successful event.\n    const successEvent: Protocol.Network.DeviceBoundSessionEventOccurredEvent = {\n      eventId: 'event3' as Protocol.Network.DeviceBoundSessionEventId,\n      site,\n      sessionId,\n      succeeded: true,\n      challengeEventDetails:\n          {challenge: 'challenge', challengeResult: Protocol.Network.ChallengeEventDetailsChallengeResult.Success}\n    };\n    networkManager.dispatchEventToListeners(SDK.NetworkManager.Events.DeviceBoundSessionEventOccurred, successEvent);\n\n    assert.isTrue(model.sessionHasErrors(site, sessionId));\n    assert.isTrue(session?.hasErrors);\n\n    const listener = sinon.spy();\n    model.addEventListener(Application.DeviceBoundSessionsModel.DeviceBoundSessionModelEvents.CLEAR_EVENTS, listener);\n\n    // Errors are not cleared when clearEvents is called when preserving the log.\n    Common.Settings.moduleSetting('device-bound-sessions-preserve-log').set(true);\n    model.clearEvents();\n    sinon.assert.notCalled(listener);\n    assert.isTrue(model.sessionHasErrors(site, sessionId));\n    assert.isTrue(session?.hasErrors);\n\n    // Errors are cleared when clearEvents is called when not preserving the log.\n    Common.Settings.moduleSetting('device-bound-sessions-preserve-log').set(false);\n    model.clearEvents();\n    sinon.assert.calledOnce(listener);\n    const noLongerFailedSessions = listener.firstCall.args[0].data.noLongerFailedSessions;\n    assert.strictEqual(noLongerFailedSessions.size, 1);\n    assert.deepEqual(noLongerFailedSessions.get(site), [sessionId]);\n    assert.isFalse(model.sessionHasErrors(site, sessionId));\n    assert.isFalse(session?.hasErrors);\n  });\n\n  it('returns false for isSessionTerminated when session does not exist', () => {\n    assert.isFalse(model.isSessionTerminated('unknown-site', 'unknown-session'));\n  });\n});\n"]}