{"version":3,"file":"PreloadingDisabledInfobar.test.js","sourceRoot":"","sources":["../../../../../../../../front_end/panels/application/preloading/components/PreloadingDisabledInfobar.test.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright 2025 The Chromium Authors\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport * as i18n from '../../../../core/i18n/i18n.js';\nimport * as Platform from '../../../../core/platform/platform.js';\nimport {describeWithEnvironment} from '../../../../testing/EnvironmentHelpers.js';\nimport {createViewFunctionStub} from '../../../../testing/ViewFunctionHelpers.js';\n\nimport * as PreloadingComponents from './components.js';\n\nconst {urlString} = Platform.DevToolsPath;\n\ndescribeWithEnvironment('PreloadingDisabledInfobar', () => {\n  it('renders nothing when enabled', async () => {\n    const view = createViewFunctionStub(PreloadingComponents.PreloadingDisabledInfobar.PreloadingDisabledInfobar);\n    const component = new PreloadingComponents.PreloadingDisabledInfobar.PreloadingDisabledInfobar(view);\n    component.wasShown();\n    const input = await view.nextInput;\n\n    assert.deepEqual(input, {\n      header: null,\n      warnings: [],\n    });\n  });\n\n  it('renders disabled by preference', async () => {\n    const view = createViewFunctionStub(PreloadingComponents.PreloadingDisabledInfobar.PreloadingDisabledInfobar);\n    const component = new PreloadingComponents.PreloadingDisabledInfobar.PreloadingDisabledInfobar(view);\n    component.disabledByPreference = true;\n    const input = await view.nextInput;\n\n    assert.deepEqual(input, {\n      header: i18n.i18n.lockedString('Speculative loading is disabled'),\n      warnings: [{\n        key: i18n.i18n.lockedString('User settings or extensions'),\n        valueId:\n            'Speculative loading is disabled because of user settings or an extension. Go to {PH1} to update your preference. Go to {PH2} to disable any extension that blocks speculative loading.',\n        placeholders: {\n          PH1: {\n            title: i18n.i18n.lockedString('Preload pages settings'),\n            href: urlString`chrome://settings/performance`,\n          },\n          PH2: {\n            title: i18n.i18n.lockedString('Extensions settings'),\n            href: urlString`chrome://extensions`,\n          },\n        },\n      }],\n    });\n  });\n\n  it('renders disabled by Data Saver', async () => {\n    const view = createViewFunctionStub(PreloadingComponents.PreloadingDisabledInfobar.PreloadingDisabledInfobar);\n    const component = new PreloadingComponents.PreloadingDisabledInfobar.PreloadingDisabledInfobar(view);\n    component.disabledByDataSaver = true;\n    const input = await view.nextInput;\n\n    assert.deepEqual(input, {\n      header: i18n.i18n.lockedString('Speculative loading is disabled'),\n      warnings: [{\n        key: i18n.i18n.lockedString('Data Saver'),\n        valueId: 'Speculative loading is disabled because of the operating system\\'s Data Saver mode.',\n      }],\n    });\n  });\n\n  it('renders disabled by Battery Saver', async () => {\n    const view = createViewFunctionStub(PreloadingComponents.PreloadingDisabledInfobar.PreloadingDisabledInfobar);\n    const component = new PreloadingComponents.PreloadingDisabledInfobar.PreloadingDisabledInfobar(view);\n    component.disabledByBatterySaver = true;\n    const input = await view.nextInput;\n\n    assert.deepEqual(input, {\n      header: i18n.i18n.lockedString('Speculative loading is disabled'),\n      warnings: [{\n        key: i18n.i18n.lockedString('Battery Saver'),\n        valueId: 'Speculative loading is disabled because of the operating system\\'s Battery Saver mode.',\n      }],\n    });\n  });\n\n  it('renders force enabled by prefetch holdback', async () => {\n    const view = createViewFunctionStub(PreloadingComponents.PreloadingDisabledInfobar.PreloadingDisabledInfobar);\n    const component = new PreloadingComponents.PreloadingDisabledInfobar.PreloadingDisabledInfobar(view);\n    component.disabledByHoldbackPrefetchSpeculationRules = true;\n    const input = await view.nextInput;\n\n    assert.deepEqual(input, {\n      header: i18n.i18n.lockedString('Speculative loading is force-enabled'),\n      warnings: [{\n        key: i18n.i18n.lockedString('Prefetch was disabled, but is force-enabled now'),\n        valueId:\n            'Prefetch is forced-enabled because DevTools is open. When DevTools is closed, prefetch will be disabled because this browser session is part of a holdback group used for performance comparisons.',\n      }],\n    });\n  });\n\n  it('renders force enabled by prerender holdback', async () => {\n    const view = createViewFunctionStub(PreloadingComponents.PreloadingDisabledInfobar.PreloadingDisabledInfobar);\n    const component = new PreloadingComponents.PreloadingDisabledInfobar.PreloadingDisabledInfobar(view);\n    component.disabledByHoldbackPrerenderSpeculationRules = true;\n    const input = await view.nextInput;\n\n    assert.deepEqual(input, {\n      header: i18n.i18n.lockedString('Speculative loading is force-enabled'),\n      warnings: [{\n        key: i18n.i18n.lockedString('Prerendering was disabled, but is force-enabled now'),\n        valueId:\n            'Prerendering is forced-enabled because DevTools is open. When DevTools is closed, prerendering will be disabled because this browser session is part of a holdback group used for performance comparisons.',\n      }],\n    });\n  });\n\n  it('renders multiple warnings', async () => {\n    const view = createViewFunctionStub(PreloadingComponents.PreloadingDisabledInfobar.PreloadingDisabledInfobar);\n    const component = new PreloadingComponents.PreloadingDisabledInfobar.PreloadingDisabledInfobar(view);\n    component.disabledByPreference = true;\n    component.disabledByDataSaver = true;\n    component.disabledByBatterySaver = true;\n    component.disabledByHoldbackPrefetchSpeculationRules = true;\n    component.disabledByHoldbackPrerenderSpeculationRules = true;\n    const input = await view.nextInput;\n\n    assert.deepEqual(input, {\n      header: i18n.i18n.lockedString('Speculative loading is disabled'),\n      warnings: [\n        {\n          key: i18n.i18n.lockedString('User settings or extensions'),\n          valueId:\n              'Speculative loading is disabled because of user settings or an extension. Go to {PH1} to update your preference. Go to {PH2} to disable any extension that blocks speculative loading.',\n          placeholders: {\n            PH1: {\n              title: i18n.i18n.lockedString('Preload pages settings'),\n              href: urlString`chrome://settings/performance`,\n            },\n            PH2: {\n              title: i18n.i18n.lockedString('Extensions settings'),\n              href: urlString`chrome://extensions`,\n            },\n          },\n        },\n        {\n          key: i18n.i18n.lockedString('Data Saver'),\n          valueId: 'Speculative loading is disabled because of the operating system\\'s Data Saver mode.',\n        },\n        {\n          key: i18n.i18n.lockedString('Battery Saver'),\n          valueId: 'Speculative loading is disabled because of the operating system\\'s Battery Saver mode.',\n        },\n        {\n          key: i18n.i18n.lockedString('Prefetch was disabled, but is force-enabled now'),\n          valueId:\n              'Prefetch is forced-enabled because DevTools is open. When DevTools is closed, prefetch will be disabled because this browser session is part of a holdback group used for performance comparisons.',\n        },\n        {\n          key: i18n.i18n.lockedString('Prerendering was disabled, but is force-enabled now'),\n          valueId:\n              'Prerendering is forced-enabled because DevTools is open. When DevTools is closed, prerendering will be disabled because this browser session is part of a holdback group used for performance comparisons.',\n        },\n      ],\n    });\n  });\n});\n"]}