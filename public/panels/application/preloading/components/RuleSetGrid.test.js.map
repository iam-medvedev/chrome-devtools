{"version":3,"file":"RuleSetGrid.test.js","sourceRoot":"","sources":["../../../../../../../../front_end/panels/application/preloading/components/RuleSetGrid.test.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright 2023 The Chromium Authors\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport * as Common from '../../../../core/common/common.js';\nimport * as Platform from '../../../../core/platform/platform.js';\nimport * as SDK from '../../../../core/sdk/sdk.js';\nimport type * as Protocol from '../../../../generated/protocol.js';\nimport {createTarget, describeWithEnvironment} from '../../../../testing/EnvironmentHelpers.js';\nimport {createViewFunctionStub} from '../../../../testing/ViewFunctionHelpers.js';\nimport * as NetworkForward from '../../../network/forward/forward.js';\nimport * as PreloadingHelper from '../helper/helper.js';\n\nimport * as PreloadingComponents from './components.js';\n\nconst {urlString} = Platform.DevToolsPath;\n\ndescribeWithEnvironment('RuleSetGrid', () => {\n  it('updates view with correct data', async () => {\n    const view = createViewFunctionStub(PreloadingComponents.RuleSetGrid.RuleSetGrid);\n    const ruleSetGrid = new PreloadingComponents.RuleSetGrid.RuleSetGrid(view);\n    const data: PreloadingComponents.RuleSetGrid.RuleSetGridData = {\n      rows: [{\n        ruleSet: {\n          id: 'ruleSetId:0.1' as Protocol.Preload.RuleSetId,\n          loaderId: 'loaderId:1' as Protocol.Network.LoaderId,\n          sourceText: '{}',\n        },\n        preloadsStatusSummary: 'Summary',\n      }],\n      pageURL: urlString`https://example.com/`,\n    };\n\n    ruleSetGrid.data = data;\n    const input = await view.nextInput;\n    assert.deepEqual(input.data, data);\n  });\n\n  it('dispatches select event on onSelect', async () => {\n    const view = createViewFunctionStub(PreloadingComponents.RuleSetGrid.RuleSetGrid);\n    const ruleSetGrid = new PreloadingComponents.RuleSetGrid.RuleSetGrid(view);\n    const data: PreloadingComponents.RuleSetGrid.RuleSetGridData = {\n      rows: [],\n      pageURL: urlString`https://example.com/`,\n    };\n    ruleSetGrid.data = data;\n    const input = await view.nextInput;\n\n    const eventPromise = ruleSetGrid.once(PreloadingComponents.RuleSetGrid.Events.SELECT);\n\n    input.onSelect('ruleSetId:1' as Protocol.Preload.RuleSetId);\n\n    const ruleSetId = await eventPromise;\n    assert.strictEqual(ruleSetId, 'ruleSetId:1');\n  });\n\n  it('reveals in elements on onRevealInElements', async () => {\n    const view = createViewFunctionStub(PreloadingComponents.RuleSetGrid.RuleSetGrid);\n    const ruleSetGrid = new PreloadingComponents.RuleSetGrid.RuleSetGrid(view);\n    const target = createTarget();\n    SDK.TargetManager.TargetManager.instance().setScopeTarget(target);\n    const revealStub = sinon.stub(Common.Revealer.RevealerRegistry.prototype, 'reveal');\n\n    const data: PreloadingComponents.RuleSetGrid.RuleSetGridData = {\n      rows: [],\n      pageURL: urlString`https://example.com/`,\n    };\n    ruleSetGrid.data = data;\n    const input = await view.nextInput;\n\n    const ruleSet = {\n      id: 'ruleSetId:1' as Protocol.Preload.RuleSetId,\n      loaderId: 'loaderId:1' as Protocol.Network.LoaderId,\n      sourceText: '{}',\n      backendNodeId: 42 as Protocol.DOM.BackendNodeId,\n    };\n    input.onRevealInElements(ruleSet);\n\n    sinon.assert.calledOnce(revealStub);\n    const revealedObject = revealStub.firstCall.args[0];\n    assert.instanceOf(revealedObject, SDK.DOMModel.DeferredDOMNode);\n    assert.strictEqual((revealedObject as SDK.DOMModel.DeferredDOMNode).backendNodeId(), 42);\n  });\n\n  it('reveals in network on onRevealInNetwork', async () => {\n    const view = createViewFunctionStub(PreloadingComponents.RuleSetGrid.RuleSetGrid);\n    const ruleSetGrid = new PreloadingComponents.RuleSetGrid.RuleSetGrid(view);\n    const target = createTarget();\n    SDK.TargetManager.TargetManager.instance().setScopeTarget(target);\n    const networkManager = target.model(SDK.NetworkManager.NetworkManager);\n    assert.exists(networkManager);\n    const request = {requestId: 'requestId:1'} as unknown as SDK.NetworkRequest.NetworkRequest;\n\n    // Explicitly stub the method on the instance to avoid potential issues with prototype stubbing\n    const requestForIdStub = sinon.stub();\n    requestForIdStub.withArgs('requestId:1').returns(request);\n    networkManager!.requestForId = requestForIdStub;\n\n    const revealStub = sinon.stub(Common.Revealer.RevealerRegistry.prototype, 'reveal');\n\n    const data: PreloadingComponents.RuleSetGrid.RuleSetGridData = {\n      rows: [],\n      pageURL: urlString`https://example.com/`,\n    };\n    ruleSetGrid.data = data;\n    const input = await view.nextInput;\n\n    const ruleSet = {\n      id: 'ruleSetId:1' as Protocol.Preload.RuleSetId,\n      loaderId: 'loaderId:1' as Protocol.Network.LoaderId,\n      sourceText: '{}',\n      requestId: 'requestId:1' as Protocol.Network.RequestId,\n      url: 'https://example.com/rules.json',\n    };\n    input.onRevealInNetwork(ruleSet);\n\n    sinon.assert.calledOnce(revealStub);\n    const revealedObject = revealStub.firstCall.args[0];\n    assert.instanceOf(revealedObject, NetworkForward.UIRequestLocation.UIRequestLocation);\n    assert.strictEqual((revealedObject as NetworkForward.UIRequestLocation.UIRequestLocation).request, request);\n  });\n\n  it('reveals preloads on onRevealPreloadsAssociatedWithRuleSet', async () => {\n    const view = createViewFunctionStub(PreloadingComponents.RuleSetGrid.RuleSetGrid);\n    const ruleSetGrid = new PreloadingComponents.RuleSetGrid.RuleSetGrid(view);\n    const revealStub = sinon.stub(Common.Revealer.RevealerRegistry.prototype, 'reveal');\n\n    const data: PreloadingComponents.RuleSetGrid.RuleSetGridData = {\n      rows: [],\n      pageURL: urlString`https://example.com/`,\n    };\n    ruleSetGrid.data = data;\n    const input = await view.nextInput;\n\n    const ruleSet = {\n      id: 'ruleSetId:1' as Protocol.Preload.RuleSetId,\n      loaderId: 'loaderId:1' as Protocol.Network.LoaderId,\n      sourceText: '{}',\n    };\n    input.onRevealPreloadsAssociatedWithRuleSet(ruleSet);\n\n    sinon.assert.calledOnce(revealStub);\n    const revealedObject = revealStub.firstCall.args[0];\n    assert.instanceOf(revealedObject, PreloadingHelper.PreloadingForward.AttemptViewWithFilter);\n    assert.strictEqual(\n        (revealedObject as PreloadingHelper.PreloadingForward.AttemptViewWithFilter).ruleSetId, 'ruleSetId:1');\n  });\n});\n"]}