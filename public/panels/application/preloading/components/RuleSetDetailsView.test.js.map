{"version":3,"file":"RuleSetDetailsView.test.js","sourceRoot":"","sources":["../../../../../../../../front_end/panels/application/preloading/components/RuleSetDetailsView.test.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright 2023 The Chromium Authors\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport * as Protocol from '../../../../generated/protocol.js';\nimport {\n  renderElementIntoDOM,\n} from '../../../../testing/DOMHelpers.js';\nimport {describeWithEnvironment} from '../../../../testing/EnvironmentHelpers.js';\nimport {createViewFunctionStub} from '../../../../testing/ViewFunctionHelpers.js';\n\nimport * as PreloadingComponents from './components.js';\n\nfunction renderRuleSetDetailsView() {\n  const view = createViewFunctionStub(PreloadingComponents.RuleSetDetailsView.RuleSetDetailsView);\n  const component = new PreloadingComponents.RuleSetDetailsView.RuleSetDetailsView(undefined, view);\n  renderElementIntoDOM(component);\n  return {component, view};\n}\n\ndescribeWithEnvironment('RuleSetDetailsView', () => {\n  it('renders placeholder if not selected', async () => {\n    const {component, view} = renderRuleSetDetailsView();\n    component.ruleSet = null;\n\n    assert.isNull(await view.nextInput);\n  });\n\n  it('renders rule set', async () => {\n    const {component, view} = renderRuleSetDetailsView();\n    const sourceText = `\n{\n  \"prefetch\": [\n    {\n      \"source\": \"list\",\n      \"urls\": [\"/subresource.js\"]\n    }\n  ]\n}\n`;\n    component.ruleSet = {\n      id: 'ruleSetId:1' as Protocol.Preload.RuleSetId,\n      loaderId: 'loaderId:1' as Protocol.Network.LoaderId,\n      sourceText,\n      backendNodeId: 1 as Protocol.DOM.BackendNodeId,\n    };\n    component.shouldPrettyPrint = false;\n\n    const input = await view.nextInput;\n    assert.exists(input);\n    assert.isUndefined(input.errorMessage);\n    assert.strictEqual(input.sourceText, sourceText);\n  });\n\n  it('renders url when included', async () => {\n    const {component, view} = renderRuleSetDetailsView();\n    component.ruleSet = {\n      id: 'ruleSetId:1' as Protocol.Preload.RuleSetId,\n      loaderId: 'loaderId:1' as Protocol.Network.LoaderId,\n      sourceText: '<something valid>',\n      url: 'https://example.com/speculationrules.json',\n      requestId: 'requestId' as Protocol.Network.RequestId,\n    };\n\n    const input = await view.nextInput;\n    assert.exists(input);\n    assert.strictEqual(input.url, 'https://example.com/speculationrules.json');\n  });\n\n  it('renders the error message', async () => {\n    const {component, view} = renderRuleSetDetailsView();\n    component.ruleSet = {\n      id: 'ruleSetId:1' as Protocol.Preload.RuleSetId,\n      loaderId: 'loaderId:1' as Protocol.Network.LoaderId,\n      sourceText: '<something invalid>',\n      backendNodeId: 1 as Protocol.DOM.BackendNodeId,\n      errorType: Protocol.Preload.RuleSetErrorType.SourceIsNotJsonObject,\n      errorMessage: 'Line: 6, column: 1, Syntax error.',\n    };\n\n    const input = await view.nextInput;\n    assert.exists(input);\n    assert.strictEqual(input.errorMessage, 'Line: 6, column: 1, Syntax error.');\n  });\n\n  it('formats the source text', async () => {\n    const {component, view} = renderRuleSetDetailsView();\n    component.ruleSet = {\n      id: 'ruleSetId:1' as Protocol.Preload.RuleSetId,\n      loaderId: 'loaderId:1' as Protocol.Network.LoaderId,\n      sourceText: '{\"prefetch\":[{\"source\": \"list\",\"urls\": [\"/subresource.js\"]}]}',\n      backendNodeId: 1 as Protocol.DOM.BackendNodeId,\n    };\n\n    const input = await view.nextInput;\n    assert.exists(input);\n    assert.strictEqual(input.sourceText, `{\n    \"prefetch\": [\n        {\n            \"source\": \"list\",\n            \"urls\": [\n                \"/subresource.js\"\n            ]\n        }\n    ]\n}`);\n  });\n});\n"]}