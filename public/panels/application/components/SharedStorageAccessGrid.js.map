{"version":3,"file":"SharedStorageAccessGrid.js","sourceRoot":"","sources":["../../../../../../../front_end/panels/application/components/SharedStorageAccessGrid.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright 2022 The Chromium Authors. All rights reserved.\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport '../../../ui/legacy/components/data_grid/data_grid.js';\n\nimport * as i18n from '../../../core/i18n/i18n.js';\nimport type * as Protocol from '../../../generated/protocol.js';\n// inspectorCommonStyles is imported for the empty state styling that is used for the start view\n// eslint-disable-next-line rulesdir/es-modules-import\nimport inspectorCommonStylesRaw from '../../../ui/legacy/inspectorCommon.css.js';\nimport * as UI from '../../../ui/legacy/legacy.js';\nimport * as Lit from '../../../ui/lit/lit.js';\nimport * as VisualLogging from '../../../ui/visual_logging/visual_logging.js';\n\nimport sharedStorageAccessGridStylesRaw from './sharedStorageAccessGrid.css.js';\n\n// TODO(crbug.com/391381439): Fully migrate off of constructed style sheets.\nconst sharedStorageAccessGridStyles = new CSSStyleSheet();\nsharedStorageAccessGridStyles.replaceSync(sharedStorageAccessGridStylesRaw.cssContent);\n\n// TODO(crbug.com/391381439): Fully migrate off of constructed style sheets.\nconst inspectorCommonStyles = new CSSStyleSheet();\ninspectorCommonStyles.replaceSync(inspectorCommonStylesRaw.cssContent);\n\nconst SHARED_STORAGE_EXPLANATION_URL =\n    'https://developers.google.com/privacy-sandbox/private-advertising/shared-storage';\n\nconst {render, html} = Lit;\n\nconst UIStrings = {\n  /**\n   *@description Text in Shared Storage Events View of the Application panel\n   */\n  sharedStorage: 'Shared storage',\n  /**\n   *@description Hover text for an info icon in the Shared Storage Events panel\n   */\n  allSharedStorageEvents: 'All shared storage events for this page.',\n  /**\n   *@description Text in Shared Storage Events View of the Application panel\n   * Date and time of an Shared Storage event in a locale-\n   * dependent format.\n   */\n  eventTime: 'Event Time',\n  /**\n   *@description Text in Shared Storage Events View of the Application panel\n   * Type of shared storage event such as 'documentAddModule', 'documentRun',\n   * 'documentSet', 'workletDelete', or 'workletGet'.\n   */\n  eventType: 'Access Type',\n  /**\n   *@description Text in Shared Storage Events View of the Application panel\n   * Owner origin of the shared storage for this access event.\n   */\n  ownerOrigin: 'Owner Origin',\n  /**\n   *@description Text in Shared Storage Events View of the Application panel\n   * Event parameters whose presence/absence depend on the access type.\n   */\n  eventParams: 'Optional Event Params',\n  /**\n   *@description Text shown when no shared storage event is shown.\n   * Shared storage allows to store and access data that can be shared across different sites.\n   * A shared storage event is for example an access from a site to that storage.\n   */\n  noEvents: 'No shared storage events detected',\n  /**\n   *@description Text shown when no shared storage event is shown. It explains the shared storage event page.\n   * Shared storage allows to store and access data that can be shared across different sites.\n   * A shared storage event is for example an access from a site to that storage.\n   */\n  sharedStorageDescription:\n      'On this page you can view, add, edit and delete shared storage key-value pairs and view shared storage events.',\n  /**\n   * @description Text used in a link to learn more about the topic.\n   */\n  learnMore: 'Learn more',\n\n} as const;\n\nconst str_ = i18n.i18n.registerUIStrings('panels/application/components/SharedStorageAccessGrid.ts', UIStrings);\nexport const i18nString = i18n.i18n.getLocalizedString.bind(undefined, str_);\n\nexport class SharedStorageAccessGrid extends HTMLElement {\n  readonly #shadow = this.attachShadow({mode: 'open'});\n  #datastores: Protocol.Storage.SharedStorageAccessedEvent[] = [];\n\n  connectedCallback(): void {\n    this.#shadow.adoptedStyleSheets = [sharedStorageAccessGridStyles, inspectorCommonStyles];\n    this.#render();\n  }\n\n  // eslint-disable-next-line rulesdir/set-data-type-reference\n  set data(data: Protocol.Storage.SharedStorageAccessedEvent[]) {\n    this.#datastores = data.sort((a, b) => a.accessTime - b.accessTime);\n    this.#render();\n  }\n\n  #render(): void {\n    render(html`${this.#renderGridOrNoDataMessage()}`, this.#shadow, {host: this});\n  }\n\n  #renderGridOrNoDataMessage(): Lit.TemplateResult {\n    if (this.#datastores.length === 0) {\n      return html`\n        <div class=\"empty-state\" jslog=${VisualLogging.section().context('empty-view')}>\n          <div class=\"empty-state-header\">${i18nString(UIStrings.noEvents)}</div>\n          <div class=\"empty-state-description\">\n            <span>${i18nString(UIStrings.sharedStorageDescription)}</span>\n            ${\n          UI.XLink.XLink.create(\n              SHARED_STORAGE_EXPLANATION_URL, i18nString(UIStrings.learnMore), 'x-link', undefined, 'learn-more')}\n          </div>\n        </div>\n      `;\n    }\n    // clang-format off\n    return html`\n      <div>\n        <span class=\"heading\">${i18nString(UIStrings.sharedStorage)}</span>\n        <devtools-icon class=\"info-icon\"\n                        title=${i18nString(UIStrings.allSharedStorageEvents)}\n                        .data=${{iconName: 'info', color: 'var(--icon-default)', width: '16px'}}>\n        </devtools-icon>\n        <devtools-data-grid striped inline @select=${this.#onSelect}>\n          <table>\n            <tr>\n              <th id=\"event-time\" weight=\"10\" sortable>\n                ${i18nString(UIStrings.eventTime)}\n              </th>\n              <th id=\"event-type\" weight=\"10\" sortable>\n                ${i18nString(UIStrings.eventType)}\n              </th>\n              <th id=\"event-owner-origin\" weight=\"10\" sortable>\n                ${i18nString(UIStrings.ownerOrigin)}\n              </th>\n              <th id=\"event-params\" weight=\"10\" sortable>\n                ${i18nString(UIStrings.eventParams)}\n              </th>\n            </tr>\n            ${\n        this.#datastores.map((event, index) => html`\n              <tr data-index=${index}>\n                <td data-value=${event.accessTime}>\n                  ${\n            new Date(1e3 * event.accessTime)\n                .toLocaleString()}\n                </td>\n                <td>${event.type}</td>\n                <td>${event.ownerOrigin}</td>\n                <td>${JSON.stringify(event.params)}</td>\n              </tr>\n            `)}\n          </table>\n        </devtools-data-grid>\n      </div>\n    `;\n    // clang-format on\n  }\n\n  #onSelect(event: CustomEvent<HTMLElement>): void {\n    const index = parseInt(event.detail.dataset.index || '', 10);\n    const datastore = isNaN(index) ? undefined : this.#datastores[index];\n    if (datastore) {\n      this.dispatchEvent(new CustomEvent('select', {detail: datastore}));\n    }\n  }\n}\n\ncustomElements.define('devtools-shared-storage-access-grid', SharedStorageAccessGrid);\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    'devtools-shared-storage-access-grid': SharedStorageAccessGrid;\n  }\n}\n"]}