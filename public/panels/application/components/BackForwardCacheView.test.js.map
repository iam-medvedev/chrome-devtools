{"version":3,"file":"BackForwardCacheView.test.js","sourceRoot":"","sources":["../../../../../../../front_end/panels/application/components/BackForwardCacheView.test.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright 2023 The Chromium Authors\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport type * as Platform from '../../../core/platform/platform.js';\nimport * as SDK from '../../../core/sdk/sdk.js';\nimport * as Protocol from '../../../generated/protocol.js';\nimport {\n  dispatchClickEvent,\n  renderElementIntoDOM,\n} from '../../../testing/DOMHelpers.js';\nimport {createTarget} from '../../../testing/EnvironmentHelpers.js';\nimport {describeWithMockConnection} from '../../../testing/MockConnection.js';\nimport {getMainFrame, navigate, setMockResourceTree} from '../../../testing/ResourceTreeHelpers.js';\nimport {createViewFunctionStub} from '../../../testing/ViewFunctionHelpers.js';\n\nimport * as ApplicationComponents from './components.js';\n\nasync function renderBackForwardCacheView(): Promise<ApplicationComponents.BackForwardCacheView.BackForwardCacheView> {\n  const component = new ApplicationComponents.BackForwardCacheView.BackForwardCacheView();\n  renderElementIntoDOM(component);\n  component.requestUpdate();\n  await component.updateComplete;\n  return component;\n}\n\ndescribeWithMockConnection('BackForwardCacheView', () => {\n  let target: SDK.Target.Target;\n  let resourceTreeModel: SDK.ResourceTreeModel.ResourceTreeModel;\n\n  beforeEach(async () => {\n    setMockResourceTree(false);\n    const tabTarget = createTarget({type: SDK.Target.Type.TAB});\n    createTarget({parentTarget: tabTarget, subtype: 'prerender'});\n    target = createTarget({parentTarget: tabTarget});\n    resourceTreeModel =\n        target.model(SDK.ResourceTreeModel.ResourceTreeModel) as SDK.ResourceTreeModel.ResourceTreeModel;\n  });\n\n  it('updates BFCacheView on main frame navigation', async () => {\n    await renderBackForwardCacheView();\n    navigate(getMainFrame(target), {}, Protocol.Page.NavigationType.BackForwardCacheRestore);\n  });\n\n  it('updates BFCacheView on BFCache detail update', async () => {\n    await renderBackForwardCacheView();\n    resourceTreeModel.dispatchEventToListeners(\n        SDK.ResourceTreeModel.Events.BackForwardCacheDetailsUpdated, getMainFrame(target));\n  });\n\n  it('renders status if restored from BFCache', async () => {\n    resourceTreeModel.mainFrame = {\n      url: 'https://www.example.com/',\n      backForwardCacheDetails: {\n        restoredFromCache: true,\n        explanations: [],\n      },\n    } as unknown as SDK.ResourceTreeModel.ResourceTreeFrame;\n    const component = await renderBackForwardCacheView();\n    const renderedStatus = component.contentElement.querySelector('devtools-report-section');\n    assert.strictEqual(renderedStatus?.textContent?.trim(), 'Successfully served from back/forward cache.');\n  });\n\n  it('renders explanations if not restorable from BFCache', async () => {\n    resourceTreeModel.mainFrame = {\n      url: 'https://www.example.com/',\n      backForwardCacheDetails: {\n        restoredFromCache: false,\n        explanations: [\n          {\n            type: Protocol.Page.BackForwardCacheNotRestoredReasonType.SupportPending,\n            reason: Protocol.Page.BackForwardCacheNotRestoredReason.WebLocks,\n          },\n          {\n            type: Protocol.Page.BackForwardCacheNotRestoredReasonType.PageSupportNeeded,\n            reason: Protocol.Page.BackForwardCacheNotRestoredReason.ServiceWorkerUnregistration,\n          },\n          {\n            type: Protocol.Page.BackForwardCacheNotRestoredReasonType.Circumstantial,\n            reason: Protocol.Page.BackForwardCacheNotRestoredReason.MainResourceHasCacheControlNoStore,\n          },\n        ],\n      },\n    } as unknown as SDK.ResourceTreeModel.ResourceTreeFrame;\n    const component = await renderBackForwardCacheView();\n    const sectionHeaders = component.contentElement.querySelectorAll('devtools-report-section-header');\n    const sectionHeadersText = Array.from(sectionHeaders).map(sectionHeader => sectionHeader.textContent?.trim());\n    assert.deepEqual(sectionHeadersText, ['Actionable', 'Pending Support', 'Not Actionable']);\n\n    const sections = component.contentElement.querySelectorAll('devtools-report-section');\n    const sectionsText = Array.from(sections).map(section => section.textContent?.trim());\n    const expected = [\n      'Not served from back/forward cache: to trigger back/forward cache, use Chrome\\'s back/forward buttons, or use the test button below to automatically navigate away and back.',\n      'Test back/forward cache',\n      'ServiceWorker was unregistered while a page was in back/forward cache.',\n      'Pages that use WebLocks are not currently eligible for back/forward cache.',\n      'Pages whose main resource has cache-control:no-store cannot enter back/forward cache.',\n      'Learn more: back/forward cache eligibility',\n    ];\n    assert.deepEqual(sectionsText, expected);\n  });\n\n  it('renders explanation tree', async () => {\n    resourceTreeModel.mainFrame = {\n      url: 'https://www.example.com/',\n      backForwardCacheDetails: {\n        restoredFromCache: false,\n        explanationsTree: {\n          url: 'https://www.example.com',\n          explanations: [{\n            type: Protocol.Page.BackForwardCacheNotRestoredReasonType.SupportPending,\n            reason: Protocol.Page.BackForwardCacheNotRestoredReason.WebLocks,\n          }],\n          children: [{\n            url: 'https://www.example.com/frame.html',\n            explanations: [{\n              type: Protocol.Page.BackForwardCacheNotRestoredReasonType.Circumstantial,\n              reason: Protocol.Page.BackForwardCacheNotRestoredReason.MainResourceHasCacheControlNoStore,\n            }],\n            children: [],\n          }],\n        },\n        explanations: [\n          {\n            type: Protocol.Page.BackForwardCacheNotRestoredReasonType.SupportPending,\n            reason: Protocol.Page.BackForwardCacheNotRestoredReason.WebLocks,\n          },\n          {\n            type: Protocol.Page.BackForwardCacheNotRestoredReasonType.Circumstantial,\n            reason: Protocol.Page.BackForwardCacheNotRestoredReason.MainResourceHasCacheControlNoStore,\n          },\n        ],\n      },\n    } as unknown as SDK.ResourceTreeModel.ResourceTreeFrame;\n    const view = createViewFunctionStub(ApplicationComponents.BackForwardCacheView.BackForwardCacheView);\n    new ApplicationComponents.BackForwardCacheView.BackForwardCacheView(view);\n\n    const treeData = (await view.nextInput).frameTreeData;\n\n    const expected = {\n      frameCount: 2,\n      issueCount: 2,\n      node: {\n        text: '(2) https://www.example.com',\n        iconName: 'frame',\n        children: [\n          {\n            text: 'WebLocks',\n          },\n          {\n            text: '(1) https://www.example.com/frame.html',\n            iconName: 'iframe',\n            children: [\n              {\n                text: 'MainResourceHasCacheControlNoStore',\n              },\n            ],\n          },\n        ],\n      },\n    };\n\n    assert.deepEqual(treeData, expected);\n  });\n\n  it('renders blocking details if available', async () => {\n    resourceTreeModel.mainFrame = {\n      resourceForURL: () => null,\n      url: 'https://www.example.com/',\n      backForwardCacheDetails: {\n        restoredFromCache: false,\n        explanations: [\n          {\n            type: Protocol.Page.BackForwardCacheNotRestoredReasonType.SupportPending,\n            reason: Protocol.Page.BackForwardCacheNotRestoredReason.WebLocks,\n            details: [\n              {url: 'https://www.example.com/index.html', lineNumber: 10, columnNumber: 5},\n              {url: 'https://www.example.com/script.js', lineNumber: 15, columnNumber: 20},\n            ],\n          },\n        ],\n      },\n    } as unknown as SDK.ResourceTreeModel.ResourceTreeFrame;\n\n    const component = await renderBackForwardCacheView();\n    const sectionHeaders = component.contentElement.querySelectorAll('devtools-report-section-header');\n    const sectionHeadersText = Array.from(sectionHeaders).map(sectionHeader => sectionHeader.textContent?.trim());\n    assert.deepEqual(sectionHeadersText, ['Pending Support']);\n\n    const sections = component.contentElement.querySelectorAll('devtools-report-section');\n    const sectionsText = Array.from(sections).map(section => section.textContent?.trim());\n    const expected = [\n      'Not served from back/forward cache: to trigger back/forward cache, use Chrome\\'s back/forward buttons, or use the test button below to automatically navigate away and back.',\n      'Test back/forward cache',\n      'Pages that use WebLocks are not currently eligible for back/forward cache.',\n      'Learn more: back/forward cache eligibility',\n    ];\n    assert.deepEqual(sectionsText, expected);\n\n    const details = component.contentElement.querySelector('.details-list devtools-expandable-list');\n    details!.shadowRoot!.querySelector('button')!.click();\n    const items = details!.shadowRoot!.querySelectorAll('.expandable-list-items .devtools-link');\n    const detailsText = Array.from(items).map(detail => detail.textContent?.trim());\n    assert.deepEqual(detailsText, ['www.example.com/index.html:11:6', 'www.example.com/script.js:16:21']);\n  });\n\n  it('can handle delayed navigation history when testing for BFcache availability', async () => {\n    const entries = [\n      {\n        id: 5,\n        url: 'about:blank',\n        userTypedURL: 'about:blank',\n        title: '',\n        transitionType: Protocol.Page.TransitionType.Typed,\n      },\n      {\n        id: 8,\n        url: 'chrome://terms/',\n        userTypedURL: '',\n        title: '',\n        transitionType: Protocol.Page.TransitionType.Typed,\n      },\n    ];\n    const stub = sinon.stub();\n    stub.onCall(0).returns({entries, currentIndex: 0});\n    stub.onCall(1).returns({entries, currentIndex: 0});\n    stub.onCall(2).returns({entries, currentIndex: 0});\n    stub.onCall(3).returns({entries, currentIndex: 0});\n    stub.onCall(4).returns({entries, currentIndex: 1});\n    resourceTreeModel.navigationHistory = stub;\n\n    resourceTreeModel.navigate = (url: Platform.DevToolsPath.UrlString) => {\n      resourceTreeModel.frameNavigated({url} as unknown as Protocol.Page.Frame, undefined);\n      return Promise.resolve({frameId: '' as Protocol.Page.FrameId, getError(): undefined {}});\n    };\n    resourceTreeModel.navigateToHistoryEntry = (entry: Protocol.Page.NavigationEntry) => {\n      resourceTreeModel.frameNavigated({url: entry.url} as unknown as Protocol.Page.Frame, undefined);\n    };\n    const navigateToHistoryEntrySpy = sinon.spy(resourceTreeModel, 'navigateToHistoryEntry');\n    resourceTreeModel.storageKeyForFrame = () => Promise.resolve(null);\n\n    resourceTreeModel.mainFrame = {\n      url: 'about:blank',\n      backForwardCacheDetails: {\n        restoredFromCache: true,\n        explanations: [],\n      },\n    } as unknown as SDK.ResourceTreeModel.ResourceTreeFrame;\n    const component = await renderBackForwardCacheView();\n    const button = component.contentElement.querySelector('[aria-label=\"Test back/forward cache\"]');\n    assert.instanceOf(button, HTMLElement);\n    dispatchClickEvent(button);\n\n    await new Promise<void>(resolve => {\n      let eventCounter = 0;\n      resourceTreeModel.addEventListener(SDK.ResourceTreeModel.Events.FrameNavigated, () => {\n        if (++eventCounter === 2) {\n          resolve();\n        }\n      });\n    });\n    sinon.assert.calledOnceWithExactly(navigateToHistoryEntrySpy, entries[0]);\n  });\n});\n"]}