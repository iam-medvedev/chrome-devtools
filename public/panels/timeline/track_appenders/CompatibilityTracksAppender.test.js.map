{"version":3,"file":"CompatibilityTracksAppender.test.js","sourceRoot":"","sources":["../../../../../../../front_end/panels/timeline/track_appenders/CompatibilityTracksAppender.test.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright 2023 The Chromium Authors. All rights reserved.\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport * as Trace from '../../../models/trace/trace.js';\nimport {describeWithEnvironment} from '../../../testing/EnvironmentHelpers.js';\nimport {setupIgnoreListManagerEnvironment} from '../../../testing/TraceHelpers.js';\nimport {TraceLoader} from '../../../testing/TraceLoader.js';\nimport * as PerfUI from '../../../ui/legacy/components/perf_ui/perf_ui.js';\nimport * as Timeline from '../timeline.js';\n\ndescribeWithEnvironment('CompatibilityTracksAppender', function() {\n  let parsedTrace: Trace.Handlers.Types.ParsedTrace;\n  let tracksAppender: Timeline.CompatibilityTracksAppender.CompatibilityTracksAppender;\n  let entryData: Trace.Types.Events.Event[] = [];\n  let flameChartData = PerfUI.FlameChart.FlameChartTimelineData.createEmpty();\n  let entryTypeByLevel: Timeline.TimelineFlameChartDataProvider.EntryType[] = [];\n\n  async function initTrackAppender(\n      context: Mocha.Suite|Mocha.Context, fixture = 'timings-track.json.gz'): Promise<void> {\n    entryData = [];\n    flameChartData = PerfUI.FlameChart.FlameChartTimelineData.createEmpty();\n    entryTypeByLevel = [];\n    ({parsedTrace} = await TraceLoader.traceEngine(context, fixture));\n    const entityMapper = new Timeline.Utils.EntityMapper.EntityMapper(parsedTrace);\n    tracksAppender = new Timeline.CompatibilityTracksAppender.CompatibilityTracksAppender(\n        flameChartData, parsedTrace, entryData, entryTypeByLevel, entityMapper);\n    const timingsTrack = tracksAppender.timingsTrackAppender();\n    const gpuTrack = tracksAppender.gpuTrackAppender();\n    const threadAppenders = tracksAppender.threadAppenders();\n    let currentLevel = timingsTrack.appendTrackAtLevel(0);\n    currentLevel = gpuTrack.appendTrackAtLevel(currentLevel);\n    for (const threadAppender of threadAppenders) {\n      currentLevel = threadAppender.appendTrackAtLevel(currentLevel);\n    }\n  }\n\n  beforeEach(async () => {\n    setupIgnoreListManagerEnvironment();\n    await initTrackAppender(this);\n  });\n\n  describe('Tree view data', () => {\n    describe('eventsInTrack', () => {\n      it('returns all the events appended by a track with multiple levels', () => {\n        const timingsTrack = tracksAppender.timingsTrackAppender();\n        const timingsTrackEvents = tracksAppender.eventsInTrack(timingsTrack);\n        const allTimingEvents = [\n          ...parsedTrace.UserTimings.consoleTimings,\n          ...parsedTrace.UserTimings.timestampEvents,\n          ...parsedTrace.UserTimings.performanceMarks,\n          ...parsedTrace.UserTimings.performanceMeasures,\n        ].sort((a, b) => a.ts - b.ts);\n        assert.deepEqual(timingsTrackEvents, allTimingEvents);\n      });\n\n      it('returns all the events appended by a track with one level', () => {\n        const gpuTrack = tracksAppender.gpuTrackAppender();\n        const gpuTrackEvents = tracksAppender.eventsInTrack(gpuTrack) as readonly Trace.Types.Events.Event[];\n        assert.deepEqual(gpuTrackEvents, parsedTrace.GPU.mainGPUThreadTasks);\n      });\n    });\n    describe('eventsForTreeView', () => {\n      it('returns only sync events if using async events means a tree cannot be built', () => {\n        const timingsTrack = tracksAppender.timingsTrackAppender();\n        const timingsEvents = tracksAppender.eventsInTrack(timingsTrack);\n        assert.isFalse(Trace.Helpers.TreeHelpers.canBuildTreesFromEvents(timingsEvents));\n        const treeEvents = tracksAppender.eventsForTreeView(timingsTrack);\n        const allEventsAreSync = treeEvents.every(event => !Trace.Types.Events.isPhaseAsync(event.ph));\n        assert.isTrue(allEventsAreSync);\n      });\n      it('returns both sync and async events if a tree can be built with them', async () => {\n        // This file contains events in the timings track that can be assembled as a tree\n        await initTrackAppender(this, 'sync-like-timings.json.gz');\n        const timingsTrack = tracksAppender.timingsTrackAppender();\n        const timingsEvents = tracksAppender.eventsInTrack(timingsTrack);\n        assert.isTrue(Trace.Helpers.TreeHelpers.canBuildTreesFromEvents(timingsEvents));\n        const treeEvents = tracksAppender.eventsForTreeView(timingsTrack);\n        assert.deepEqual(treeEvents, timingsEvents);\n      });\n\n      it('returns events for tree view for nested tracks', async () => {\n        // This file contains two rasterizer threads which should be\n        // nested inside the same header.\n        await initTrackAppender(this, 'lcp-images-rasterizer.json.gz');\n        const rasterTracks = tracksAppender.threadAppenders().filter(\n            threadAppender => threadAppender.threadType === Trace.Handlers.Threads.ThreadType.RASTERIZER);\n        assert.lengthOf(rasterTracks, 2);\n\n        const raster1Events = tracksAppender.eventsInTrack(rasterTracks[0]);\n        assert.lengthOf(raster1Events, 6);\n        assert.isTrue(Trace.Helpers.TreeHelpers.canBuildTreesFromEvents(raster1Events));\n        const raster1TreeEvents = tracksAppender.eventsForTreeView(rasterTracks[0]);\n        assert.deepEqual(raster1TreeEvents, raster1Events);\n\n        const raster2Events = tracksAppender.eventsInTrack(rasterTracks[1]);\n        assert.lengthOf(raster2Events, 1);\n        assert.isTrue(Trace.Helpers.TreeHelpers.canBuildTreesFromEvents(raster2Events));\n        const raster2TreeEvents = tracksAppender.eventsForTreeView(rasterTracks[1]);\n        assert.deepEqual(raster2TreeEvents, raster2Events);\n      });\n    });\n    describe('groupEventsForTreeView', () => {\n      it('returns all the events of a flame chart group with multiple levels', async () => {\n        // This file contains events in the timings track that can be assembled as a tree\n        await initTrackAppender(this, 'sync-like-timings.json.gz');\n        const timingsGroupEvents = tracksAppender.groupEventsForTreeView(flameChartData.groups[0]);\n        if (!timingsGroupEvents) {\n          assert.fail('Could not find events for group');\n        }\n        const allTimingEvents = [\n          ...parsedTrace.UserTimings.consoleTimings,\n          ...parsedTrace.UserTimings.timestampEvents,\n          ...parsedTrace.UserTimings.performanceMarks,\n          ...parsedTrace.UserTimings.performanceMeasures,\n        ].sort((a, b) => a.ts - b.ts);\n        assert.deepEqual(timingsGroupEvents, allTimingEvents);\n      });\n      it('returns all the events of a flame chart group with one level', () => {\n        const gpuGroupEvents =\n            tracksAppender.groupEventsForTreeView(flameChartData.groups[1]) as readonly Trace.Types.Events.Event[];\n        if (!gpuGroupEvents) {\n          assert.fail('Could not find events for group');\n        }\n        assert.deepEqual(gpuGroupEvents, parsedTrace.GPU.mainGPUThreadTasks);\n      });\n    });\n  });\n\n  describe('popoverInfo', () => {\n    it('shows the correct warning for a long task when hovered', async function() {\n      await initTrackAppender(this, 'simple-js-program.json.gz');\n      const events = parsedTrace.Renderer?.allTraceEntries;\n      if (!events) {\n        throw new Error('Could not find renderer events');\n      }\n      const longTask = events.find(e => (e.dur || 0) > 1_000_000);\n      if (!longTask) {\n        throw new Error('Could not find long task');\n      }\n      const info = tracksAppender.popoverInfo(longTask, 2);\n      assert.strictEqual(info.warningElements?.length, 1);\n      const warning = info.warningElements?.[0];\n      if (!(warning instanceof HTMLSpanElement)) {\n        throw new Error('Found unexpected warning');\n      }\n      assert.strictEqual(warning?.innerText, 'Long task took 1.30\\u00A0s.');\n    });\n\n    it('shows the correct warning for a forced recalc styles when hovered', async function() {\n      await initTrackAppender(this, 'large-layout-small-recalc.json.gz');\n      const events = parsedTrace.Warnings.perWarning.get('FORCED_REFLOW') || [];\n\n      if (!events) {\n        throw new Error('Could not find forced reflows events');\n      }\n      const recalcStyles = events[0];\n      if (!recalcStyles) {\n        throw new Error('Could not find recalc styles');\n      }\n      const info = tracksAppender.popoverInfo(recalcStyles, 2);\n      assert.strictEqual(info.warningElements?.length, 1);\n      const warning = info.warningElements?.[0];\n      if (!(warning instanceof HTMLSpanElement)) {\n        throw new Error('Found unexpected warning');\n      }\n      assert.strictEqual(warning?.innerText, 'Forced reflow is a likely performance bottleneck.');\n    });\n\n    it('shows the correct warning for a forced layout when hovered', async function() {\n      await initTrackAppender(this, 'large-layout-small-recalc.json.gz');\n      const events = parsedTrace.Warnings.perWarning.get('FORCED_REFLOW') || [];\n\n      if (!events) {\n        throw new Error('Could not find forced reflows events');\n      }\n      const layout = events[1];\n      if (!layout) {\n        throw new Error('Could not find layout');\n      }\n      const info = tracksAppender.popoverInfo(layout, 2);\n      assert.strictEqual(info.warningElements?.length, 1);\n      const warning = info.warningElements?.[0];\n      if (!(warning instanceof HTMLSpanElement)) {\n        throw new Error('Found unexpected warning');\n      }\n      assert.strictEqual(warning?.innerText, 'Forced reflow is a likely performance bottleneck.');\n    });\n\n    it('shows the correct warning for slow idle callbacks', async function() {\n      await initTrackAppender(this, 'idle-callback.json.gz');\n      const events = parsedTrace.Renderer?.allTraceEntries;\n      if (!events) {\n        throw new Error('Could not find renderer events');\n      }\n      const idleCallback = events.find(event => {\n        const {duration} = Trace.Helpers.Timing.eventTimingsMilliSeconds(event);\n        if (!Trace.Types.Events.isFireIdleCallback(event)) {\n          return false;\n        }\n        if (duration <= event.args.data.allottedMilliseconds) {\n          false;\n        }\n        return true;\n      });\n      if (!idleCallback) {\n        throw new Error('Could not find idle callback');\n      }\n      const info = tracksAppender.popoverInfo(idleCallback, 2);\n      assert.strictEqual(info.warningElements?.length, 1);\n      const warning = info.warningElements?.[0];\n      if (!(warning instanceof HTMLSpanElement)) {\n        throw new Error('Found unexpected warning');\n      }\n      assert.strictEqual(warning?.innerText, 'Idle callback execution extended beyond deadline by 79.56\\u00A0ms');\n    });\n  });\n\n  it('can return the group for a given level', async () => {\n    await initTrackAppender(this, 'web-dev-with-commit.json.gz');\n    // The order of these groups might seem odd, but it's based on the setup in\n    // the initTrackAppender function which does GPU and then threads.\n    const groupForLevel0 = tracksAppender.groupForLevel(0);\n    assert.strictEqual(groupForLevel0?.name, 'GPU');\n    const groupForLevel1 = tracksAppender.groupForLevel(1);\n    assert.strictEqual(groupForLevel1?.name, 'Main — https://web.dev/');\n  });\n});\n"]}