{"version":3,"file":"ExtensionTrackAppender.test.js","sourceRoot":"","sources":["../../../../../../../front_end/panels/timeline/track_appenders/ExtensionTrackAppender.test.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright 2024 The Chromium Authors. All rights reserved.\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport { // eslint-disable-line rulesdir/es-modules-import\n  createTraceExtensionDataFromPerformanceAPITestInput,\n  type PerformanceAPIExtensionTestData,\n} from '../../../models/trace/handlers/ExtensionTraceDataHandler.test.js';\nimport * as Trace from '../../../models/trace/trace.js';\nimport {describeWithEnvironment} from '../../../testing/EnvironmentHelpers.js';\nimport {getBaseTraceParseModelData} from '../../../testing/TraceHelpers.js';\nimport {TraceLoader} from '../../../testing/TraceLoader.js';\nimport * as PerfUI from '../../../ui/legacy/components/perf_ui/perf_ui.js';\nimport * as ThemeSupport from '../../../ui/legacy/theme_support/theme_support.js';\nimport * as Timeline from '../timeline.js';\n\nfunction initTrackAppender(\n    flameChartData: PerfUI.FlameChart.FlameChartTimelineData, parsedTrace: Trace.Handlers.Types.ParsedTrace,\n    entryData: Trace.Types.Events.Event[], entryTypeByLevel: Timeline.TimelineFlameChartDataProvider.EntryType[]):\n    Timeline.ExtensionTrackAppender.ExtensionTrackAppender[] {\n  const entityMapper = new Timeline.Utils.EntityMapper.EntityMapper(parsedTrace);\n  const compatibilityTracksAppender = new Timeline.CompatibilityTracksAppender.CompatibilityTracksAppender(\n      flameChartData, parsedTrace, entryData, entryTypeByLevel, entityMapper);\n\n  return compatibilityTracksAppender.allVisibleTrackAppenders().filter(track => track.appenderName === 'Extension') as\n      Timeline.ExtensionTrackAppender.ExtensionTrackAppender[];\n}\n\ndescribeWithEnvironment('ExtensionTrackAppender', function() {\n  let parsedTrace: Trace.Handlers.Types.ParsedTrace;\n  let extensionTrackAppenders: Timeline.ExtensionTrackAppender.ExtensionTrackAppender[];\n  let entryData: Trace.Types.Events.Event[] = [];\n  let flameChartData = PerfUI.FlameChart.FlameChartTimelineData.createEmpty();\n  let entryTypeByLevel: Timeline.TimelineFlameChartDataProvider.EntryType[] = [];\n\n  beforeEach(async function() {\n    ({parsedTrace} = await TraceLoader.traceEngine(this, 'extension-tracks-and-marks.json.gz'));\n    extensionTrackAppenders = initTrackAppender(flameChartData, parsedTrace, entryData, entryTypeByLevel);\n    let level = 0;\n    extensionTrackAppenders.forEach(appender => {\n      level = appender.appendTrackAtLevel(level);\n    });\n  });\n\n  afterEach(() => {\n    entryData = [];\n    flameChartData = PerfUI.FlameChart.FlameChartTimelineData.createEmpty();\n    entryTypeByLevel = [];\n  });\n\n  describe('appendTrackAtLevel', function() {\n    it('creates flamechart groups for the Extension tracks properly', function() {\n      assert.lengthOf(flameChartData.groups, 3);\n      assert.strictEqual(flameChartData.groups[0].name, 'A track group — Custom track');\n      assert.strictEqual(flameChartData.groups[0].startLevel, 0);\n      assert.strictEqual(flameChartData.groups[0].style.nestingLevel, 0);\n      assert.strictEqual(flameChartData.groups[1].name, 'Another Extension Track');\n      assert.strictEqual(flameChartData.groups[1].startLevel, 0);\n      assert.strictEqual(flameChartData.groups[1].style.nestingLevel, 1);\n      assert.strictEqual(flameChartData.groups[2].name, 'An Extension Track — Custom track');\n      assert.strictEqual(flameChartData.groups[2].startLevel, 1);\n      assert.strictEqual(flameChartData.groups[2].style.nestingLevel, 0);\n    });\n\n    it('adds start times correctly', function() {\n      const allExtensionTrackEntries =\n          parsedTrace.ExtensionTraceData.extensionTrackData.map(track => Object.values(track.entriesByTrack)).flat(2);\n      for (let i = 0; i < allExtensionTrackEntries.length; ++i) {\n        const event = allExtensionTrackEntries[i];\n        assert.strictEqual(flameChartData.entryStartTimes[i], Trace.Helpers.Timing.microToMilli(event.ts));\n      }\n    });\n\n    it('adds total times correctly', function() {\n      const allExtensionTrackEntries =\n          parsedTrace.ExtensionTraceData.extensionTrackData.map(track => Object.values(track.entriesByTrack)).flat(2);\n      for (let i = 0; i < allExtensionTrackEntries.length; i++) {\n        const event = allExtensionTrackEntries[i];\n        if (Trace.Types.Events.isMarkerEvent(event)) {\n          assert.isNaN(flameChartData.entryTotalTimes[i]);\n          continue;\n        }\n        const expectedTotalTimeForEvent = event.dur ?\n            Trace.Helpers.Timing.microToMilli(event.dur) :\n            Timeline.TimelineFlameChartDataProvider.InstantEventVisibleDurationMs;\n        assert.strictEqual(flameChartData.entryTotalTimes[i], expectedTotalTimeForEvent);\n      }\n    });\n\n    it('Assigns a lower level (closer to the top) to an event buffered later when start and end times are equal',\n       async function() {\n         // Three extension entries with same start and end time.\n         // Test they are appended in inverse order.\n         const extensionData = [\n           {\n             detail: {\n               devtools: {dataType: 'track-entry', track: 'track'},\n             },\n             name: 'First measurement',\n             ts: 100,\n             dur: 100,\n           },\n           {\n             detail: {devtools: {track: 'track'}},\n             name: 'Second measurement',\n             ts: 100,\n             dur: 100,\n           },\n           {\n             detail: {devtools: {track: 'track'}},\n             name: 'Third measurement',\n             ts: 100,\n             dur: 100,\n           },\n         ] as PerformanceAPIExtensionTestData[];\n         const traceExtensionData = await createTraceExtensionDataFromPerformanceAPITestInput(extensionData);\n         const testParsedTrace = getBaseTraceParseModelData({ExtensionTraceData: traceExtensionData});\n         entryData = [];\n         flameChartData = PerfUI.FlameChart.FlameChartTimelineData.createEmpty();\n         entryTypeByLevel = [];\n         extensionTrackAppenders = initTrackAppender(flameChartData, testParsedTrace, entryData, entryTypeByLevel);\n         let level = 0;\n         extensionTrackAppenders.forEach(appender => {\n           level = appender.appendTrackAtLevel(level);\n         });\n         const indexForFirst = entryData.findIndex(e => e.name === 'First measurement');\n         const indexForSecond = entryData.findIndex(e => e.name === 'Second measurement');\n         const indexForThird = entryData.findIndex(e => e.name === 'Third measurement');\n         assert.strictEqual(flameChartData.entryLevels[indexForThird], 0);\n         assert.strictEqual(flameChartData.entryLevels[indexForSecond], 1);\n         assert.strictEqual(flameChartData.entryLevels[indexForFirst], 2);\n       });\n  });\n\n  describe('colorForEvent and titleForEvent', function() {\n    before(() => {\n      // Rather than use the real colours here and burden the test with having to\n      // inject loads of CSS, we fake out the colours. this is fine for our tests as\n      // the exact value of the colours is not important; we just make sure that it\n      // parses them out correctly. Each variable is given a different rgb() value to\n      // ensure we know the code is working and using the right one.\n      const styleElement = document.createElement('style');\n      styleElement.id = 'fake-perf-panel-colors';\n      styleElement.textContent = `\n        :root {\n          --ref-palette-blue70: rgb(4 4 4);\n          --ref-palette-green70: rgb(10 10 10);\n        }\n      `;\n      document.documentElement.appendChild(styleElement);\n      ThemeSupport.ThemeSupport.clearThemeCache();\n    });\n\n    after(() => {\n      const styleElementToRemove = document.documentElement.querySelector('#fake-perf-panel-colors');\n      if (styleElementToRemove) {\n        document.documentElement.removeChild(styleElementToRemove);\n      }\n      ThemeSupport.ThemeSupport.clearThemeCache();\n    });\n    it('returns the correct color and title for extension entries', function() {\n      const allExtensionTrackEntries =\n          parsedTrace.ExtensionTraceData.extensionTrackData.map(track => Object.values(track.entriesByTrack)).flat(2);\n      for (const event of allExtensionTrackEntries) {\n        assert.strictEqual(extensionTrackAppenders[0].titleForEvent(event), event.name);\n        if (event.args.color === 'tertiary') {\n          // \"tertiary\" color category is mapped to --ref-palette-green70\n          // which is faked out to 10, 10, 10\n          assert.strictEqual(extensionTrackAppenders[0].colorForEvent(event), 'rgb(10 10 10)');\n        } else {\n          // Unknown colors are mapped to \"primary\" by default, and\n          // \"primary\" color category is mapped to --ref-palette-blue70\n          // which is faked out to 4, 4, 4\n          assert.strictEqual(extensionTrackAppenders[0].colorForEvent(event), 'rgb(4 4 4)');\n        }\n      }\n    });\n\n    it('sets a default value when a color is not set or is set an unknown value', function() {\n      const mockExtensionEntryNoColor = {\n        args: {\n          metadata: {dataType: 'track-entry', extensionName: 'Extension'},\n          track: 'A track',\n        },\n        cat: 'devtools.extension',\n      } as unknown as Trace.Types.Events.Event;\n\n      const mockExtensionEntryUnknownColor = {\n        args: {\n          metadata: {dataType: 'track-entry', extensionName: 'Extension'},\n          track: 'A track',\n          color: 'anUnknownColor',\n        },\n        cat: 'devtools.extension',\n      } as unknown as Trace.Types.Events.Event;\n      // \"primary\" color category is mapped to --ref-palette-blue70\n      // which is faked out to 4, 4, 4\n      assert.strictEqual(extensionTrackAppenders[0].colorForEvent(mockExtensionEntryNoColor), 'rgb(4 4 4)');\n      assert.strictEqual(extensionTrackAppenders[0].colorForEvent(mockExtensionEntryUnknownColor), 'rgb(4 4 4)');\n    });\n  });\n\n  describe('toggling', function() {\n    it('Does not append extension data when the configuration is set to disabled', async function() {\n      entryData = [];\n      flameChartData = PerfUI.FlameChart.FlameChartTimelineData.createEmpty();\n      entryTypeByLevel = [];\n      Timeline.TimelinePanel.TimelinePanel.extensionDataVisibilitySetting().set(false);\n      parsedTrace = (await TraceLoader.traceEngine(this, 'extension-tracks-and-marks.json.gz')).parsedTrace;\n      extensionTrackAppenders = initTrackAppender(flameChartData, parsedTrace, entryData, entryTypeByLevel);\n      let level = 0;\n      extensionTrackAppenders.forEach(appender => {\n        level = appender.appendTrackAtLevel(level);\n      });\n      assert.lengthOf(flameChartData.groups, 0);\n      Timeline.TimelinePanel.TimelinePanel.extensionDataVisibilitySetting().set(true);\n    });\n  });\n\n  describe('titleForEvent', function() {\n    it('returns the title for an entry correctly', function() {\n      const allExtensionTrackEntries =\n          parsedTrace.ExtensionTraceData.extensionTrackData.map(track => Object.values(track.entriesByTrack)).flat(2);\n      const title = extensionTrackAppenders[0].titleForEvent(allExtensionTrackEntries[0]);\n      assert.strictEqual(title, 'An extension measurement');\n    });\n  });\n\n  describe('setPopoverInfo', function() {\n    it('build the tooltip content for an entry correctly', function() {\n      const info: Timeline.CompatibilityTracksAppender.PopoverInfo = {\n        title: 'title',\n        formattedTime: 'time',\n        warningElements: [],\n        additionalElements: [],\n        url: null,\n      };\n      const allExtensionTrackEntries =\n          parsedTrace.ExtensionTraceData.extensionTrackData.map(track => Object.values(track.entriesByTrack)).flat(2);\n      extensionTrackAppenders[0].setPopoverInfo(allExtensionTrackEntries[0], info);\n      assert.strictEqual(info.title, 'A hint if needed');\n      // The i18n encodes spaces using the u00A0 unicode character.\n      assert.strictEqual(info.formattedTime, '1.00\\u00A0s');\n      assert.isUndefined(info.additionalElements?.at(0)?.nodeName);\n    });\n  });\n});\n"]}