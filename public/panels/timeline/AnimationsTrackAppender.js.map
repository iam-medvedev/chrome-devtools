{"version":3,"file":"AnimationsTrackAppender.js","sourceRoot":"","sources":["../../../../../../front_end/panels/timeline/AnimationsTrackAppender.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright 2023 The Chromium Authors. All rights reserved.\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport * as i18n from '../../core/i18n/i18n.js';\nimport * as Trace from '../../models/trace/trace.js';\nimport * as PerfUI from '../../ui/legacy/components/perf_ui/perf_ui.js';\nimport * as ThemeSupport from '../../ui/legacy/theme_support/theme_support.js';\n\nimport {addDecorationToEvent, buildGroupStyle, buildTrackHeader, getFormattedTime} from './AppenderUtils.js';\nimport {\n  type CompatibilityTracksAppender,\n  type HighlightedEntryInfo,\n  type TrackAppender,\n  type TrackAppenderName,\n  VisualLoggingTrackName,\n} from './CompatibilityTracksAppender.js';\n\nconst UIStrings = {\n  /**\n   *@description Text in Timeline Flame Chart Data Provider of the Performance panel\n   */\n  animations: 'Animations',\n};\n\nconst str_ = i18n.i18n.registerUIStrings('panels/timeline/AnimationsTrackAppender.ts', UIStrings);\nconst i18nString = i18n.i18n.getLocalizedString.bind(undefined, str_);\n\nexport class AnimationsTrackAppender implements TrackAppender {\n  readonly appenderName: TrackAppenderName = 'Animations';\n\n  #compatibilityBuilder: CompatibilityTracksAppender;\n  #parsedTrace: Readonly<Trace.Handlers.Types.ParsedTrace>;\n  #eventAppendedCallback = this.#eventAppendedCallbackFunction.bind(this);\n\n  constructor(compatibilityBuilder: CompatibilityTracksAppender, parsedTrace: Trace.Handlers.Types.ParsedTrace) {\n    this.#compatibilityBuilder = compatibilityBuilder;\n    this.#parsedTrace = parsedTrace;\n  }\n\n  appendTrackAtLevel(trackStartLevel: number, expanded?: boolean|undefined): number {\n    const animations = this.#parsedTrace.Animations.animations;\n    if (animations.length === 0) {\n      return trackStartLevel;\n    }\n    this.#appendTrackHeaderAtLevel(trackStartLevel, expanded);\n    return this.#compatibilityBuilder.appendEventsAtLevel(\n        animations, trackStartLevel, this, this.#eventAppendedCallback);\n  }\n\n  #appendTrackHeaderAtLevel(currentLevel: number, expanded?: boolean): void {\n    const style = buildGroupStyle({useFirstLineForOverview: false});\n    const group = buildTrackHeader(\n        VisualLoggingTrackName.ANIMATIONS, currentLevel, i18nString(UIStrings.animations), style,\n        /* selectable= */ true, expanded);\n    this.#compatibilityBuilder.registerTrackForGroup(group, this);\n  }\n\n  #eventAppendedCallbackFunction(event: Trace.Types.Events.Event, index: number): void {\n    if (event && Trace.Types.Events.isSyntheticAnimation(event)) {\n      const CLSInsight = Trace.Insights.InsightRunners.CumulativeLayoutShift;\n      const failures = CLSInsight.getNonCompositedFailure(event);\n      if (failures.length) {\n        addDecorationToEvent(this.#compatibilityBuilder.getFlameChartTimelineData(), index, {\n          type: PerfUI.FlameChart.FlameChartDecorationType.WARNING_TRIANGLE,\n        });\n      }\n    }\n  }\n\n  colorForEvent(): string {\n    return ThemeSupport.ThemeSupport.instance().getComputedValue('--app-color-rendering');\n  }\n\n  titleForEvent(event: Trace.Types.Events.SyntheticAnimationPair): string {\n    const {displayName} = event.args.data.beginEvent.args.data;\n    return displayName || event.name;\n  }\n\n  highlightedEntryInfo(event: Trace.Types.Events.SyntheticAnimationPair): HighlightedEntryInfo {\n    const title = this.titleForEvent(event);\n    return {title, formattedTime: getFormattedTime(event.dur)};\n  }\n}\n"]}