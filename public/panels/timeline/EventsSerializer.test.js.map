{"version":3,"file":"EventsSerializer.test.js","sourceRoot":"","sources":["../../../../../../front_end/panels/timeline/EventsSerializer.test.ts"],"names":[],"mappings":"AAAA,4DAA4D;AAC5D,yEAAyE;AACzE,6BAA6B;AAE7B,OAAO,KAAK,WAAW,MAAM,6BAA6B,CAAC;AAC3D,OAAO,EAAC,aAAa,EAAC,MAAM,+BAA+B,CAAC;AAC5D,OAAO,EAAC,WAAW,EAAC,MAAM,8BAA8B,CAAC;AAEzD,OAAO,KAAK,QAAQ,MAAM,eAAe,CAAC;AAE1C,SAAS,cAAc,CACnB,UAAwE,EACxE,SACW;IACb,MAAM,KAAK,GAAG,UAAU,CAAC,IAAI,CAAC,KAAK,CAAC,EAAE,CAAC,SAAS,CAAC,KAAK,CAAC,CAAC,CAAC;IACzD,IAAI,CAAC,KAAK,EAAE,CAAC;QACX,MAAM,IAAI,KAAK,CAAC,gCAAgC,CAAC,CAAC;IACpD,CAAC;IACD,OAAO,KAAK,CAAC;AACf,CAAC;AAED,QAAQ,CAAC,kBAAkB,EAAE,GAAG,EAAE;IAChC,EAAE,CAAC,4DAA4D,EAAE,KAAK;QACpE,MAAM,EAAC,SAAS,EAAC,GAAG,MAAM,WAAW,CAAC,WAAW,CAAC,IAAI,EAAE,qBAAqB,CAAC,CAAC;QAC/E,MAAM,gBAAgB,GAAG,IAAI,QAAQ,CAAC,gBAAgB,CAAC,gBAAgB,EAAE,CAAC;QAC1E,MAAM,UAAU,GAAG,aAAa,CAAC,SAAS,CAAC,QAAQ,CAAC,CAAC;QACrD,8CAA8C;QAC9C,MAAM,QAAQ,GAAG,cAAc,CAAC,UAAU,CAAC,OAAO,EAAE,KAAK,CAAC,EAAE;YAC1D,OAAO,KAAK,CAAC,IAAI,KAAK,WAAW,CAAC;QACpC,CAAC,CAAC,CAAC;QAEH,MAAM,cAAc,GAAG,SAAS,CAAC,eAAe,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC;QAC3D,MAAM,WAAW,GAAG,cAAc,CAAC,UAAU,CAAC,OAAO,EAAE,KAAK,CAAC,EAAE,CAAC,WAAW,CAAC,KAAK,CAAC,WAAW,CAAC,aAAa,CAAC,KAAK,CAAC,CAAC,CAAC;QACpH,MAAM,WAAW,GAAG,gBAAgB,CAAC,WAAW,CAAC,QAAQ,CAAC,CAAC;QAC3D,MAAM,iBAAiB,GAAG,gBAAgB,CAAC,WAAW,CAAC,cAAc,CAAC,CAAC;QACvE,MAAM,cAAc,GAAG,gBAAgB,CAAC,WAAW,CAAC,WAAW,CAAC,CAAC;QAEjE,6BAA6B;QAC7B,MAAM,CAAC,SAAS,CAAC,WAAW,EAAE,QAAQ,CAAC,CAAC;QACxC,MAAM,CAAC,SAAS,CAAC,iBAAiB,EAAE,QAAQ,CAAC,CAAC;QAC9C,MAAM,CAAC,SAAS,CAAC,cAAc,EAAE,kBAAkB,CAAC,CAAC;QAErD,MAAM,CAAC,IAAI,CAAC,WAAW,CAAC,CAAC;QACzB,MAAM,CAAC,IAAI,CAAC,iBAAiB,CAAC,CAAC;QAC/B,MAAM,CAAC,IAAI,CAAC,cAAc,CAAC,CAAC;QAE5B,MAAM,gBAAgB,GAAG,gBAAgB,CAAC,WAAW,CAAC,WAAW,EAAE,SAAS,CAAC,CAAC;QAC9E,MAAM,sBAAsB,GAAG,gBAAgB,CAAC,WAAW,CAAC,iBAAiB,EAAE,SAAS,CAAC,CAAC;QAC1F,MAAM,mBAAmB,GAAG,gBAAgB,CAAC,WAAW,CAAC,cAAc,EAAE,SAAS,CAAC,CAAC;QAEpF,6BAA6B;QAC7B,MAAM,CAAC,WAAW,CAAC,gBAAgB,EAAE,QAAQ,CAAC,CAAC;QAC/C,MAAM,CAAC,WAAW,CAAC,sBAAsB,EAAE,cAAc,CAAC,CAAC;QAC3D,MAAM,CAAC,WAAW,CAAC,mBAAmB,EAAE,WAAW,CAAC,CAAC;IACvD,CAAC,CAAC,CAAC;AACL,CAAC,CAAC,CAAC","sourcesContent":["// Copyright 2024 The Chromium Authors. All rights reserved.\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport * as TraceEngine from '../../models/trace/trace.js';\nimport {getMainThread} from '../../testing/TraceHelpers.js';\nimport {TraceLoader} from '../../testing/TraceLoader.js';\n\nimport * as Timeline from './timeline.js';\n\nfunction findFirstEntry(\n    allEntries: readonly TraceEngine.Types.TraceEvents.SyntheticTraceEntry[],\n    predicate: (entry: TraceEngine.Types.TraceEvents.SyntheticTraceEntry) =>\n        boolean): TraceEngine.Types.TraceEvents.SyntheticTraceEntry {\n  const entry = allEntries.find(entry => predicate(entry));\n  if (!entry) {\n    throw new Error('Could not find expected entry.');\n  }\n  return entry;\n}\n\ndescribe('EventsSerializer', () => {\n  it('correctly implements a bidirectional key <-> event mapping', async function() {\n    const {traceData} = await TraceLoader.traceEngine(this, 'basic-stack.json.gz');\n    const eventsSerializer = new Timeline.EventsSerializer.EventsSerializer();\n    const mainThread = getMainThread(traceData.Renderer);\n    // Find first 'Timer Fired' entry in the trace\n    const rawEntry = findFirstEntry(mainThread.entries, entry => {\n      return entry.name === 'TimerFire';\n    });\n\n    const syntheticEvent = traceData.NetworkRequests.byTime[0];\n    const profileCall = findFirstEntry(mainThread.entries, entry => TraceEngine.Types.TraceEvents.isProfileCall(entry));\n    const rawEntryKey = eventsSerializer.keyForEvent(rawEntry);\n    const syntheticEventKey = eventsSerializer.keyForEvent(syntheticEvent);\n    const profileCallKey = eventsSerializer.keyForEvent(profileCall);\n\n    // Test event -> key mappings\n    assert.deepEqual(rawEntryKey, 'r-8036');\n    assert.deepEqual(syntheticEventKey, 's-2078');\n    assert.deepEqual(profileCallKey, 'p-55385-259-38-4');\n\n    assert.isOk(rawEntryKey);\n    assert.isOk(syntheticEventKey);\n    assert.isOk(profileCallKey);\n\n    const resolvedRawEntry = eventsSerializer.eventForKey(rawEntryKey, traceData);\n    const resolvedSyntheticEntry = eventsSerializer.eventForKey(syntheticEventKey, traceData);\n    const resolvedProfileCall = eventsSerializer.eventForKey(profileCallKey, traceData);\n\n    // Test key -> event mappings\n    assert.strictEqual(resolvedRawEntry, rawEntry);\n    assert.strictEqual(resolvedSyntheticEntry, syntheticEvent);\n    assert.strictEqual(resolvedProfileCall, profileCall);\n  });\n});\n"]}