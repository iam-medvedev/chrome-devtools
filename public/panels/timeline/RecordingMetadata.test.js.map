{"version":3,"file":"RecordingMetadata.test.js","sourceRoot":"","sources":["../../../../../../front_end/panels/timeline/RecordingMetadata.test.ts"],"names":[],"mappings":"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","sourcesContent":["\n// Copyright 2025 The Chromium Authors. All rights reserved.\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport * as SDK from '../../core/sdk/sdk.js';\nimport * as Trace from '../../models/trace/trace.js';\nimport {describeWithEnvironment} from '../../testing/EnvironmentHelpers.js';\n\nimport * as Timeline from './timeline.js';\n\ndescribeWithEnvironment('RecordingMetadata', () => {\n  it('for a CPU profile it just returns the origin', async () => {\n    const result = Timeline.RecordingMetadata.forCPUProfile();\n    assert.deepEqual(result, {dataOrigin: Trace.Types.File.DataOrigin.CPU_PROFILE});\n  });\n\n  it('returns the associated metadata for a chrome trace', async () => {\n    const cpuThrottlingManager = SDK.CPUThrottlingManager.CPUThrottlingManager.instance({forceNew: true});\n    sinon.stub(cpuThrottlingManager, 'hasPrimaryPageTargetSet').returns(true);\n    sinon.stub(cpuThrottlingManager, 'cpuThrottlingRate').returns(2);\n    const networkManager = SDK.NetworkManager.MultitargetNetworkManager.instance({forceNew: true});\n    sinon.stub(networkManager, 'isThrottling').returns(true);\n    sinon.stub(networkManager, 'networkConditions').returns({\n      title: 'Slow 3G',\n      download: 1,\n      upload: 2,\n      latency: 3,\n    });\n    const metadata = await Timeline.RecordingMetadata.forTrace({recordingStartTime: 1234});\n    assert.deepEqual(metadata, {\n      source: 'DevTools',\n      startTime: new Date(1234).toJSON(),\n      cpuThrottling: 2,\n      networkThrottling: 'Slow 3G',\n      networkThrottlingConditions: {\n        download: 1,\n        latency: 3,\n        upload: 2,\n        packetLoss: undefined,\n        packetQueueLength: undefined,\n        packetReordering: undefined,\n        targetLatency: undefined,\n      },\n      cruxFieldData: undefined,\n      dataOrigin: Trace.Types.File.DataOrigin.TRACE_EVENTS,\n      emulatedDeviceTitle: undefined,\n    });\n  });\n\n  it('does not store network conditions if the user has not throttled them', async () => {\n    const cpuThrottlingManager = SDK.CPUThrottlingManager.CPUThrottlingManager.instance({forceNew: true});\n    sinon.stub(cpuThrottlingManager, 'hasPrimaryPageTargetSet').returns(true);\n    sinon.stub(cpuThrottlingManager, 'cpuThrottlingRate').returns(2);\n    const networkManager = SDK.NetworkManager.MultitargetNetworkManager.instance({forceNew: true});\n    sinon.stub(networkManager, 'isThrottling').returns(false);\n    const metadata = await Timeline.RecordingMetadata.forTrace({recordingStartTime: 1234});\n    assert.deepEqual(metadata, {\n      source: 'DevTools',\n      startTime: new Date(1234).toJSON(),\n      cpuThrottling: 2,\n      networkThrottling: undefined,\n      networkThrottlingConditions: undefined,\n      cruxFieldData: undefined,\n      dataOrigin: Trace.Types.File.DataOrigin.TRACE_EVENTS,\n      emulatedDeviceTitle: undefined,\n    });\n  });\n\n  it('does not store cpu throttling if there is no throttling', async () => {\n    const cpuThrottlingManager = SDK.CPUThrottlingManager.CPUThrottlingManager.instance({forceNew: true});\n    sinon.stub(cpuThrottlingManager, 'hasPrimaryPageTargetSet').returns(true);\n    // 1 is the equivalent of no throttling\n    sinon.stub(cpuThrottlingManager, 'cpuThrottlingRate').returns(1);\n    const networkManager = SDK.NetworkManager.MultitargetNetworkManager.instance({forceNew: true});\n    sinon.stub(networkManager, 'isThrottling').returns(true);\n    sinon.stub(networkManager, 'networkConditions').returns({\n      title: 'Slow 3G',\n      download: 1,\n      upload: 2,\n      latency: 3,\n    });\n    const metadata = await Timeline.RecordingMetadata.forTrace({recordingStartTime: 1234});\n    assert.deepEqual(metadata, {\n      source: 'DevTools',\n      startTime: new Date(1234).toJSON(),\n      cpuThrottling: undefined,\n      networkThrottling: 'Slow 3G',\n      networkThrottlingConditions: {\n        download: 1,\n        latency: 3,\n        upload: 2,\n        packetLoss: undefined,\n        packetQueueLength: undefined,\n        packetReordering: undefined,\n        targetLatency: undefined,\n      },\n      cruxFieldData: undefined,\n      dataOrigin: Trace.Types.File.DataOrigin.TRACE_EVENTS,\n      emulatedDeviceTitle: undefined,\n    });\n  });\n\n  it('calls the title function if the network condition title is a function', async () => {\n    const cpuThrottlingManager = SDK.CPUThrottlingManager.CPUThrottlingManager.instance({forceNew: true});\n    sinon.stub(cpuThrottlingManager, 'hasPrimaryPageTargetSet').returns(true);\n    sinon.stub(cpuThrottlingManager, 'getHardwareConcurrency').returns(Promise.resolve(1));\n    sinon.stub(cpuThrottlingManager, 'cpuThrottlingRate').returns(2);\n    const networkManager = SDK.NetworkManager.MultitargetNetworkManager.instance({forceNew: true});\n    sinon.stub(networkManager, 'isThrottling').returns(true);\n    sinon.stub(networkManager, 'networkConditions').returns({\n      title: () => 'Slow 3G',\n      download: 1,\n      upload: 1,\n      latency: 1,\n    });\n    const metadata = await Timeline.RecordingMetadata.forTrace();\n    assert.deepEqual(metadata, {\n      source: 'DevTools',\n      startTime: undefined,\n      cpuThrottling: 2,\n      networkThrottling: 'Slow 3G',\n      networkThrottlingConditions: {\n        download: 1,\n        latency: 1,\n        upload: 1,\n        packetLoss: undefined,\n        packetQueueLength: undefined,\n        packetReordering: undefined,\n        targetLatency: undefined,\n      },\n      emulatedDeviceTitle: undefined,\n      cruxFieldData: undefined,\n      dataOrigin: Trace.Types.File.DataOrigin.TRACE_EVENTS,\n    });\n  });\n});\n"]}