{"version":3,"file":"StatusDialog.js","sourceRoot":"","sources":["../../../../../../front_end/panels/timeline/StatusDialog.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright 2025 The Chromium Authors. All rights reserved.\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\n/* eslint-disable rulesdir/no-imperative-dom-api */\n\nimport '../../ui/legacy/legacy.js';\n\nimport * as i18n from '../../core/i18n/i18n.js';\nimport * as Platform from '../../core/platform/platform.js';\nimport * as TextUtils from '../../models/text_utils/text_utils.js';\nimport type * as Trace from '../../models/trace/trace.js';\nimport * as Workspace from '../../models/workspace/workspace.js';\nimport type * as Buttons from '../../ui/components/buttons/buttons.js';\nimport * as UI from '../../ui/legacy/legacy.js';\nimport * as VisualLogging from '../../ui/visual_logging/visual_logging.js';\n\nimport {traceJsonGenerator} from './SaveFileFormatter.js';\nimport timelineStatusDialogStyles from './timelineStatusDialog.css.js';\n\nconst UIStrings = {\n  /**\n   * @description Text to download the trace file after an error\n   */\n  downloadAfterError: 'Download trace',\n  /**\n   * @description Text for the status of something\n   */\n  status: 'Status',\n  /**\n   * @description Text that refers to the time\n   */\n  time: 'Time',\n  /**\n   * @description Text for the description of something\n   */\n  description: 'Description',\n  /**\n   * @description Text of an item that stops the running task\n   */\n  stop: 'Stop',\n\n} as const;\nconst str_ = i18n.i18n.registerUIStrings('panels/timeline/StatusDialog.ts', UIStrings);\nconst i18nString = i18n.i18n.getLocalizedString.bind(undefined, str_);\n\n/**\n * This is the dialog shown whilst a trace is being recorded/imported.\n */\nexport class StatusDialog extends UI.Widget.VBox {\n  private status: HTMLElement;\n  private time: Element|undefined;\n  private progressLabel?: HTMLElement;\n  private progressBar?: HTMLElement;\n  private readonly description: HTMLElement|undefined;\n  private button: Buttons.Button.Button;\n  private downloadTraceButton: Buttons.Button.Button;\n  private startTime!: number;\n  private timeUpdateTimer?: number;\n  #rawEvents?: Trace.Types.Events.Event[];\n\n  constructor(\n      options: {\n        hideStopButton: boolean,\n        showTimer?: boolean,\n        showProgress?: boolean,\n        description?: string,\n        buttonText?: string,\n      },\n      onButtonClickCallback: () => (Promise<void>| void)) {\n    super({\n      jslog: `${VisualLogging.dialog('timeline-status').track({resize: true})}`,\n      useShadowDom: true,\n    });\n\n    this.contentElement.classList.add('timeline-status-dialog');\n\n    const statusLine = this.contentElement.createChild('div', 'status-dialog-line status');\n    statusLine.createChild('div', 'label').textContent = i18nString(UIStrings.status);\n    this.status = statusLine.createChild('div', 'content');\n    UI.ARIAUtils.markAsStatus(this.status);\n\n    if (options.showTimer) {\n      const timeLine = this.contentElement.createChild('div', 'status-dialog-line time');\n      timeLine.createChild('div', 'label').textContent = i18nString(UIStrings.time);\n      this.time = timeLine.createChild('div', 'content');\n    }\n\n    if (options.showProgress) {\n      const progressBarContainer = this.contentElement.createChild('div', 'status-dialog-line progress');\n      this.progressLabel = progressBarContainer.createChild('div', 'label');\n      this.progressBar = progressBarContainer.createChild('div', 'indicator-container').createChild('div', 'indicator');\n      UI.ARIAUtils.markAsProgressBar(this.progressBar);\n    }\n\n    if (typeof options.description === 'string') {\n      const descriptionLine = this.contentElement.createChild('div', 'status-dialog-line description');\n      descriptionLine.createChild('div', 'label').textContent = i18nString(UIStrings.description);\n      this.description = descriptionLine.createChild('div', 'content');\n      this.description.innerText = options.description;\n    }\n\n    const buttonContainer = this.contentElement.createChild('div', 'stop-button');\n    this.downloadTraceButton = UI.UIUtils.createTextButton(i18nString(UIStrings.downloadAfterError), () => {\n      void this.#downloadRawTraceAfterError();\n    }, {jslogContext: 'timeline.download-after-error'});\n\n    this.downloadTraceButton.disabled = true;\n    this.downloadTraceButton.classList.add('hidden');\n\n    const buttonText = options.buttonText || i18nString(UIStrings.stop);\n    this.button = UI.UIUtils.createTextButton(buttonText, onButtonClickCallback, {\n      jslogContext: 'timeline.stop-recording',\n    });\n    // Profiling can't be stopped during initialization.\n    this.button.classList.toggle('hidden', options.hideStopButton);\n\n    buttonContainer.append(this.downloadTraceButton);\n    buttonContainer.append(this.button);\n  }\n\n  finish(): void {\n    this.stopTimer();\n    this.button.classList.add('hidden');\n  }\n\n  async #downloadRawTraceAfterError(): Promise<void> {\n    if (!this.#rawEvents || this.#rawEvents.length === 0) {\n      return;\n    }\n    const traceStart = Platform.DateUtilities.toISO8601Compact(new Date());\n    const fileName = `Trace-Load-Error-${traceStart}.json` as Platform.DevToolsPath.RawPathString;\n    const formattedTraceIter = traceJsonGenerator(this.#rawEvents, {});\n    const traceAsString = Array.from(formattedTraceIter).join('');\n    await Workspace.FileManager.FileManager.instance().save(\n        fileName, new TextUtils.ContentData.ContentData(traceAsString, /* isBase64=*/ false, 'application/json'),\n        /* forceSaveAs=*/ true);\n    Workspace.FileManager.FileManager.instance().close(fileName);\n  }\n\n  enableDownloadOfEvents(rawEvents: Trace.Types.Events.Event[]): void {\n    this.#rawEvents = rawEvents;\n    this.downloadTraceButton.disabled = false;\n    this.downloadTraceButton.classList.remove('hidden');\n  }\n\n  remove(): void {\n    (this.element.parentNode as HTMLElement)?.classList.remove('tinted');\n    this.stopTimer();\n    this.element.remove();\n  }\n\n  showPane(parent: Element): void {\n    this.show(parent);\n    parent.classList.add('tinted');\n  }\n\n  enableAndFocusButton(): void {\n    this.button.classList.remove('hidden');\n    this.button.focus();\n  }\n\n  updateStatus(text: string): void {\n    this.status.textContent = text;\n  }\n\n  updateProgressBar(activity: string, percent: number): void {\n    if (this.progressLabel) {\n      this.progressLabel.textContent = activity;\n    }\n    if (this.progressBar) {\n      this.progressBar.style.width = percent.toFixed(1) + '%';\n      UI.ARIAUtils.setValueNow(this.progressBar, percent);\n    }\n    this.updateTimer();\n  }\n\n  startTimer(): void {\n    this.startTime = Date.now();\n    this.timeUpdateTimer = window.setInterval(this.updateTimer.bind(this), 100);\n    this.updateTimer();\n  }\n\n  private stopTimer(): void {\n    if (!this.timeUpdateTimer) {\n      return;\n    }\n    clearInterval(this.timeUpdateTimer);\n    this.updateTimer();\n    delete this.timeUpdateTimer;\n  }\n\n  private updateTimer(): void {\n    if (!this.timeUpdateTimer || !this.time) {\n      return;\n    }\n\n    const seconds = (Date.now() - this.startTime) / 1000;\n    this.time.textContent = i18n.TimeUtilities.preciseSecondsToString(seconds, 1);\n  }\n\n  override wasShown(): void {\n    super.wasShown();\n    this.registerRequiredCSS(timelineStatusDialogStyles);\n  }\n}\n"]}