{"version":3,"file":"CPUThrottlingSelector.test.js","sourceRoot":"","sources":["../../../../../../../front_end/panels/timeline/components/CPUThrottlingSelector.test.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright 2024 The Chromium Authors. All rights reserved.\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport * as SDK from '../../../core/sdk/sdk.js';\nimport * as MobileThrottling from '../../../panels/mobile_throttling/mobile_throttling.js';\nimport {renderElementIntoDOM} from '../../../testing/DOMHelpers.js';\nimport {describeWithEnvironment} from '../../../testing/EnvironmentHelpers.js';\nimport * as RenderCoordinator from '../../../ui/components/render_coordinator/render_coordinator.js';\n\nimport * as Components from './components.js';\n\ndescribeWithEnvironment('CPUThrottlingSelector', () => {\n  let cpuThrottlingManager: SDK.CPUThrottlingManager.CPUThrottlingManager;\n\n  beforeEach(() => {\n    cpuThrottlingManager = SDK.CPUThrottlingManager.CPUThrottlingManager.instance({forceNew: true});\n    MobileThrottling.ThrottlingManager.ThrottlingManager.instance({forceNew: true});\n  });\n\n  it('renders all CPU throttling options', async () => {\n    const view = new Components.CPUThrottlingSelector.CPUThrottlingSelector();\n    renderElementIntoDOM(view);\n\n    await RenderCoordinator.done();\n\n    const menuItems = view.shadowRoot!.querySelectorAll('devtools-menu-item');\n\n    assert.lengthOf(menuItems, 7);\n\n    assert.strictEqual(menuItems[0].value, 1);\n    assert.isTrue(menuItems[0].selected);\n    assert.match(menuItems[0].innerText, /No throttling/);\n\n    assert.strictEqual(menuItems[1].value, 4);\n    assert.isFalse(menuItems[1].selected);\n    assert.match(menuItems[1].innerText, /4× slowdown/);\n\n    assert.strictEqual(menuItems[2].value, 6);\n    assert.isFalse(menuItems[2].selected);\n    assert.match(menuItems[2].innerText, /6× slowdown/);\n\n    assert.strictEqual(menuItems[3].value, 20);\n    assert.isFalse(menuItems[3].selected);\n    assert.match(menuItems[3].innerText, /20× slowdown/);\n\n    assert.strictEqual(menuItems[4].value, 'low-tier-mobile');\n    assert.isFalse(menuItems[4].selected);\n    assert.match(menuItems[4].innerText, /Low-tier mobile/);\n\n    assert.strictEqual(menuItems[5].value, 'mid-tier-mobile');\n    assert.isFalse(menuItems[5].selected);\n    assert.match(menuItems[5].innerText, /Mid-tier mobile/);\n  });\n\n  it('updates CPU throttling manager on change', async () => {\n    const view = new Components.CPUThrottlingSelector.CPUThrottlingSelector();\n    renderElementIntoDOM(view);\n\n    await RenderCoordinator.done();\n\n    const menuItems = view.shadowRoot!.querySelectorAll('devtools-menu-item');\n\n    assert.isTrue(menuItems[0].selected);\n    assert.strictEqual(cpuThrottlingManager.cpuThrottlingRate(), 1);\n\n    menuItems[1].click();\n    await RenderCoordinator.done();\n\n    assert.isTrue(menuItems[1].selected);\n    assert.strictEqual(cpuThrottlingManager.cpuThrottlingRate(), 4);\n  });\n\n  it('reacts to changes in CPU throttling manager', async () => {\n    const view = new Components.CPUThrottlingSelector.CPUThrottlingSelector();\n    renderElementIntoDOM(view);\n\n    await RenderCoordinator.done();\n\n    const menuItems = view.shadowRoot!.querySelectorAll('devtools-menu-item');\n\n    assert.isTrue(menuItems[0].selected);\n\n    cpuThrottlingManager.setCPUThrottlingOption(SDK.CPUThrottlingManager.LowTierThrottlingOption);\n    await RenderCoordinator.done();\n\n    assert.isTrue(menuItems[2].selected);\n  });\n  it('reacts to changes in CPU throttling manager when it is unmounted and then remounted', async () => {\n    const view = new Components.CPUThrottlingSelector.CPUThrottlingSelector();\n    // Change the conditions before the component is put into the DOM.\n    cpuThrottlingManager.setCPUThrottlingOption(SDK.CPUThrottlingManager.LowTierThrottlingOption);\n\n    renderElementIntoDOM(view);\n    await RenderCoordinator.done();\n    // Ensure that the component picks up the new changes and has selected the right thorttling setting\n    const menuItems = view.shadowRoot!.querySelectorAll('devtools-menu-item');\n    assert.isTrue(menuItems[2].selected);\n  });\n});\n"]}