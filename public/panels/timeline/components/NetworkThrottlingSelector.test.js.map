{"version":3,"file":"NetworkThrottlingSelector.test.js","sourceRoot":"","sources":["../../../../../../../front_end/panels/timeline/components/NetworkThrottlingSelector.test.ts"],"names":[],"mappings":"AAAA,4DAA4D;AAC5D,yEAAyE;AACzE,6BAA6B;AAE7B,OAAO,KAAK,MAAM,MAAM,gCAAgC,CAAC;AACzD,OAAO,KAAK,GAAG,MAAM,0BAA0B,CAAC;AAChD,OAAO,EAAC,oBAAoB,EAAC,MAAM,gCAAgC,CAAC;AACpE,OAAO,EAAC,uBAAuB,EAAC,MAAM,wCAAwC,CAAC;AAE/E,OAAO,KAAK,WAAW,MAAM,iEAAiE,CAAC;AAC/F,OAAO,KAAK,gBAAgB,MAAM,8CAA8C,CAAC;AAEjF,OAAO,KAAK,UAAU,MAAM,iBAAiB,CAAC;AAE9C,uBAAuB,CAAC,2BAA2B,EAAE,GAAG,EAAE;IACxD,MAAM,WAAW,GAAG,WAAW,CAAC,iBAAiB,CAAC,iBAAiB,CAAC,QAAQ,EAAE,CAAC;IAC/E,IAAI,cAA4D,CAAC;IACjE,IAAI,oBAA8E,CAAC;IACnF,IAAI,UAA2B,CAAC;IAEhC,UAAU,CAAC,GAAG,EAAE;QACd,cAAc,GAAG,GAAG,CAAC,cAAc,CAAC,yBAAyB,CAAC,QAAQ,CAAC,EAAC,QAAQ,EAAE,IAAI,EAAC,CAAC,CAAC;QACzF,oBAAoB,GAAG,MAAM,CAAC,QAAQ,CAAC,QAAQ,CAAC,QAAQ,EAAE,CAAC,aAAa,CAAC,2BAA2B,CAAC,CAAC;QACtG,UAAU,GAAG,KAAK,CAAC,IAAI,CAAC,MAAM,CAAC,QAAQ,CAAC,gBAAgB,CAAC,QAAQ,EAAE,EAAE,QAAQ,CAAC,CAAC;IACjF,CAAC,CAAC,CAAC;IAEH,SAAS,CAAC,GAAG,EAAE;QACb,oBAAoB,CAAC,GAAG,CAAC,EAAE,CAAC,CAAC;QAC7B,UAAU,CAAC,OAAO,EAAE,CAAC;IACvB,CAAC,CAAC,CAAC;IAEH,EAAE,CAAC,mCAAmC,EAAE,KAAK,IAAI,EAAE;QACjD,MAAM,IAAI,GAAG,IAAI,UAAU,CAAC,yBAAyB,CAAC,yBAAyB,EAAE,CAAC;QAClF,oBAAoB,CAAC,IAAI,CAAC,CAAC;QAE3B,MAAM,WAAW,CAAC,IAAI,EAAE,CAAC;QAEzB,MAAM,MAAM,GAAG,IAAI,CAAC,UAAW,CAAC,gBAAgB,CAAC,qBAAqB,CAAqC,CAAC;QAE5G,MAAM,CAAC,QAAQ,CAAC,MAAM,EAAE,CAAC,CAAC,CAAC;QAE3B,MAAM,CAAC,WAAW,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC,IAAI,EAAE,UAAU,CAAC,CAAC;QAC/C,MAAM,WAAW,GAAG,MAAM,CAAC,CAAC,CAAC,CAAC,gBAAgB,CAAC,oBAAoB,CAAoC,CAAC;QACxG,MAAM,CAAC,QAAQ,CAAC,WAAW,EAAE,CAAC,CAAC,CAAC;QAChC,MAAM,CAAC,KAAK,CAAC,WAAW,CAAC,CAAC,CAAC,CAAC,SAAS,EAAE,eAAe,CAAC,CAAC;QACxD,MAAM,CAAC,MAAM,CAAC,WAAW,CAAC,CAAC,CAAC,CAAC,QAAQ,CAAC,CAAC;QAEvC,MAAM,CAAC,WAAW,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC,IAAI,EAAE,SAAS,CAAC,CAAC;QAC9C,MAAM,WAAW,GAAG,MAAM,CAAC,CAAC,CAAC,CAAC,gBAAgB,CAAC,oBAAoB,CAAoC,CAAC;QACxG,MAAM,CAAC,QAAQ,CAAC,WAAW,EAAE,CAAC,CAAC,CAAC;QAChC,MAAM,CAAC,KAAK,CAAC,WAAW,CAAC,CAAC,CAAC,CAAC,SAAS,EAAE,SAAS,CAAC,CAAC;QAClD,MAAM,CAAC,OAAO,CAAC,WAAW,CAAC,CAAC,CAAC,CAAC,QAAQ,CAAC,CAAC;QACxC,MAAM,CAAC,KAAK,CAAC,WAAW,CAAC,CAAC,CAAC,CAAC,SAAS,EAAE,SAAS,CAAC,CAAC;QAClD,MAAM,CAAC,OAAO,CAAC,WAAW,CAAC,CAAC,CAAC,CAAC,QAAQ,CAAC,CAAC;QACxC,MAAM,CAAC,KAAK,CAAC,WAAW,CAAC,CAAC,CAAC,CAAC,SAAS,EAAE,IAAI,CAAC,CAAC;QAC7C,MAAM,CAAC,OAAO,CAAC,WAAW,CAAC,CAAC,CAAC,CAAC,QAAQ,CAAC,CAAC;QACxC,MAAM,CAAC,KAAK,CAAC,WAAW,CAAC,CAAC,CAAC,CAAC,SAAS,EAAE,SAAS,CAAC,CAAC;QAClD,MAAM,CAAC,OAAO,CAAC,WAAW,CAAC,CAAC,CAAC,CAAC,QAAQ,CAAC,CAAC;QAExC,MAAM,CAAC,WAAW,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC,IAAI,EAAE,QAAQ,CAAC,CAAC;QAC7C,MAAM,WAAW,GAAG,MAAM,CAAC,CAAC,CAAC,CAAC,gBAAgB,CAAC,oBAAoB,CAAoC,CAAC;QACxG,MAAM,CAAC,QAAQ,CAAC,WAAW,EAAE,CAAC,CAAC,CAAC;QAChC,MAAM,CAAC,KAAK,CAAC,WAAW,CAAC,CAAC,CAAC,CAAC,SAAS,EAAE,MAAM,CAAC,CAAC;QAC/C,MAAM,CAAC,OAAO,CAAC,WAAW,CAAC,CAAC,CAAC,CAAC,QAAQ,CAAC,CAAC;IAC1C,CAAC,CAAC,CAAC;IAEH,EAAE,CAAC,mCAAmC,EAAE,KAAK,IAAI,EAAE;QACjD,MAAM,IAAI,GAAG,IAAI,UAAU,CAAC,yBAAyB,CAAC,yBAAyB,EAAE,CAAC;QAClF,oBAAoB,CAAC,IAAI,CAAC,CAAC;QAE3B,MAAM,WAAW,CAAC,IAAI,EAAE,CAAC;QAEzB,MAAM,KAAK,GAAG,IAAI,CAAC,UAAW,CAAC,gBAAgB,CAAC,oBAAoB,CAAoC,CAAC;QACzG,MAAM,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,QAAQ,CAAC,CAAC;QACjC,MAAM,CAAC,WAAW,CAAC,cAAc,CAAC,iBAAiB,EAAE,CAAC,YAAY,EAAE,eAAe,CAAC,CAAC;QAErF,KAAK,CAAC,CAAC,CAAC,CAAC,KAAK,EAAE,CAAC;QACjB,MAAM,WAAW,CAAC,IAAI,EAAE,CAAC;QAEzB,MAAM,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,QAAQ,CAAC,CAAC;QACjC,MAAM,CAAC,OAAO,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,QAAQ,CAAC,CAAC;QAClC,MAAM,CAAC,WAAW,CAAC,cAAc,CAAC,iBAAiB,EAAE,CAAC,YAAY,EAAE,SAAS,CAAC,CAAC;IACjF,CAAC,CAAC,CAAC;IAEH,EAAE,CAAC,mCAAmC,EAAE,KAAK,IAAI,EAAE;QACjD,MAAM,IAAI,GAAG,IAAI,UAAU,CAAC,yBAAyB,CAAC,yBAAyB,EAAE,CAAC;QAClF,oBAAoB,CAAC,IAAI,CAAC,CAAC;QAE3B,MAAM,WAAW,CAAC,IAAI,EAAE,CAAC;QAEzB,MAAM,KAAK,GAAG,IAAI,CAAC,UAAW,CAAC,gBAAgB,CAAC,oBAAoB,CAAoC,CAAC;QACzG,MAAM,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,QAAQ,CAAC,CAAC;QAEjC,cAAc,CAAC,oBAAoB,CAAC,gBAAgB,CAAC,iBAAiB,CAAC,iBAAiB,CAAC,cAAc,CAAC,CAAC,CAAC,CAAC,CAAC;QAC5G,MAAM,WAAW,CAAC,IAAI,EAAE,CAAC;QAEzB,MAAM,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,QAAQ,CAAC,CAAC;QACjC,MAAM,CAAC,OAAO,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,QAAQ,CAAC,CAAC;IACpC,CAAC,CAAC,CAAC;IAEH,EAAE,CAAC,kCAAkC,EAAE,KAAK,IAAI,EAAE;QAChD,MAAM,IAAI,GAAG,IAAI,UAAU,CAAC,yBAAyB,CAAC,yBAAyB,EAAE,CAAC;QAClF,oBAAoB,CAAC,IAAI,CAAC,CAAC;QAE3B,MAAM,WAAW,CAAC,IAAI,EAAE,CAAC;QAEzB,IAAI,KAAK,GAAG,IAAI,CAAC,UAAW,CAAC,gBAAgB,CAAC,oBAAoB,CAA4B,CAAC;QAC/F,MAAM,CAAC,QAAQ,CAAC,KAAK,EAAE,CAAC,CAAC,CAAC;QAE1B,oBAAoB,CAAC,GAAG,CAAC,CAAC;gBACxB,KAAK,EAAE,aAAa;gBACpB,YAAY,EAAE,aAAa;gBAC3B,QAAQ,EAAE,CAAC;gBACX,MAAM,EAAE,CAAC;gBACT,OAAO,EAAE,CAAC;aACX,CAAC,CAAC,CAAC;QACJ,MAAM,WAAW,CAAC,IAAI,EAAE,CAAC;QAEzB,KAAK,GAAG,IAAI,CAAC,UAAW,CAAC,gBAAgB,CAAC,oBAAoB,CAA4B,CAAC;QAC3F,MAAM,CAAC,QAAQ,CAAC,KAAK,EAAE,CAAC,CAAC,CAAC;QAC1B,MAAM,CAAC,KAAK,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,SAAS,EAAE,aAAa,CAAC,CAAC;IAClD,CAAC,CAAC,CAAC;IAEH,EAAE,CAAC,0DAA0D,EAAE,KAAK,IAAI,EAAE;QACxE,MAAM,IAAI,GAAG,IAAI,UAAU,CAAC,yBAAyB,CAAC,yBAAyB,EAAE,CAAC;QAClF,oBAAoB,CAAC,IAAI,CAAC,CAAC;QAE3B,MAAM,WAAW,CAAC,IAAI,EAAE,CAAC;QAEzB,MAAM,KAAK,GAAG,IAAI,CAAC,UAAW,CAAC,gBAAgB,CAAC,oBAAoB,CAAoC,CAAC;QACzG,MAAM,OAAO,GAAG,KAAK,CAAC,KAAK,CAAC,MAAM,GAAG,CAAC,CAAC,CAAC;QACxC,OAAO,CAAC,KAAK,EAAE,CAAC;QAEhB,MAAM,CAAC,OAAO,CAAC,OAAO,CAAC,QAAQ,CAAC,CAAC;QAEjC,MAAM,WAAW,CAAC,IAAI,EAAE,CAAC;QAEzB,MAAM,CAAC,UAAU,CAAC,UAAU,CAAC,CAAC;QAC9B,MAAM,CAAC,OAAO,CAAC,OAAO,CAAC,QAAQ,CAAC,CAAC;IACnC,CAAC,CAAC,CAAC;AACL,CAAC,CAAC,CAAC","sourcesContent":["// Copyright 2024 The Chromium Authors. All rights reserved.\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport * as Common from '../../../core/common/common.js';\nimport * as SDK from '../../../core/sdk/sdk.js';\nimport {renderElementIntoDOM} from '../../../testing/DOMHelpers.js';\nimport {describeWithEnvironment} from '../../../testing/EnvironmentHelpers.js';\nimport type * as Menus from '../../../ui/components/menus/menus.js';\nimport * as Coordinator from '../../../ui/components/render_coordinator/render_coordinator.js';\nimport * as MobileThrottling from '../../mobile_throttling/mobile_throttling.js';\n\nimport * as Components from './components.js';\n\ndescribeWithEnvironment('NetworkThrottlingSelector', () => {\n  const coordinator = Coordinator.RenderCoordinator.RenderCoordinator.instance();\n  let networkManager: SDK.NetworkManager.MultitargetNetworkManager;\n  let customNetworkSetting: Common.Settings.Setting<SDK.NetworkManager.Conditions[]>;\n  let mockReveal: sinon.SinonStub;\n\n  beforeEach(() => {\n    networkManager = SDK.NetworkManager.MultitargetNetworkManager.instance({forceNew: true});\n    customNetworkSetting = Common.Settings.Settings.instance().moduleSetting('custom-network-conditions');\n    mockReveal = sinon.stub(Common.Revealer.RevealerRegistry.instance(), 'reveal');\n  });\n\n  afterEach(() => {\n    customNetworkSetting.set([]);\n    mockReveal.restore();\n  });\n\n  it('should render all default presets', async () => {\n    const view = new Components.NetworkThrottlingSelector.NetworkThrottlingSelector();\n    renderElementIntoDOM(view);\n\n    await coordinator.done();\n\n    const groups = view.shadowRoot!.querySelectorAll('devtools-menu-group') as NodeListOf<Menus.Menu.MenuGroup>;\n\n    assert.lengthOf(groups, 3);\n\n    assert.strictEqual(groups[0].name, 'Disabled');\n    const group1Items = groups[0].querySelectorAll('devtools-menu-item') as NodeListOf<Menus.Menu.MenuItem>;\n    assert.lengthOf(group1Items, 1);\n    assert.match(group1Items[0].innerText, /No throttling/);\n    assert.isTrue(group1Items[0].selected);\n\n    assert.strictEqual(groups[1].name, 'Presets');\n    const group2Items = groups[1].querySelectorAll('devtools-menu-item') as NodeListOf<Menus.Menu.MenuItem>;\n    assert.lengthOf(group2Items, 4);\n    assert.match(group2Items[0].innerText, /Fast 4G/);\n    assert.isFalse(group2Items[0].selected);\n    assert.match(group2Items[1].innerText, /Slow 4G/);\n    assert.isFalse(group2Items[1].selected);\n    assert.match(group2Items[2].innerText, /3G/);\n    assert.isFalse(group2Items[2].selected);\n    assert.match(group2Items[3].innerText, /Offline/);\n    assert.isFalse(group2Items[3].selected);\n\n    assert.strictEqual(groups[2].name, 'Custom');\n    const group3Items = groups[2].querySelectorAll('devtools-menu-item') as NodeListOf<Menus.Menu.MenuItem>;\n    assert.lengthOf(group3Items, 1);\n    assert.match(group3Items[0].innerText, /Addâ€¦/);\n    assert.isFalse(group3Items[0].selected);\n  });\n\n  it('updates network manager on change', async () => {\n    const view = new Components.NetworkThrottlingSelector.NetworkThrottlingSelector();\n    renderElementIntoDOM(view);\n\n    await coordinator.done();\n\n    const items = view.shadowRoot!.querySelectorAll('devtools-menu-item') as NodeListOf<Menus.Menu.MenuItem>;\n    assert.isTrue(items[0].selected);\n    assert.strictEqual(networkManager.networkConditions().i18nTitleKey, 'No throttling');\n\n    items[1].click();\n    await coordinator.done();\n\n    assert.isTrue(items[1].selected);\n    assert.isFalse(items[0].selected);\n    assert.strictEqual(networkManager.networkConditions().i18nTitleKey, 'Fast 4G');\n  });\n\n  it('reacts to network manager changes', async () => {\n    const view = new Components.NetworkThrottlingSelector.NetworkThrottlingSelector();\n    renderElementIntoDOM(view);\n\n    await coordinator.done();\n\n    const items = view.shadowRoot!.querySelectorAll('devtools-menu-item') as NodeListOf<Menus.Menu.MenuItem>;\n    assert.isTrue(items[0].selected);\n\n    networkManager.setNetworkConditions(MobileThrottling.ThrottlingPresets.ThrottlingPresets.networkPresets[1]);\n    await coordinator.done();\n\n    assert.isTrue(items[2].selected);\n    assert.isFalse(items[0].selected);\n  });\n\n  it('reacts to custom setting changes', async () => {\n    const view = new Components.NetworkThrottlingSelector.NetworkThrottlingSelector();\n    renderElementIntoDOM(view);\n\n    await coordinator.done();\n\n    let items = view.shadowRoot!.querySelectorAll('devtools-menu-item') as NodeListOf<HTMLElement>;\n    assert.lengthOf(items, 6);\n\n    customNetworkSetting.set([{\n      title: 'Custom item',\n      i18nTitleKey: 'Custom item',\n      download: 0,\n      upload: 0,\n      latency: 0,\n    }]);\n    await coordinator.done();\n\n    items = view.shadowRoot!.querySelectorAll('devtools-menu-item') as NodeListOf<HTMLElement>;\n    assert.lengthOf(items, 7);\n    assert.match(items[5].innerText, /Custom item/);\n  });\n\n  it('reveals custom throttling settings when \"Add...\" clicked', async () => {\n    const view = new Components.NetworkThrottlingSelector.NetworkThrottlingSelector();\n    renderElementIntoDOM(view);\n\n    await coordinator.done();\n\n    const items = view.shadowRoot!.querySelectorAll('devtools-menu-item') as NodeListOf<Menus.Menu.MenuItem>;\n    const addItem = items[items.length - 1];\n    addItem.click();\n\n    assert.isFalse(addItem.selected);\n\n    await coordinator.done();\n\n    assert(mockReveal.calledOnce);\n    assert.isFalse(addItem.selected);\n  });\n});\n"]}