{"version":3,"file":"LiveMetricsView.js","sourceRoot":"","sources":["../../../../../../../front_end/panels/timeline/components/LiveMetricsView.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright 2024 The Chromium Authors. All rights reserved.\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport * as Common from '../../../core/common/common.js';\nimport * as i18n from '../../../core/i18n/i18n.js';\nimport type * as SDK from '../../../core/sdk/sdk.js';\nimport * as LiveMetrics from '../../../models/live-metrics/live-metrics.js';\nimport * as ComponentHelpers from '../../../ui/components/helpers/helpers.js';\nimport * as LitHtml from '../../../ui/lit-html/lit-html.js';\n\nimport liveMetricsViewStyles from './liveMetricsView.css.js';\n\nconst {html, nothing, Directives} = LitHtml;\nconst {until, classMap} = Directives;\n\nexport class LiveMetricsNextSteps extends HTMLElement {\n  static readonly litTagName = LitHtml.literal`devtools-live-metrics-next-steps`;\n  readonly #shadow = this.attachShadow({mode: 'open'});\n\n  constructor() {\n    super();\n    this.#render();\n  }\n\n  connectedCallback(): void {\n    this.#shadow.adoptedStyleSheets = [liveMetricsViewStyles];\n  }\n\n  #render(): void {\n    const output = html`\n      <div class=\"next-steps\">\n        <h3>Next steps</h3>\n      </div>\n    `;\n    LitHtml.render(output, this.#shadow, {host: this});\n  }\n}\n\nexport class LiveMetricsView extends HTMLElement {\n  static readonly litTagName = LitHtml.literal`devtools-live-metrics-view`;\n  readonly #shadow = this.attachShadow({mode: 'open'});\n\n  #liveMetrics: LiveMetrics.LiveMetrics = new LiveMetrics.LiveMetrics();\n\n  #lcpValue?: LiveMetrics.LCPChangeEvent;\n  #clsValue?: LiveMetrics.CLSChangeEvent;\n  #inpValue?: LiveMetrics.INPChangeEvent;\n\n  constructor() {\n    super();\n    this.#render();\n  }\n\n  #onReset = (): void => {\n    this.#lcpValue = undefined;\n    this.#clsValue = undefined;\n    this.#inpValue = undefined;\n    void ComponentHelpers.ScheduledRender.scheduleRender(this, this.#render);\n  };\n\n  #onLcpChange = (event: {data: LiveMetrics.LCPChangeEvent}): void => {\n    this.#lcpValue = event.data;\n    void ComponentHelpers.ScheduledRender.scheduleRender(this, this.#render);\n  };\n\n  #onClsChange = (event: {data: LiveMetrics.CLSChangeEvent}): void => {\n    this.#clsValue = event.data;\n    void ComponentHelpers.ScheduledRender.scheduleRender(this, this.#render);\n  };\n\n  #onInpChange = (event: {data: LiveMetrics.INPChangeEvent}): void => {\n    this.#inpValue = event.data;\n    void ComponentHelpers.ScheduledRender.scheduleRender(this, this.#render);\n  };\n\n  connectedCallback(): void {\n    this.#shadow.adoptedStyleSheets = [liveMetricsViewStyles];\n    this.#liveMetrics.addEventListener(LiveMetrics.Events.Reset, this.#onReset);\n    this.#liveMetrics.addEventListener(LiveMetrics.Events.LCPChanged, this.#onLcpChange);\n    this.#liveMetrics.addEventListener(LiveMetrics.Events.CLSChanged, this.#onClsChange);\n    this.#liveMetrics.addEventListener(LiveMetrics.Events.INPChanged, this.#onInpChange);\n  }\n\n  disconnectedCallback(): void {\n    this.#liveMetrics.removeEventListener(LiveMetrics.Events.Reset, this.#onReset);\n    this.#liveMetrics.removeEventListener(LiveMetrics.Events.LCPChanged, this.#onLcpChange);\n    this.#liveMetrics.removeEventListener(LiveMetrics.Events.CLSChanged, this.#onClsChange);\n    this.#liveMetrics.removeEventListener(LiveMetrics.Events.INPChanged, this.#onInpChange);\n  }\n\n  #renderLiveLcp(lcpValue: LiveMetrics.LCPChangeEvent|undefined): LitHtml.LitTemplate {\n    const title = 'Largest Contentful Paint (LCP)';\n    if (!lcpValue) {\n      return this.#renderLiveMetric(title);\n    }\n\n    return this.#renderLiveMetric(\n        title,\n        i18n.TimeUtilities.millisToString(lcpValue.value),\n        lcpValue.rating,\n        lcpValue?.node,\n    );\n  }\n\n  #renderLiveCls(clsValue: LiveMetrics.CLSChangeEvent|undefined): LitHtml.LitTemplate {\n    const title = 'Cumulative Layout Shift (CLS)';\n    if (!clsValue) {\n      return this.#renderLiveMetric(title);\n    }\n\n    return this.#renderLiveMetric(\n        title,\n        clsValue.value === 0 ? '0' : clsValue.value.toFixed(3),\n        clsValue.rating,\n    );\n  }\n\n  #renderLiveInp(inpValue: LiveMetrics.INPChangeEvent|undefined): LitHtml.LitTemplate {\n    const title = 'Interaction to Next Paint (INP)';\n    if (!inpValue) {\n      return this.#renderLiveMetric(title);\n    }\n\n    return this.#renderLiveMetric(\n        title,\n        i18n.TimeUtilities.millisToString(inpValue.value),\n        inpValue.rating,\n        inpValue.node,\n    );\n  }\n\n  #renderLiveMetric(title: string, valueStr?: string, rating?: LiveMetrics.Rating, node?: SDK.DOMModel.DOMNode):\n      LitHtml.LitTemplate {\n    const ratingClass = rating || 'waiting';\n    // clang-format off\n    return html`\n      <div class=\"metric-card\">\n        <div class=\"metric-card-title\">${title}</div>\n        <div class=${classMap({\n          'metric-card-value': true,\n          [ratingClass]: true,\n        })}>\n          ${valueStr || '-'}\n        </div>\n        <div class=\"metric-card-element\">\n          ${node ? html`\n              <div class=\"metric-card-section-title\">Related node</div>\n              <div>${until(Common.Linkifier.Linkifier.linkify(node))}</div>`\n            : nothing}\n        </div>\n      </div>\n    `;\n    // clang-format on\n  }\n\n  #render = (): void => {\n    const output = html`\n      <div class=\"live-metrics\">\n        <h3>Local and Field Metrics</h3>\n        <div class=\"metric-cards\">\n          <div>\n            ${this.#renderLiveLcp(this.#lcpValue)}\n          </div>\n          <div>\n            ${this.#renderLiveCls(this.#clsValue)}\n          </div>\n          <div>\n            ${this.#renderLiveInp(this.#inpValue)}\n          </div>\n        </div>\n        <h3>Interactions</h3>\n      </div>\n    `;\n    LitHtml.render(output, this.#shadow, {host: this});\n  };\n}\n\ncustomElements.define('devtools-live-metrics-view', LiveMetricsView);\ncustomElements.define('devtools-live-metrics-next-steps', LiveMetricsNextSteps);\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    'devtools-live-metrics-view': LiveMetricsView;\n    'devtools-live-metrics-next-steps': LiveMetricsNextSteps;\n  }\n}\n"]}