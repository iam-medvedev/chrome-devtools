{"version":3,"file":"IgnoreListSetting.test.js","sourceRoot":"","sources":["../../../../../../../front_end/panels/timeline/components/IgnoreListSetting.test.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright 2024 The Chromium Authors. All rights reserved.\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport * as Common from '../../../core/common/common.js';\nimport * as SDK from '../../../core/sdk/sdk.js';\nimport * as Bindings from '../../../models/bindings/bindings.js';\nimport * as Workspace from '../../../models/workspace/workspace.js';\nimport {renderElementIntoDOM} from '../../../testing/DOMHelpers.js';\nimport {describeWithEnvironment} from '../../../testing/EnvironmentHelpers.js';\nimport * as Coordinator from '../../../ui/components/render_coordinator/render_coordinator.js';\n\nimport * as TimelineComponents from './components.js';\n\ndescribeWithEnvironment('isIgnoreListedEntry', () => {\n  async function renderIgnoreListSetting(): Promise<HTMLElement> {\n    const coordinator = Coordinator.RenderCoordinator.RenderCoordinator.instance();\n    const component = new TimelineComponents.IgnoreListSetting.IgnoreListSetting();\n    renderElementIntoDOM(component);\n    await coordinator.done();\n    return component;\n  }\n\n  function getAllRules(component: HTMLElement): {regex: string, disabled: boolean}[] {\n    assert.isNotNull(component.shadowRoot);\n    const regexRows = component.shadowRoot.querySelectorAll<HTMLElement>('.regex-row');\n    return Array.from(regexRows).map(row => {\n      const checkboxShadow = row.querySelector('dt-checkbox')?.shadowRoot;\n      assert.exists(checkboxShadow);\n      return {\n        regex: checkboxShadow.querySelector('label')?.textContent?.trim() ?? '',\n        disabled: !checkboxShadow.querySelector('input')?.checked,\n      };\n    });\n  }\n\n  before(() => {\n    const targetManager = SDK.TargetManager.TargetManager.instance();\n    const workspace = Workspace.Workspace.WorkspaceImpl.instance({forceNew: true});\n    const resourceMapping = new Bindings.ResourceMapping.ResourceMapping(targetManager, workspace);\n    const debuggerWorkspaceBinding = Bindings.DebuggerWorkspaceBinding.DebuggerWorkspaceBinding.instance(\n        {forceNew: true, resourceMapping, targetManager});\n    Bindings.IgnoreListManager.IgnoreListManager.instance({\n      forceNew: true,\n      debuggerWorkspaceBinding,\n    });\n\n    ignoreRegex('rule 1');\n  });\n\n  it('Able to render the ignore listed rules', async () => {\n    const component = await renderIgnoreListSetting();\n    const ignoredRules = getAllRules(component);\n\n    // There is a default rule `/node_modules/|/bower_components/`\n    assert.deepStrictEqual(ignoredRules.length, 2);\n    assert.deepStrictEqual(ignoredRules[0].regex, '/node_modules/|/bower_components/');\n    assert.deepStrictEqual(ignoredRules[0].disabled, false);\n    assert.deepStrictEqual(ignoredRules[1].regex, 'rule 1');\n    assert.deepStrictEqual(ignoredRules[1].disabled, false);\n\n    // Check the remove buttons are rendered\n    assert.isNotNull(component.shadowRoot);\n    const regexRowsElements = component.shadowRoot.querySelectorAll<HTMLElement>('.regex-row');\n    Array.from(regexRowsElements).forEach(row => {\n      const removeButton = row.querySelector('devtools-button');\n      assert.exists(removeButton);\n    });\n  });\n\n  it('Able to render the disabled ignore listed rules', async () => {\n    disableIgnoreRegex('rule 1');\n\n    const component = await renderIgnoreListSetting();\n    const ignoredRules = getAllRules(component);\n\n    // There is a default rule `/node_modules/|/bower_components/`\n    assert.deepStrictEqual(ignoredRules.length, 2);\n    assert.deepStrictEqual(ignoredRules[0].regex, '/node_modules/|/bower_components/');\n    assert.deepStrictEqual(ignoredRules[0].disabled, false);\n    assert.deepStrictEqual(ignoredRules[1].regex, 'rule 1');\n    assert.deepStrictEqual(ignoredRules[1].disabled, true);\n  });\n\n  it('Able to toggle the disable status of an ignore listed rules', async () => {\n    const component = await renderIgnoreListSetting();\n\n    assert.isNotNull(component.shadowRoot);\n    const regexRows = component.shadowRoot.querySelectorAll<HTMLElement>('.regex-row');\n    // \"rule 1\" is the second in the view.\n    // Now the \"rule 1\" is disabled (by last test), so click the checkbox, it will be enabled.\n    // Add sanity checks to make sure.\n    const checkboxShadow = regexRows[1].querySelector('dt-checkbox')?.shadowRoot;\n    assert.strictEqual(checkboxShadow?.querySelector('label')?.textContent, 'rule 1');\n    assert.isTrue(isIgnoreRegexDisabled('rule 1'));\n\n    const rule1CheckBox = checkboxShadow?.querySelector('input');\n    rule1CheckBox?.click();\n    assert.isFalse(isIgnoreRegexDisabled('rule 1'));\n  });\n\n  it('Able to remove an ignore list rule', async () => {\n    const component = await renderIgnoreListSetting();\n\n    assert.isNotNull(component.shadowRoot);\n    const regexRows = component.shadowRoot.querySelectorAll<HTMLElement>('.regex-row');\n    // \"rule 1\" is the second in the view.\n    // Add sanity checks to make sure.\n    const checkboxShadow = regexRows[1].querySelector('dt-checkbox')?.shadowRoot;\n    assert.strictEqual(checkboxShadow?.querySelector('label')?.textContent, 'rule 1');\n    assert.isTrue(isRegexInIgnoredList('rule 1'));\n\n    const rule1RemoveButton = regexRows[1].querySelector('devtools-button');\n    rule1RemoveButton?.click();\n    assert.isFalse(isRegexInIgnoredList('rule 1'));\n  });\n});\n\nfunction ignoreRegex(regexValue: string): void {\n  const regexPatterns =\n      (Common.Settings.Settings.instance().moduleSetting('skip-stack-frames-pattern') as Common.Settings.RegExpSetting)\n          .getAsArray();\n  regexPatterns.push({pattern: regexValue, disabled: false});\n}\n\nfunction disableIgnoreRegex(regexValue: string): void {\n  const regexPatterns =\n      (Common.Settings.Settings.instance().moduleSetting('skip-stack-frames-pattern') as Common.Settings.RegExpSetting)\n          .getAsArray();\n  for (const regexPattern of regexPatterns) {\n    if (regexPattern.pattern === regexValue) {\n      regexPattern.disabled = true;\n      break;\n    }\n  }\n}\n\nfunction isIgnoreRegexDisabled(regexValue: string): boolean {\n  const regexPatterns =\n      (Common.Settings.Settings.instance().moduleSetting('skip-stack-frames-pattern') as Common.Settings.RegExpSetting)\n          .getAsArray();\n  for (const regexPattern of regexPatterns) {\n    if (regexPattern.pattern === regexValue) {\n      return regexPattern.disabled ?? false;\n    }\n  }\n  return false;\n}\n\n/**\n * Returns if the regex is in the ignore list, no matter if it is disabled.\n */\nfunction isRegexInIgnoredList(regexValue: string): boolean {\n  const regexPatterns =\n      (Common.Settings.Settings.instance().moduleSetting('skip-stack-frames-pattern') as Common.Settings.RegExpSetting)\n          .getAsArray();\n  for (const regexPattern of regexPatterns) {\n    if (regexPattern.pattern === regexValue) {\n      return true;\n    }\n  }\n  return false;\n}\n"]}