{"version":3,"file":"BreadcrumbsUI.js","sourceRoot":"","sources":["../../../../../../../front_end/panels/timeline/components/BreadcrumbsUI.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright 2023 The Chromium Authors. All rights reserved.\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport * as TraceEngine from '../../../models/trace/trace.js';\nimport * as ComponentHelpers from '../../../ui/components/helpers/helpers.js';\nimport * as IconButton from '../../../ui/components/icon_button/icon_button.js';\nimport * as LitHtml from '../../../ui/lit-html/lit-html.js';\n\nimport {type Breadcrumb, flattenBreadcrumbs} from './Breadcrumbs.js';\nimport breadcrumbsUIStyles from './breadcrumbsUI.css.js';\n\nconst {render, html} = LitHtml;\n\nexport interface BreadcrumbsUIData {\n  breadcrumb: Breadcrumb;\n}\n\nexport class BreadcrumbRemovedEvent extends Event {\n  static readonly eventName = 'breadcrumbremoved';\n\n  constructor(public breadcrumb: Breadcrumb) {\n    super(BreadcrumbRemovedEvent.eventName);\n  }\n}\n\nexport class BreadcrumbsUI extends HTMLElement {\n  static readonly litTagName = LitHtml.literal`devtools-breadcrumbs-ui`;\n  readonly #shadow = this.attachShadow({mode: 'open'});\n  readonly #boundRender = this.#render.bind(this);\n  #breadcrumb: Breadcrumb|null = null;\n\n  connectedCallback(): void {\n    this.#shadow.adoptedStyleSheets = [breadcrumbsUIStyles];\n  }\n\n  set data(data: BreadcrumbsUIData) {\n    this.#breadcrumb = data.breadcrumb;\n    void ComponentHelpers.ScheduledRender.scheduleRender(this, this.#boundRender);\n  }\n\n  #removeBreadcrumb(breadcrumb: Breadcrumb): void {\n    this.dispatchEvent(new BreadcrumbRemovedEvent(breadcrumb));\n  }\n\n  #showBreadcrumbsAndScrollLastCrumbIntoView(): void {\n    const container = this.#shadow.querySelector<HTMLDivElement>('.breadcrumbs');\n    if (!container) {\n      return;\n    }\n    // Display Breadcrumbs after at least one was created\n    container.style.display = 'flex';\n    requestAnimationFrame(() => {\n      // If the width of all the elements is greater than the width of the\n      // container, we need to scroll the last element into view.\n      if (container.scrollWidth - container.clientWidth > 0) {\n        requestAnimationFrame(() => {\n          // For some unknown reason, if we scroll after one rAF, the values\n          // are slightly off by a few pixels which means that the element does\n          // not get properly scrolled fully into view. Therefore we wait for a\n          // second rAF, at which point the values are correct and this will\n          // scroll the container fully to ensure the last breadcrumb is fully\n          // visible.\n          container.scrollLeft = container.scrollWidth - container.clientWidth;\n        });\n      }\n    });\n  }\n\n  #renderElement(breadcrumb: Breadcrumb, index: number): LitHtml.LitTemplate {\n    const breadcrumbRange = TraceEngine.Helpers.Timing.microSecondsToMilliseconds(breadcrumb.window.range);\n    // clang-format off\n    return html`\n          <div class=\"breadcrumb\" @click=${(): void => this.#removeBreadcrumb(breadcrumb)}>\n           <span class=\"${(index !== 0 && breadcrumb.child === null) ? 'last-breadcrumb' : ''} range\">\n            ${(index === 0) ?\n              `Full range (${breadcrumbRange.toFixed(2)}ms)` :\n              `${breadcrumbRange.toFixed(2)}ms`}\n            </span>\n          </div>\n          ${breadcrumb.child !== null ?\n            html`\n            <${IconButton.Icon.Icon.litTagName} .data=${{\n              iconName: 'chevron-right',\n              color: 'var(--icon-default)',\n              width: '16px',\n              height: '16px',\n            } as IconButton.Icon.IconData}>`\n            : ''}\n      `;\n    // clang-format on\n  }\n\n  #render(): void {\n    // clang-format off\n    const output = html`\n      ${this.#breadcrumb === null ? html`` : html`<div class=\"breadcrumbs\">\n        ${flattenBreadcrumbs(this.#breadcrumb).map((breadcrumb, index) => this.#renderElement(breadcrumb, index))}\n      </div>`}\n    `;\n    // clang-format on\n    render(output, this.#shadow, {host: this});\n    if (this.#breadcrumb?.child) {\n      // If we have >1 crumbs show breadcrumbs and ensure the last one is visible by scrolling the container.\n      this.#showBreadcrumbsAndScrollLastCrumbIntoView();\n    }\n  }\n}\n\nComponentHelpers.CustomElements.defineComponent('devtools-breadcrumbs-ui', BreadcrumbsUI);\n\ndeclare global {\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\n  interface HTMLElementTagNameMap {\n    'devtools-breadcrumbs-ui': BreadcrumbsUI;\n  }\n}\n"]}