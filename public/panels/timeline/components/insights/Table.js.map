{"version":3,"file":"Table.js","sourceRoot":"","sources":["../../../../../../../../front_end/panels/timeline/components/insights/Table.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright 2024 The Chromium Authors\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n/* eslint-disable rulesdir/no-lit-render-outside-of-view */\n\nimport * as i18n from '../../../../core/i18n/i18n.js';\nimport type * as Trace from '../../../../models/trace/trace.js';\nimport * as ComponentHelpers from '../../../../ui/components/helpers/helpers.js';\nimport * as Lit from '../../../../ui/lit/lit.js';\n\nimport type * as BaseInsightComponent from './BaseInsightComponent.js';\nimport {EventReferenceClick} from './EventRef.js';\nimport tableStyles from './table.css.js';\n\nconst UIStrings = {\n  /**\n   * @description Table row value representing the remaining items not shown in the table due to size constraints. This row will always represent at least 2 items.\n   * @example {5} PH1\n   */\n  others: '{PH1} others',\n} as const;\n\nconst str_ = i18n.i18n.registerUIStrings('panels/timeline/components/insights/Table.ts', UIStrings);\nexport const i18nString = i18n.i18n.getLocalizedString.bind(undefined, str_);\n\nconst {html} = Lit;\n\ntype BaseInsightComponent = BaseInsightComponent.BaseInsightComponent<Trace.Insights.Types.InsightModel>;\n\n/**\n * @file An interactive table component.\n *\n * On hover:\n *           desaturates the relevant events (in both the minimap and the flamegraph), and\n *           replaces the current insight's overlays with the overlays attached to that row.\n *           The currently selected trace bounds does not change.\n *\n *           Removing the mouse from the table without clicking on any row restores the original\n *           overlays.\n *\n * On click:\n *           \"sticks\" the selection, replaces overlays like hover does, and additionally updates\n *           the current trace bounds to fit the bounds of the row's overlays.\n */\n\nexport interface TableState {\n  selectedRowEl: HTMLElement|null;\n  selectionIsSticky: boolean;\n}\n\nexport interface TableData {\n  insight: BaseInsightComponent;\n  headers: string[];\n  rows: TableDataRow[];\n}\n\nexport interface TableDataRow {\n  values: Array<number|string|Lit.LitTemplate>;\n  overlays?: Trace.Types.Overlays.Overlay[];\n  subRows?: TableDataRow[];\n}\n\nexport function renderOthersLabel(numOthers: number): string {\n  return i18nString(UIStrings.others, {PH1: numOthers});\n}\n\nexport interface RowLimitAggregator<T> {\n  mapToRow: (item: T) => TableDataRow;\n  createAggregatedTableRow: (remaining: T[]) => TableDataRow;\n}\n\n/**\n * Maps `arr` to a list of `TableDataRow`s  using `aggregator.mapToRow`, but limits the number of `TableDataRow`s to `limit`.\n * If the length of `arr` is larger than `limit`, any excess rows will be aggregated into the final `TableDataRow` using `aggregator.createAggregatedTableRow`.\n *\n * Useful for creating a \"N others\" row in a data table.\n *\n * Example: `arr` is a list of 15 items & `limit` is 10. The first 9 items in `arr` would be mapped to `TableDataRow`s using `aggregator.mapToRow` and\n * the 10th `TableDataRow` would be created by using `aggregator.createAggregatedTableRow` on the 6 items that were not sent through `aggregator.mapToRow`.\n */\nexport function createLimitedRows<T>(arr: T[], aggregator: RowLimitAggregator<T>, limit = 10): TableDataRow[] {\n  if (arr.length === 0 || limit === 0) {\n    return [];\n  }\n\n  const aggregateStartIndex = limit - 1;\n  const items = arr.slice(0, aggregateStartIndex).map(aggregator.mapToRow.bind(aggregator));\n  if (arr.length > limit) {\n    items.push(aggregator.createAggregatedTableRow(arr.slice(aggregateStartIndex)));\n  } else if (arr.length === limit) {\n    items.push(aggregator.mapToRow(arr[aggregateStartIndex]));\n  }\n\n  return items;\n}\n\nexport class Table extends HTMLElement {\n  readonly #shadow = this.attachShadow({mode: 'open'});\n  #insight?: BaseInsightComponent;\n  #state?: TableState;\n  #headers?: string[];\n  /** The rows as given as by the user, which may include recursive rows via subRows. */\n  #rows?: TableDataRow[];\n  /** All rows/subRows, in the order that they appear visually. This is the result of traversing `#rows` and any subRows found. */\n  #flattenedRows?: TableDataRow[];\n  #rowToParentRow = new Map<TableDataRow, TableDataRow>();\n  #interactive = false;\n  #currentHoverIndex: number|null = null;\n\n  set data(data: TableData) {\n    this.#insight = data.insight;\n    this.#state = data.insight.sharedTableState;\n    this.#headers = data.headers;\n    this.#rows = data.rows;\n    // If this table isn't interactive, don't attach mouse listeners or use CSS :hover.\n    this.#interactive = this.#rows.some(row => row.overlays || row.subRows?.length);\n    void ComponentHelpers.ScheduledRender.scheduleRender(this, this.#render);\n  }\n\n  connectedCallback(): void {\n    void ComponentHelpers.ScheduledRender.scheduleRender(this, this.#render);\n  }\n\n  #onHoverRow(e: MouseEvent): void {\n    if (!this.#flattenedRows) {\n      return;\n    }\n\n    if (!(e.target instanceof HTMLElement)) {\n      return;\n    }\n\n    const rowEl = e.target.closest('tr');\n    if (!rowEl?.parentElement) {\n      return;\n    }\n\n    const rowEls = [...rowEl.parentElement.children];\n    const index = rowEl.sectionRowIndex;\n    if (index === this.#currentHoverIndex) {\n      return;\n    }\n\n    for (const el of rowEl.parentElement.querySelectorAll('.hover')) {\n      el.classList.remove('hover');\n    }\n\n    // Add 'hover' class to all parent rows.\n    let row: TableDataRow|undefined = this.#rowToParentRow.get(this.#flattenedRows[index]);\n    while (row) {\n      const index = this.#flattenedRows.indexOf(row);\n      const rowEl = rowEls[index];\n      rowEl.classList.add('hover');\n      row = this.#rowToParentRow.get(row);\n    }\n\n    this.#currentHoverIndex = index;\n    // Temporarily selects the row, but only if there is not already a sticky selection.\n    this.#onSelectedRowChanged(rowEl, index, {isHover: true});\n  }\n\n  #onClickRow(e: MouseEvent): void {\n    if (!(e.target instanceof HTMLElement)) {\n      return;\n    }\n\n    const rowEl = e.target.closest('tr');\n    if (!rowEl?.parentElement) {\n      return;\n    }\n\n    const index = [...rowEl.parentElement.children].indexOf(rowEl);\n    if (index === -1) {\n      return;\n    }\n\n    // If the desired overlays consist of just a single ENTRY_OUTLINE, then\n    // it is more intuitive to just select the target event.\n    const overlays = this.#flattenedRows?.[index]?.overlays;\n    if (overlays?.length === 1 && overlays[0].type === 'ENTRY_OUTLINE') {\n      this.dispatchEvent(new EventReferenceClick(overlays[0].entry));\n      return;\n    }\n\n    // Select the row and make it sticky.\n    this.#onSelectedRowChanged(rowEl, index, {sticky: true});\n  }\n\n  #onMouseLeave(): void {\n    for (const el of this.shadowRoot?.querySelectorAll('.hover') ?? []) {\n      el.classList.remove('hover');\n    }\n\n    this.#currentHoverIndex = null;\n    // Unselect the row, unless it's sticky.\n    this.#onSelectedRowChanged(null, null);\n  }\n\n  #onSelectedRowChanged(rowEl: HTMLElement|null, rowIndex: number|null, opts: {\n    sticky?: boolean,\n    isHover?: boolean,\n  } = {}): void {\n    if (!this.#flattenedRows || !this.#state || !this.#insight) {\n      return;\n    }\n\n    if (this.#state.selectionIsSticky && !opts.sticky) {\n      return;\n    }\n\n    // Unselect a sticky-selection when clicking it for a second time.\n    if (this.#state.selectionIsSticky && rowEl === this.#state.selectedRowEl) {\n      rowEl = null;\n      opts.sticky = false;\n    }\n\n    if (rowEl && rowIndex !== null) {\n      const overlays = this.#flattenedRows[rowIndex].overlays;\n      if (overlays) {\n        this.#insight.toggleTemporaryOverlays(overlays, {updateTraceWindow: !opts.isHover});\n      }\n    } else {\n      this.#insight.toggleTemporaryOverlays(null, {updateTraceWindow: false});\n    }\n\n    this.#state.selectedRowEl?.classList.remove('selected');\n    rowEl?.classList.add('selected');\n    this.#state.selectedRowEl = rowEl;\n    this.#state.selectionIsSticky = opts.sticky ?? false;\n  }\n\n  async #render(): Promise<void> {\n    if (!this.#headers || !this.#rows) {\n      return;\n    }\n\n    const rowToParentRow = this.#rowToParentRow;\n    rowToParentRow.clear();\n\n    const numColumns = this.#headers.length;\n    const flattenedRows: TableDataRow[] = [];\n    const rowEls: Lit.TemplateResult[] = [];\n    function traverse(parent: TableDataRow|null, row: TableDataRow, depth = 0): void {\n      if (parent) {\n        rowToParentRow.set(row, parent);\n      }\n\n      const thStyles = Lit.Directives.styleMap({\n        paddingLeft: `calc(${depth} * var(--sys-size-5))`,\n        backgroundImage: `repeating-linear-gradient(\n              to right,\n              var(--sys-color-tonal-outline) 0 var(--sys-size-1),\n              transparent var(--sys-size-1) var(--sys-size-5)\n            )`,\n        backgroundPosition: '0 0',\n        backgroundRepeat: 'no-repeat',\n        backgroundSize: `calc(${depth} * var(--sys-size-5))`,\n      });\n      const trStyles = Lit.Directives.styleMap({\n        color: depth ? 'var(--sys-color-on-surface-subtle)' : '',\n      });\n      const columnEls = row.values.map(\n          (value, i) => i === 0 ? html`<th\n                scope=\"row\"\n                colspan=${i === row.values.length - 1 ? numColumns - i : 1}\n                style=${thStyles}>${value}\n              </th>` :\n                                  html`<td>${value}</td>`);\n      rowEls.push(html`<tr style=${trStyles}>${columnEls}</tr>`);\n\n      flattenedRows.push(row);\n\n      for (const subRow of row.subRows ?? []) {\n        traverse(row, subRow, depth + 1);\n      }\n    }\n\n    for (const row of this.#rows) {\n      traverse(null, row);\n    }\n\n    this.#flattenedRows = flattenedRows;\n\n    Lit.render(\n        html`<style>${tableStyles}</style>\n      <table\n          class=${Lit.Directives.classMap({\n          interactive: this.#interactive,\n        })}\n          @mouseleave=${this.#interactive ? this.#onMouseLeave : null}>\n        <thead>\n          <tr>\n          ${this.#headers.map(h => html`<th scope=\"col\">${h}</th>`)}\n          </tr>\n        </thead>\n        <tbody\n          @mouseover=${this.#interactive ? this.#onHoverRow : null}\n          @click=${this.#interactive ? this.#onClickRow : null}\n        >${rowEls}</tbody>\n      </table>`,\n        this.#shadow, {host: this});\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    'devtools-performance-table': Table;\n  }\n}\n\ncustomElements.define('devtools-performance-table', Table);\n"]}