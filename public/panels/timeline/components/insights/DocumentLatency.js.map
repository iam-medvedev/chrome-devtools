{"version":3,"file":"DocumentLatency.js","sourceRoot":"","sources":["../../../../../../../../front_end/panels/timeline/components/insights/DocumentLatency.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright 2024 The Chromium Authors. All rights reserved.\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport './Checklist.js';\n\nimport type {DocumentLatencyInsightModel} from '../../../../models/trace/insights/DocumentLatency.js';\nimport * as Trace from '../../../../models/trace/trace.js';\nimport * as Lit from '../../../../ui/lit/lit.js';\nimport type * as Overlays from '../../overlays/overlays.js';\n\nimport {BaseInsightComponent} from './BaseInsightComponent.js';\n\nconst {UIStrings, i18nString} = Trace.Insights.Models.DocumentLatency;\n\nconst {html} = Lit;\n\nexport class DocumentLatency extends BaseInsightComponent<DocumentLatencyInsightModel> {\n  static override readonly litTagName = Lit.StaticHtml.literal`devtools-performance-document-latency`;\n  override internalName = 'document-latency';\n  protected override hasAskAISupport = true;\n\n  override createOverlays(): Overlays.Overlays.TimelineOverlay[] {\n    if (!this.model?.data?.documentRequest) {\n      return [];\n    }\n\n    const overlays: Overlays.Overlays.TimelineOverlay[] = [];\n    const event = this.model.data.documentRequest;\n    const redirectDurationMicro = Trace.Helpers.Timing.milliToMicro(this.model.data.redirectDuration);\n\n    const sections = [];\n    if (this.model.data.redirectDuration) {\n      const bounds = Trace.Helpers.Timing.traceWindowFromMicroSeconds(\n          event.ts,\n          (event.ts + redirectDurationMicro) as Trace.Types.Timing.Micro,\n      );\n      sections.push({bounds, label: i18nString(UIStrings.redirectsLabel), showDuration: true});\n      overlays.push({type: 'CANDY_STRIPED_TIME_RANGE', bounds, entry: event});\n    }\n    if (!this.model.data.checklist.serverResponseIsFast.value) {\n      const serverResponseTimeMicro = Trace.Helpers.Timing.milliToMicro(this.model.data.serverResponseTime);\n      // NOTE: NetworkRequestHandlers never makes a synthetic network request event if `timing` is missing.\n      const sendEnd = event.args.data.timing?.sendEnd ?? Trace.Types.Timing.Milli(0);\n      const sendEndMicro = Trace.Helpers.Timing.milliToMicro(sendEnd);\n      const bounds = Trace.Helpers.Timing.traceWindowFromMicroSeconds(\n          sendEndMicro,\n          (sendEndMicro + serverResponseTimeMicro) as Trace.Types.Timing.Micro,\n      );\n      sections.push({bounds, label: i18nString(UIStrings.serverResponseTimeLabel), showDuration: true});\n    }\n    if (this.model.data.uncompressedResponseBytes) {\n      const bounds = Trace.Helpers.Timing.traceWindowFromMicroSeconds(\n          event.args.data.syntheticData.downloadStart,\n          (event.args.data.syntheticData.downloadStart + event.args.data.syntheticData.download) as\n              Trace.Types.Timing.Micro,\n      );\n      sections.push({bounds, label: i18nString(UIStrings.uncompressedDownload), showDuration: true});\n      overlays.push({type: 'CANDY_STRIPED_TIME_RANGE', bounds, entry: event});\n    }\n\n    if (sections.length) {\n      overlays.push({\n        type: 'TIMESPAN_BREAKDOWN',\n        sections,\n        entry: this.model.data.documentRequest,\n        // Always render below because the document request is guaranteed to be\n        // the first request in the network track.\n        renderLocation: 'BELOW_EVENT',\n      });\n    }\n    overlays.push({\n      type: 'ENTRY_SELECTED',\n      entry: this.model.data.documentRequest,\n    });\n\n    return overlays;\n  }\n\n  override getEstimatedSavingsTime(): Trace.Types.Timing.Milli|null {\n    return this.model?.metricSavings?.FCP ?? null;\n  }\n\n  override getEstimatedSavingsBytes(): number|null {\n    return this.model?.data?.uncompressedResponseBytes ?? null;\n  }\n\n  override renderContent(): Lit.LitTemplate {\n    if (!this.model?.data) {\n      return Lit.nothing;\n    }\n\n    // clang-format off\n    return html`<devtools-performance-checklist .checklist=${this.model.data.checklist}></devtools-performance-checklist>`;\n    // clang-format on\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    'devtools-performance-document-latency': DocumentLatency;\n  }\n}\n\ncustomElements.define('devtools-performance-document-latency', DocumentLatency);\n"]}