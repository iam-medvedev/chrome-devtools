{"version":3,"file":"DocumentLatency.js","sourceRoot":"","sources":["../../../../../../../../front_end/panels/timeline/components/insights/DocumentLatency.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright 2024 The Chromium Authors. All rights reserved.\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport * as i18n from '../../../../core/i18n/i18n.js';\nimport type * as TraceEngine from '../../../../models/trace/trace.js';\nimport * as IconButton from '../../../../ui/components/icon_button/icon_button.js';\nimport * as LitHtml from '../../../../ui/lit-html/lit-html.js';\nimport type * as Overlays from '../../overlays/overlays.js';\n\nimport {BaseInsight, shouldRenderForCategory} from './Helpers.js';\nimport * as SidebarInsight from './SidebarInsight.js';\nimport {InsightsCategories} from './types.js';\n\nconst UIStrings = {\n  /**\n   * @description Text to tell the user that the document request does not have redirects.\n   */\n  redirects: 'Avoids multiple page redirects',\n  /**\n   * @description Text to tell the user that the time starting the document request to when the server started responding is acceptable.\n   */\n  serverResponseTime: 'Initial server response time was short',\n  /**\n   * @description Text to tell the user that text compression (like gzip) was applied.\n   */\n  textCompression: 'Text compression applied',\n};\n\nconst str_ = i18n.i18n.registerUIStrings('panels/timeline/components/insights/DocumentLatency.ts', UIStrings);\nconst i18nString = i18n.i18n.getLocalizedString.bind(undefined, str_);\n\nexport function getDocumentLatencyInsight(\n    insights: TraceEngine.Insights.Types.TraceInsightData|null,\n    navigationId: string|null): TraceEngine.Insights.Types.InsightResults['DocumentLatency']|null {\n  if (!insights || !navigationId) {\n    return null;\n  }\n\n  const insightsByNavigation = insights.get(navigationId);\n  if (!insightsByNavigation) {\n    return null;\n  }\n\n  const insight = insightsByNavigation.DocumentLatency;\n  if (insight instanceof Error) {\n    return null;\n  }\n  return insight;\n}\n\nexport class DocumentLatency extends BaseInsight {\n  static readonly litTagName = LitHtml.literal`devtools-performance-document-latency`;\n  override insightCategory: InsightsCategories = InsightsCategories.OTHER;\n  override internalName: string = 'document-latency';\n  override userVisibleTitle: string = 'Document request latency';\n\n  #adviceIcon(didPass: boolean): LitHtml.TemplateResult {\n    const icon = didPass ? 'check-circle' : 'clear';\n\n    return LitHtml.html`\n      <${IconButton.Icon.Icon.litTagName}\n      name=${icon}\n      class=${didPass ? 'metric-value-good' : 'metric-value-bad'}\n      ></${IconButton.Icon.Icon.litTagName}>\n    `;\n  }\n\n  override createOverlays(): Overlays.Overlays.TimelineOverlay[] {\n    // TODO: create overlays\n    return [];\n  }\n\n  #renderInsight(insight: TraceEngine.Insights.Types.InsightResults['DocumentLatency']): LitHtml.LitTemplate {\n    // clang-format off\n    return LitHtml.html`\n    <div class=\"insights\">\n      <${SidebarInsight.SidebarInsight.litTagName} .data=${{\n            title: this.userVisibleTitle,\n            expanded: this.isActive(),\n            estimatedSavings: insight.metricSavings?.FCP,\n        } as SidebarInsight.InsightDetails}\n        @insighttoggleclick=${this.onSidebarClick}\n      >\n        <div slot=\"insight-description\" class=\"insight-description\">\n          <ul class=\"insight-results insight-icon-results\">\n              <li class=\"insight-entry\">\n                ${this.#adviceIcon(insight.redirectDuration === 0)}\n                <span>${i18nString(UIStrings.redirects)}</span>\n              </li>\n              <li class=\"insight-entry\">\n                ${this.#adviceIcon(insight.serverResponseTime === 0)}\n                <span>${i18nString(UIStrings.serverResponseTime)}</span>\n              </li>\n              <li class=\"insight-entry\">\n                ${this.#adviceIcon(insight.uncompressedResponseBytes === 0)}\n                <span>${i18nString(UIStrings.textCompression)}</span>\n              </li>\n            </ul>\n        </div>\n        <div slot=\"insight-content\" class=\"table-container\">\n        </div>\n      </${SidebarInsight.SidebarInsight}>\n    </div>`;\n    // clang-format on\n  }\n\n  override render(): void {\n    const insight = getDocumentLatencyInsight(this.data.insights, this.data.navigationId);\n    const matchesCategory = shouldRenderForCategory({\n      activeCategory: this.data.activeCategory,\n      insightCategory: this.insightCategory,\n    });\n    const output = matchesCategory && insight ? this.#renderInsight(insight) : LitHtml.nothing;\n    LitHtml.render(output, this.shadow, {host: this});\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    'devtools-performance-document-latency': DocumentLatency;\n  }\n}\n\ncustomElements.define('devtools-performance-document-latency', DocumentLatency);\n"]}