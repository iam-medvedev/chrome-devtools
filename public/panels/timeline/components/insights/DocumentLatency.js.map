{"version":3,"file":"DocumentLatency.js","sourceRoot":"","sources":["../../../../../../../../front_end/panels/timeline/components/insights/DocumentLatency.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright 2024 The Chromium Authors. All rights reserved.\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport * as i18n from '../../../../core/i18n/i18n.js';\nimport type * as Trace from '../../../../models/trace/trace.js';\nimport * as IconButton from '../../../../ui/components/icon_button/icon_button.js';\nimport * as LitHtml from '../../../../ui/lit-html/lit-html.js';\nimport type * as Overlays from '../../overlays/overlays.js';\n\nimport {BaseInsight, shouldRenderForCategory} from './Helpers.js';\nimport * as SidebarInsight from './SidebarInsight.js';\nimport {InsightsCategories} from './types.js';\n\nconst UIStrings = {\n  /**\n   * @description Text to tell the user that the document request does not have redirects.\n   */\n  passingRedirects: 'Avoids redirects',\n  /**\n   * @description Text to tell the user that the document request had redirects.\n   */\n  failedRedirects: 'Had redirects',\n  /**\n   * @description Text to tell the user that the time starting the document request to when the server started responding is acceptable.\n   */\n  passingServerResponseTime: 'Server responds quickly',\n  /**\n   * @description Text to tell the user that the time starting the document request to when the server started responding is not acceptable.\n   */\n  failedServerResponseTime: 'Server responded slowly',\n  /**\n   * @description Text to tell the user that text compression (like gzip) was applied.\n   */\n  passingTextCompression: 'Applies text compression',\n  /**\n   * @description Text to tell the user that text compression (like gzip) was not applied.\n   */\n  failedTextCompression: 'No compression applied',\n};\n\nconst str_ = i18n.i18n.registerUIStrings('panels/timeline/components/insights/DocumentLatency.ts', UIStrings);\nconst i18nString = i18n.i18n.getLocalizedString.bind(undefined, str_);\n\nexport function getDocumentLatencyInsight(\n    insights: Trace.Insights.Types.TraceInsightSets|null,\n    navigationId: string|null): Trace.Insights.Types.InsightResults['DocumentLatency']|null {\n  if (!insights || !navigationId) {\n    return null;\n  }\n\n  const insightsByNavigation = insights.get(navigationId);\n  if (!insightsByNavigation) {\n    return null;\n  }\n\n  const insight = insightsByNavigation.data.DocumentLatency;\n  if (insight instanceof Error) {\n    return null;\n  }\n  return insight;\n}\n\nexport class DocumentLatency extends BaseInsight {\n  static readonly litTagName = LitHtml.literal`devtools-performance-document-latency`;\n  override insightCategory: InsightsCategories = InsightsCategories.OTHER;\n  override internalName: string = 'document-latency';\n  override userVisibleTitle: string = 'Document request latency';\n\n  #check(didPass: boolean, good: string, bad: string): LitHtml.TemplateResult {\n    const icon = didPass ? 'check-circle' : 'clear';\n\n    return LitHtml.html`\n      <${IconButton.Icon.Icon.litTagName}\n        name=${icon}\n        class=${didPass ? 'metric-value-good' : 'metric-value-bad'}\n      ></${IconButton.Icon.Icon.litTagName}>\n      <span>${didPass ? good : bad}</span>\n    `;\n  }\n\n  override createOverlays(): Overlays.Overlays.TimelineOverlay[] {\n    const insight = getDocumentLatencyInsight(this.data.insights, this.data.navigationId);\n    if (!insight?.data?.documentRequest) {\n      return [];\n    }\n\n    // TODO(crbug.com/352244434) add breakdown for server response time, queing, redirects, etc...\n    return [{\n      type: 'ENTRY_SELECTED',\n      entry: insight.data.documentRequest,\n    }];\n  }\n\n  #renderInsight(insight: Trace.Insights.Types.InsightResults['DocumentLatency']): LitHtml.LitTemplate {\n    if (!insight.data) {\n      return LitHtml.nothing;\n    }\n\n    // clang-format off\n    return LitHtml.html`\n    <div class=\"insights\">\n      <${SidebarInsight.SidebarInsight.litTagName} .data=${{\n            title: this.userVisibleTitle,\n            expanded: this.isActive(),\n            estimatedSavings: insight.metricSavings?.FCP,\n        } as SidebarInsight.InsightDetails}\n        @insighttoggleclick=${this.onSidebarClick}\n      >\n        <div slot=\"insight-description\" class=\"insight-description\">\n          <ul class=\"insight-results insight-icon-results\">\n              <li class=\"insight-entry\">\n                ${this.#check(insight.data.redirectDuration === 0,\n                  i18nString(UIStrings.passingRedirects), i18nString(UIStrings.failedRedirects))}\n              </li>\n              <li class=\"insight-entry\">\n                ${this.#check(!insight.data.serverResponseTooSlow,\n                  i18nString(UIStrings.passingServerResponseTime), i18nString(UIStrings.failedServerResponseTime))}\n              </li>\n              <li class=\"insight-entry\">\n                ${this.#check(insight.data.uncompressedResponseBytes === 0,\n                  i18nString(UIStrings.passingTextCompression), i18nString(UIStrings.failedTextCompression))}\n              </li>\n            </ul>\n        </div>\n      </${SidebarInsight.SidebarInsight}>\n    </div>`;\n    // clang-format on\n  }\n\n  override render(): void {\n    const insight = getDocumentLatencyInsight(this.data.insights, this.data.navigationId);\n    const matchesCategory = shouldRenderForCategory({\n      activeCategory: this.data.activeCategory,\n      insightCategory: this.insightCategory,\n    });\n    const output = matchesCategory && insight?.data ? this.#renderInsight(insight) : LitHtml.nothing;\n    LitHtml.render(output, this.shadow, {host: this});\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    'devtools-performance-document-latency': DocumentLatency;\n  }\n}\n\ncustomElements.define('devtools-performance-document-latency', DocumentLatency);\n"]}