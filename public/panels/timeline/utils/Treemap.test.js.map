{"version":3,"file":"Treemap.test.js","sourceRoot":"","sources":["../../../../../../../front_end/panels/timeline/utils/Treemap.test.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright 2025 The Chromium Authors\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport {describeWithEnvironment} from '../../../testing/EnvironmentHelpers.js';\nimport {TraceLoader} from '../../../testing/TraceLoader.js';\n\nimport * as Utils from './utils.js';\n\ndescribe('Treemap', () => {\n  describe('makeScriptNode', () => {\n    const src = 'main.js';\n\n    it('uses node data when available', () => {\n      const node = Utils.Treemap.makeScriptNode(src, '', {\n        'a.js': {resourceBytes: 100},\n        'b.js': {resourceBytes: 100, duplicatedNormalizedModuleName: 'blah'},\n        'c.js': {resourceBytes: 100},\n      });\n      assert.deepEqual(node, {\n        name: src,\n        resourceBytes: 300,\n        encodedBytes: undefined,\n        children: [\n          {\n            name: 'a.js',\n            resourceBytes: 100,\n            encodedBytes: undefined,\n          },\n          {\n            duplicatedNormalizedModuleName: 'blah',\n            name: 'b.js',\n            resourceBytes: 100,\n            encodedBytes: undefined,\n          },\n          {\n            name: 'c.js',\n            resourceBytes: 100,\n            encodedBytes: undefined,\n          },\n        ],\n      });\n    });\n\n    it('creates directory node when multiple leaf nodes', () => {\n      const node = Utils.Treemap.makeScriptNode(src, '', {\n        'folder/a.js': {resourceBytes: 100},\n        'folder/b.js': {resourceBytes: 100},\n      });\n      assert.deepEqual(node, {\n        name: src,\n        children: [\n          {\n            children: [\n              {\n                name: 'a.js',\n                resourceBytes: 100,\n                encodedBytes: undefined,\n              },\n              {\n                name: 'b.js',\n                resourceBytes: 100,\n                encodedBytes: undefined,\n              },\n            ],\n            name: '/folder',\n            resourceBytes: 200,\n            encodedBytes: undefined,\n          },\n        ],\n        resourceBytes: 200,\n        encodedBytes: undefined,\n      });\n    });\n\n    it('flattens directory node when single leaf nodes', () => {\n      const node = Utils.Treemap.makeScriptNode(src, '', {\n        'root/folder1/a.js': {resourceBytes: 100},\n        'root/folder2/b.js': {resourceBytes: 100},\n      });\n      assert.deepEqual(node, {\n        name: src,\n        children: [\n          {\n            children: [\n              {\n                children: undefined,\n                name: 'folder1/a.js',\n                resourceBytes: 100,\n                encodedBytes: undefined,\n              },\n              {\n                children: undefined,\n                name: 'folder2/b.js',\n                resourceBytes: 100,\n                encodedBytes: undefined,\n              },\n            ],\n            name: '/root',\n            resourceBytes: 200,\n            encodedBytes: undefined,\n          },\n        ],\n        resourceBytes: 200,\n        encodedBytes: undefined,\n      });\n    });\n\n    it('ignores leading slashes', () => {\n      const node = Utils.Treemap.makeScriptNode(src, '', {\n        '/a.js': {resourceBytes: 100},\n        '/b.js': {resourceBytes: 100},\n      });\n      assert.deepEqual(node, {\n        name: src,\n        resourceBytes: 200,\n        encodedBytes: undefined,\n        children: [\n          {\n            name: 'a.js',\n            resourceBytes: 100,\n            encodedBytes: undefined,\n          },\n          {\n            name: 'b.js',\n            resourceBytes: 100,\n            encodedBytes: undefined,\n          },\n        ],\n      });\n    });\n\n    it('ignores repeated slashes', () => {\n      const node = Utils.Treemap.makeScriptNode(src, '', {\n        'root//a.js': {resourceBytes: 100},\n        'root//b.js': {resourceBytes: 100},\n      });\n      assert.deepEqual(node, {\n        name: src,\n        children: [\n          {\n            name: '/root',\n            children: [\n              {\n                name: 'a.js',\n                resourceBytes: 100,\n                encodedBytes: undefined,\n              },\n              {\n                name: 'b.js',\n                resourceBytes: 100,\n                encodedBytes: undefined,\n              },\n            ],\n            resourceBytes: 200,\n            encodedBytes: undefined,\n          },\n        ],\n        resourceBytes: 200,\n        encodedBytes: undefined,\n      });\n    });\n\n    it('source root replaces matching prefixes', () => {\n      const sourcesData = {\n        'some/prefix/main.js': {resourceBytes: 100},\n        'not/some/prefix/a.js': {resourceBytes: 101},\n      };\n      let node = Utils.Treemap.makeScriptNode(src, 'some/prefix', sourcesData);\n      assert.deepEqual(node, {\n        name: src,\n        children: [\n          {\n            name: 'some/prefix',\n            resourceBytes: 201,\n            encodedBytes: undefined,\n            children: [\n              {\n                name: 'main.js',\n                resourceBytes: 100,\n                encodedBytes: undefined,\n              },\n              {\n                name: 'not/a.js',\n                resourceBytes: 101,\n                encodedBytes: undefined,\n                children: undefined,\n              },\n            ],\n          },\n        ],\n        resourceBytes: 201,\n        encodedBytes: undefined,\n      });\n\n      expect(node.name).to.equal(src);\n      expect(node.resourceBytes).to.equal(201);\n\n      node = node.children![0];\n      expect(node.name).to.equal('some/prefix');\n      expect(node.resourceBytes).to.equal(201);\n      expect(node.children?.[0].name).to.equal('main.js');\n      expect(node.children?.[1].name).to.equal('not/a.js');\n    });\n\n    it('nodes have duplicates data', () => {\n      const sourcesData = {\n        'lib/folder/a.js': {resourceBytes: 100},\n        'lib/node_modules/dep/a.js': {resourceBytes: 101, duplicatedNormalizedModuleName: 'dep/a.js'},\n        'node_modules/dep/a.js': {resourceBytes: 100, duplicatedNormalizedModuleName: 'dep/a.js'},\n        'lib/node_modules/dep/b.js': {resourceBytes: 101, duplicatedNormalizedModuleName: 'dep/b.js'},\n        'node_modules/dep/b.js': {resourceBytes: 100, duplicatedNormalizedModuleName: 'dep/b.js'},\n      };\n      const node = Utils.Treemap.makeScriptNode(src, '', sourcesData);\n      assert.deepEqual(node, {\n        name: src,\n        resourceBytes: 502,\n        encodedBytes: undefined,\n        children: [\n          {\n            children: [\n              {\n                children: undefined,\n                name: 'folder/a.js',\n                resourceBytes: 100,\n                encodedBytes: undefined,\n              },\n              {\n                children: [\n                  {\n                    duplicatedNormalizedModuleName: 'dep/a.js',\n                    name: 'a.js',\n                    resourceBytes: 101,\n                    encodedBytes: undefined,\n                  },\n                  {\n                    duplicatedNormalizedModuleName: 'dep/b.js',\n                    name: 'b.js',\n                    resourceBytes: 101,\n                    encodedBytes: undefined,\n                  },\n                ],\n                name: 'node_modules/dep',\n                resourceBytes: 202,\n                encodedBytes: undefined,\n              },\n            ],\n            name: 'lib',\n            resourceBytes: 302,\n            encodedBytes: undefined,\n          },\n          {\n            children: [\n              {\n                duplicatedNormalizedModuleName: 'dep/a.js',\n                name: 'a.js',\n                resourceBytes: 100,\n                encodedBytes: undefined,\n              },\n              {\n                duplicatedNormalizedModuleName: 'dep/b.js',\n                name: 'b.js',\n                resourceBytes: 100,\n                encodedBytes: undefined,\n              },\n            ],\n            name: 'node_modules/dep',\n            resourceBytes: 200,\n            encodedBytes: undefined,\n          },\n        ],\n      });\n    });\n  });\n\n  describeWithEnvironment('createTreemapData', () => {\n    it('works (source maps)', async function() {\n      const parsedTrace = await TraceLoader.traceEngine(this, 'dupe-js.json.gz');\n      const data = Utils.Treemap.createTreemapData(parsedTrace.data.Scripts, new Map())\n                       .map(d => [d.name, d.resourceBytes, d.encodedBytes, !!d.children?.length]);\n      assert.deepEqual(data, [\n        ['extensions::SafeBuiltins', 3204, 3204, false], ['v8/LoadTimes', 198, 198, false],\n        ['https://dupe-modules-lh-2.surge.sh/bundle.js?v1', 921607, 251055, true],\n        ['https://dupe-modules-lh-2.surge.sh/bundle.js?v2', 921607, 251053, true],\n        ['https://dupe-modules-lh-2.surge.sh/bundle.js?v3', 921607, 251055, true],\n        ['https://dupe-modules-lh-2.surge.sh/bundle.js?v4', 921607, 251055, true],\n        ['chrome-extension://cgaocdmhkmfnkdkbnckgmpopcbpaaejo/library/libraries.js', 67717, 67717, false],\n        ['chrome-extension://cgaocdmhkmfnkdkbnckgmpopcbpaaejo/content_scripts/detect.js', 1426, 1426, false],\n        ['chrome-extension://cgaocdmhkmfnkdkbnckgmpopcbpaaejo/content_scripts/run.js', 259, 259, false],\n        ['chrome-extension://pmhkaepabdniocnppdkfgifgonahhpdi/polyfills/webcomponents-ce.js', 19548, 19548, false],\n        ['chrome-extension://pmhkaepabdniocnppdkfgifgonahhpdi/incognito_content_script.js', 991691, 991691, false]\n      ]);\n    });\n\n    it('works (no source maps; inline scripts)', async function() {\n      const parsedTrace = await TraceLoader.traceEngine(this, 'yahoo-news.json.gz');\n      const data = Utils.Treemap.createTreemapData(parsedTrace.data.Scripts, new Map())\n                       .filter(d => d.children?.[0].name.includes('inline'))\n                       .map(d => [d.name.substring(0, 70), d.resourceBytes, d.encodedBytes, !!d.children?.length]);\n      assert.deepEqual(data, [\n        ['https://news.yahoo.com/', 264860, 52435, true],\n        ['https://cdn.taboola.com/libtrc/static/topics/taboola-browsing-topics.h', 492, 483, true],\n        ['https://cdn.taboola.com/scripts/prebid_iframe_sync.html?gdpr=0&gdpr_co', 392049, 392049, true],\n        ['https://securepubads.g.doubleclick.net/static/topics/topics_frame.html', 102850, 28761, true],\n        ['https://opus.analytics.yahoo.com/tag/opus-frame.html?referrer=https%3A', 5537, 2862, true],\n        ['https://onetag-sys.com/usync/?gdpr=0&gdpr_consent=&pubId=69f48c2160c81', 2356, 942, true],\n        ['https://sync.go.sonobi.com/uc.html?gdpr=0&gdpr_consent=&us_privacy=1YN', 3511, 4100, true],\n        ['https://c841865208bc99b5e2ae14cac96331fd.safeframe.googlesyndication.c', 31008, 31008, true],\n        ['https://c841865208bc99b5e2ae14cac96331fd.safeframe.googlesyndication.c', 20047, 20047, true],\n        ['https://c841865208bc99b5e2ae14cac96331fd.safeframe.googlesyndication.c', 20056, 20056, true],\n        ['https://c841865208bc99b5e2ae14cac96331fd.safeframe.googlesyndication.c', 41584, 41584, true],\n        ['https://us-u.openx.net/w/1.0/pd?cc=1&plm=6&ph=208e6dab-f554-4b1c-b023-', 113, 123, true],\n        ['https://tpc.googlesyndication.com/sodar/62bHydCX.html', 38984, 38984, true],\n        ['https://u.openx.net/w/1.0/cm?cc=1&id=4241c706-9fd2-4ae4-b2d7-c9f8d34e7', 113, 123, true],\n        ['https://c841865208bc99b5e2ae14cac96331fd.safeframe.googlesyndication.c', 696, 696, true],\n        ['https://s0.2mdn.net/sadbundle/16824365171377590673/index.html?ev=01_25', 8181, 2709, true],\n        ['https://onetag-sys.com/usync/?pubId=765b4e6bb9c8438', 2356, 942, true]\n      ]);\n    });\n  });\n});\n"]}