{"version":3,"file":"IgnoreList.test.js","sourceRoot":"","sources":["../../../../../../../front_end/panels/timeline/utils/IgnoreList.test.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright 2024 The Chromium Authors. All rights reserved.\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport * as Common from '../../../core/common/common.js';\nimport type * as Platform from '../../../core/platform/platform.js';\nimport * as Bindings from '../../../models/bindings/bindings.js';\nimport * as Trace from '../../../models/trace/trace.js';\nimport {\n  describeWithMockConnection,\n} from '../../../testing/MockConnection.js';\nimport {\n  makeMockSamplesHandlerData,\n  makeProfileCall,\n} from '../../../testing/TraceHelpers.js';\n\nimport { // eslint-disable-line rulesdir/es_modules_import\n  loadCodeLocationResolvingScenario,\n} from './SourceMapsResolver.test.js';\nimport * as Utils from './utils.js';\n\ndescribeWithMockConnection('isIgnoreListedEntry', () => {\n  it('uses url mappings to determine if an url is ignore listed', async () => {\n    const {authoredScriptURL, genScriptURL, scriptId} = await loadCodeLocationResolvingScenario();\n\n    const LINE_NUMBER = 0;\n    const COLUMN_NUMBER = 9;\n\n    const profileCallWithMappings =\n        makeProfileCall('function', 10, 100, Trace.Types.Events.ProcessID(1), Trace.Types.Events.ThreadID(1));\n    profileCallWithMappings.callFrame = {\n      lineNumber: LINE_NUMBER,\n      columnNumber: COLUMN_NUMBER,\n      functionName: 'minified',\n      scriptId,\n      url: genScriptURL,\n    };\n\n    const workersData: Trace.Handlers.ModelHandlers.Workers.WorkersData = {\n      workerSessionIdEvents: [],\n      workerIdByThread: new Map(),\n      workerURLById: new Map(),\n    };\n\n    Bindings.IgnoreListManager.IgnoreListManager.instance().ignoreListURL(\n        authoredScriptURL as Platform.DevToolsPath.UrlString);\n    const traceWithMappings = {\n      Samples: makeMockSamplesHandlerData([profileCallWithMappings]),\n      Workers: workersData,\n    } as Trace.Handlers.Types.ParsedTrace;\n    const resolver = new Utils.SourceMapsResolver.SourceMapsResolver(traceWithMappings);\n    await resolver.install();\n    assert.isTrue(Utils.IgnoreList.isIgnoreListedEntry(profileCallWithMappings));\n  });\n\n  it('ignores entries with a url in the source map\\'s ignoreList field when the user enables known third party ignoring',\n     async () => {\n       const {ignoreListedURL, scriptId} = await loadCodeLocationResolvingScenario();\n\n       // This matches the location mapping added to the sourcemap.\n       const LINE_NUMBER = 3;\n       const COLUMN_NUMBER = 0;\n\n       const profileCallWithMappings =\n           makeProfileCall('function', 10, 100, Trace.Types.Events.ProcessID(1), Trace.Types.Events.ThreadID(1));\n       profileCallWithMappings.callFrame = {\n         lineNumber: LINE_NUMBER,\n         columnNumber: COLUMN_NUMBER,\n         functionName: 'ignore',\n         scriptId,\n         url: ignoreListedURL,\n       };\n\n       const workersData: Trace.Handlers.ModelHandlers.Workers.WorkersData = {\n         workerSessionIdEvents: [],\n         workerIdByThread: new Map(),\n         workerURLById: new Map(),\n       };\n       const traceWithMappings = {\n         Samples: makeMockSamplesHandlerData([profileCallWithMappings]),\n         Workers: workersData,\n       } as Trace.Handlers.Types.ParsedTrace;\n       const resolver = new Utils.SourceMapsResolver.SourceMapsResolver(traceWithMappings);\n       await resolver.install();\n       assert.isTrue(Utils.IgnoreList.isIgnoreListedEntry(profileCallWithMappings));\n       const ignoreKnownThirdPartySetting =\n           Common.Settings.Settings.instance().moduleSetting('automatically-ignore-list-known-third-party-scripts');\n       const ignoreKnownThirdPartySettingValue = ignoreKnownThirdPartySetting.get();\n\n       ignoreKnownThirdPartySetting.set(true);\n       assert.isTrue(Utils.IgnoreList.isIgnoreListedEntry(profileCallWithMappings));\n\n       ignoreKnownThirdPartySetting.set(false);\n       assert.isFalse(Utils.IgnoreList.isIgnoreListedEntry(profileCallWithMappings));\n\n       // restore to the original value.\n       ignoreKnownThirdPartySetting.set(ignoreKnownThirdPartySettingValue);\n     });\n  it('ignores entries belonging to content script when the user enables content script ignoring', async () => {\n    const {contentScriptURL, contentScriptId: scriptId} = await loadCodeLocationResolvingScenario();\n\n    const LINE_NUMBER = 0;\n    const COLUMN_NUMBER = 0;\n\n    const profileCallWithContentScript =\n        makeProfileCall('function', 10, 100, Trace.Types.Events.ProcessID(1), Trace.Types.Events.ThreadID(1));\n    profileCallWithContentScript.callFrame = {\n      lineNumber: LINE_NUMBER,\n      columnNumber: COLUMN_NUMBER,\n      functionName: '',\n      scriptId,\n      url: contentScriptURL,\n    };\n\n    const workersData: Trace.Handlers.ModelHandlers.Workers.WorkersData = {\n      workerSessionIdEvents: [],\n      workerIdByThread: new Map(),\n      workerURLById: new Map(),\n    };\n    const traceWithMappings = {\n      Samples: makeMockSamplesHandlerData([profileCallWithContentScript]),\n      Workers: workersData,\n    } as Trace.Handlers.Types.ParsedTrace;\n    const resolver = new Utils.SourceMapsResolver.SourceMapsResolver(traceWithMappings);\n    await resolver.install();\n    assert.isTrue(Utils.IgnoreList.isIgnoreListedEntry(profileCallWithContentScript));\n\n    const ignoreContentScriptSetting = Common.Settings.Settings.instance().moduleSetting('skip-content-scripts');\n    const ignoreContentScriptSettingValue = ignoreContentScriptSetting.get();\n\n    ignoreContentScriptSetting.set(true);\n    assert.isTrue(Utils.IgnoreList.isIgnoreListedEntry(profileCallWithContentScript));\n\n    ignoreContentScriptSetting.set(false);\n    assert.isFalse(Utils.IgnoreList.isIgnoreListedEntry(profileCallWithContentScript));\n\n    // restore to the original value.\n    ignoreContentScriptSetting.set(ignoreContentScriptSettingValue);\n  });\n});\n"]}