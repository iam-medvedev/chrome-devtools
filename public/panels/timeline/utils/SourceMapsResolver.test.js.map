{"version":3,"file":"SourceMapsResolver.test.js","sourceRoot":"","sources":["../../../../../../../front_end/panels/timeline/utils/SourceMapsResolver.test.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright 2023 The Chromium Authors. All rights reserved.\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport type {Chrome} from '../../../../extension-api/ExtensionAPI.js';\nimport type * as Platform from '../../../core/platform/platform.js';\nimport * as SDK from '../../../core/sdk/sdk.js';\nimport type * as Protocol from '../../../generated/protocol.js';\nimport * as Bindings from '../../../models/bindings/bindings.js';\nimport * as Trace from '../../../models/trace/trace.js';\nimport * as Workspace from '../../../models/workspace/workspace.js';\nimport {createTarget} from '../../../testing/EnvironmentHelpers.js';\nimport {TestPlugin} from '../../../testing/LanguagePluginHelpers.js';\nimport {\n  describeWithMockConnection,\n} from '../../../testing/MockConnection.js';\nimport {MockProtocolBackend} from '../../../testing/MockScopeChain.js';\nimport {encodeSourceMap} from '../../../testing/SourceMapEncoder.js';\nimport {loadBasicSourceMapExample} from '../../../testing/SourceMapHelpers.js';\nimport {\n  makeMockSamplesHandlerData,\n  makeProfileCall,\n} from '../../../testing/TraceHelpers.js';\nimport {TraceLoader} from '../../../testing/TraceLoader.js';\n\nimport * as Utils from './utils.js';\n\nconst MINIFIED_FUNCTION_NAME = 'minified';\nconst AUTHORED_FUNCTION_NAME = 'someFunction';\n\nexport async function loadCodeLocationResolvingScenario():\n    Promise<{authoredScriptURL: string, genScriptURL: string, scriptId: Protocol.Runtime.ScriptId}> {\n  const target = createTarget();\n\n  const targetManager = SDK.TargetManager.TargetManager.instance();\n  const workspace = Workspace.Workspace.WorkspaceImpl.instance({forceNew: true});\n  const resourceMapping = new Bindings.ResourceMapping.ResourceMapping(targetManager, workspace);\n  const debuggerWorkspaceBinding = Bindings.DebuggerWorkspaceBinding.DebuggerWorkspaceBinding.instance(\n      {forceNew: true, resourceMapping, targetManager});\n  Bindings.IgnoreListManager.IgnoreListManager.instance({\n    forceNew: true,\n    debuggerWorkspaceBinding,\n  });\n\n  const backend = new MockProtocolBackend();\n  const sourceRoot = 'http://example.com';\n  const scriptInfo = {\n    url: `${sourceRoot}/test.out.js`,\n    content: 'function f(x) {\\n  console.log(x);\\n}\\n',\n  };\n  const authoredScripName = 'test.ts';\n  const authoredScriptURL = `${sourceRoot}/${authoredScripName}`;\n\n  const sourceMapInfo = {\n    url: `${scriptInfo.url}.map`,\n    content: encodeSourceMap(\n        [\n          `0:9 => ${authoredScripName}:0:1`,\n          `1:0 => ${authoredScripName}:4:0`,\n          `1:2 => ${authoredScripName}:4:2`,\n          `2:0 => ${authoredScripName}:2:0`,\n        ],\n        sourceRoot),\n  };\n  const [, script] = await Promise.all([\n    debuggerWorkspaceBinding.waitForUISourceCodeAdded(\n        `${sourceRoot}/test.ts` as Platform.DevToolsPath.UrlString, target),\n    backend.addScript(target, scriptInfo, sourceMapInfo),\n  ]);\n\n  return {authoredScriptURL, scriptId: script.scriptId, genScriptURL: scriptInfo.url};\n}\n\nfunction parsedTraceFromProfileCalls(profileCalls: Trace.Types.Events.SyntheticProfileCall[]):\n    Trace.Handlers.Types.ParsedTrace {\n  const workersData: Trace.Handlers.ModelHandlers.Workers.WorkersData = {\n    workerSessionIdEvents: [],\n    workerIdByThread: new Map(),\n    workerURLById: new Map(),\n  };\n  // This only includes data used in the SourceMapsResolver\n  return {\n    Samples: makeMockSamplesHandlerData(profileCalls),\n    Workers: workersData,\n  } as Trace.Handlers.Types.ParsedTrace;\n}\n\ndescribeWithMockConnection('SourceMapsResolver', () => {\n  describe('function name resolving', () => {\n    let target: SDK.Target.Target;\n    let script: SDK.Script.Script;\n    let parsedTrace: Trace.Handlers.Types.ParsedTrace;\n    let profileCallForNameResolving: Trace.Types.Events.SyntheticProfileCall;\n    beforeEach(async function() {\n      target = createTarget();\n      script = (await loadBasicSourceMapExample(target)).script;\n\n      profileCallForNameResolving =\n          makeProfileCall('function', 10, 100, Trace.Types.Events.ProcessID(1), Trace.Types.Events.ThreadID(1));\n\n      profileCallForNameResolving.callFrame = {\n        columnNumber: 51,\n        functionName: 'minified',\n        lineNumber: 0,\n        scriptId: script.scriptId,\n        url: 'file://gen.js',\n      };\n      parsedTrace = parsedTraceFromProfileCalls([profileCallForNameResolving]);\n    });\n\n    it('renames nodes from the profile models when the corresponding scripts and source maps have loaded',\n       async function() {\n         const resolver = new Utils.SourceMapsResolver.SourceMapsResolver(parsedTrace);\n\n         // Test the node's name is minified before the script and source maps load.\n         assert.strictEqual(\n             Trace.Handlers.ModelHandlers.Samples.getProfileCallFunctionName(\n                 parsedTrace.Samples, profileCallForNameResolving),\n             MINIFIED_FUNCTION_NAME);\n\n         await resolver.install();\n\n         // Now that the script and source map have loaded, test that the model has been automatically\n         // reparsed to resolve function names.\n         assert.strictEqual(\n             Trace.Handlers.ModelHandlers.Samples.getProfileCallFunctionName(\n                 parsedTrace.Samples, profileCallForNameResolving),\n             AUTHORED_FUNCTION_NAME);\n\n         // Ensure we populate the cache\n         assert.strictEqual(\n             Utils.SourceMapsResolver.SourceMapsResolver.resolvedCodeLocationForEntry(profileCallForNameResolving)\n                 ?.name,\n             AUTHORED_FUNCTION_NAME);\n       });\n\n    it('resolves function names using a plugin when available', async () => {\n      const PLUGIN_FUNCTION_NAME = 'PLUGIN_FUNCTION_NAME';\n      class Plugin extends TestPlugin {\n        constructor() {\n          super('InstrumentationBreakpoints');\n        }\n\n        override getFunctionInfo(_rawLocation: Chrome.DevTools.RawLocation):\n            Promise<{frames: Chrome.DevTools.FunctionInfo[], missingSymbolFiles?: string[]|undefined}> {\n          return Promise.resolve({frames: [{name: PLUGIN_FUNCTION_NAME}]});\n        }\n        override handleScript(_: SDK.Script.Script) {\n          return true;\n        }\n      }\n\n      const {pluginManager} = Bindings.DebuggerWorkspaceBinding.DebuggerWorkspaceBinding.instance();\n      pluginManager.addPlugin(new Plugin());\n      const resolver = new Utils.SourceMapsResolver.SourceMapsResolver(parsedTrace);\n      await resolver.install();\n      assert.strictEqual(\n          Trace.Handlers.ModelHandlers.Samples.getProfileCallFunctionName(\n              parsedTrace.Samples, profileCallForNameResolving),\n          PLUGIN_FUNCTION_NAME);\n    });\n  });\n  describe('code location resolving', () => {\n    it('correctly stores url mappings using source maps', async () => {\n      const {authoredScriptURL, genScriptURL, scriptId} = await loadCodeLocationResolvingScenario();\n      const profileCallWithMappings =\n          makeProfileCall('function', 10, 100, Trace.Types.Events.ProcessID(1), Trace.Types.Events.ThreadID(1));\n      const LINE_NUMBER = 0;\n      const COLUMN_NUMBER = 9;\n      profileCallWithMappings.callFrame = {\n        lineNumber: LINE_NUMBER,\n        columnNumber: COLUMN_NUMBER,\n        functionName: 'minified',\n        scriptId,\n        url: genScriptURL,\n      };\n\n      const profileCallWithNoMappings =\n          makeProfileCall('function', 10, 100, Trace.Types.Events.ProcessID(1), Trace.Types.Events.ThreadID(1));\n      profileCallWithNoMappings.callFrame = {\n        // Purposefully pick a location for which there is no mapping\n        // in the source map we just added.\n        lineNumber: 0,\n        columnNumber: 1,\n        functionName: 'minified',\n        scriptId,\n        url: authoredScriptURL,\n      };\n\n      // For a profile call with mappings, it must return the mapped script.\n      const traceWithMappings = parsedTraceFromProfileCalls([profileCallWithMappings]);\n      let resolver = new Utils.SourceMapsResolver.SourceMapsResolver(traceWithMappings);\n      await resolver.install();\n      let sourceMappedURL =\n          Utils.SourceMapsResolver.SourceMapsResolver.resolvedURLForEntry(traceWithMappings, profileCallWithMappings);\n      assert.strictEqual(sourceMappedURL, authoredScriptURL);\n\n      // For a profile call without mappings, it must return the original URL\n      const traceWithoutMappings = parsedTraceFromProfileCalls([profileCallWithNoMappings]);\n      resolver = new Utils.SourceMapsResolver.SourceMapsResolver(traceWithoutMappings);\n      await resolver.install();\n      sourceMappedURL = Utils.SourceMapsResolver.SourceMapsResolver.resolvedURLForEntry(\n          traceWithoutMappings, profileCallWithNoMappings);\n      assert.strictEqual(sourceMappedURL, genScriptURL);\n    });\n  });\n  describe('unnecessary work detection', () => {\n    it('does not dispatch a SourceMappingsUpdated event if relevant mappings were not updated', async function() {\n      const {parsedTrace} = await TraceLoader.traceEngine(this, 'user-timings.json.gz');\n      const listener = sinon.spy();\n\n      const sourceMapsResolver = new Utils.SourceMapsResolver.SourceMapsResolver(parsedTrace);\n      sourceMapsResolver.addEventListener(Utils.SourceMapsResolver.SourceMappingsUpdated.eventName, listener);\n      await sourceMapsResolver.install();\n      assert.isTrue(listener.notCalled);\n    });\n  });\n});\n"]}