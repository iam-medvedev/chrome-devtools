{"version":3,"file":"ReleaseNoteView.js","sourceRoot":"","sources":["../../../../../../front_end/panels/whats_new/ReleaseNoteView.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright 2024 The Chromium Authors. All rights reserved.\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport * as Host from '../../core/host/host.js';\nimport * as i18n from '../../core/i18n/i18n.js';\nimport type * as Platform from '../../core/platform/platform.js';\nimport * as Marked from '../../third_party/marked/marked.js';\nimport * as Buttons from '../../ui/components/buttons/buttons.js';\nimport type * as MarkdownView from '../../ui/components/markdown_view/markdown_view.js';\nimport * as UI from '../../ui/legacy/legacy.js';\nimport * as LitHtml from '../../ui/lit-html/lit-html.js';\nimport * as VisualLogging from '../../ui/visual_logging/visual_logging.js';\n\nimport {getReleaseNote, type ReleaseNote, VideoType} from './ReleaseNoteText.js';\n\nconst {render, html} = LitHtml;\nimport releaseNoteViewStyles from './releaseNoteView.css.js';\n\nconst UIStrings = {\n  /**\n   *@description Text that is usually a hyperlink to more documentation\n   */\n  seeFeatures: 'See all new features',\n};\nconst str_ = i18n.i18n.registerUIStrings('panels/whats_new/ReleaseNoteView.ts', UIStrings);\n\nconst i18nString = i18n.i18n.getLocalizedString.bind(undefined, str_);\n\nexport const WHATS_NEW_THUMBNAIL = '../../Images/whatsnew.svg' as Platform.DevToolsPath.RawPathString;\nexport const DEVTOOLS_TIPS_THUMBNAIL = '../../Images/devtools-tips.svg' as Platform.DevToolsPath.RawPathString;\nexport const GENERAL_THUMBNAIL = '../../Images/devtools-thumbnail.svg' as Platform.DevToolsPath.RawPathString;\n\nexport interface ViewInput {\n  markdownContent: Marked.Marked.Token[][];\n  getReleaseNote: () => ReleaseNote;\n  openNewTab: (link: string) => void;\n  getThumbnailPath: (type: VideoType) => Platform.DevToolsPath.UrlString;\n}\nexport type View = (input: ViewInput, output: ViewOutput, target: HTMLElement) => void;\nexport type ViewOutput = unknown;\n\nexport async function getMarkdownContent(): Promise<Marked.Marked.Token[][]> {\n  const markdown = await ReleaseNoteView.getFileContent();\n  const markdownAst = Marked.Marked.lexer(markdown);\n  const splitMarkdownAst: Marked.Marked.Token[][] = [];\n\n  // Split markdown content into groups of content to be rendered together.\n  // Each topic is supposed to be rendered in a separate card.\n  let groupStartDepth = Number.MAX_SAFE_INTEGER;\n  markdownAst.forEach((token: Marked.Marked.Token) => {\n    if (token.type === 'heading' && groupStartDepth >= token.depth) {\n      splitMarkdownAst.push([token]);\n      groupStartDepth = token.depth;\n    } else if (splitMarkdownAst.length > 0) {\n      splitMarkdownAst[splitMarkdownAst.length - 1].push(token);\n    } else {\n      // Missing a heading. Add to a separate section.\n      splitMarkdownAst.push([token]);\n    }\n  });\n  return splitMarkdownAst;\n}\n\nexport class ReleaseNoteView extends UI.Widget.VBox {\n  #view: View;\n\n  constructor(element?: HTMLElement, view: View = (input, _output, target) => {\n    const releaseNote = input.getReleaseNote();\n    const markdownContent = input.markdownContent;\n    // clang-format off\n    render(html`\n      <div class=\"whatsnew\" jslog=${VisualLogging.section().context('release-notes')}>\n        <div class=\"header\">\n          ${releaseNote.header}\n        </div>\n        <div>\n          <devtools-button\n                .variant=${Buttons.Button.Variant.PRIMARY}\n                .jslogContext=${'learn-more'}\n                @click=${() => input.openNewTab(releaseNote.link)}\n            >${i18nString(UIStrings.seeFeatures)}</devtools-button>\n        </div>\n\n        <div class=\"feature-container\">\n          <div class=\"video-container\">\n            ${releaseNote.videoLinks.map((value: {description: string, link: Platform.DevToolsPath.UrlString, type?: VideoType}) => {\n              return html`\n                <x-link\n                href=${value.link}\n                jslog=${VisualLogging.link().track({click: true}).context('learn-more')}>\n                  <div class=\"video\">\n                    <img class=\"thumbnail\" src=${input.getThumbnailPath(value.type ?? VideoType.WHATS_NEW)}>\n                    <div class=\"thumbnail-description\"><span>${value.description}</span></div>\n                  </div>\n              </x-link>\n              `;\n            })}\n          </div>\n          ${markdownContent.map((markdown: Marked.Marked.Token[]) => {\n            return html`<div class=\"feature\"><devtools-markdown-view slot=\"content\" .data=${{tokens: markdown} as MarkdownView.MarkdownView.MarkdownViewData}></devtools-markdown-view></div>`;\n          })}\n        </div>\n      </div>\n    `, target, {host: this});\n    // clang-format on\n  }) {\n    super(true, undefined, element);\n    this.#view = view;\n    this.update();\n  }\n\n  static async getFileContent(): Promise<string> {\n    const url = new URL('./resources/WNDT.md', import.meta.url);\n    try {\n      const response = await fetch(url.toString());\n      return response.text();\n    } catch (error) {\n      throw new Error(`Markdown file ${\n          url.toString()} not found. Make sure it is correctly listed in the relevant BUILD.gn files.`);\n    }\n  }\n\n  override async doUpdate(): Promise<void> {\n    const markdownContent = await getMarkdownContent();\n    this.#view(\n        {\n          getReleaseNote,\n          openNewTab: this.#openNewTab,\n          markdownContent,\n          getThumbnailPath: this.#getThumbnailPath,\n        },\n        this, this.contentElement);\n  }\n\n  #getThumbnailPath(type: VideoType): Platform.DevToolsPath.UrlString {\n    let img;\n    switch (type) {\n      case VideoType.WHATS_NEW:\n        img = WHATS_NEW_THUMBNAIL;\n        break;\n      case VideoType.DEVTOOLS_TIPS:\n        img = DEVTOOLS_TIPS_THUMBNAIL;\n        break;\n      case VideoType.OTHER:\n        img = GENERAL_THUMBNAIL;\n        break;\n    }\n    return new URL(img, import.meta.url).toString() as Platform.DevToolsPath.UrlString;\n  }\n\n  #openNewTab(link: string): void {\n    Host.InspectorFrontendHost.InspectorFrontendHostInstance.openInNewTab(link as Platform.DevToolsPath.UrlString);\n  }\n\n  override wasShown(): void {\n    super.wasShown();\n    this.registerCSSFiles([releaseNoteViewStyles]);\n  }\n}\n"]}