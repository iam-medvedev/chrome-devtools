{"version":3,"file":"ReleaseNoteView.js","sourceRoot":"","sources":["../../../../../../front_end/panels/whats_new/ReleaseNoteView.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright 2024 The Chromium Authors. All rights reserved.\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport '../../ui/components/markdown_view/markdown_view.js';\n\nimport * as Host from '../../core/host/host.js';\nimport * as i18n from '../../core/i18n/i18n.js';\nimport type * as Platform from '../../core/platform/platform.js';\nimport * as Marked from '../../third_party/marked/marked.js';\nimport * as Buttons from '../../ui/components/buttons/buttons.js';\nimport type * as MarkdownView from '../../ui/components/markdown_view/markdown_view.js';\nimport * as Coordinator from '../../ui/components/render_coordinator/render_coordinator.js';\nimport * as UI from '../../ui/legacy/legacy.js';\nimport * as LitHtml from '../../ui/lit-html/lit-html.js';\nimport * as VisualLogging from '../../ui/visual_logging/visual_logging.js';\n\nimport {getReleaseNote} from './ReleaseNoteText.js';\nimport releaseNoteViewStyles from './releaseNoteView.css.js';\nimport {releaseNoteViewId} from './WhatsNewImpl.js';\n\nconst {html} = LitHtml;\n\nconst coordinator = Coordinator.RenderCoordinator.RenderCoordinator.instance();\n\nconst UIStrings = {\n  /**\n   *@description Text that is usually a hyperlink to more documentation\n   */\n  learnMore: 'Learn more',\n  /**\n   *@description Text to close something\n   */\n  close: 'Close',\n};\nconst str_ = i18n.i18n.registerUIStrings('panels/whats_new/ReleaseNoteView.ts', UIStrings);\n\nconst i18nString = i18n.i18n.getLocalizedString.bind(undefined, str_);\n\nlet releaseNoteViewInstance: ReleaseNoteViewWrapper;\n\nexport class ReleaseNoteViewWrapper extends UI.Widget.VBox {\n  releaseNoteElement: ReleaseNoteView;\n  constructor() {\n    super(true);\n    this.element.setAttribute('jslog', `${VisualLogging.panel().context('whats-new')}`);\n    this.releaseNoteElement = new ReleaseNoteView();\n    this.contentElement.appendChild(this.releaseNoteElement);\n  }\n\n  static instance(opts: {forceNew: boolean|null} = {forceNew: null}): ReleaseNoteViewWrapper {\n    const {forceNew} = opts;\n    if (!releaseNoteViewInstance || forceNew) {\n      releaseNoteViewInstance = new ReleaseNoteViewWrapper();\n    }\n    return releaseNoteViewInstance;\n  }\n}\n\nexport class ReleaseNoteView extends HTMLElement {\n  readonly #shadow = this.attachShadow({mode: 'open'});\n\n  connectedCallback(): void {\n    this.#shadow.adoptedStyleSheets = [\n      releaseNoteViewStyles,\n    ];\n    this.#render();\n  }\n\n  static async getFileContent(): Promise<string> {\n    const url = new URL('./resources/WNDT.md', import.meta.url);\n    try {\n      const response = await fetch(url.toString());\n      return response.text();\n    } catch (error) {\n      throw new Error(`Markdown file ${\n          url.toString()} not found. Make sure it is correctly listed in the relevant BUILD.gn files.`);\n    }\n  }\n\n  async #renderHighlights(): Promise<LitHtml.TemplateResult> {\n    const markdown = await ReleaseNoteView.getFileContent();\n    const markdownAst = Marked.Marked.lexer(markdown);\n\n    // clang-format off\n    return html`<devtools-markdown-view .data=${{tokens: markdownAst} as MarkdownView.MarkdownView.MarkdownViewData}>\n      </devtools-markdown-view>\n    `;\n    // clang-format on\n  }\n\n  #render(): void {\n    const releaseNote = getReleaseNote();\n    void coordinator.write(() => {\n      // clang-format off\n      const tmpl = html`\n      <div class=\"release-note-top-section\">\n        ${getReleaseNote().header}\n      </div>\n      <div class=\"hbox\">\n        <div class=\"release-note-container\" jslog=${VisualLogging.section().context('release-notes')}>\n         <ul aria-label=${releaseNote.header}>\n            ${LitHtml.Directives.until(this.#renderHighlights())}\n          </ul>\n          <div>\n            <devtools-button\n              .data=${{\n                variant: Buttons.Button.Variant.OUTLINED,\n              } as Buttons.Button.ButtonData}\n              .jslogContext=${'learn-more'}\n              @click=${(event: MouseEvent): void => {\n                event.consume(true);\n                  Host.InspectorFrontendHost.InspectorFrontendHostInstance.openInNewTab(releaseNote.link as Platform.DevToolsPath.UrlString);\n                }}\n            >${i18nString(UIStrings.learnMore)}\n            </devtools-button>\n            <devtools-button\n              .data=${{\n                variant: Buttons.Button.Variant.OUTLINED,\n              } as Buttons.Button.ButtonData}\n              .jslogContext=${'close'}\n              @click=${(event: MouseEvent): void => {\n                event.consume(true);\n                UI.InspectorView.InspectorView.instance().closeDrawerTab(releaseNoteViewId, true);\n                }}\n            >\n            ${i18nString(UIStrings.close)}\n            </devtools-button>\n          </div>\n        </div>\n        <x-link\n          href=${releaseNote.link}\n          class=\"devtools-link release-note-image\"\n          jslog=${VisualLogging.link().track({click: true}).context('learn-more')}\n        >\n          <img src=${new URL('./resources/whatsnew.avif', import.meta.url).toString()}>\n        </x-link>\n      </div>\n      `;\n      // clang-format on\n      LitHtml.render(tmpl, this.#shadow, {host: this});\n      const releaseNoteImage = this.#shadow.querySelector('img');\n      if (releaseNoteImage) {\n        UI.Tooltip.Tooltip.install(releaseNoteImage, getReleaseNote().header);\n      }\n    });\n  }\n}\n\ncustomElements.define('devtools-release-note-view', ReleaseNoteView);\n\ndeclare global {\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\n  interface HTMLElementTagNameMap {\n    'devtools-release-note-view': ReleaseNoteView;\n  }\n}\n"]}