{"version":3,"file":"ReleaseNote.test.js","sourceRoot":"","sources":["../../../../../../front_end/panels/whats_new/ReleaseNote.test.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright 2024 The Chromium Authors. All rights reserved.\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport * as Common from '../../core/common/common.js';\nimport * as Platform from '../../core/platform/platform.js';\nimport * as Root from '../../core/root/root.js';\nimport {\n  deinitializeGlobalVars,\n  initializeGlobalVars,\n} from '../../testing/EnvironmentHelpers.js';\nimport * as UI from '../../ui/legacy/legacy.js';\n\nimport type * as WhatsNewModule from './whats_new.js';\n\nconst {urlString} = Platform.DevToolsPath;\n\ndescribe('Release Note', () => {\n  // eslint-disable-next-line @typescript-eslint/naming-convention\n  let WhatsNew: typeof WhatsNewModule;\n\n  before(async () => {\n    await initializeGlobalVars();\n\n    WhatsNew = await import('./whats_new.js');\n    WhatsNew.ReleaseNoteText.setReleaseNoteForTest(\n        {\n          version: 99,\n          header: 'Highlights from Chrome 100 update',\n          markdownLinks: [],\n          link: urlString`https://developers.google.com/web/tools/chrome-devtools/`,\n          videoLinks: [],\n        },\n    );\n\n    // We need to add the What's New view so that an error is not thrown when requesting\n    // to show the release notes when needed.\n    UI.ViewManager.registerViewExtension({\n      location: UI.ViewManager.ViewLocationValues.DRAWER_VIEW,\n      id: 'release-note',\n      title: () => 'What\\'s New' as Platform.UIString.LocalizedString,\n      commandPrompt: () => 'Show What\\'s New' as Platform.UIString.LocalizedString,\n      persistence: UI.ViewManager.ViewPersistence.CLOSEABLE,\n      order: 1,\n      async loadView() {\n        return new WhatsNew.ReleaseNoteView.ReleaseNoteView();\n      },\n    });\n\n    // This setting is used to determine if the What's New panel needs to be shown.\n    Common.Settings.registerSettingsForTest([{\n      category: Common.Settings.SettingCategory.APPEARANCE,\n      title: () => 'Show What\\'s New after each update' as Platform.UIString.LocalizedString,\n      settingName: 'help.show-release-note',\n      settingType: Common.Settings.SettingType.BOOLEAN,\n      defaultValue: true,\n    }]);\n    Root.Runtime.experiments.clearForTest();\n    await initializeGlobalVars({reset: false});\n  });\n\n  after(async () => await deinitializeGlobalVars());\n\n  it('sets and gets the last seen release note version correctly', () => {\n    const releaseNoteVersionSetting = WhatsNew.WhatsNew.getReleaseNoteVersionSetting();\n    assert.strictEqual(releaseNoteVersionSetting.get(), 0);\n    releaseNoteVersionSetting.set(1);\n    assert.strictEqual(releaseNoteVersionSetting.get(), 1);\n  });\n\n  it('updates the last seen version when the release notes are shown', () => {\n    assert.strictEqual(WhatsNew.WhatsNew.getReleaseNoteVersionSetting().get(), 1);\n    WhatsNew.WhatsNew.showReleaseNoteIfNeeded();\n    assert.strictEqual(WhatsNew.WhatsNew.getReleaseNoteVersionSetting().get(), 99);\n  });\n\n  it('shows the release notes only when needed', () => {\n    const lastSeenVersionSetting = WhatsNew.WhatsNew.getReleaseNoteVersionSetting();\n\n    lastSeenVersionSetting.set(98);\n    assert.isTrue(WhatsNew.WhatsNew.showReleaseNoteIfNeeded());\n\n    lastSeenVersionSetting.set(99);\n    assert.isFalse(WhatsNew.WhatsNew.showReleaseNoteIfNeeded());\n\n    lastSeenVersionSetting.set(0);\n    assert.isFalse(WhatsNew.WhatsNew.showReleaseNoteIfNeeded());\n\n    lastSeenVersionSetting.set(100);\n    assert.isFalse(WhatsNew.WhatsNew.showReleaseNoteIfNeeded());\n  });\n});\n"]}