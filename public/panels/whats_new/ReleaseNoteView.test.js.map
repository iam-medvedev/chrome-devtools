{"version":3,"file":"ReleaseNoteView.test.js","sourceRoot":"","sources":["../../../../../../front_end/panels/whats_new/ReleaseNoteView.test.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright 2024 The Chromium Authors. All rights reserved.\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport * as Host from '../../core/host/host.js';\nimport type * as Platform from '../../core/platform/platform.js';\nimport {\n  describeWithEnvironment,\n} from '../../testing/EnvironmentHelpers.js';\nimport type * as Buttons from '../../ui/components/buttons/buttons.js';\nimport type * as UI from '../../ui/legacy/legacy.js';\n\nimport * as WhatsNew from './whats_new.js';\n\nconst CONTENT1 = 'Something something topic-1.\\n';\nconst CONTENT2 = 'Something something topic-2.\\n';\n\ndescribeWithEnvironment('Release Note View', () => {\n  before(() => {\n    WhatsNew.ReleaseNoteText.setReleaseNoteForTest(\n        {\n          version: 99,\n          header: 'What\\'s new in DevTools 100',\n          markdownLinks: [\n            {\n              key: 'topic-1',\n              link: 'https://google.com.com/#topic-1',\n            },\n          ],\n          link: 'https://google.com',\n        },\n    );\n  });\n\n  it('splits up markdown file content into separate sections', async () => {\n    const h1 = '### [Topic 1](topic-1)\\n';\n    const h2 = '### [Topic 2](topic-2)\\n';\n\n    const content = [h1, CONTENT1, h2, CONTENT2];\n    const notes = content.join('');\n\n    sinon.stub(WhatsNew.ReleaseNoteView.ReleaseNoteView, 'getFileContent').returns(Promise.resolve(notes));\n    const splitContent = await WhatsNew.ReleaseNoteView.getMarkdownContent();\n    assert.lengthOf(splitContent, 2);\n\n    for (let i = 0; i < 2; ++i) {\n      assert.lengthOf(splitContent[i], 2);\n      assert.deepStrictEqual(splitContent[i][0].type, 'heading');\n      assert.deepStrictEqual(splitContent[i][1].type, 'paragraph');\n      assert.deepStrictEqual(splitContent[i][0].raw, content[i * 2]);\n      assert.deepStrictEqual(splitContent[i][1].raw, content[i * 2 + 1]);\n    }\n  });\n\n  it('groups nested markdown headers into one', async () => {\n    const h1 = '### [Topic 1](topic-1)\\n';\n    const h2 = '#### [Topic 2](topic-2)\\n';\n\n    const content = [h1, CONTENT1, h2, CONTENT2];\n    const notes = content.join('');\n\n    sinon.stub(WhatsNew.ReleaseNoteView.ReleaseNoteView, 'getFileContent').returns(Promise.resolve(notes));\n    const splitContent = await WhatsNew.ReleaseNoteView.getMarkdownContent();\n    assert.lengthOf(splitContent, 1);\n    assert.lengthOf(splitContent[0], 4);\n\n    assert.deepStrictEqual(splitContent[0][0].raw, h1);\n    assert.deepStrictEqual(splitContent[0][1].raw, CONTENT1);\n    assert.deepStrictEqual(splitContent[0][2].raw, h2);\n    assert.deepStrictEqual(splitContent[0][3].raw, CONTENT2);\n  });\n\n  it('splits headerless paragraphs into its own section', async () => {\n    const h1 = '### [Topic 1](topic-1)\\n';\n    const content = [CONTENT1, h1];\n    const notes = content.join('');\n\n    sinon.stub(WhatsNew.ReleaseNoteView.ReleaseNoteView, 'getFileContent').returns(Promise.resolve(notes));\n    const splitContent = await WhatsNew.ReleaseNoteView.getMarkdownContent();\n    assert.lengthOf(splitContent, 2);\n    assert.lengthOf(splitContent[0], 1);\n    assert.lengthOf(splitContent[1], 1);\n\n    assert.deepStrictEqual(splitContent[0][0].raw, CONTENT1);\n    assert.deepStrictEqual(splitContent[1][0].raw, h1);\n  });\n\n  it('renders markdown content', async () => {\n    sinon.stub(WhatsNew.ReleaseNoteView.ReleaseNoteView, 'getFileContent').returns(Promise.resolve(CONTENT1));\n    const releaseNoteView = new WhatsNew.ReleaseNoteView.ReleaseNoteView();\n    await releaseNoteView.pendingUpdate();\n\n    const markdown = releaseNoteView.contentElement.querySelector('devtools-markdown-view');\n    assert.isNotNull(markdown);\n  });\n\n  it('renders link to video', async () => {\n    sinon.stub(WhatsNew.ReleaseNoteView.ReleaseNoteView, 'getFileContent').returns(Promise.resolve(CONTENT1));\n    const releaseNoteView = new WhatsNew.ReleaseNoteView.ReleaseNoteView();\n    await releaseNoteView.pendingUpdate();\n    const link = releaseNoteView.contentElement.querySelector<UI.XLink.XLink>('x-link');\n    assert.isNotNull(link);\n    assert.deepStrictEqual(link.href, 'https://google.com/');\n  });\n\n  it('renders button that links to blogpost', async () => {\n    sinon.stub(WhatsNew.ReleaseNoteView.ReleaseNoteView, 'getFileContent').returns(Promise.resolve(CONTENT1));\n    const releaseNoteView = new WhatsNew.ReleaseNoteView.ReleaseNoteView();\n    await releaseNoteView.pendingUpdate();\n    const button = releaseNoteView.contentElement.querySelector<Buttons.Button.Button>('devtools-button');\n    assert.isNotNull(button);\n    const openInNewTabStub = sinon.stub(Host.InspectorFrontendHost.InspectorFrontendHostInstance, 'openInNewTab');\n\n    button.click();\n    assert.strictEqual(openInNewTabStub.callCount, 1);\n    assert.isTrue(\n        openInNewTabStub.firstCall.calledWith('https://google.com' as Platform.DevToolsPath.UrlString),\n        'openInNewTab was not called with the expected URL.');\n  });\n});\n"]}