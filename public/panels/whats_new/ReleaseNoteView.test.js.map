{"version":3,"file":"ReleaseNoteView.test.js","sourceRoot":"","sources":["../../../../../../front_end/panels/whats_new/ReleaseNoteView.test.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright 2024 The Chromium Authors. All rights reserved.\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport * as Host from '../../core/host/host.js';\nimport * as Platform from '../../core/platform/platform.js';\nimport {\n  describeWithEnvironment,\n} from '../../testing/EnvironmentHelpers.js';\nimport type * as Buttons from '../../ui/components/buttons/buttons.js';\nimport type * as UI from '../../ui/legacy/legacy.js';\n\nimport * as WhatsNew from './whats_new.js';\n\nconst {urlString} = Platform.DevToolsPath;\nconst CONTENT1 = 'Something something topic-1.\\n';\nconst CONTENT2 = 'Something something topic-2.\\n';\n\ndescribeWithEnvironment('Release Note View', () => {\n  before(() => {\n    WhatsNew.ReleaseNoteText.setReleaseNoteForTest(\n        {\n          version: 99,\n          header: 'What\\'s new in DevTools 100',\n          markdownLinks: [\n            {\n              key: 'topic-1',\n              link: 'https://google.com.com/#topic-1',\n            },\n          ],\n          videoLinks: [\n            {\n              description: 'Highlight from the Chrome 132 update',\n              link: urlString`https://developer.chrome.com/blog/new-in-devtools-132/`,\n              type: WhatsNew.ReleaseNoteText.VideoType.WHATS_NEW,\n            },\n            {\n              description: 'DevTools tips',\n              link: urlString`https://developer.chrome.com/blog/devtools-tips-39`,\n              type: WhatsNew.ReleaseNoteText.VideoType.DEVTOOLS_TIPS,\n            },\n            {\n              description: 'Other',\n              link: urlString`https://developer.chrome.com/`,\n              type: WhatsNew.ReleaseNoteText.VideoType.OTHER,\n            },\n          ],\n          link: 'https://google.com',\n        },\n    );\n  });\n\n  it('splits up markdown file content into separate sections', async () => {\n    const h1 = '### [Topic 1](topic-1)\\n';\n    const h2 = '### [Topic 2](topic-2)\\n';\n\n    const content = [h1, CONTENT1, h2, CONTENT2];\n    const notes = content.join('');\n\n    sinon.stub(WhatsNew.ReleaseNoteView.ReleaseNoteView, 'getFileContent').returns(Promise.resolve(notes));\n    const splitContent = await WhatsNew.ReleaseNoteView.getMarkdownContent();\n    assert.lengthOf(splitContent, 2);\n\n    for (let i = 0; i < 2; ++i) {\n      assert.lengthOf(splitContent[i], 2);\n      assert.deepEqual(splitContent[i][0].type, 'heading');\n      assert.deepEqual(splitContent[i][1].type, 'paragraph');\n      assert.deepEqual(splitContent[i][0].raw, content[i * 2]);\n      assert.deepEqual(splitContent[i][1].raw, content[i * 2 + 1]);\n    }\n  });\n\n  it('groups nested markdown headers into one', async () => {\n    const h1 = '### [Topic 1](topic-1)\\n';\n    const h2 = '#### [Topic 2](topic-2)\\n';\n\n    const content = [h1, CONTENT1, h2, CONTENT2];\n    const notes = content.join('');\n\n    sinon.stub(WhatsNew.ReleaseNoteView.ReleaseNoteView, 'getFileContent').returns(Promise.resolve(notes));\n    const splitContent = await WhatsNew.ReleaseNoteView.getMarkdownContent();\n    assert.lengthOf(splitContent, 1);\n    assert.lengthOf(splitContent[0], 4);\n\n    assert.deepEqual(splitContent[0][0].raw, h1);\n    assert.deepEqual(splitContent[0][1].raw, CONTENT1);\n    assert.deepEqual(splitContent[0][2].raw, h2);\n    assert.deepEqual(splitContent[0][3].raw, CONTENT2);\n  });\n\n  it('splits headerless paragraphs into its own section', async () => {\n    const h1 = '### [Topic 1](topic-1)\\n';\n    const content = [CONTENT1, h1];\n    const notes = content.join('');\n\n    sinon.stub(WhatsNew.ReleaseNoteView.ReleaseNoteView, 'getFileContent').returns(Promise.resolve(notes));\n    const splitContent = await WhatsNew.ReleaseNoteView.getMarkdownContent();\n    assert.lengthOf(splitContent, 2);\n    assert.lengthOf(splitContent[0], 1);\n    assert.lengthOf(splitContent[1], 1);\n\n    assert.deepEqual(splitContent[0][0].raw, CONTENT1);\n    assert.deepEqual(splitContent[1][0].raw, h1);\n  });\n\n  it('renders markdown content', async () => {\n    sinon.stub(WhatsNew.ReleaseNoteView.ReleaseNoteView, 'getFileContent').returns(Promise.resolve(CONTENT1));\n    const releaseNoteView = new WhatsNew.ReleaseNoteView.ReleaseNoteView();\n    await releaseNoteView.updateComplete;\n\n    const markdown = releaseNoteView.contentElement.querySelector('devtools-markdown-view');\n    assert.isNotNull(markdown);\n  });\n\n  it('renders button that links to blogpost', async () => {\n    sinon.stub(WhatsNew.ReleaseNoteView.ReleaseNoteView, 'getFileContent').returns(Promise.resolve(''));\n    const releaseNoteView = new WhatsNew.ReleaseNoteView.ReleaseNoteView();\n    await releaseNoteView.updateComplete;\n    const button = releaseNoteView.contentElement.querySelector<Buttons.Button.Button>('devtools-button');\n    assert.isNotNull(button);\n    const openInNewTabStub = sinon.stub(Host.InspectorFrontendHost.InspectorFrontendHostInstance, 'openInNewTab');\n\n    button.click();\n    assert.strictEqual(openInNewTabStub.callCount, 1);\n    assert.isTrue(\n        openInNewTabStub.firstCall.calledWith(urlString`https://google.com`),\n        'openInNewTab was not called with the expected URL.');\n  });\n\n  it('renders video links with description text', async () => {\n    sinon.stub(WhatsNew.ReleaseNoteView.ReleaseNoteView, 'getFileContent').returns(Promise.resolve(''));\n    const releaseNoteView = new WhatsNew.ReleaseNoteView.ReleaseNoteView();\n    await releaseNoteView.updateComplete;\n    const videos = releaseNoteView.contentElement.querySelectorAll<UI.XLink.XLink>('.video-container > x-link');\n    assert.lengthOf(videos, 3);\n\n    const releaseNotes = WhatsNew.ReleaseNoteText.getReleaseNote();\n    const descriptions = Array.from(videos).map(n => n.innerText.trim());\n    const expectedDescriptions = releaseNotes.videoLinks.map(video => video.description);\n    assert.deepEqual(descriptions, expectedDescriptions);\n  });\n\n  it('renders expected thumbnails', async () => {\n    sinon.stub(WhatsNew.ReleaseNoteView.ReleaseNoteView, 'getFileContent').returns(Promise.resolve(''));\n    const releaseNoteView = new WhatsNew.ReleaseNoteView.ReleaseNoteView();\n    await releaseNoteView.updateComplete;\n    const thumbnails = releaseNoteView.contentElement.querySelectorAll<HTMLImageElement>('.thumbnail');\n    assert.lengthOf(thumbnails, 3);\n\n    const thumbnailFilepaths = Array.from(thumbnails).map(n => n.src);\n    const expectedThumbnails = [\n      WhatsNew.ReleaseNoteView.WHATS_NEW_THUMBNAIL,\n      WhatsNew.ReleaseNoteView.DEVTOOLS_TIPS_THUMBNAIL,\n      WhatsNew.ReleaseNoteView.GENERAL_THUMBNAIL,\n    ];\n    const expectedFilepaths = expectedThumbnails.map(src => new URL(src, import.meta.url).toString());\n\n    assert.deepEqual(thumbnailFilepaths, expectedFilepaths);\n  });\n});\n"]}