{"version":3,"file":"CoverageView.test.js","sourceRoot":"","sources":["../../../../../../front_end/panels/coverage/CoverageView.test.ts"],"names":[],"mappings":"AAAA,sCAAsC;AACtC,yEAAyE;AACzE,6BAA6B;AAE7B,OAAO,KAAK,GAAG,MAAM,uBAAuB,CAAC;AAE7C,OAAO,KAAK,QAAQ,MAAM,mCAAmC,CAAC;AAC9D,OAAO,KAAK,SAAS,MAAM,qCAAqC,CAAC;AACjE,OAAO,EAAC,oBAAoB,EAAC,MAAM,6BAA6B,CAAC;AACjE,OAAO,EAAC,YAAY,EAAE,mBAAmB,EAAC,MAAM,qCAAqC,CAAC;AACtF,OAAO,EAAC,0BAA0B,EAAC,MAAM,iCAAiC,CAAC;AAC3E,OAAO,EAAC,QAAQ,EAAE,YAAY,EAAE,QAAQ,EAAC,MAAM,sCAAsC,CAAC;AACtF,OAAO,KAAK,iBAAiB,MAAM,8DAA8D,CAAC;AAClG,OAAO,KAAK,EAAE,MAAM,2BAA2B,CAAC;AAEhD,OAAO,KAAK,QAAQ,MAAM,eAAe,CAAC;AAE1C,MAAM,oBAAoB,GAAG,CAAC,IAAwC,EAAE,EAAE;IACxE,OAAO,OAAO,CAAC,IAAI,CAAC,cAAc,CAAC,aAAa,CAAC,cAAc,CAAC,CAAC,CAAC;AACpE,CAAC,CAAC;AAEF,MAAM,gBAAgB,GAAG,CAAC,IAAwC,EAAE,EAAE;IACpE,OAAO,OAAO,CAAC,IAAI,CAAC,cAAc,CAAC,aAAa,CAAC,4BAA4B,CAAC,CAAC,CAAC;AAClF,CAAC,CAAC;AAEF,MAAM,sBAAsB,GAAG,CAAC,IAAwC,EAAE,EAAE;IAC1E,OAAO,OAAO,CAAC,IAAI,CAAC,cAAc,CAAC,aAAa,CAAC,iBAAiB,CAAC,CAAC,CAAC;AACvE,CAAC,CAAC;AAEF,MAAM,oBAAoB,GAAG,CAAC,IAAwC,EAAE,EAAE;IACxE,OAAO,OAAO,CAAC,IAAI,CAAC,cAAc,CAAC,aAAa,CAAC,eAAe,CAAC,CAAC,CAAC;AACrE,CAAC,CAAC;AAEF,MAAM,oBAAoB,GAAG,GAAG,EAAE;IAChC,MAAM,MAAM,GAAG,YAAY,EAAE,CAAC;IAE9B,MAAM,SAAS,GAAG,SAAS,CAAC,SAAS,CAAC,aAAa,CAAC,QAAQ,CAAC,EAAC,QAAQ,EAAE,IAAI,EAAC,CAAC,CAAC;IAC/E,MAAM,aAAa,GAAG,GAAG,CAAC,aAAa,CAAC,aAAa,CAAC,QAAQ,EAAE,CAAC;IACjE,MAAM,eAAe,GAAG,IAAI,QAAQ,CAAC,eAAe,CAAC,eAAe,CAAC,aAAa,EAAE,SAAS,CAAC,CAAC;IAC/F,MAAM,iBAAiB,GAAG,SAAS,CAAC,iBAAiB,CAAC,iBAAiB,CAAC,QAAQ,CAAC,EAAC,QAAQ,EAAE,IAAI,EAAC,CAAC,CAAC;IACnG,QAAQ,CAAC,wBAAwB,CAAC,wBAAwB,CAAC,QAAQ,CAAC;QAClE,QAAQ,EAAE,IAAI;QACd,eAAe;QACf,aAAa;QACb,iBAAiB;KAClB,CAAC,CAAC;IACH,QAAQ,CAAC,mBAAmB,CAAC,mBAAmB,CAAC,QAAQ,CAAC,EAAC,QAAQ,EAAE,IAAI,EAAE,eAAe,EAAE,aAAa,EAAC,CAAC,CAAC;IAE5G,MAAM,aAAa,GAAG,MAAM,CAAC,KAAK,CAAC,QAAQ,CAAC,aAAa,CAAC,aAAa,CAAC,CAAC;IACzE,MAAM,CAAC,MAAM,CAAC,aAAa,CAAC,CAAC;IAC7B,MAAM,QAAQ,GAAG,KAAK,CAAC,GAAG,CAAC,aAAa,EAAE,OAAO,CAAC,CAAC;IACnD,MAAM,OAAO,GAAG,KAAK,CAAC,GAAG,CAAC,aAAa,EAAE,MAAM,CAAC,CAAC;IAEjD,MAAM,QAAQ,GAAG,MAAM,CAAC,KAAK,CAAC,GAAG,CAAC,QAAQ,CAAC,QAAQ,CAAC,CAAC;IACrD,MAAM,CAAC,MAAM,CAAC,QAAQ,CAAC,CAAC;IACxB,KAAK,CAAC,IAAI,CAAC,QAAQ,CAAC,KAAK,EAAE,+BAA+B,CAAC,CAAC,QAAQ,CAAC;QACnE,QAAQ,EAAE,GAAG,EAAE,CAAC,SAAS;KAC1B,CAAC,CAAC;IACH,KAAK,CAAC,IAAI,CAAC,QAAQ,CAAC,KAAK,EAAE,0BAA0B,CAAC,CAAC,QAAQ,CAAC;QAC9D,QAAQ,EAAE,EAAE;QACZ,QAAQ,EAAE,GAAG,EAAE,CAAC,SAAS;QACzB,SAAS,EAAE,CAAC;KACb,CAAC,CAAC;IACH,KAAK,CAAC,IAAI,CAAC,QAAQ,CAAC,KAAK,EAAE,8BAA8B,CAAC,CAAC,QAAQ,CAAC;QAClE,QAAQ,EAAE,GAAG,EAAE,CAAC,SAAS;QACzB,SAAS,EAAE,EAAE;KACd,CAAC,CAAC;IAEH,MAAM,aAAa,GAAG,MAAM,CAAC,aAAa,EAAE,CAAC;IAC7C,KAAK,CAAC,IAAI,CAAC,aAAa,EAAE,6BAA6B,CAAC,CAAC,QAAQ,CAAC;QAChE,SAAS,EAAE,CAAC;QACZ,QAAQ,EAAE,GAAG,EAAE,CAAC,SAAS;KAC1B,CAAC,CAAC;IACH,KAAK,CAAC,IAAI,CAAC,aAAa,EAAE,4BAA4B,CAAC,CAAC,QAAQ,CAAC;QAC/D,QAAQ,EAAE,GAAG,EAAE,CAAC,SAAS;KAC1B,CAAC,CAAC;IACH,KAAK,CAAC,IAAI,CAAC,aAAa,EAAE,4BAA4B,CAAC,CAAC,QAAQ,CAAC;QAC/D,MAAM,EAAE,EAAE;QACV,QAAQ,EAAE,GAAG,EAAE,CAAC,SAAS;QACzB,SAAS,EAAE,CAAC;KACb,CAAC,CAAC;IAEH,OAAO,EAAC,QAAQ,EAAE,OAAO,EAAE,MAAM,EAAC,CAAC;AACrC,CAAC,CAAC;AAEF,0BAA0B,CAAC,cAAc,EAAE,GAAG,EAAE;IAC9C,UAAU,CAAC,GAAG,EAAE;QACd,mBAAmB,CAAC;YAClB,gBAAgB;YAChB,iBAAiB;YACjB,4BAA4B;YAC5B,2BAA2B;YAC3B,uBAAuB;SACxB,CAAC,CAAC;IACL,CAAC,CAAC,CAAC;IAEH,EAAE,CAAC,8DAA8D,EAAE,KAAK,IAAI,EAAE;QAC5E,MAAM,IAAI,GAAG,QAAQ,CAAC,YAAY,CAAC,YAAY,CAAC,QAAQ,EAAE,CAAC;QAC3D,oBAAoB,CAAC,IAAI,CAAC,CAAC;QAC3B,MAAM,IAAI,CAAC,cAAc,CAAC;QAC1B,MAAM,CAAC,MAAM,CAAC,oBAAoB,CAAC,IAAI,CAAC,CAAC,CAAC;QAE1C,MAAM,MAAM,GAAG,IAAI,CAAC,cAAc,CAAC,aAAa,CAAC,8BAA8B,CAAC,CAAC;QACjF,MAAM,CAAC,MAAM,CAAC,MAAM,CAAC,CAAC;QAEtB,MAAM,SAAS,GACX,KAAK,CAAC,GAAG,CAAC,EAAE,CAAC,cAAc,CAAC,cAAc,CAAC,QAAQ,EAAE,CAAC,SAAS,CAAC,2BAA2B,CAAC,EAAE,SAAS,CAAC,CAAC;QAC7G,MAAM,SAAS,GACX,KAAK,CAAC,GAAG,CAAC,EAAE,CAAC,cAAc,CAAC,cAAc,CAAC,QAAQ,EAAE,CAAC,SAAS,CAAC,4BAA4B,CAAC,EAAE,SAAS,CAAC,CAAC;QAE7G,MAAsB,CAAC,OAAO,EAAE,CAAC,IAAI,YAAY,CAAC,OAAO,CAAC,CAAC,CAAC;QAC7D,MAAM,CAAC,MAAM,CAAC,SAAS,CAAC,UAAU,IAAI,SAAS,CAAC,UAAU,CAAC,CAAC;IAC9D,CAAC,CAAC,CAAC;IAEH,EAAE,CAAC,2CAA2C,EAAE,KAAK,IAAI,EAAE;QACzD,MAAM,EAAC,QAAQ,EAAE,OAAO,EAAE,MAAM,EAAC,GAAG,oBAAoB,EAAE,CAAC;QAC3D,MAAM,IAAI,GAAG,QAAQ,CAAC,YAAY,CAAC,YAAY,CAAC,QAAQ,EAAE,CAAC;QAC3D,oBAAoB,CAAC,IAAI,CAAC,CAAC;QAC3B,MAAM,CAAC,MAAM,CAAC,oBAAoB,CAAC,IAAI,CAAC,CAAC,CAAC;QAC1C,MAAM,CAAC,OAAO,CAAC,gBAAgB,CAAC,IAAI,CAAC,CAAC,CAAC;QACvC,MAAM,CAAC,OAAO,CAAC,sBAAsB,CAAC,IAAI,CAAC,CAAC,CAAC;QAC7C,MAAM,CAAC,OAAO,CAAC,oBAAoB,CAAC,IAAI,CAAC,CAAC,CAAC;QAC3C,KAAK,CAAC,MAAM,CAAC,SAAS,CAAC,QAAQ,CAAC,CAAC;QAEjC,MAAM,IAAI,CAAC,cAAc,CAAC,EAAC,MAAM,EAAE,KAAK,EAAE,kBAAkB,EAAE,KAAK,EAAC,CAAC,CAAC;QACtE,MAAM,iBAAiB,CAAC,IAAI,EAAE,CAAC;QAC/B,MAAM,CAAC,OAAO,CAAC,oBAAoB,CAAC,IAAI,CAAC,CAAC,CAAC;QAC3C,MAAM,CAAC,MAAM,CAAC,gBAAgB,CAAC,IAAI,CAAC,CAAC,CAAC;QACtC,MAAM,CAAC,OAAO,CAAC,sBAAsB,CAAC,IAAI,CAAC,CAAC,CAAC;QAC7C,MAAM,CAAC,OAAO,CAAC,oBAAoB,CAAC,IAAI,CAAC,CAAC,CAAC;QAC3C,KAAK,CAAC,MAAM,CAAC,UAAU,CAAC,QAAQ,CAAC,CAAC;QAElC,QAAQ,CAAC,YAAY,CAAC,MAAM,CAAC,EAAE,EAAE,uFAAuD,CAAC;QACzF,MAAM,IAAI,CAAC,cAAc,CAAC;QAE1B,MAAM,CAAC,OAAO,CAAC,oBAAoB,CAAC,IAAI,CAAC,CAAC,CAAC;QAC3C,MAAM,CAAC,OAAO,CAAC,gBAAgB,CAAC,IAAI,CAAC,CAAC,CAAC;QACvC,MAAM,CAAC,OAAO,CAAC,sBAAsB,CAAC,IAAI,CAAC,CAAC,CAAC;QAC7C,MAAM,CAAC,MAAM,CAAC,oBAAoB,CAAC,IAAI,CAAC,CAAC,CAAC;QAC1C,KAAK,CAAC,MAAM,CAAC,UAAU,CAAC,QAAQ,CAAC,CAAC;QAClC,KAAK,CAAC,MAAM,CAAC,SAAS,CAAC,OAAO,CAAC,CAAC;QAEhC,QAAQ,CAAC,YAAY,CAAC,MAAM,CAAC,CAAC,CAAC;QAC/B,MAAM,IAAI,CAAC,cAAc,CAAC;QAC1B,MAAM,CAAC,OAAO,CAAC,oBAAoB,CAAC,IAAI,CAAC,CAAC,CAAC;QAC3C,MAAM,CAAC,MAAM,CAAC,gBAAgB,CAAC,IAAI,CAAC,CAAC,CAAC;QACtC,MAAM,CAAC,OAAO,CAAC,sBAAsB,CAAC,IAAI,CAAC,CAAC,CAAC;QAC7C,MAAM,CAAC,OAAO,CAAC,oBAAoB,CAAC,IAAI,CAAC,CAAC,CAAC;QAC3C,KAAK,CAAC,MAAM,CAAC,UAAU,CAAC,QAAQ,CAAC,CAAC;QAClC,KAAK,CAAC,MAAM,CAAC,SAAS,CAAC,OAAO,CAAC,CAAC;QAEhC,MAAM,IAAI,CAAC,aAAa,EAAE,CAAC;QAC3B,IAAI,CAAC,QAAQ,EAAE,CAAC;QAChB,IAAI,CAAC,QAAQ,EAAE,CAAC;QAChB,IAAI,CAAC,MAAM,EAAE,CAAC;QACd,QAAQ,CAAC,YAAY,CAAC,YAAY,CAAC,cAAc,EAAE,CAAC;IACtD,CAAC,CAAC,CAAC;IAEH,EAAE,CAAC,kCAAkC,EAAE,KAAK,IAAI,EAAE;QAChD,MAAM,EAAC,QAAQ,EAAE,OAAO,EAAC,GAAG,oBAAoB,EAAE,CAAC;QACnD,MAAM,IAAI,GAAG,QAAQ,CAAC,YAAY,CAAC,YAAY,CAAC,QAAQ,EAAE,CAAC;QAC3D,MAAM,IAAI,CAAC,cAAc,CAAC;QAC1B,oBAAoB,CAAC,IAAI,CAAC,CAAC;QAC3B,MAAM,CAAC,MAAM,CAAC,oBAAoB,CAAC,IAAI,CAAC,CAAC,CAAC;QAC1C,MAAM,CAAC,OAAO,CAAC,gBAAgB,CAAC,IAAI,CAAC,CAAC,CAAC;QACvC,MAAM,CAAC,OAAO,CAAC,sBAAsB,CAAC,IAAI,CAAC,CAAC,CAAC;QAC7C,MAAM,CAAC,OAAO,CAAC,oBAAoB,CAAC,IAAI,CAAC,CAAC,CAAC;QAC3C,KAAK,CAAC,MAAM,CAAC,SAAS,CAAC,QAAQ,CAAC,CAAC;QAEjC,MAAM,IAAI,CAAC,cAAc,CAAC,EAAC,MAAM,EAAE,KAAK,EAAE,kBAAkB,EAAE,KAAK,EAAC,CAAC,CAAC;QACtE,MAAM,iBAAiB,CAAC,IAAI,CAAC,EAAC,WAAW,EAAE,IAAI,EAAC,CAAC,CAAC;QAClD,MAAM,CAAC,OAAO,CAAC,oBAAoB,CAAC,IAAI,CAAC,CAAC,CAAC;QAC3C,MAAM,CAAC,MAAM,CAAC,gBAAgB,CAAC,IAAI,CAAC,CAAC,CAAC;QACtC,MAAM,CAAC,OAAO,CAAC,sBAAsB,CAAC,IAAI,CAAC,CAAC,CAAC;QAC7C,MAAM,CAAC,OAAO,CAAC,oBAAoB,CAAC,IAAI,CAAC,CAAC,CAAC;QAC3C,KAAK,CAAC,MAAM,CAAC,UAAU,CAAC,QAAQ,CAAC,CAAC;QAElC,+CAA+C;QAC/C,MAAM,EAAC,QAAQ,EAAE,SAAS,EAAE,OAAO,EAAE,QAAQ,EAAE,MAAM,EAAE,OAAO,EAAC,GAAG,oBAAoB,EAAE,CAAC;QACzF,QAAQ,CAAC,OAAO,CAAC,CAAC;QAClB,MAAM,iBAAiB,CAAC,IAAI,CAAC,EAAC,WAAW,EAAE,IAAI,EAAC,CAAC,CAAC;QAClD,MAAM,CAAC,OAAO,CAAC,oBAAoB,CAAC,IAAI,CAAC,CAAC,CAAC;QAC3C,MAAM,CAAC,OAAO,CAAC,gBAAgB,CAAC,IAAI,CAAC,CAAC,CAAC;QACvC,MAAM,CAAC,MAAM,CAAC,sBAAsB,CAAC,IAAI,CAAC,CAAC,CAAC;QAC5C,MAAM,CAAC,OAAO,CAAC,oBAAoB,CAAC,IAAI,CAAC,CAAC,CAAC;QAC3C,KAAK,CAAC,MAAM,CAAC,UAAU,CAAC,QAAQ,CAAC,CAAC;QAClC,KAAK,CAAC,MAAM,CAAC,UAAU,CAAC,OAAO,CAAC,CAAC;QACjC,KAAK,CAAC,MAAM,CAAC,UAAU,CAAC,SAAS,CAAC,CAAC;QACnC,KAAK,CAAC,MAAM,CAAC,SAAS,CAAC,QAAQ,CAAC,CAAC;QAEjC,QAAQ,CAAC,YAAY,CAAC,OAAO,CAAC,EAAE,EAAC,GAAG,EAAE,6BAA6B,EAAC,CAAC,CAAC;QACtE,MAAM,IAAI,CAAC,cAAc,CAAC;QAC1B,MAAM,CAAC,OAAO,CAAC,oBAAoB,CAAC,IAAI,CAAC,CAAC,CAAC;QAC3C,MAAM,CAAC,MAAM,CAAC,gBAAgB,CAAC,IAAI,CAAC,CAAC,CAAC;QACtC,MAAM,CAAC,OAAO,CAAC,sBAAsB,CAAC,IAAI,CAAC,CAAC,CAAC;QAC7C,MAAM,CAAC,OAAO,CAAC,oBAAoB,CAAC,IAAI,CAAC,CAAC,CAAC;QAC3C,KAAK,CAAC,MAAM,CAAC,UAAU,CAAC,QAAQ,CAAC,CAAC;QAClC,KAAK,CAAC,MAAM,CAAC,UAAU,CAAC,OAAO,CAAC,CAAC;QACjC,KAAK,CAAC,MAAM,CAAC,UAAU,CAAC,SAAS,CAAC,CAAC;QACnC,KAAK,CAAC,MAAM,CAAC,SAAS,CAAC,QAAQ,CAAC,CAAC;QAEjC,MAAM,IAAI,CAAC,aAAa,EAAE,CAAC;QAC3B,IAAI,CAAC,QAAQ,EAAE,CAAC;QAChB,IAAI,CAAC,QAAQ,EAAE,CAAC;QAChB,IAAI,CAAC,MAAM,EAAE,CAAC;QACd,QAAQ,CAAC,YAAY,CAAC,YAAY,CAAC,cAAc,EAAE,CAAC;IACtD,CAAC,CAAC,CAAC;AACL,CAAC,CAAC,CAAC","sourcesContent":["// Copyright 2023 The Chromium Authors\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport * as SDK from '../../core/sdk/sdk.js';\nimport * as Protocol from '../../generated/protocol.js';\nimport * as Bindings from '../../models/bindings/bindings.js';\nimport * as Workspace from '../../models/workspace/workspace.js';\nimport {renderElementIntoDOM} from '../../testing/DOMHelpers.js';\nimport {createTarget, registerNoopActions} from '../../testing/EnvironmentHelpers.js';\nimport {describeWithMockConnection} from '../../testing/MockConnection.js';\nimport {activate, getMainFrame, navigate} from '../../testing/ResourceTreeHelpers.js';\nimport * as RenderCoordinator from '../../ui/components/render_coordinator/render_coordinator.js';\nimport * as UI from '../../ui/legacy/legacy.js';\n\nimport * as Coverage from './coverage.js';\n\nconst isShowingLandingPage = (view: Coverage.CoverageView.CoverageView) => {\n  return Boolean(view.contentElement.querySelector('.empty-state'));\n};\n\nconst isShowingResults = (view: Coverage.CoverageView.CoverageView) => {\n  return Boolean(view.contentElement.querySelector('.coverage-results .results'));\n};\n\nconst isShowingPrerenderPage = (view: Coverage.CoverageView.CoverageView) => {\n  return Boolean(view.contentElement.querySelector('.prerender-page'));\n};\n\nconst isShowingBfcachePage = (view: Coverage.CoverageView.CoverageView) => {\n  return Boolean(view.contentElement.querySelector('.bfcache-page'));\n};\n\nconst setupTargetAndModels = () => {\n  const target = createTarget();\n\n  const workspace = Workspace.Workspace.WorkspaceImpl.instance({forceNew: true});\n  const targetManager = SDK.TargetManager.TargetManager.instance();\n  const resourceMapping = new Bindings.ResourceMapping.ResourceMapping(targetManager, workspace);\n  const ignoreListManager = Workspace.IgnoreListManager.IgnoreListManager.instance({forceNew: true});\n  Bindings.DebuggerWorkspaceBinding.DebuggerWorkspaceBinding.instance({\n    forceNew: true,\n    resourceMapping,\n    targetManager,\n    ignoreListManager,\n  });\n  Bindings.CSSWorkspaceBinding.CSSWorkspaceBinding.instance({forceNew: true, resourceMapping, targetManager});\n\n  const coverageModel = target.model(Coverage.CoverageModel.CoverageModel);\n  assert.exists(coverageModel);\n  const startSpy = sinon.spy(coverageModel, 'start');\n  const stopSpy = sinon.spy(coverageModel, 'stop');\n\n  const cssModel = target.model(SDK.CSSModel.CSSModel);\n  assert.exists(cssModel);\n  sinon.stub(cssModel.agent, 'invoke_startRuleUsageTracking').resolves({\n    getError: () => undefined,\n  });\n  sinon.stub(cssModel.agent, 'invoke_takeCoverageDelta').resolves({\n    coverage: [],\n    getError: () => undefined,\n    timestamp: 0,\n  });\n  sinon.stub(cssModel.agent, 'invoke_stopRuleUsageTracking').resolves({\n    getError: () => undefined,\n    ruleUsage: [],\n  });\n\n  const profilerAgent = target.profilerAgent();\n  sinon.stub(profilerAgent, 'invoke_startPreciseCoverage').resolves({\n    timestamp: 0,\n    getError: () => undefined,\n  });\n  sinon.stub(profilerAgent, 'invoke_stopPreciseCoverage').resolves({\n    getError: () => undefined,\n  });\n  sinon.stub(profilerAgent, 'invoke_takePreciseCoverage').resolves({\n    result: [],\n    getError: () => undefined,\n    timestamp: 0,\n  });\n\n  return {startSpy, stopSpy, target};\n};\n\ndescribeWithMockConnection('CoverageView', () => {\n  beforeEach(() => {\n    registerNoopActions([\n      'coverage.clear',\n      'coverage.export',\n      'coverage.start-with-reload',\n      'coverage.toggle-recording',\n      'inspector-main.reload',\n    ]);\n  });\n\n  it('dispatches a record/reload action when the button is clicked', async () => {\n    const view = Coverage.CoverageView.CoverageView.instance();\n    renderElementIntoDOM(view);\n    await view.updateComplete;\n    assert.isTrue(isShowingLandingPage(view));\n\n    const button = view.contentElement.querySelector('.empty-state devtools-button');\n    assert.exists(button);\n\n    const toggleSpy =\n        sinon.spy(UI.ActionRegistry.ActionRegistry.instance().getAction('coverage.toggle-recording'), 'execute');\n    const reloadSpy =\n        sinon.spy(UI.ActionRegistry.ActionRegistry.instance().getAction('coverage.start-with-reload'), 'execute');\n\n    (button as HTMLElement).onclick?.(new PointerEvent('click'));\n    assert.isTrue(toggleSpy.calledOnce || reloadSpy.calledOnce);\n  });\n\n  it('can handle back/forward cache navigations', async () => {\n    const {startSpy, stopSpy, target} = setupTargetAndModels();\n    const view = Coverage.CoverageView.CoverageView.instance();\n    renderElementIntoDOM(view);\n    assert.isTrue(isShowingLandingPage(view));\n    assert.isFalse(isShowingResults(view));\n    assert.isFalse(isShowingPrerenderPage(view));\n    assert.isFalse(isShowingBfcachePage(view));\n    sinon.assert.notCalled(startSpy);\n\n    await view.startRecording({reload: false, jsCoveragePerBlock: false});\n    await RenderCoordinator.done();\n    assert.isFalse(isShowingLandingPage(view));\n    assert.isTrue(isShowingResults(view));\n    assert.isFalse(isShowingPrerenderPage(view));\n    assert.isFalse(isShowingBfcachePage(view));\n    sinon.assert.calledOnce(startSpy);\n\n    navigate(getMainFrame(target), {}, Protocol.Page.NavigationType.BackForwardCacheRestore);\n    await view.updateComplete;\n\n    assert.isFalse(isShowingLandingPage(view));\n    assert.isFalse(isShowingResults(view));\n    assert.isFalse(isShowingPrerenderPage(view));\n    assert.isTrue(isShowingBfcachePage(view));\n    sinon.assert.calledOnce(startSpy);\n    sinon.assert.notCalled(stopSpy);\n\n    navigate(getMainFrame(target));\n    await view.updateComplete;\n    assert.isFalse(isShowingLandingPage(view));\n    assert.isTrue(isShowingResults(view));\n    assert.isFalse(isShowingPrerenderPage(view));\n    assert.isFalse(isShowingBfcachePage(view));\n    sinon.assert.calledOnce(startSpy);\n    sinon.assert.notCalled(stopSpy);\n\n    await view.stopRecording();\n    view.willHide();\n    view.wasShown();\n    view.detach();\n    Coverage.CoverageView.CoverageView.removeInstance();\n  });\n\n  it('can handle prerender activations', async () => {\n    const {startSpy, stopSpy} = setupTargetAndModels();\n    const view = Coverage.CoverageView.CoverageView.instance();\n    await view.updateComplete;\n    renderElementIntoDOM(view);\n    assert.isTrue(isShowingLandingPage(view));\n    assert.isFalse(isShowingResults(view));\n    assert.isFalse(isShowingPrerenderPage(view));\n    assert.isFalse(isShowingBfcachePage(view));\n    sinon.assert.notCalled(startSpy);\n\n    await view.startRecording({reload: false, jsCoveragePerBlock: false});\n    await RenderCoordinator.done({waitForWork: true});\n    assert.isFalse(isShowingLandingPage(view));\n    assert.isTrue(isShowingResults(view));\n    assert.isFalse(isShowingPrerenderPage(view));\n    assert.isFalse(isShowingBfcachePage(view));\n    sinon.assert.calledOnce(startSpy);\n\n    // Create 2nd target for the prerendered frame.\n    const {startSpy: startSpy2, stopSpy: stopSpy2, target: target2} = setupTargetAndModels();\n    activate(target2);\n    await RenderCoordinator.done({waitForWork: true});\n    assert.isFalse(isShowingLandingPage(view));\n    assert.isFalse(isShowingResults(view));\n    assert.isTrue(isShowingPrerenderPage(view));\n    assert.isFalse(isShowingBfcachePage(view));\n    sinon.assert.calledOnce(startSpy);\n    sinon.assert.calledOnce(stopSpy);\n    sinon.assert.calledOnce(startSpy2);\n    sinon.assert.notCalled(stopSpy2);\n\n    navigate(getMainFrame(target2), {url: 'http://www.example.com/page'});\n    await view.updateComplete;\n    assert.isFalse(isShowingLandingPage(view));\n    assert.isTrue(isShowingResults(view));\n    assert.isFalse(isShowingPrerenderPage(view));\n    assert.isFalse(isShowingBfcachePage(view));\n    sinon.assert.calledOnce(startSpy);\n    sinon.assert.calledOnce(stopSpy);\n    sinon.assert.calledOnce(startSpy2);\n    sinon.assert.notCalled(stopSpy2);\n\n    await view.stopRecording();\n    view.willHide();\n    view.wasShown();\n    view.detach();\n    Coverage.CoverageView.CoverageView.removeInstance();\n  });\n});\n"]}