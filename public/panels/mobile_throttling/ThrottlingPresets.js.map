{"version":3,"file":"ThrottlingPresets.js","sourceRoot":"","sources":["../../../../../../front_end/panels/mobile_throttling/ThrottlingPresets.ts"],"names":[],"mappings":"AAAA,4DAA4D;AAC5D,yEAAyE;AACzE,6BAA6B;AAE7B,OAAO,KAAK,IAAI,MAAM,yBAAyB,CAAC;AAChD,OAAO,KAAK,GAAG,MAAM,uBAAuB,CAAC;AAE7C,MAAM,SAAS,GAAG;IAChB;;OAEG;IACH,YAAY,EAAE,kCAAkC;IAChD;;OAEG;IACH,sBAAsB,EAAE,0BAA0B;IAClD;;OAEG;IACH,aAAa,EAAE,iBAAiB;IAChC;;OAEG;IACH,iBAAiB,EAAE,2BAA2B;IAC9C;;;OAGG;IACH,2BAA2B,EAAE,+BAA+B;IAC5D;;OAEG;IACH,aAAa,EAAE,iBAAiB;IAChC;;OAEG;IACH,iBAAiB,EAAE,2BAA2B;IAC9C;;;OAGG;IACH,2BAA2B,EAAE,+BAA+B;IAC5D;;OAEG;IACH,MAAM,EAAE,QAAQ;IAChB;;OAEG;IACH,gCAAgC,EAAE,sCAAsC;CAChE,CAAC;AAEX,MAAM,IAAI,GAAG,IAAI,CAAC,IAAI,CAAC,iBAAiB,CAAC,+CAA+C,EAAE,SAAS,CAAC,CAAC;AACrG,MAAM,UAAU,GAAG,IAAI,CAAC,IAAI,CAAC,kBAAkB,CAAC,IAAI,CAAC,SAAS,EAAE,IAAI,CAAC,CAAC;AACtE,MAAM,OAAO,iBAAiB;IAC5B,MAAM,CAAC,yBAAyB;QAC9B,MAAM,KAAK,GAAG,OAAO,GAAG,CAAC,cAAc,CAAC,sBAAsB,CAAC,KAAK,KAAK,UAAU,CAAC,CAAC;YACjF,GAAG,CAAC,cAAc,CAAC,sBAAsB,CAAC,KAAK,EAAE,CAAC,CAAC;YACnD,GAAG,CAAC,cAAc,CAAC,sBAAsB,CAAC,KAAK,CAAC;QACpD,OAAO;YACL,KAAK;YACL,WAAW,EAAE,UAAU,CAAC,SAAS,CAAC,YAAY,CAAC;YAC/C,OAAO,EAAE,GAAG,CAAC,cAAc,CAAC,sBAAsB;YAClD,mBAAmB,EAAE,GAAG,CAAC,oBAAoB,CAAC,kBAAkB;YAChE,YAAY,EAAE,eAAe;SAC9B,CAAC;IACJ,CAAC;IAED,MAAM,CAAC,oBAAoB;QACzB,MAAM,KAAK,GAAG,OAAO,GAAG,CAAC,cAAc,CAAC,iBAAiB,CAAC,KAAK,KAAK,UAAU,CAAC,CAAC;YAC5E,GAAG,CAAC,cAAc,CAAC,iBAAiB,CAAC,KAAK,EAAE,CAAC,CAAC;YAC9C,GAAG,CAAC,cAAc,CAAC,iBAAiB,CAAC,KAAK,CAAC;QAC/C,OAAO;YACL,KAAK;YACL,WAAW,EAAE,UAAU,CAAC,SAAS,CAAC,sBAAsB,CAAC;YACzD,OAAO,EAAE,GAAG,CAAC,cAAc,CAAC,iBAAiB;YAC7C,mBAAmB,EAAE,GAAG,CAAC,oBAAoB,CAAC,kBAAkB;YAChE,YAAY,EAAE,SAAS;SACxB,CAAC;IACJ,CAAC;IAED,MAAM,CAAC,yBAAyB;QAC9B,MAAM,aAAa,GAAG,GAAG,CAAC,oBAAoB,CAAC,uCAAuC,CAAC,IAAI,EAAE,KAAK,CAAC,CAAC;QACpG,MAAM,mBAAmB,GAAG,aAAa,CAAC,CAAC,CAAC,GAAG,CAAC,oBAAoB,CAAC,uCAAuC,CAAC,CAAC;YAClE,GAAG,CAAC,oBAAoB,CAAC,uBAAuB,CAAC;QAC7F,MAAM,WAAW,GAAG,aAAa,CAAC,CAAC;YAC/B,UAAU,CAAC,SAAS,CAAC,2BAA2B,EAAE,EAAC,GAAG,EAAE,mBAAmB,CAAC,IAAI,EAAE,EAAC,CAAC,CAAC,CAAC;YACtF,UAAU,CAAC,SAAS,CAAC,iBAAiB,CAAC,CAAC;QAE5C,OAAO;YACL,KAAK,EAAE,UAAU,CAAC,SAAS,CAAC,aAAa,CAAC;YAC1C,WAAW;YACX,OAAO,EAAE,GAAG,CAAC,cAAc,CAAC,gBAAgB;YAC5C,mBAAmB;YACnB,YAAY,EAAE,gBAAgB;SAC/B,CAAC;IACJ,CAAC;IAED,MAAM,CAAC,0BAA0B;QAC/B,MAAM,aAAa,GAAG,GAAG,CAAC,oBAAoB,CAAC,uCAAuC,CAAC,IAAI,EAAE,KAAK,CAAC,CAAC;QACpG,MAAM,mBAAmB,GAAG,aAAa,CAAC,CAAC,CAAC,GAAG,CAAC,oBAAoB,CAAC,uCAAuC,CAAC,CAAC;YAClE,GAAG,CAAC,oBAAoB,CAAC,uBAAuB,CAAC;QAC7F,MAAM,WAAW,GAAG,aAAa,CAAC,CAAC;YAC/B,UAAU,CAAC,SAAS,CAAC,2BAA2B,EAAE,EAAC,GAAG,EAAE,mBAAmB,CAAC,IAAI,EAAE,EAAC,CAAC,CAAC,CAAC;YACtF,UAAU,CAAC,SAAS,CAAC,iBAAiB,CAAC,CAAC;QAE5C,OAAO;YACL,KAAK,EAAE,UAAU,CAAC,SAAS,CAAC,aAAa,CAAC;YAC1C,WAAW;YACX,OAAO,EAAE,GAAG,CAAC,cAAc,CAAC,gBAAgB;YAC5C,mBAAmB;YACnB,YAAY,EAAE,iBAAiB;SAChC,CAAC;IACJ,CAAC;IAED,MAAM,CAAC,mBAAmB;QACxB,OAAO;YACL,KAAK,EAAE,UAAU,CAAC,SAAS,CAAC,MAAM,CAAC;YACnC,WAAW,EAAE,UAAU,CAAC,SAAS,CAAC,gCAAgC,CAAC;YACnE,YAAY,EAAE,QAAQ;SACvB,CAAC;IACJ,CAAC;IAED,MAAM,CAAC,gBAAgB;QACrB,OAAO;YACL,iBAAiB,CAAC,0BAA0B,EAAE;YAC9C,iBAAiB,CAAC,yBAAyB,EAAE;YAC7C,iBAAiB,CAAC,mBAAmB,EAAE;SACxC,CAAC;IACJ,CAAC;IAED,MAAM,CAAC,wBAAwB;QAC7B,OAAO;YACL,iBAAiB,CAAC,oBAAoB,EAAE;SACzC,CAAC;IACJ,CAAC;IAED,MAAM,CAAC,2BAA2B,CAAC,GAAW;QAC5C,MAAM,wBAAwB,GAAG,GAAG,CAAC;QACrC,MAAM,WAAW,GAAG,EAAE,CAAC;QAEvB,IAAI,CAAC,MAAM,CAAC,QAAQ,CAAC,GAAG,CAAC,EAAE,CAAC;YAC1B,OAAO,IAAI,CAAC;QACd,CAAC;QAED,IAAI,GAAG,GAAG,WAAW,EAAE,CAAC;YACtB,OAAO,IAAI,CAAC;QACd,CAAC;QAED,IAAI,aAAa,GAAuC,IAAI,CAAC;QAC7D,IAAI,YAAY,GAAG,QAAQ,CAAC;QAC5B,KAAK,MAAM,MAAM,IAAI,iBAAiB,CAAC,cAAc,EAAE,CAAC;YACtD,MAAM,EAAC,aAAa,EAAC,GAAG,MAAM,CAAC;YAC/B,IAAI,CAAC,aAAa,EAAE,CAAC;gBACnB,SAAS;YACX,CAAC;YAED,MAAM,IAAI,GAAG,IAAI,CAAC,GAAG,CAAC,aAAa,GAAG,GAAG,CAAC,CAAC;YAC3C,IAAI,IAAI,GAAG,wBAAwB,EAAE,CAAC;gBACpC,SAAS;YACX,CAAC;YAED,IAAI,YAAY,GAAG,IAAI,EAAE,CAAC;gBACxB,SAAS;YACX,CAAC;YAED,aAAa,GAAG,MAAM,CAAC;YACvB,YAAY,GAAG,IAAI,CAAC;QACtB,CAAC;QAED,OAAO,aAAa,CAAC;IACvB,CAAC;IAED,MAAM,CAAC,cAAc,GAAoC;QACvD,GAAG,CAAC,cAAc,CAAC,gBAAgB;QACnC,GAAG,CAAC,cAAc,CAAC,gBAAgB;QACnC,GAAG,CAAC,cAAc,CAAC,gBAAgB;QACnC,GAAG,CAAC,cAAc,CAAC,iBAAiB;KACrC,CAAC;IAEF,MAAM,CAAC,oBAAoB,GAAmD;QAC5E,GAAG,CAAC,oBAAoB,CAAC,kBAAkB;QAC3C,GAAG,CAAC,oBAAoB,CAAC,uBAAuB;QAChD,GAAG,CAAC,oBAAoB,CAAC,uBAAuB;QAChD,GAAG,CAAC,oBAAoB,CAAC,yBAAyB;QAClD,GAAG,CAAC,oBAAoB,CAAC,uCAAuC;QAChE,GAAG,CAAC,oBAAoB,CAAC,uCAAuC;KACjE,CAAC;;AAGJ,yCAAyC;AACzC,UAAU,CAAC,gBAAgB,GAAG,UAAU,CAAC,gBAAgB,IAAI,EAAE,CAAC;AAChE,yCAAyC;AACzC,UAAU,CAAC,gBAAgB,CAAC,cAAc,GAAG,iBAAiB,CAAC,cAAc,CAAC","sourcesContent":["// Copyright 2017 The Chromium Authors. All rights reserved.\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport * as i18n from '../../core/i18n/i18n.js';\nimport * as SDK from '../../core/sdk/sdk.js';\n\nconst UIStrings = {\n  /**\n   *@description Text for no network throttling\n   */\n  noThrottling: 'No CPU and no network throttling',\n  /**\n   *@description Text in Throttling Presets of the Network panel\n   */\n  noInternetConnectivity: 'No internet connectivity',\n  /**\n   *@description Text in Throttling Presets of the Network panel\n   */\n  lowTierMobile: 'Low-tier mobile',\n  /**\n   *@description Text in Throttling Presets of the Network panel\n   */\n  slowGXCpuSlowdown: 'Slow 3G & 6x CPU slowdown',\n  /**\n   * @description Text in Throttling Presets of the Network panel\n   * @example {2.2} PH1\n   */\n  slowGXCpuSlowdownCalibrated: 'Slow 3G & {PH1}x CPU slowdown',\n  /**\n   *@description Text in Throttling Presets of the Network panel\n   */\n  midtierMobile: 'Mid-tier mobile',\n  /**\n   *@description Text in Throttling Presets of the Network panel\n   */\n  fastGXCpuSlowdown: 'Fast 3G & 4x CPU slowdown',\n  /**\n   * @description Text in Throttling Presets of the Network panel\n   * @example {2.2} PH1\n   */\n  fastGXCpuSlowdownCalibrated: 'Fast 3G & {PH1}x CPU slowdown',\n  /**\n   *@description Text in Network Throttling Selector of the Network panel\n   */\n  custom: 'Custom',\n  /**\n   *@description Text in Throttling Presets of the Network panel\n   */\n  checkNetworkAndPerformancePanels: 'Check Network and Performance panels',\n} as const;\n\nconst str_ = i18n.i18n.registerUIStrings('panels/mobile_throttling/ThrottlingPresets.ts', UIStrings);\nconst i18nString = i18n.i18n.getLocalizedString.bind(undefined, str_);\nexport class ThrottlingPresets {\n  static getNoThrottlingConditions(): Conditions {\n    const title = typeof SDK.NetworkManager.NoThrottlingConditions.title === 'function' ?\n        SDK.NetworkManager.NoThrottlingConditions.title() :\n        SDK.NetworkManager.NoThrottlingConditions.title;\n    return {\n      title,\n      description: i18nString(UIStrings.noThrottling),\n      network: SDK.NetworkManager.NoThrottlingConditions,\n      cpuThrottlingOption: SDK.CPUThrottlingManager.NoThrottlingOption,\n      jslogContext: 'no-throttling',\n    };\n  }\n\n  static getOfflineConditions(): Conditions {\n    const title = typeof SDK.NetworkManager.OfflineConditions.title === 'function' ?\n        SDK.NetworkManager.OfflineConditions.title() :\n        SDK.NetworkManager.OfflineConditions.title;\n    return {\n      title,\n      description: i18nString(UIStrings.noInternetConnectivity),\n      network: SDK.NetworkManager.OfflineConditions,\n      cpuThrottlingOption: SDK.CPUThrottlingManager.NoThrottlingOption,\n      jslogContext: 'offline',\n    };\n  }\n\n  static getLowEndMobileConditions(): Conditions {\n    const useCalibrated = SDK.CPUThrottlingManager.CalibratedLowTierMobileThrottlingOption.rate() !== 0;\n    const cpuThrottlingOption = useCalibrated ? SDK.CPUThrottlingManager.CalibratedLowTierMobileThrottlingOption :\n                                                SDK.CPUThrottlingManager.LowTierThrottlingOption;\n    const description = useCalibrated ?\n        i18nString(UIStrings.slowGXCpuSlowdownCalibrated, {PH1: cpuThrottlingOption.rate()}) :\n        i18nString(UIStrings.slowGXCpuSlowdown);\n\n    return {\n      title: i18nString(UIStrings.lowTierMobile),\n      description,\n      network: SDK.NetworkManager.Slow3GConditions,\n      cpuThrottlingOption,\n      jslogContext: 'low-end-mobile',\n    };\n  }\n\n  static getMidTierMobileConditions(): Conditions {\n    const useCalibrated = SDK.CPUThrottlingManager.CalibratedMidTierMobileThrottlingOption.rate() !== 0;\n    const cpuThrottlingOption = useCalibrated ? SDK.CPUThrottlingManager.CalibratedMidTierMobileThrottlingOption :\n                                                SDK.CPUThrottlingManager.MidTierThrottlingOption;\n    const description = useCalibrated ?\n        i18nString(UIStrings.fastGXCpuSlowdownCalibrated, {PH1: cpuThrottlingOption.rate()}) :\n        i18nString(UIStrings.fastGXCpuSlowdown);\n\n    return {\n      title: i18nString(UIStrings.midtierMobile),\n      description,\n      network: SDK.NetworkManager.Slow4GConditions,\n      cpuThrottlingOption,\n      jslogContext: 'mid-tier-mobile',\n    };\n  }\n\n  static getCustomConditions(): PlaceholderConditions {\n    return {\n      title: i18nString(UIStrings.custom),\n      description: i18nString(UIStrings.checkNetworkAndPerformancePanels),\n      jslogContext: 'custom',\n    };\n  }\n\n  static getMobilePresets(): Array<Conditions|PlaceholderConditions> {\n    return [\n      ThrottlingPresets.getMidTierMobileConditions(),\n      ThrottlingPresets.getLowEndMobileConditions(),\n      ThrottlingPresets.getCustomConditions(),\n    ];\n  }\n\n  static getAdvancedMobilePresets(): Conditions[] {\n    return [\n      ThrottlingPresets.getOfflineConditions(),\n    ];\n  }\n\n  static getRecommendedNetworkPreset(rtt: number): SDK.NetworkManager.Conditions|null {\n    const RTT_COMPARISON_THRESHOLD = 200;\n    const RTT_MINIMUM = 60;\n\n    if (!Number.isFinite(rtt)) {\n      return null;\n    }\n\n    if (rtt < RTT_MINIMUM) {\n      return null;\n    }\n\n    let closestPreset: SDK.NetworkManager.Conditions|null = null;\n    let smallestDiff = Infinity;\n    for (const preset of ThrottlingPresets.networkPresets) {\n      const {targetLatency} = preset;\n      if (!targetLatency) {\n        continue;\n      }\n\n      const diff = Math.abs(targetLatency - rtt);\n      if (diff > RTT_COMPARISON_THRESHOLD) {\n        continue;\n      }\n\n      if (smallestDiff < diff) {\n        continue;\n      }\n\n      closestPreset = preset;\n      smallestDiff = diff;\n    }\n\n    return closestPreset;\n  }\n\n  static networkPresets: SDK.NetworkManager.Conditions[] = [\n    SDK.NetworkManager.Fast4GConditions,\n    SDK.NetworkManager.Slow4GConditions,\n    SDK.NetworkManager.Slow3GConditions,\n    SDK.NetworkManager.OfflineConditions,\n  ];\n\n  static cpuThrottlingPresets: SDK.CPUThrottlingManager.CPUThrottlingOption[] = [\n    SDK.CPUThrottlingManager.NoThrottlingOption,\n    SDK.CPUThrottlingManager.MidTierThrottlingOption,\n    SDK.CPUThrottlingManager.LowTierThrottlingOption,\n    SDK.CPUThrottlingManager.ExtraSlowThrottlingOption,\n    SDK.CPUThrottlingManager.CalibratedLowTierMobileThrottlingOption,\n    SDK.CPUThrottlingManager.CalibratedMidTierMobileThrottlingOption,\n  ];\n}\n\n// @ts-expect-error exported for Tests.js\nglobalThis.MobileThrottling = globalThis.MobileThrottling || {};\n// @ts-expect-error exported for Tests.js\nglobalThis.MobileThrottling.networkPresets = ThrottlingPresets.networkPresets;\n\nexport interface Conditions {\n  title: string;\n  description: string;\n  network: SDK.NetworkManager.Conditions;\n  cpuThrottlingOption: SDK.CPUThrottlingManager.CPUThrottlingOption;\n  jslogContext?: string;\n}\n\nexport interface NetworkThrottlingConditionsGroup {\n  title: string;\n  items: SDK.NetworkManager.Conditions[];\n}\n\nexport interface MobileThrottlingConditionsGroup {\n  title: string;\n  items: Array<Conditions|PlaceholderConditions>;\n}\n\nexport type ConditionsList = Array<Conditions|PlaceholderConditions|null>;\n\nexport interface PlaceholderConditions {\n  title: string;\n  description: string;\n  jslogContext?: string;\n}\n"]}