{"version":3,"file":"CreateRecordingView.test.js","sourceRoot":"","sources":["../../../../../../../front_end/panels/recorder/components/CreateRecordingView.test.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright 2023 The Chromium Authors\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport {assertScreenshot, renderElementIntoDOM} from '../../../testing/DOMHelpers.js';\nimport {\n  describeWithEnvironment,\n  setupActionRegistry,\n} from '../../../testing/EnvironmentHelpers.js';\nimport {\n  createViewFunctionStub,\n  type ViewFunctionStub,\n} from '../../../testing/ViewFunctionHelpers.js';\nimport * as Models from '../models/models.js';\n\nimport * as Components from './components.js';\n\ndescribeWithEnvironment('CreateRecordingView', () => {\n  setupActionRegistry();\n\n  const widgets: Components.CreateRecordingView.CreateRecordingView[] = [];\n\n  afterEach(() => {\n    // Unregister global listeners in willHide to prevent leaks.\n    for (const widget of widgets) {\n      widget.willHide();\n    }\n  });\n\n  async function createWidget(\n      params?: {\n        onRecordingStarted:\n            (data: {name: string, selectorTypesToRecord: Models.Schema.SelectorType[], selectorAttribute?: string}) =>\n                void,\n        recorderSettings?: Models.RecorderSettings.RecorderSettings,\n      },\n      output?: Components.CreateRecordingView.ViewOutput):\n      Promise<[\n        ViewFunctionStub<typeof Components.CreateRecordingView.CreateRecordingView>,\n        Components.CreateRecordingView.CreateRecordingView\n      ]> {\n    const view = createViewFunctionStub(Components.CreateRecordingView.CreateRecordingView, output);\n    const component = new Components.CreateRecordingView.CreateRecordingView(undefined, view);\n    component.recorderSettings = params?.recorderSettings ?? new Models.RecorderSettings.RecorderSettings();\n    if (params?.onRecordingStarted) {\n      component.onRecordingStarted = params?.onRecordingStarted;\n    }\n    component.wasShown();\n    widgets.push(component);\n    await view.nextInput;\n    return [view, component];\n  }\n\n  it('starts a recording if data is correct', async () => {\n    const recordingStartedStub = sinon.stub();\n    const [view] = await createWidget({\n      onRecordingStarted: recordingStartedStub,\n    });\n    view.input.onUpdate({name: 'test'});\n    view.input.onUpdate({selectorAttribute: 'test-attr'});\n    view.input.onUpdate({selectorType: Models.Schema.SelectorType.CSS, checked: true});\n    view.input.onUpdate({selectorType: Models.Schema.SelectorType.ARIA, checked: false});\n    view.input.onUpdate({selectorType: Models.Schema.SelectorType.Pierce, checked: false});\n    view.input.onUpdate({selectorType: Models.Schema.SelectorType.Text, checked: false});\n    view.input.onUpdate({selectorType: Models.Schema.SelectorType.XPath, checked: false});\n    view.input.onRecordingStarted();\n    sinon.assert.calledOnceWithExactly(recordingStartedStub, {\n      selectorTypesToRecord: [Models.Schema.SelectorType.CSS],\n      selectorAttribute: 'test-attr',\n      name: 'test',\n    });\n  });\n\n  it('renders an error if the name is empty', async () => {\n    const recordingStartedStub = sinon.stub();\n    const [view] = await createWidget({\n      onRecordingStarted: recordingStartedStub,\n    });\n    view.input.onUpdate({name: ''});\n    view.input.onUpdate({selectorAttribute: 'test-attr'});\n    view.input.onUpdate({selectorType: Models.Schema.SelectorType.CSS, checked: true});\n    view.input.onRecordingStarted();\n    const input = await view.nextInput;\n    assert.deepEqual(input.error?.message, 'Recording name is required');\n    sinon.assert.notCalled(recordingStartedStub);\n  });\n\n  it('renders an error if the selector attributes are turned off', async () => {\n    const recordingStartedStub = sinon.stub();\n    const [view] = await createWidget({\n      onRecordingStarted: recordingStartedStub,\n    });\n    view.input.onUpdate({name: 'test'});\n    view.input.onUpdate({selectorAttribute: 'test-attr'});\n    view.input.onUpdate({selectorType: Models.Schema.SelectorType.CSS, checked: false});\n    view.input.onUpdate({selectorType: Models.Schema.SelectorType.ARIA, checked: false});\n    view.input.onUpdate({selectorType: Models.Schema.SelectorType.Pierce, checked: false});\n    view.input.onUpdate({selectorType: Models.Schema.SelectorType.Text, checked: false});\n    view.input.onUpdate({selectorType: Models.Schema.SelectorType.XPath, checked: false});\n    view.input.onRecordingStarted();\n    const input = await view.nextInput;\n    assert.deepEqual(\n        input.error?.message,\n        'You must choose CSS, Pierce, or XPath as one of your options. Only these selectors are guaranteed to be recorded since ARIA and text selectors may not be unique.');\n    sinon.assert.notCalled(recordingStartedStub);\n  });\n\n  describe('view', () => {\n    it('renders default view', async () => {\n      const target = document.createElement('div');\n      renderElementIntoDOM(target);\n      Components.CreateRecordingView.DEFAULT_VIEW(\n          {\n            name: 'test',\n            selectorAttribute: '',\n            selectorTypes: [\n              {selectorType: Models.Schema.SelectorType.CSS, checked: false},\n              {selectorType: Models.Schema.SelectorType.ARIA, checked: false},\n              {selectorType: Models.Schema.SelectorType.Text, checked: false},\n              {selectorType: Models.Schema.SelectorType.XPath, checked: false},\n              {selectorType: Models.Schema.SelectorType.Pierce, checked: false}\n            ],\n            onRecordingStarted: sinon.stub(),\n            onRecordingCancelled: sinon.stub(),\n            onErrorReset: sinon.stub(),\n            onUpdate: sinon.stub(),\n          },\n          {}, target);\n      await assertScreenshot('CreateRecordingView/default-view.png');\n    });\n    it('renders the error view', async () => {\n      const target = document.createElement('div');\n      renderElementIntoDOM(target);\n      Components.CreateRecordingView.DEFAULT_VIEW(\n          {\n            name: 'test',\n            selectorAttribute: '',\n            selectorTypes: [\n              {selectorType: Models.Schema.SelectorType.CSS, checked: false},\n              {selectorType: Models.Schema.SelectorType.ARIA, checked: false},\n              {selectorType: Models.Schema.SelectorType.Text, checked: false},\n              {selectorType: Models.Schema.SelectorType.XPath, checked: false},\n              {selectorType: Models.Schema.SelectorType.Pierce, checked: false}\n            ],\n            error: new Error('error'),\n            onRecordingStarted: sinon.stub(),\n            onRecordingCancelled: sinon.stub(),\n            onErrorReset: sinon.stub(),\n            onUpdate: sinon.stub(),\n          },\n          {}, target);\n      await assertScreenshot('CreateRecordingView/error-view.png');\n    });\n  });\n});\n"]}