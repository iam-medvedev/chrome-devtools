{
  "version": 3,
  "sources": ["../../../../../../../front_end/panels/recorder/models/ConverterIds.ts", "../../../../../../../front_end/panels/recorder/models/RecorderSettings.ts", "../../../../../../../front_end/panels/recorder/models/Schema.ts", "../../../../../../../front_end/panels/recorder/models/RecorderShortcutHelper.ts", "../../../../../../../front_end/panels/recorder/models/RecordingPlayer.ts", "../../../../../../../front_end/panels/recorder/models/RecordingSession.ts", "../../../../../../../front_end/panels/recorder/models/SchemaUtils.ts", "../../../../../../../front_end/panels/recorder/models/SDKUtils.ts", "../../../../../../../front_end/panels/recorder/models/RecordingSettings.ts", "../../../../../../../front_end/panels/recorder/models/RecordingStorage.ts", "../../../../../../../front_end/panels/recorder/models/ScreenshotStorage.ts", "../../../../../../../front_end/panels/recorder/models/ScreenshotUtils.ts", "../../../../../../../front_end/panels/recorder/models/Section.ts", "../../../../../../../front_end/panels/recorder/models/Tooltip.ts"],
  "sourcesContent": ["// Copyright 2023 The Chromium Authors\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nexport const enum ConverterIds {\n  JSON = 'json',\n  PUPPETEER = 'puppeteer',\n  PUPPETEER_FIREFOX = 'puppeteer-firefox',\n  REPLAY = '@puppeteer/replay',\n  LIGHTHOUSE = 'lighthouse',\n}\n", "// Copyright 2023 The Chromium Authors\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport * as Common from '../../../core/common/common.js';\nimport * as i18n from '../../../core/i18n/i18n.js';\n\nimport {ConverterIds} from './ConverterIds.js';\nimport {PlayRecordingSpeed} from './RecordingPlayer.js';\nimport {SelectorType} from './Schema.js';\n\nconst UIStrings = {\n  /**\n   * @description This string is used to generate the default name for the create recording form in the Recording panel.\n   * The format is similar to the one used by MacOS to generate names for screenshots. Both {DATE} and {TIME} are localized\n   * using the current locale.\n   * @example {2022-08-04} DATE\n   * @example {10:32:48} TIME\n   */\n  defaultRecordingName: 'Recording {DATE} at {TIME}',\n} as const;\n\nconst str_ = i18n.i18n.registerUIStrings(\n    'panels/recorder/models/RecorderSettings.ts',\n    UIStrings,\n);\nconst i18nString = i18n.i18n.getLocalizedString.bind(undefined, str_);\n\nexport class RecorderSettings {\n  #selectorAttribute = Common.Settings.Settings.instance().createSetting(\n      'recorder-selector-attribute',\n      '',\n  );\n  #speed = Common.Settings.Settings.instance().createSetting(\n      'recorder-panel-replay-speed',\n      PlayRecordingSpeed.NORMAL,\n  );\n  #replayExtension = Common.Settings.Settings.instance().createSetting(\n      'recorder-panel-replay-extension',\n      '',\n  );\n  #selectorTypes = new Map<SelectorType, Common.Settings.Setting<boolean>>();\n  #preferredCopyFormat = Common.Settings.Settings.instance().createSetting<string>(\n      'recorder-preferred-copy-format',\n      ConverterIds.JSON,\n  );\n\n  constructor() {\n    for (const selectorType of Object.values(SelectorType)) {\n      this.#selectorTypes.set(\n          selectorType,\n          Common.Settings.Settings.instance().createSetting(\n              `recorder-${selectorType}-selector-enabled`,\n              true,\n              ),\n      );\n    }\n  }\n\n  get selectorAttribute(): string {\n    return this.#selectorAttribute.get();\n  }\n\n  set selectorAttribute(value: string) {\n    this.#selectorAttribute.set(value);\n  }\n\n  get speed(): PlayRecordingSpeed {\n    return this.#speed.get();\n  }\n\n  set speed(speed: PlayRecordingSpeed) {\n    this.#speed.set(speed);\n  }\n\n  get replayExtension(): string {\n    return this.#replayExtension.get();\n  }\n\n  set replayExtension(replayExtension: string) {\n    this.#replayExtension.set(replayExtension);\n  }\n\n  get defaultTitle(): Common.UIString.LocalizedString {\n    const now = new Date();\n\n    return i18nString(UIStrings.defaultRecordingName, {\n      DATE: now.toLocaleDateString(),\n      TIME: now.toLocaleTimeString(),\n    });\n  }\n\n  get defaultSelectors(): SelectorType[] {\n    return Object.values(SelectorType)\n        .filter(\n            type => this.getSelectorByType(type),\n        );\n  }\n\n  getSelectorByType(type: SelectorType): boolean|undefined {\n    return this.#selectorTypes.get(type)?.get();\n  }\n\n  setSelectorByType(type: SelectorType, value: boolean): void {\n    this.#selectorTypes.get(type)?.set(value);\n  }\n\n  get preferredCopyFormat(): string {\n    return this.#preferredCopyFormat.get();\n  }\n\n  set preferredCopyFormat(value: string) {\n    this.#preferredCopyFormat.set(value);\n  }\n}\n", "// Copyright 2023 The Chromium Authors\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport type * as PuppeteerReplay from '../../../third_party/puppeteer-replay/puppeteer-replay.js';\n\nexport type UserFlow = PuppeteerReplay.Schema.UserFlow;\nexport type Step = PuppeteerReplay.Schema.Step;\nexport type NavigationEvent = PuppeteerReplay.Schema.NavigationEvent;\nexport type Target = PuppeteerReplay.Schema.Target;\nexport type FrameSelector = PuppeteerReplay.Schema.FrameSelector;\nexport type ChangeStep = PuppeteerReplay.Schema.ChangeStep;\nexport type ClickStep = PuppeteerReplay.Schema.ClickStep;\nexport type DoubleClickStep = PuppeteerReplay.Schema.DoubleClickStep;\nexport type HoverStep = PuppeteerReplay.Schema.HoverStep;\nexport type KeyDownStep = PuppeteerReplay.Schema.KeyDownStep;\nexport type KeyUpStep = PuppeteerReplay.Schema.KeyUpStep;\nexport type SetViewportStep = PuppeteerReplay.Schema.SetViewportStep;\nexport type EmulateNetworkConditionsStep = PuppeteerReplay.Schema.EmulateNetworkConditionsStep;\nexport type Selector = PuppeteerReplay.Schema.Selector;\nexport type StepWithSelectors = PuppeteerReplay.Schema.StepWithSelectors;\nexport type AssertedEvent = PuppeteerReplay.Schema.AssertedEvent;\nexport type NavigateStep = PuppeteerReplay.Schema.NavigateStep;\nexport type ScrollStep = PuppeteerReplay.Schema.ScrollStep;\nexport type AssertionStep = PuppeteerReplay.Schema.AssertionStep;\nexport type ClickAttributes = PuppeteerReplay.Schema.ClickAttributes;\nexport type Key = PuppeteerReplay.Schema.Key;\nexport {AssertedEventType, SelectorType, StepType} from '../../../third_party/puppeteer-replay/puppeteer-replay.js';\n", "// Copyright 2023 The Chromium Authors\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport * as UI from '../../../ui/legacy/legacy.js';\n\nexport class RecorderShortcutHelper {\n  #abortController: AbortController;\n  #timeoutId: ReturnType<typeof setTimeout>|null = null;\n  #timeout: number;\n\n  constructor(timeout = 200) {\n    this.#timeout = timeout;\n    this.#abortController = new AbortController();\n  }\n\n  #cleanInternals(): void {\n    this.#abortController.abort();\n    if (this.#timeoutId) {\n      clearTimeout(this.#timeoutId);\n    }\n    this.#abortController = new AbortController();\n  }\n\n  #handleCallback(callback: () => void): void {\n    this.#cleanInternals();\n    void callback();\n  }\n\n  handleShortcut(callback: () => void): void {\n    this.#cleanInternals();\n\n    document.addEventListener(\n        'keyup',\n        event => {\n          if (UI.KeyboardShortcut.KeyboardShortcut.eventHasCtrlEquivalentKey(event)) {\n            this.#handleCallback(callback);\n          }\n        },\n        {signal: this.#abortController.signal},\n    );\n\n    this.#timeoutId = setTimeout(\n        () => this.#handleCallback(callback),\n        this.#timeout,\n    );\n  }\n}\n", "// Copyright 2023 The Chromium Authors\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport * as Common from '../../../core/common/common.js';\nimport type * as Platform from '../../../core/platform/platform.js';\nimport * as SDK from '../../../core/sdk/sdk.js';\nimport type * as Protocol from '../../../generated/protocol.js';\nimport * as PuppeteerService from '../../../services/puppeteer/puppeteer.js';\nimport * as PuppeteerReplay from '../../../third_party/puppeteer-replay/puppeteer-replay.js';\nimport type * as puppeteer from '../../../third_party/puppeteer/puppeteer.js';\n\nimport type {Step, UserFlow} from './Schema.js';\n\nexport const enum PlayRecordingSpeed {\n  NORMAL = 'normal',\n  SLOW = 'slow',\n  VERY_SLOW = 'very_slow',\n  EXTREMELY_SLOW = 'extremely_slow',\n}\n\nconst speedDelayMap: Record<PlayRecordingSpeed, number> = {\n  [PlayRecordingSpeed.NORMAL]: 0,\n  [PlayRecordingSpeed.SLOW]: 500,\n  [PlayRecordingSpeed.VERY_SLOW]: 1000,\n  [PlayRecordingSpeed.EXTREMELY_SLOW]: 2000,\n} as const;\n\nexport const enum ReplayResult {\n  FAILURE = 'Failure',\n  SUCCESS = 'Success',\n}\n\nexport const defaultTimeout = 5000;  // ms\n\nfunction isPageTarget(target: Protocol.Target.TargetInfo): boolean {\n  // Treat DevTools targets as page targets too.\n  return (\n      Common.ParsedURL.schemeIs(target.url as Platform.DevToolsPath.UrlString, 'devtools:') || target.type === 'page' ||\n      target.type === 'background_page' || target.type === 'webview');\n}\n\nexport class RecordingPlayer extends Common.ObjectWrapper.ObjectWrapper<EventTypes> {\n  userFlow: UserFlow;\n  speed: PlayRecordingSpeed;\n  timeout: number;\n  breakpointIndexes: Set<number>;\n  steppingOver = false;\n  aborted = false;\n  #stopResolver = Promise.withResolvers<void>();\n  #abortResolver = Promise.withResolvers<void>();\n  #runner?: PuppeteerReplay.Runner;\n\n  constructor(\n      userFlow: UserFlow,\n      {\n        speed,\n        breakpointIndexes = new Set(),\n      }: {\n        speed: PlayRecordingSpeed,\n        breakpointIndexes?: Set<number>,\n      },\n  ) {\n    super();\n    this.userFlow = userFlow;\n    this.speed = speed;\n    this.timeout = userFlow.timeout || defaultTimeout;\n    this.breakpointIndexes = breakpointIndexes;\n  }\n\n  #resolveAndRefreshStopPromise(): void {\n    this.#stopResolver.resolve();\n    this.#stopResolver = Promise.withResolvers();\n  }\n\n  static async connectPuppeteer(): Promise<{\n    page: puppeteer.Page,\n    browser: puppeteer.Browser,\n  }> {\n    const rootTarget = SDK.TargetManager.TargetManager.instance().rootTarget();\n    if (!rootTarget) {\n      throw new Error('Could not find the root target');\n    }\n\n    const primaryPageTarget = SDK.TargetManager.TargetManager.instance().primaryPageTarget();\n    if (!primaryPageTarget) {\n      throw new Error('Could not find the primary page target');\n    }\n    const childTargetManager = primaryPageTarget.model(\n        SDK.ChildTargetManager.ChildTargetManager,\n    );\n    if (!childTargetManager) {\n      throw new Error('Could not get childTargetManager');\n    }\n    const resourceTreeModel = primaryPageTarget.model(\n        SDK.ResourceTreeModel.ResourceTreeModel,\n    );\n    if (!resourceTreeModel) {\n      throw new Error('Could not get resource tree model');\n    }\n    const mainFrame = resourceTreeModel.mainFrame;\n    if (!mainFrame) {\n      throw new Error('Could not find main frame');\n    }\n\n    const rootChildTargetManager = rootTarget.model(SDK.ChildTargetManager.ChildTargetManager);\n\n    if (!rootChildTargetManager) {\n      throw new Error('Could not find the child target manager class for the root target');\n    }\n\n    // Pass an empty message handler because it will be overwritten by puppeteer anyways.\n    const result = await rootChildTargetManager.createParallelConnection(() => {});\n    const connection = result.connection as SDK.Connections.ParallelConnectionInterface;\n\n    const mainTargetId = await childTargetManager.getParentTargetId();\n    const rootTargetId = await rootChildTargetManager.getParentTargetId();\n\n    const {page, browser, puppeteerConnection} =\n        await PuppeteerService.PuppeteerConnection.PuppeteerConnectionHelper.connectPuppeteerToConnectionViaTab(\n            {\n              connection,\n              rootTargetId: rootTargetId as string,\n              isPageTargetCallback: isPageTarget,\n            },\n        );\n\n    if (!page) {\n      throw new Error('could not find main page!');\n    }\n\n    browser.on('targetdiscovered', (targetInfo: Protocol.Target.TargetInfo) => {\n      // Pop-ups opened by the main target won't be auto-attached. Therefore,\n      // we need to create a session for them explicitly. We user openedId\n      // and type to classify a target as requiring a session.\n      if (targetInfo.type !== 'page') {\n        return;\n      }\n      if (targetInfo.targetId === mainTargetId) {\n        return;\n      }\n      if (targetInfo.openerId !== mainTargetId) {\n        return;\n      }\n      void puppeteerConnection._createSession(\n          targetInfo,\n          /* emulateAutoAttach= */ true,\n      );\n    });\n\n    return {page, browser};\n  }\n\n  static async disconnectPuppeteer(browser: puppeteer.Browser): Promise<void> {\n    try {\n      const pages = await browser.pages();\n      for (const page of pages) {\n        const client = (page as puppeteer.Page)._client();\n        await client.send('Network.disable');\n        await client.send('Page.disable');\n        await client.send('Log.disable');\n        await client.send('Performance.disable');\n        await client.send('Runtime.disable');\n        await client.send('Emulation.clearDeviceMetricsOverride');\n        await client.send('Emulation.setAutomationOverride', {enabled: false});\n        for (const frame of page.frames()) {\n          const client = frame.client;\n          await client.send('Network.disable');\n          await client.send('Page.disable');\n          await client.send('Log.disable');\n          await client.send('Performance.disable');\n          await client.send('Runtime.disable');\n          await client.send('Emulation.setAutomationOverride', {enabled: false});\n        }\n      }\n      await browser.disconnect();\n    } catch (err) {\n      console.error('Error disconnecting Puppeteer', err.message);\n    }\n  }\n\n  async stop(): Promise<void> {\n    await Promise.race([this.#stopResolver.promise, this.#abortResolver.promise]);\n  }\n\n  get abortPromise(): Promise<void> {\n    return this.#abortResolver.promise;\n  }\n\n  abort(): void {\n    this.aborted = true;\n    this.#abortResolver.resolve();\n    this.#runner?.abort();\n  }\n\n  disposeForTesting(): void {\n    this.#stopResolver.resolve();\n    this.#abortResolver.resolve();\n  }\n\n  continue(): void {\n    this.steppingOver = false;\n    this.#resolveAndRefreshStopPromise();\n  }\n\n  stepOver(): void {\n    this.steppingOver = true;\n    this.#resolveAndRefreshStopPromise();\n  }\n\n  updateBreakpointIndexes(breakpointIndexes: Set<number>): void {\n    this.breakpointIndexes = breakpointIndexes;\n  }\n\n  async play(): Promise<void> {\n    const {page, browser} = await RecordingPlayer.connectPuppeteer();\n    this.aborted = false;\n\n    const player = this;\n    class ExtensionWithBreak extends PuppeteerReplay.PuppeteerRunnerExtension {\n      readonly #speed: PlayRecordingSpeed;\n\n      constructor(\n          browser: puppeteer.Browser,\n          page: puppeteer.Page,\n          {\n            timeout,\n            speed,\n          }: {\n            timeout: number,\n            speed: PlayRecordingSpeed,\n          },\n      ) {\n        super(browser, page, {timeout});\n        this.#speed = speed;\n      }\n\n      override async beforeEachStep?(step: Step, flow: UserFlow): Promise<void> {\n        const {resolve, promise} = Promise.withResolvers<void>();\n        player.dispatchEventToListeners(Events.STEP, {\n          step,\n          resolve,\n        });\n        await promise;\n        const currentStepIndex = flow.steps.indexOf(step);\n        const shouldStopAtCurrentStep = player.steppingOver || player.breakpointIndexes.has(currentStepIndex);\n        const shouldWaitForSpeed = step.type !== 'setViewport' && step.type !== 'navigate' && !player.aborted;\n        if (shouldStopAtCurrentStep) {\n          player.dispatchEventToListeners(Events.STOP);\n          await player.stop();\n          player.dispatchEventToListeners(Events.CONTINUE);\n        } else if (shouldWaitForSpeed) {\n          await Promise.race([\n            new Promise(\n                resolve => setTimeout(resolve, speedDelayMap[this.#speed]),\n                ),\n            player.abortPromise,\n          ]);\n        }\n      }\n\n      override async runStep(\n          step: PuppeteerReplay.Schema.Step,\n          flow: PuppeteerReplay.Schema.UserFlow,\n          ): Promise<void> {\n        // When replaying on a DevTools target we skip setViewport and navigate steps\n        // because navigation and viewport changes are not supported there.\n        if (Common.ParsedURL.schemeIs(page?.url() as Platform.DevToolsPath.UrlString, 'devtools:') &&\n            (step.type === 'setViewport' || step.type === 'navigate')) {\n          return;\n        }\n        if (step.type === 'navigate' &&\n            Common.ParsedURL.schemeIs(step.url as Platform.DevToolsPath.UrlString, 'chrome:')) {\n          throw new Error('Not allowed to replay on chrome:// URLs');\n        }\n        // Focus the target in case it's not focused.\n        await this.page.bringToFront();\n        await super.runStep(step, flow);\n      }\n    }\n\n    const extension = new ExtensionWithBreak(browser, page, {\n      timeout: this.timeout,\n      speed: this.speed,\n    });\n\n    this.#runner = await PuppeteerReplay.createRunner(this.userFlow, extension);\n    let error: Error|undefined;\n\n    try {\n      await this.#runner.run();\n    } catch (err) {\n      error = err;\n      console.error('Replay error', err.message);\n    } finally {\n      await RecordingPlayer.disconnectPuppeteer(browser);\n    }\n    if (this.aborted) {\n      this.dispatchEventToListeners(Events.ABORT);\n    } else if (error) {\n      this.dispatchEventToListeners(Events.ERROR, error);\n    } else {\n      this.dispatchEventToListeners(Events.DONE);\n    }\n  }\n}\n\nexport const enum Events {\n  ABORT = 'Abort',\n  DONE = 'Done',\n  STEP = 'Step',\n  STOP = 'Stop',\n  ERROR = 'Error',\n  CONTINUE = 'Continue',\n}\n\ninterface EventTypes {\n  [Events.ABORT]: void;\n  [Events.DONE]: void;\n  [Events.STEP]: {step: Step, resolve: () => void};\n  [Events.STOP]: void;\n  [Events.CONTINUE]: void;\n  [Events.ERROR]: Error;\n}\n", "// Copyright 2023 The Chromium Authors\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport * as Common from '../../../core/common/common.js';\nimport * as Platform from '../../../core/platform/platform.js';\nimport * as SDK from '../../../core/sdk/sdk.js';\nimport type * as ProtocolProxyApi from '../../../generated/protocol-proxy-api.js';\nimport type * as Protocol from '../../../generated/protocol.js';\nimport * as UI from '../../../ui/legacy/legacy.js';\nimport type * as Injected from '../injected/injected.js';\nimport * as Util from '../util/util.js';\n\nimport {\n  AssertedEventType,\n  type ChangeStep,\n  type ClickStep,\n  type DoubleClickStep,\n  type FrameSelector,\n  type Key,\n  type KeyDownStep,\n  type KeyUpStep,\n  type NavigationEvent,\n  type SelectorType,\n  type Step,\n  StepType,\n  type Target,\n  type UserFlow,\n} from './Schema.js';\nimport {areSelectorsEqual, createEmulateNetworkConditionsStep, createViewportStep} from './SchemaUtils.js';\nimport {evaluateInAllFrames, getTargetFrameContext} from './SDKUtils.js';\n\nconst formatAsJSLiteral = Platform.StringUtilities.formatAsJSLiteral;\n\ninterface TargetInfoChangedEvent {\n  type: 'targetInfoChanged';\n  event: Common.EventTarget.EventTargetEvent<Protocol.Target.TargetInfo>;\n  target: SDK.Target.Target;\n}\n\ninterface TargetCreatedRecorderEvent {\n  type: 'targetCreated';\n  event: Common.EventTarget.EventTargetEvent<Protocol.Target.TargetInfo>;\n  target: SDK.Target.Target;\n}\n\ninterface TargetClosedRecorderEvent {\n  type: 'targetClosed';\n  event: Common.EventTarget.EventTargetEvent<Protocol.Target.TargetID>;\n  target: SDK.Target.Target;\n}\n\ninterface BindingCalledRecorderEvent {\n  type: 'bindingCalled';\n  event: Common.EventTarget.EventTargetEvent<Protocol.Runtime.BindingCalledEvent>;\n  target: SDK.Target.Target;\n  frameId: Protocol.Page.FrameId;\n}\n\ntype RecorderEvent =\n    |TargetInfoChangedEvent|TargetCreatedRecorderEvent|TargetClosedRecorderEvent|BindingCalledRecorderEvent;\n\nconst unrelatedNavigationTypes = new Set([\n  'typed',\n  'address_bar',\n  'auto_bookmark',\n  'auto_subframe',\n  'generated',\n  'auto_toplevel',\n  'reload',\n  'keyword',\n  'keyword_generated',\n]);\n\ninterface Shortcut {\n  meta: boolean;\n  ctrl: boolean;\n  shift: boolean;\n  alt: boolean;\n  keyCode: number;\n}\n\nconst createShortcuts = (descriptors: number[][]): Shortcut[] => {\n  const shortcuts: Shortcut[] = [];\n  for (const shortcut of descriptors) {\n    for (const key of shortcut) {\n      const shortcutBase = {meta: false, ctrl: false, shift: false, alt: false, keyCode: -1};\n\n      const {keyCode, modifiers} = UI.KeyboardShortcut.KeyboardShortcut.keyCodeAndModifiersFromKey(key);\n\n      shortcutBase.keyCode = keyCode;\n      const modifiersMap = UI.KeyboardShortcut.Modifiers;\n\n      shortcutBase.ctrl = Boolean(modifiers & modifiersMap.Ctrl.value);\n      shortcutBase.meta = Boolean(modifiers & modifiersMap.Meta.value);\n      shortcutBase.shift = Boolean(modifiers & modifiersMap.Shift.value);\n      shortcutBase.shift = Boolean(modifiers & modifiersMap.Alt.value);\n\n      if (shortcutBase.keyCode !== -1) {\n        shortcuts.push(shortcutBase);\n      }\n    }\n  }\n\n  return shortcuts;\n};\n\nconst evaluateInAllTargets =\n    async(worldName: string, targets: SDK.Target.Target[], expression: string): Promise<void> => {\n  await Promise.all(targets.map(target => evaluateInAllFrames(worldName, target, expression)));\n};\n\nconst RecorderBinding = Object.freeze({\n  addStep: 'addStep',\n  stopShortcut: 'stopShortcut',\n});\n\nexport class RecordingSession extends Common.ObjectWrapper.ObjectWrapper<EventTypes> {\n  readonly #target: SDK.Target.Target;\n  readonly #pageAgent: ProtocolProxyApi.PageApi;\n  readonly #targetAgent: ProtocolProxyApi.TargetApi;\n  readonly #networkManager: SDK.NetworkManager.MultitargetNetworkManager;\n  readonly #resourceTreeModel: SDK.ResourceTreeModel.ResourceTreeModel;\n  readonly #targets = new Map<string, SDK.Target.Target>();\n  readonly #lastNavigationEntryIdByTarget = new Map<string, number>();\n  readonly #lastNavigationHistoryByTarget = new Map<string, number[]>();\n  readonly #scriptIdentifiers = new Map<string, Protocol.Page.ScriptIdentifier>();\n  readonly #runtimeEventDescriptors = new Map<\n      SDK.Target.Target,\n      Array<Common.EventTarget.EventDescriptor<SDK.RuntimeModel.EventTypes, SDK.RuntimeModel.Events>>>();\n  readonly #childTargetEventDescriptors = new Map<\n      SDK.Target.Target,\n      Array<Common.EventTarget.EventDescriptor<SDK.ChildTargetManager.EventTypes, SDK.ChildTargetManager.Events>>>();\n  readonly #mutex = new Common.Mutex.Mutex();\n\n  #userFlow: UserFlow;\n  #stepsPendingNavigationByTargetId = new Map<string, Step>();\n  #started = false;\n  #selectorTypesToRecord: SelectorType[] = [];\n\n  constructor(target: SDK.Target.Target, opts: {\n    title: string,\n    selectorTypesToRecord: SelectorType[],\n    selectorAttribute?: string,\n  }) {\n    super();\n    this.#target = target;\n    this.#pageAgent = target.pageAgent();\n    this.#targetAgent = target.targetAgent();\n    this.#networkManager = SDK.NetworkManager.MultitargetNetworkManager.instance();\n    const resourceTreeModel = target.model(SDK.ResourceTreeModel.ResourceTreeModel);\n    if (!resourceTreeModel) {\n      throw new Error('ResourceTreeModel is missing for the target: ' + target.id());\n    }\n    this.#resourceTreeModel = resourceTreeModel;\n    this.#target = target;\n    this.#userFlow = {title: opts.title, selectorAttribute: opts.selectorAttribute, steps: []};\n    this.#selectorTypesToRecord = opts.selectorTypesToRecord;\n  }\n\n  /**\n   * @returns - A deep copy of the session's current user flow.\n   */\n  cloneUserFlow(): UserFlow {\n    return structuredClone(this.#userFlow);\n  }\n\n  /**\n   * Overwrites the session's current user flow with the given one.\n   *\n   * This method will not dispatch an `recordingupdated` event.\n   */\n  overwriteUserFlow(flow: Readonly<UserFlow>): void {\n    this.#userFlow = structuredClone(flow);\n  }\n\n  async start(): Promise<void> {\n    if (this.#started) {\n      throw new Error('The session has started');\n    }\n    this.#started = true;\n\n    this.#networkManager.addEventListener(\n        SDK.NetworkManager.MultitargetNetworkManager.Events.CONDITIONS_CHANGED, this.#appendCurrentNetworkStep, this);\n\n    await this.#appendInitialSteps();\n\n    // Focus the target so that events can be captured without additional actions.\n    await this.#pageAgent.invoke_bringToFront();\n\n    await this.#setUpTarget(this.#target);\n  }\n\n  async stop(): Promise<void> {\n    // Wait for any remaining updates.\n    await this.#dispatchRecordingUpdate();\n\n    // Create a deadlock for the remaining events.\n    void this.#mutex.acquire();\n\n    await Promise.all([...this.#targets.values()].map(this.#tearDownTarget));\n\n    this.#networkManager.removeEventListener(\n        SDK.NetworkManager.MultitargetNetworkManager.Events.CONDITIONS_CHANGED, this.#appendCurrentNetworkStep, this);\n  }\n\n  async #appendInitialSteps(): Promise<void> {\n    // Quick validation before doing anything.\n    const mainFrame = this.#resourceTreeModel.mainFrame;\n    if (!mainFrame) {\n      throw new Error('Could not find mainFrame.');\n    }\n\n    // Network step.\n    if (this.#networkManager.networkConditions() !== SDK.NetworkManager.NoThrottlingConditions) {\n      this.#appendCurrentNetworkStep();\n    }\n\n    // Viewport step.\n    const {cssLayoutViewport} = await this.#target.pageAgent().invoke_getLayoutMetrics();\n    this.#appendStep(createViewportStep(cssLayoutViewport));\n\n    // Navigation step.\n    const history = await this.#resourceTreeModel.navigationHistory();\n    if (history) {\n      const entry = history.entries[history.currentIndex];\n      this.#lastNavigationEntryIdByTarget.set(this.#target.id(), entry.id);\n      this.#lastNavigationHistoryByTarget.set(this.#target.id(), history.entries.map(entry => entry.id));\n      this.#userFlow.steps.push({\n        type: StepType.Navigate,\n        url: entry.url,\n        assertedEvents: [{type: AssertedEventType.Navigation, url: entry.url, title: entry.title}],\n      });\n    } else {\n      this.#userFlow.steps.push({\n        type: StepType.Navigate,\n        url: mainFrame.url,\n        assertedEvents: [\n          {type: AssertedEventType.Navigation, url: mainFrame.url, title: await this.#getDocumentTitle(this.#target)},\n        ],\n      });\n    }\n\n    // Commit\n    void this.#dispatchRecordingUpdate();\n  }\n\n  async #getDocumentTitle(target: SDK.Target.Target): Promise<string> {\n    const response = await target.runtimeAgent().invoke_evaluate({expression: 'document.title'});\n    return response.result?.value || '';\n  }\n\n  #appendCurrentNetworkStep(): void {\n    const networkConditions = this.#networkManager.networkConditions();\n    this.#appendStep(createEmulateNetworkConditionsStep(networkConditions));\n  }\n\n  #updateTimeout?: number;\n  #updateListeners: Array<() => void> = [];\n  #dispatchRecordingUpdate(): Promise<void> {\n    if (this.#updateTimeout) {\n      clearTimeout(this.#updateTimeout);\n    }\n    this.#updateTimeout = setTimeout(() => {\n                            // Making a copy to prevent mutations of this.userFlow by event consumers.\n                            this.dispatchEventToListeners(Events.RECORDING_UPDATED, structuredClone(this.#userFlow));\n                            this.#updateTimeout = undefined;\n                            for (const resolve of this.#updateListeners) {\n                              resolve();\n                            }\n                            this.#updateListeners.length = 0;\n                          }, 100) as unknown as number;\n    return new Promise<void>(resolve => {\n      this.#updateListeners.push(resolve);\n    });\n  }\n\n  get #previousStep(): Step|undefined {\n    return this.#userFlow.steps.slice(-1)[0];\n  }\n\n  /**\n   * Contains keys that are pressed related to a change step.\n   */\n  #pressedChangeKeys = new Set<Key>();\n\n  /**\n   * Shift-reduces a given step into the user flow.\n   */\n  #appendStep(step: Step): void {\n    switch (step.type) {\n      case 'doubleClick': {\n        for (let j = this.#userFlow.steps.length - 1; j > 0; j--) {\n          const previousStep = this.#userFlow.steps[j];\n          if (previousStep.type === 'click') {\n            step.selectors = previousStep.selectors;\n            this.#userFlow.steps.splice(j, 1);\n            break;\n          }\n        }\n        break;\n      }\n      case 'change': {\n        const previousStep = this.#previousStep;\n        if (!previousStep) {\n          break;\n        }\n        switch (previousStep.type) {\n          // Merging changes.\n          case 'change':\n            if (!areSelectorsEqual(step, previousStep)) {\n              break;\n            }\n            this.#userFlow.steps[this.#userFlow.steps.length - 1] = step;\n            void this.#dispatchRecordingUpdate();\n            return;\n          // Ignore key downs resulting in inputs.\n          case 'keyDown':\n            this.#pressedChangeKeys.add(previousStep.key);\n            this.#userFlow.steps.pop();\n            this.#appendStep(step);\n            return;\n        }\n        break;\n      }\n      case 'keyDown': {\n        // This can happen if there are successive keydown's from a repeated key\n        // for example.\n        if (this.#pressedChangeKeys.has(step.key)) {\n          return;\n        }\n        break;\n      }\n      case 'keyUp': {\n        // Ignore key ups coming from change inputs.\n        if (this.#pressedChangeKeys.has(step.key)) {\n          this.#pressedChangeKeys.delete(step.key);\n          return;\n        }\n        break;\n      }\n    }\n    this.#userFlow.steps.push(step);\n    void this.#dispatchRecordingUpdate();\n  }\n\n  #handleBeforeUnload(context: {frame: FrameSelector, target: Target}, sdkTarget: SDK.Target.Target): void {\n    const lastStep = this.#userFlow.steps[this.#userFlow.steps.length - 1];\n    if (lastStep && !lastStep.assertedEvents?.find(event => event.type === AssertedEventType.Navigation)) {\n      const target = context.target || 'main';\n      const frameSelector = (context.frame || []).join(',');\n      const lastStepTarget = lastStep.target || 'main';\n      const lastStepFrameSelector = (('frame' in lastStep ? lastStep.frame : []) || []).join(',');\n      if (target === lastStepTarget && frameSelector === lastStepFrameSelector) {\n        lastStep.assertedEvents = [{type: AssertedEventType.Navigation}];\n        this.#stepsPendingNavigationByTargetId.set(sdkTarget.id(), lastStep);\n        void this.#dispatchRecordingUpdate();\n      }\n    }\n  }\n\n  #replaceUnloadWithNavigation(target: SDK.Target.Target, event: NavigationEvent): void {\n    const stepPendingNavigation = this.#stepsPendingNavigationByTargetId.get(target.id());\n    if (!stepPendingNavigation) {\n      return;\n    }\n    const step = stepPendingNavigation;\n    if (!step.assertedEvents) {\n      return;\n    }\n    const navigationEvent = step.assertedEvents.find(event => event.type === AssertedEventType.Navigation);\n    if (!navigationEvent || navigationEvent.url) {\n      return;\n    }\n    navigationEvent.url = event.url;\n    navigationEvent.title = event.title;\n    void this.#dispatchRecordingUpdate();\n  }\n\n  #handleStopShortcutBinding(event: Common.EventTarget.EventTargetEvent<Protocol.Runtime.BindingCalledEvent>): void {\n    const shortcutLength = Number(event.data.payload);\n    // Look for one less step as the last one gets consumed before creating a step\n    for (let index = 0; index < shortcutLength - 1; index++) {\n      this.#userFlow.steps.pop();\n    }\n\n    this.dispatchEventToListeners(Events.RECORDING_STOPPED, structuredClone(this.#userFlow));\n  }\n\n  #receiveBindingCalled(\n      target: SDK.Target.Target,\n      event: Common.EventTarget.EventTargetEvent<Protocol.Runtime.BindingCalledEvent>): void {\n    switch (event.data.name) {\n      case RecorderBinding.stopShortcut:\n        this.#handleStopShortcutBinding(event);\n        return;\n      case RecorderBinding.addStep:\n        this.#handleAddStepBinding(target, event);\n        return;\n      default:\n        return;\n    }\n  }\n\n  #handleAddStepBinding(\n      target: SDK.Target.Target,\n      event: Common.EventTarget.EventTargetEvent<Protocol.Runtime.BindingCalledEvent>): void {\n    const executionContextId = event.data.executionContextId;\n    let frameId: Protocol.Page.FrameId|undefined;\n    const runtimeModel = target.model(SDK.RuntimeModel.RuntimeModel);\n    if (runtimeModel) {\n      for (const context of runtimeModel.executionContexts()) {\n        if (context.id === executionContextId) {\n          frameId = context.frameId;\n          break;\n        }\n      }\n    }\n    if (!frameId) {\n      throw new Error('No execution context found for the binding call + ' + JSON.stringify(event.data));\n    }\n\n    const step = JSON.parse(event.data.payload) as Injected.Step.Step;\n    const resourceTreeModel =\n        target.model(SDK.ResourceTreeModel.ResourceTreeModel) as SDK.ResourceTreeModel.ResourceTreeModel;\n    const frame = resourceTreeModel.frameForId(frameId);\n    if (!frame) {\n      throw new Error('Could not find frame.');\n    }\n\n    const context = getTargetFrameContext(target, frame);\n\n    if (step.type === 'beforeUnload') {\n      this.#handleBeforeUnload(context, target);\n      return;\n    }\n\n    // TODO: type-safe parsing from client steps to internal step format.\n    switch (step.type) {\n      case 'change': {\n        this.#appendStep({\n          type: 'change',\n          value: step.value,\n          selectors: step.selectors,\n          frame: context.frame.length ? context.frame : undefined,\n          target: context.target,\n        } as ChangeStep);\n        break;\n      }\n      case 'doubleClick': {\n        this.#appendStep({\n          type: 'doubleClick',\n          target: context.target,\n          selectors: step.selectors,\n          offsetY: step.offsetY,\n          offsetX: step.offsetX,\n          frame: context.frame.length ? context.frame : undefined,\n          deviceType: step.deviceType,\n          button: step.button,\n        } as DoubleClickStep);\n        break;\n      }\n      case 'click': {\n        this.#appendStep({\n          type: 'click',\n          target: context.target,\n          selectors: step.selectors,\n          offsetY: step.offsetY,\n          offsetX: step.offsetX,\n          frame: context.frame.length ? context.frame : undefined,\n          duration: step.duration,\n          deviceType: step.deviceType,\n          button: step.button,\n        } as ClickStep);\n        break;\n      }\n      case 'keyUp': {\n        this.#appendStep({\n          type: 'keyUp',\n          key: step.key,\n          frame: context.frame.length ? context.frame : undefined,\n          target: context.target,\n        } as KeyUpStep);\n        break;\n      }\n      case 'keyDown': {\n        this.#appendStep({\n          type: 'keyDown',\n          frame: context.frame.length ? context.frame : undefined,\n          target: context.target,\n          key: step.key,\n        } as KeyDownStep);\n        break;\n      }\n      default:\n        throw new Error('Unhandled client event');\n    }\n  }\n\n  #getStopShortcuts(): Shortcut[] {\n    const descriptors = UI.ShortcutRegistry.ShortcutRegistry.instance()\n                            .shortcutsForAction('chrome-recorder.start-recording')\n                            .map(key => key.descriptors.map(press => press.key));\n\n    return createShortcuts(descriptors);\n  }\n\n  static get #allowUntrustedEvents(): boolean {\n    try {\n      // This setting is set during the test to work around the fact that Puppeteer cannot\n      // send trusted change and input events.\n      Common.Settings.Settings.instance().settingForTest('untrusted-recorder-events');\n      return true;\n    } catch {\n    }\n    return false;\n  }\n\n  #setUpTarget = async(target: SDK.Target.Target): Promise<void> => {\n    if (target.type() !== SDK.Target.Type.FRAME) {\n      return;\n    }\n    this.#targets.set(target.id(), target);\n\n    const a11yModel = target.model(SDK.AccessibilityModel.AccessibilityModel);\n    Platform.assertNotNullOrUndefined(a11yModel);\n    await a11yModel.resumeModel();\n\n    await this.#addBindings(target);\n    await this.#injectApplicationScript(target);\n\n    const childTargetManager = target.model(SDK.ChildTargetManager.ChildTargetManager);\n    Platform.assertNotNullOrUndefined(childTargetManager);\n    this.#childTargetEventDescriptors.set(target, [\n      childTargetManager.addEventListener(\n          SDK.ChildTargetManager.Events.TARGET_CREATED, this.#receiveTargetCreated.bind(this, target)),\n      childTargetManager.addEventListener(\n          SDK.ChildTargetManager.Events.TARGET_DESTROYED, this.#receiveTargetClosed.bind(this, target)),\n      childTargetManager.addEventListener(\n          SDK.ChildTargetManager.Events.TARGET_INFO_CHANGED, this.#receiveTargetInfoChanged.bind(this, target)),\n    ]);\n\n    await Promise.all(childTargetManager.childTargets().map(this.#setUpTarget));\n  };\n\n  #tearDownTarget = async(target: SDK.Target.Target): Promise<void> => {\n    const descriptors = this.#childTargetEventDescriptors.get(target);\n    if (descriptors) {\n      Common.EventTarget.removeEventListeners(descriptors);\n    }\n\n    await this.#injectCleanUpScript(target);\n    await this.#removeBindings(target);\n  };\n\n  async #addBindings(target: SDK.Target.Target): Promise<void> {\n    const runtimeModel = target.model(SDK.RuntimeModel.RuntimeModel);\n    Platform.assertNotNullOrUndefined(runtimeModel);\n\n    this.#runtimeEventDescriptors.set(\n        target, [runtimeModel.addEventListener(\n                    SDK.RuntimeModel.Events.BindingCalled, this.#receiveBindingCalled.bind(this, target))]);\n\n    await Promise.all(\n        Object.values(RecorderBinding)\n            .map(name => runtimeModel.addBinding({name, executionContextName: Util.DEVTOOLS_RECORDER_WORLD_NAME})));\n  }\n\n  async #removeBindings(target: SDK.Target.Target): Promise<void> {\n    await Promise.all(Object.values(RecorderBinding).map(name => target.runtimeAgent().invoke_removeBinding({name})));\n\n    const descriptors = this.#runtimeEventDescriptors.get(target);\n    if (descriptors) {\n      Common.EventTarget.removeEventListeners(descriptors);\n    }\n  }\n\n  async #injectApplicationScript(target: SDK.Target.Target): Promise<void> {\n    const injectedScript = await Util.InjectedScript.get();\n    const script = `\n      ${injectedScript};DevToolsRecorder.startRecording({getAccessibleName, getAccessibleRole}, {\n        debug: ${Util.isDebugBuild},\n        allowUntrustedEvents: ${RecordingSession.#allowUntrustedEvents},\n        selectorTypesToRecord: ${JSON.stringify(this.#selectorTypesToRecord)},\n        selectorAttribute: ${\n        this.#userFlow.selectorAttribute ? formatAsJSLiteral(this.#userFlow.selectorAttribute) : undefined},\n        stopShortcuts: ${JSON.stringify(this.#getStopShortcuts())},\n      });\n    `;\n    const [{identifier}] = await Promise.all([\n      target.pageAgent().invoke_addScriptToEvaluateOnNewDocument(\n          {source: script, worldName: Util.DEVTOOLS_RECORDER_WORLD_NAME, includeCommandLineAPI: true}),\n      evaluateInAllFrames(Util.DEVTOOLS_RECORDER_WORLD_NAME, target, script),\n    ]);\n    this.#scriptIdentifiers.set(target.id(), identifier);\n  }\n\n  async #injectCleanUpScript(target: SDK.Target.Target): Promise<void> {\n    const scriptId = this.#scriptIdentifiers.get(target.id());\n    if (!scriptId) {\n      return;\n    }\n    await target.pageAgent().invoke_removeScriptToEvaluateOnNewDocument({identifier: scriptId});\n    await evaluateInAllTargets(\n        Util.DEVTOOLS_RECORDER_WORLD_NAME, [...this.#targets.values()], 'DevToolsRecorder.stopRecording()');\n  }\n\n  #receiveTargetCreated(\n      target: SDK.Target.Target, event: Common.EventTarget.EventTargetEvent<Protocol.Target.TargetInfo>): void {\n    void this.#handleEvent({type: 'targetCreated', event, target});\n  }\n\n  #receiveTargetClosed(\n      _eventTarget: SDK.Target.Target, event: Common.EventTarget.EventTargetEvent<Protocol.Target.TargetID>): void {\n    // TODO(alexrudenko): target here appears to be the parent target of the target that is closed.\n    // Therefore, we need to find the real target via the targets map.\n    const childTarget = this.#targets.get(event.data);\n    if (childTarget) {\n      void this.#handleEvent({type: 'targetClosed', event, target: childTarget});\n    }\n  }\n\n  #receiveTargetInfoChanged(\n      eventTarget: SDK.Target.Target, event: Common.EventTarget.EventTargetEvent<Protocol.Target.TargetInfo>): void {\n    const target = this.#targets.get(event.data.targetId) || eventTarget;\n    void this.#handleEvent({type: 'targetInfoChanged', event, target});\n  }\n\n  #handleEvent(event: RecorderEvent): Promise<void> {\n    return this.#mutex.run(async () => {\n      try {\n        if (Util.isDebugBuild) {\n          console.time(`Processing ${JSON.stringify(event)}`);\n        }\n        switch (event.type) {\n          case 'targetClosed':\n            await this.#handleTargetClosed(event);\n            break;\n          case 'targetCreated':\n            await this.#handleTargetCreated(event);\n            break;\n          case 'targetInfoChanged':\n            await this.#handleTargetInfoChanged(event);\n            break;\n        }\n        if (Util.isDebugBuild) {\n          console.timeEnd(`Processing ${JSON.stringify(event)}`);\n        }\n      } catch (err) {\n        console.error('Error happened while processing recording events: ', err.message, err.stack);\n      }\n    });\n  }\n\n  async #handleTargetCreated(event: TargetCreatedRecorderEvent): Promise<void> {\n    if (event.event.data.type !== 'page' && event.event.data.type !== 'iframe') {\n      return;\n    }\n\n    await this.#targetAgent.invoke_attachToTarget({targetId: event.event.data.targetId, flatten: true});\n    const target = SDK.TargetManager.TargetManager.instance().targets().find(t => t.id() === event.event.data.targetId);\n\n    if (!target) {\n      throw new Error('Could not find target.');\n    }\n    // Generally an new target implies all other targets are not waiting for something special in their event buffers, so we flush them here.\n    await this.#setUpTarget(target);\n    // Emitted for e2e tests.\n    window.dispatchEvent(new Event('recorderAttachedToTarget'));\n  }\n\n  async #handleTargetClosed(event: TargetClosedRecorderEvent): Promise<void> {\n    const stepPendingNavigation = this.#stepsPendingNavigationByTargetId.get(event.target.id());\n    if (stepPendingNavigation) {\n      delete stepPendingNavigation.assertedEvents;\n      this.#stepsPendingNavigationByTargetId.delete(event.target.id());\n    }\n    // TODO(alexrudenko): figure out how this works with sections\n    // TODO(alexrudenko): Ignore close events as they only matter for popups but cause more trouble than benefits\n    // const closeStep: CloseStep = {\n    //   type: 'close',\n    //   target: getTargetName(event.target),\n    // };\n    // this.appendStep(closeStep);\n  }\n\n  async #handlePageNavigation(resourceTreeModel: SDK.ResourceTreeModel.ResourceTreeModel, target: SDK.Target.Target):\n      Promise<boolean> {\n    const history = await resourceTreeModel.navigationHistory();\n    if (!history) {\n      return false;\n    }\n    const entry = history.entries[history.currentIndex];\n    const prevId = this.#lastNavigationEntryIdByTarget.get(target.id());\n    if (prevId === entry.id) {\n      return true;\n    }\n    this.#lastNavigationEntryIdByTarget.set(target.id(), entry.id);\n    const lastHistory = this.#lastNavigationHistoryByTarget.get(target.id()) || [];\n    this.#lastNavigationHistoryByTarget.set(target.id(), history.entries.map(entry => entry.id));\n    if (unrelatedNavigationTypes.has(entry.transitionType) || lastHistory.includes(entry.id)) {\n      const stepPendingNavigation = this.#stepsPendingNavigationByTargetId.get(target.id());\n      if (stepPendingNavigation) {\n        delete stepPendingNavigation.assertedEvents;\n        this.#stepsPendingNavigationByTargetId.delete(target.id());\n      }\n      this.#appendStep({\n        type: StepType.Navigate,\n        url: entry.url,\n        assertedEvents: [{type: AssertedEventType.Navigation, url: entry.url, title: entry.title}],\n      });\n    } else {\n      this.#replaceUnloadWithNavigation(\n          target, {type: AssertedEventType.Navigation, url: entry.url, title: entry.title});\n    }\n    return true;\n  }\n\n  async #handleTargetInfoChanged(event: TargetInfoChangedEvent): Promise<void> {\n    if (event.event.data.type !== 'page' && event.event.data.type !== 'iframe') {\n      return;\n    }\n\n    const target = event.target;\n    const resourceTreeModel = target.model(SDK.ResourceTreeModel.ResourceTreeModel);\n    if (!resourceTreeModel) {\n      throw new Error('ResourceTreeModel is missing in handleNavigation');\n    }\n\n    if (event.event.data.type === 'iframe') {\n      this.#replaceUnloadWithNavigation(\n          target,\n          {type: AssertedEventType.Navigation, url: event.event.data.url, title: await this.#getDocumentTitle(target)});\n    } else if (event.event.data.type === 'page') {\n      if (await this.#handlePageNavigation(resourceTreeModel, target)) {\n        return;\n      }\n      // Needed for #getDocumentTitle to return something meaningful.\n      await this.#waitForDOMContentLoadedWithTimeout(resourceTreeModel, 500);\n      this.#replaceUnloadWithNavigation(\n          target,\n          {type: AssertedEventType.Navigation, url: event.event.data.url, title: await this.#getDocumentTitle(target)});\n    }\n  }\n\n  async #waitForDOMContentLoadedWithTimeout(\n      resourceTreeModel: SDK.ResourceTreeModel.ResourceTreeModel, timeout: number): Promise<void> {\n    const {resolve: resolver, promise: contentLoadedPromise} = Promise.withResolvers<void>();\n\n    const onDomContentLoaded = (): void => {\n      resourceTreeModel.removeEventListener(SDK.ResourceTreeModel.Events.DOMContentLoaded, onDomContentLoaded);\n      resolver();\n    };\n    resourceTreeModel.addEventListener(SDK.ResourceTreeModel.Events.DOMContentLoaded, onDomContentLoaded);\n    await Promise.any([\n      contentLoadedPromise,\n      new Promise<void>(\n          resolve => setTimeout(\n              () => {\n                resourceTreeModel.removeEventListener(\n                    SDK.ResourceTreeModel.Events.DOMContentLoaded, onDomContentLoaded);\n                resolve();\n              },\n              timeout)),\n    ]);\n  }\n}\n\nexport const enum Events {\n  RECORDING_UPDATED = 'recordingupdated',\n  RECORDING_STOPPED = 'recordingstopped',\n}\n\ninterface EventTypes {\n  [Events.RECORDING_UPDATED]: UserFlow;\n  [Events.RECORDING_STOPPED]: UserFlow;\n}\n", "// Copyright 2023 The Chromium Authors\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport * as PuppeteerReplay from '../../../third_party/puppeteer-replay/puppeteer-replay.js';\n\nimport {\n  type EmulateNetworkConditionsStep,\n  type SetViewportStep,\n  type Step,\n  StepType,\n} from './Schema.js';\n\nexport function createViewportStep(viewport: {\n  clientWidth: number,\n  clientHeight: number,\n}): SetViewportStep {\n  return {\n    type: StepType.SetViewport,\n    width: viewport.clientWidth,\n    height: viewport.clientHeight,\n    // TODO read real parameters here\n    deviceScaleFactor: 1,\n    isMobile: false,\n    hasTouch: false,\n    isLandscape: false,\n  };\n}\n\nexport function createEmulateNetworkConditionsStep(conditions: {\n  download: number,\n  upload: number,\n  latency: number,\n}): EmulateNetworkConditionsStep {\n  return {\n    type: StepType.EmulateNetworkConditions,\n    download: conditions.download,\n    upload: conditions.upload,\n    latency: conditions.latency,\n  };\n}\n\nexport function areSelectorsEqual(stepA: Step, stepB: Step): boolean {\n  if ('selectors' in stepA && 'selectors' in stepB) {\n    return JSON.stringify(stepA.selectors) === JSON.stringify(stepB.selectors);\n  }\n  return !('selectors' in stepA) && !('selectors' in stepB);\n}\n\nexport const minTimeout = 1;\nexport const maxTimeout = 30000;\nexport const parse = PuppeteerReplay.parse;\nexport const parseStep = PuppeteerReplay.parseStep;\n", "// Copyright 2023 The Chromium Authors\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport * as SDK from '../../../core/sdk/sdk.js';\nimport type * as Protocol from '../../../generated/protocol.js';\n\nimport type {FrameSelector, Target} from './Schema.js';\n\ninterface Context {\n  target: Target;\n  frame: FrameSelector;\n}\n\nexport function getTargetName(target: SDK.Target.Target): string {\n  if (SDK.TargetManager.TargetManager.instance().primaryPageTarget() === target) {\n    return 'main';\n  }\n  return target.id() === 'main' ? 'main' : target.inspectedURL();\n}\n\n/**\n * Returns the context for an SDK target and frame.\n * The frame is identified by the path in the resource tree model.\n * And the target is identified by `getTargetName`.\n */\nexport function getTargetFrameContext(\n    target: SDK.Target.Target,\n    frame: SDK.ResourceTreeModel.ResourceTreeFrame,\n    ): Context {\n  const path = [];\n  while (frame) {\n    const parentFrame = frame.sameTargetParentFrame();\n    if (!parentFrame) {\n      break;\n    }\n    const childFrames = parentFrame.childFrames;\n    const index = childFrames.indexOf(frame);\n    path.unshift(index);\n    frame = parentFrame;\n  }\n\n  return {target: getTargetName(target), frame: path};\n}\n\nexport async function evaluateInAllFrames(\n    worldName: string,\n    target: SDK.Target.Target,\n    expression: string,\n    ): Promise<void> {\n  const runtimeModel = target.model(\n                           SDK.RuntimeModel.RuntimeModel,\n                           ) as SDK.RuntimeModel.RuntimeModel;\n  const executionContexts = runtimeModel.executionContexts();\n\n  const resourceTreeModel = target.model(\n                                SDK.ResourceTreeModel.ResourceTreeModel,\n                                ) as SDK.ResourceTreeModel.ResourceTreeModel;\n  for (const frame of resourceTreeModel.frames()) {\n    const executionContext = executionContexts.find(\n        context => context.frameId === frame.id,\n    );\n    if (!executionContext) {\n      continue;\n    }\n\n    // Note: it would return previously created world if it exists for the frame.\n    const {executionContextId} = await target.pageAgent().invoke_createIsolatedWorld({frameId: frame.id, worldName});\n    await target.runtimeAgent().invoke_evaluate({\n      expression,\n      includeCommandLineAPI: true,\n      contextId: executionContextId,\n    });\n  }\n}\n\nexport function findTargetByExecutionContext(\n    targets: Iterable<SDK.Target.Target>,\n    executionContextId: number,\n    ): SDK.Target.Target|undefined {\n  for (const target of targets) {\n    const runtimeModel = target.model(SDK.RuntimeModel.RuntimeModel);\n    if (!runtimeModel) {\n      continue;\n    }\n    for (const context of runtimeModel.executionContexts()) {\n      if (context.id === executionContextId) {\n        return target;\n      }\n    }\n  }\n  return;\n}\n\nexport function findFrameIdByExecutionContext(\n    targets: Iterable<SDK.Target.Target>,\n    executionContextId: number,\n    ): Protocol.Page.FrameId|undefined {\n  for (const target of targets) {\n    const runtimeModel = target.model(SDK.RuntimeModel.RuntimeModel);\n    if (!runtimeModel) {\n      continue;\n    }\n    for (const context of runtimeModel.executionContexts()) {\n      if (context.id === executionContextId && context.frameId !== undefined) {\n        return context.frameId;\n      }\n    }\n  }\n  return;\n}\n\nexport const isFrameTargetInfo = (\n    target: Protocol.Target.TargetInfo,\n    ): boolean => {\n  return target.type === 'page' || target.type === 'iframe';\n};\n", "// Copyright 2023 The Chromium Authors\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport type {EmulateNetworkConditionsStep, SetViewportStep} from './Schema.js';\n\nexport interface RecordingSettings {\n  viewportSettings?: SetViewportStep;\n  networkConditionsSettings?: EmulateNetworkConditionsStep&{\n    title?: string,\n    i18nTitleKey?: string,\n  };\n  timeout?: number;\n}\n", "// Copyright 2023 The Chromium Authors\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport * as Common from '../../../core/common/common.js';\n\nimport type {UserFlow} from './Schema.js';\n\nlet instance: RecordingStorage|null = null;\n\ninterface IdGenerator {\n  next(): string;\n}\n\nclass UUIDGenerator implements IdGenerator {\n  next(): string {\n    return crypto.randomUUID();\n  }\n}\n\nexport class RecordingStorage {\n  #recordingsSetting: Common.Settings.Setting<StoredRecording[]>;\n  #mutex = new Common.Mutex.Mutex();\n  #idGenerator: IdGenerator = new UUIDGenerator();\n\n  constructor() {\n    this.#recordingsSetting = Common.Settings.Settings.instance().createSetting(\n        'recorder-recordings-ng',\n        [],\n    );\n  }\n\n  clearForTest(): void {\n    this.#recordingsSetting.set([]);\n    this.#idGenerator = new UUIDGenerator();\n  }\n\n  setIdGeneratorForTest(idGenerator: IdGenerator): void {\n    this.#idGenerator = idGenerator;\n  }\n\n  async saveRecording(flow: UserFlow): Promise<StoredRecording> {\n    const release = await this.#mutex.acquire();\n    try {\n      const recordings = await this.#recordingsSetting.forceGet();\n      const storageName = this.#idGenerator.next();\n      const recording = {storageName, flow};\n      recordings.push(recording);\n      this.#recordingsSetting.set(recordings);\n      return recording;\n    } finally {\n      release();\n    }\n  }\n\n  async updateRecording(\n      storageName: string,\n      flow: UserFlow,\n      ): Promise<StoredRecording> {\n    const release = await this.#mutex.acquire();\n    try {\n      const recordings = await this.#recordingsSetting.forceGet();\n      const recording = recordings.find(\n          recording => recording.storageName === storageName,\n      );\n      if (!recording) {\n        throw new Error('No recording is found during updateRecording');\n      }\n      recording.flow = flow;\n      this.#recordingsSetting.set(recordings);\n      return recording;\n    } finally {\n      release();\n    }\n  }\n\n  async deleteRecording(storageName: string): Promise<void> {\n    const release = await this.#mutex.acquire();\n    try {\n      const recordings = await this.#recordingsSetting.forceGet();\n      this.#recordingsSetting.set(\n          recordings.filter(recording => recording.storageName !== storageName),\n      );\n    } finally {\n      release();\n    }\n  }\n\n  getRecording(storageName: string): StoredRecording|undefined {\n    const recordings = this.#recordingsSetting.get();\n    return recordings.find(\n        recording => recording.storageName === storageName,\n    );\n  }\n\n  getRecordings(): StoredRecording[] {\n    return this.#recordingsSetting.get();\n  }\n\n  static instance(): RecordingStorage {\n    if (!instance) {\n      instance = new RecordingStorage();\n    }\n    return instance;\n  }\n}\n\nexport interface StoredRecording {\n  storageName: string;\n  flow: UserFlow;\n}\n", "// Copyright 2023 The Chromium Authors\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport * as Common from '../../../core/common/common.js';\n\nexport type Screenshot = string&{_brand: 'ImageData'};\n\nexport interface ScreenshotMetaData {\n  recordingName: string;\n  index: number;\n  data: Screenshot;\n}\n\nlet instance: ScreenshotStorage|null = null;\n\n// Default size of storage\nconst DEFAULT_MAX_STORAGE_SIZE = 50 * 1024 * 1024;\n\n/**\n * This class stores the screenshots taken for a specific recording\n * in a settings object. The total storage size is limited to 50 MB\n * by default and the least recently accessed screenshots will be\n * deleted first.\n */\nexport class ScreenshotStorage {\n  #screenshotSettings: Common.Settings.Setting<ScreenshotMetaData[]>;\n  #screenshots: Map<string, ScreenshotMetaData>;\n  #maxStorageSize: number;\n\n  constructor(maxStorageSize = DEFAULT_MAX_STORAGE_SIZE) {\n    this.#screenshotSettings = Common.Settings.Settings.instance().createSetting(\n        'recorder-screenshots',\n        [],\n    );\n    this.#screenshots = this.#loadFromSettings();\n    this.#maxStorageSize = maxStorageSize;\n  }\n\n  clear(): void {\n    this.#screenshotSettings.set([]);\n    this.#screenshots = new Map();\n  }\n\n  getScreenshotForSection(\n      recordingName: string,\n      index: number,\n      ): Screenshot|null {\n    const screenshot = this.#screenshots.get(\n        this.#calculateKey(recordingName, index),\n    );\n    if (!screenshot) {\n      return null;\n    }\n\n    this.#syncWithSettings(screenshot);\n    return screenshot.data;\n  }\n\n  storeScreenshotForSection(\n      recordingName: string,\n      index: number,\n      data: Screenshot,\n      ): void {\n    const screenshot = {recordingName, index, data};\n    this.#screenshots.set(this.#calculateKey(recordingName, index), screenshot);\n    this.#syncWithSettings(screenshot);\n  }\n\n  deleteScreenshotsForRecording(recordingName: string): void {\n    for (const [key, entry] of this.#screenshots) {\n      if (entry.recordingName === recordingName) {\n        this.#screenshots.delete(key);\n      }\n    }\n\n    this.#syncWithSettings();\n  }\n\n  #calculateKey(recordingName: string, index: number): string {\n    return `${recordingName}:${index}`;\n  }\n\n  #loadFromSettings(): Map<string, ScreenshotMetaData> {\n    const screenshots = new Map<string, ScreenshotMetaData>();\n    const data = this.#screenshotSettings.get();\n    for (const item of data) {\n      screenshots.set(this.#calculateKey(item.recordingName, item.index), item);\n    }\n\n    return screenshots;\n  }\n\n  #syncWithSettings(modifiedScreenshot?: ScreenshotMetaData): void {\n    if (modifiedScreenshot) {\n      const key = this.#calculateKey(\n          modifiedScreenshot.recordingName,\n          modifiedScreenshot.index,\n      );\n\n      // Make sure that the modified screenshot is moved to the end of the map\n      // as the JS Map remembers the original insertion order of the keys.\n      this.#screenshots.delete(key);\n      this.#screenshots.set(key, modifiedScreenshot);\n    }\n\n    const screenshots = [];\n    let currentStorageSize = 0;\n\n    // Take screenshots from the end of the list until the size constraint is met.\n    for (const [key, screenshot] of Array\n             .from(\n                 this.#screenshots.entries(),\n                 )\n             .reverse()) {\n      if (currentStorageSize < this.#maxStorageSize) {\n        currentStorageSize += screenshot.data.length;\n        screenshots.push(screenshot);\n      } else {\n        // Delete all screenshots that exceed the storage limit.\n        this.#screenshots.delete(key);\n      }\n    }\n\n    this.#screenshotSettings.set(screenshots.reverse());\n  }\n\n  static instance(\n      opts: {\n        forceNew?: boolean|null,\n        maxStorageSize?: number,\n      } = {forceNew: null, maxStorageSize: DEFAULT_MAX_STORAGE_SIZE},\n      ): ScreenshotStorage {\n    const {forceNew, maxStorageSize} = opts;\n    if (!instance || forceNew) {\n      instance = new ScreenshotStorage(maxStorageSize);\n    }\n    return instance;\n  }\n}\n", "// Copyright 2023 The Chromium Authors\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n/* eslint-disable rulesdir/no-imperative-dom-api */\n\nimport * as SDK from '../../../core/sdk/sdk.js';\n\nimport type {Screenshot} from './ScreenshotStorage.js';\n\nconst SCREENSHOT_WIDTH = 160;       // px\nconst SCREENSHOT_MAX_HEIGHT = 240;  // px\n\nasync function captureScreenshot(): Promise<Screenshot> {\n  const mainTarget = SDK.TargetManager.TargetManager.instance().primaryPageTarget();\n  if (!mainTarget) {\n    throw new Error('Could not find main target');\n  }\n\n  const {data} = await mainTarget.pageAgent().invoke_captureScreenshot({});\n  if (!data) {\n    // 1x1 px empty image.\n    return 'data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7' as Screenshot;\n  }\n  return ('data:image/png;base64,' + data) as Screenshot;\n}\n\nexport async function resizeScreenshot(data: Screenshot): Promise<Screenshot> {\n  const img = new Image();\n  const promise = new Promise(resolve => {\n    img.onload = resolve;\n  });\n  img.src = data;\n  await promise;\n\n  const canvas = document.createElement('canvas');\n  const context = canvas.getContext('2d', {willReadFrequently: true});\n  if (!context) {\n    throw new Error('Could not create context.');\n  }\n  const aspectRatio = img.width / img.height;\n  canvas.width = SCREENSHOT_WIDTH;\n  canvas.height = Math.min(\n      SCREENSHOT_MAX_HEIGHT,\n      SCREENSHOT_WIDTH / aspectRatio,\n  );\n  const bitmap = await createImageBitmap(img, {\n    resizeWidth: SCREENSHOT_WIDTH,\n    resizeQuality: 'high',\n  });\n  context.drawImage(bitmap, 0, 0);\n\n  return canvas.toDataURL('image/png') as Screenshot;\n}\n\nexport async function takeScreenshot(): Promise<Screenshot> {\n  const data = await captureScreenshot();\n  return await resizeScreenshot(data);\n}\n", "// Copyright 2023 The Chromium Authors\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport type {Step} from './Schema.js';\nimport type {Screenshot} from './ScreenshotStorage.js';\n\nexport interface Section {\n  title: string;\n  steps: Step[];\n  url: string;\n  screenshot?: Screenshot;\n  causingStep?: Step;\n}\n\nfunction startNewSection(step: Step): Section|null {\n  const navigationEvent = step.assertedEvents?.find(\n      event => event.type === 'navigation',\n  );\n  if (step.type === 'navigate') {\n    return {\n      title: navigationEvent?.title || '',\n      url: step.url,\n      steps: [],\n      causingStep: step,\n    };\n  }\n  if (navigationEvent) {\n    return {\n      title: navigationEvent.title || '',\n      url: navigationEvent.url || '',\n      steps: [],\n    };\n  }\n  return null;\n}\n\nexport function buildSections(steps: Step[]): Section[] {\n  let currentSection: Section|null = null;\n  const sections: Section[] = [];\n  for (const step of steps) {\n    if (currentSection) {\n      currentSection.steps.push(step);\n    } else if (step.type === 'navigate') {\n      currentSection = startNewSection(step);\n      continue;\n    } else {\n      currentSection = {title: 'Current page', url: '', steps: [step]};\n    }\n    const nextSection = startNewSection(step);\n    if (nextSection) {\n      if (currentSection) {\n        sections.push(currentSection);\n      }\n      currentSection = nextSection;\n    }\n  }\n  if (currentSection && (!sections.length || currentSection.steps.length)) {\n    sections.push(currentSection);\n  }\n  return sections;\n}\n", "// Copyright 2023 The Chromium Authors\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport type * as Common from '../../../core/common/common.js';\nimport * as UI from '../../../ui/legacy/legacy.js';\n\nexport function getTooltipForActions(\n    translation: string|Common.UIString.LocalizedString,\n    action: string,\n    ): string {\n  let title: string = translation;\n  const shortcuts = UI.ShortcutRegistry.ShortcutRegistry.instance().shortcutsForAction(action);\n\n  for (const shortcut of shortcuts) {\n    title += ` - ${shortcut.title()}`;\n  }\n\n  return title;\n}\n"],
  "mappings": "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",
  "names": ["Common", "client", "browser", "page", "resolve", "Common", "SDK", "UI", "parse", "parseStep", "PuppeteerReplay", "parse", "parseStep", "SDK", "entry", "event", "context", "Common", "recording", "Common", "instance", "SDK", "UI"]
}
