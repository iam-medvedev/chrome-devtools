{"version":3,"file":"AnimationGroupPreviewUI.js","sourceRoot":"","sources":["../../../../../../front_end/panels/animation/AnimationGroupPreviewUI.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright 2015 The Chromium Authors\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport type * as SDK from '../../core/sdk/sdk.js';\nimport * as UI from '../../ui/legacy/legacy.js';\nimport * as Lit from '../../ui/lit/lit.js';\nimport * as VisualLogging from '../../ui/visual_logging/visual_logging.js';\n\nimport {AnimationUI} from './AnimationUI.js';\n\nconst {render, html, svg, Directives: {classMap, ref}} = Lit;\n\nconst VIEW_BOX_HEIGHT = 32;\nconst MAX_ANIMATION_LINES_TO_SHOW = 10;\nconst MIN_ANIMATION_GROUP_DURATION = 750;\n\ninterface ViewInput {\n  isScrollDrivenAnimationGroup: boolean;\n  isPreviewAnimationDisabled: boolean;\n  isSelected: boolean;\n  isPaused: boolean;\n  isFocusable: boolean;\n  label: string;\n  animationGroupDuration: number;\n  animations: SDK.AnimationModel.AnimationImpl[];\n  onPreviewAnimationEnd: () => void;\n  onRemoveAnimationGroup: () => void;\n  onSelectAnimationGroup: () => void;\n  onFocusNextGroup: () => void;\n  onFocusPreviousGroup: () => void;\n}\n\ninterface ViewOutput {\n  replay?: () => void;\n  focus?: () => void;\n}\n\ntype View = (input: ViewInput, output: ViewOutput, target: HTMLElement) => void;\n\nconst DEFAULT_VIEW: View = (input, output, target) => {\n  const classes = classMap({\n    'animation-buffer-preview': true,\n    selected: input.isSelected,\n    paused: input.isPaused,\n    'no-animation': input.isPreviewAnimationDisabled,\n  });\n\n  const handleKeyDown = (event: KeyboardEvent): void => {\n    switch (event.key) {\n      case 'Backspace':\n      case 'Delete':\n        input.onRemoveAnimationGroup();\n        break;\n      case 'ArrowLeft':\n      case 'ArrowUp':\n        input.onFocusPreviousGroup();\n        break;\n      case 'ArrowRight':\n      case 'ArrowDown':\n        input.onFocusNextGroup();\n    }\n  };\n\n  const renderAnimationLines = (): Lit.LitTemplate => {\n    const timeToPixelRatio = 100 / Math.max(input.animationGroupDuration, MIN_ANIMATION_GROUP_DURATION);\n    const viewBox = `0 0 100 ${VIEW_BOX_HEIGHT}`;\n    const lines = input.animations.map((animation, index) => {\n      const xStartPoint = animation.delayOrStartTime();\n      const xEndPoint = xStartPoint + animation.iterationDuration();\n      const yPoint = Math.floor(VIEW_BOX_HEIGHT / Math.max(6, input.animations.length) * index + 1);\n      const colorForAnimation = AnimationUI.colorForAnimation(animation);\n      // clang-format off\n      return svg`<line\n        x1=\"${xStartPoint * timeToPixelRatio}\"\n        x2=\"${xEndPoint * timeToPixelRatio}\"\n        y1=\"${yPoint}\"\n        y2=\"${yPoint}\"\n        style=\"stroke: ${colorForAnimation}\"></line>`;\n      // clang-format on\n    });\n\n    // clang-format off\n    return html`\n      <svg\n        width=\"100%\"\n        height=\"100%\"\n        viewBox=${viewBox}\n        preserveAspectRatio=\"none\"\n        shape-rendering=\"crispEdges\">\n        ${lines}\n      </svg>\n    `;\n    // clang-format on\n  };\n\n  // clang-format off\n  render(html`\n    <div class=\"animation-group-preview-ui\">\n      <button\n        jslog=${VisualLogging.item(`animations.buffer-preview${input.isScrollDrivenAnimationGroup ? '-sda' : ''}`).track({click: true})}\n        class=${classes}\n        role=\"option\"\n        aria-label=${input.label}\n        tabindex=${input.isFocusable ? 0 : -1}\n        @keydown=${handleKeyDown}\n        @click=${input.onSelectAnimationGroup}\n        @animationend=${input.onPreviewAnimationEnd}\n        ${ref(el => {\n          if (el instanceof HTMLElement) {\n            output.focus = () => {\n              el.focus();\n            };\n          }\n        })}>\n          <div class=\"animation-paused fill\"></div>\n          <devtools-icon name=${input.isScrollDrivenAnimationGroup ? 'mouse' : 'watch'} class=\"preview-icon\"></devtools-icon>\n          <div class=\"animation-buffer-preview-animation\" ${ref(el => {\n            if (el instanceof HTMLElement) {\n              output.replay = () => {\n                el.animate(\n                  [\n                    {offset: 0, width: '0%', opacity: 1},\n                    {offset: 0.9, width: '100%', opacity: 1},\n                    {offset: 1, width: '100%', opacity: 0},\n                  ],\n                  {duration: 200, easing: 'cubic-bezier(0, 0, 0.2, 1)'}\n                );\n              };\n            }\n          })}></div>\n          ${renderAnimationLines()}\n        </button>\n        <button\n          class=\"animation-remove-button\"\n          jslog=${VisualLogging.action('animations.remove-preview').track({click: true})}\n          @click=${input.onRemoveAnimationGroup}>\n            <devtools-icon name=\"cross\"></devtools-icon>\n        </button>\n    </div>\n  `, target);\n  // clang-format on\n};\n\ninterface AnimationGroupPreviewConfig {\n  animationGroup: SDK.AnimationModel.AnimationGroup;\n  label: string;\n  onRemoveAnimationGroup: () => void;\n  onSelectAnimationGroup: () => void;\n  onFocusNextGroup: () => void;\n  onFocusPreviousGroup: () => void;\n}\n\nexport class AnimationGroupPreviewUI extends UI.Widget.Widget {\n  #view: View;\n  #viewOutput: ViewOutput = {};\n  #config: AnimationGroupPreviewConfig;\n  #previewAnimationDisabled = false;\n  #selected = false;\n  #paused = false;\n  #focusable = false;\n\n  constructor(config: AnimationGroupPreviewConfig, view = DEFAULT_VIEW) {\n    super();\n    this.#view = view;\n    this.#config = config;\n    this.requestUpdate();\n  }\n\n  setSelected(selected: boolean): void {\n    if (this.#selected === selected) {\n      return;\n    }\n\n    this.#selected = selected;\n    this.requestUpdate();\n  }\n\n  setPaused(paused: boolean): void {\n    if (this.#paused === paused) {\n      return;\n    }\n\n    this.#paused = paused;\n    this.requestUpdate();\n  }\n\n  setFocusable(focusable: boolean): void {\n    if (this.#focusable === focusable) {\n      return;\n    }\n\n    this.#focusable = focusable;\n    this.requestUpdate();\n  }\n\n  override performUpdate(): void {\n    this.#view(\n        {\n          isScrollDrivenAnimationGroup: this.#config.animationGroup.isScrollDriven(),\n          isPreviewAnimationDisabled: this.#previewAnimationDisabled,\n          isSelected: this.#selected,\n          isPaused: this.#paused,\n          isFocusable: this.#focusable,\n          label: this.#config.label,\n          animationGroupDuration: this.#config.animationGroup.groupDuration(),\n          animations: this.#config.animationGroup.animations().slice(0, MAX_ANIMATION_LINES_TO_SHOW),\n          onPreviewAnimationEnd: () => {\n            this.#previewAnimationDisabled = true;\n            this.requestUpdate();\n          },\n          onRemoveAnimationGroup: () => {\n            this.#config.onRemoveAnimationGroup();\n          },\n          onSelectAnimationGroup: () => {\n            this.#config.onSelectAnimationGroup();\n          },\n          onFocusNextGroup: () => {\n            this.#config.onFocusNextGroup();\n          },\n          onFocusPreviousGroup: () => {\n            this.#config.onFocusPreviousGroup();\n          }\n        },\n        this.#viewOutput, this.contentElement);\n  }\n\n  override focus(): void {\n    this.#viewOutput.focus?.();\n  }\n\n  replay(): void {\n    this.#viewOutput.replay?.();\n  }\n}\n"]}