{"version":3,"file":"SelectWorkspaceDialog.test.js","sourceRoot":"","sources":["../../../../../../front_end/panels/ai_assistance/SelectWorkspaceDialog.test.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright 2025 The Chromium Authors. All rights reserved.\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport * as Persistence from '../../models/persistence/persistence.js';\nimport * as Workspace from '../../models/workspace/workspace.js';\nimport {createTestFilesystem, setupAutomaticFileSystem} from '../../testing/AiAssistanceHelpers.js';\nimport {assertScreenshot, renderElementIntoDOM, setColorScheme} from '../../testing/DOMHelpers.js';\nimport {describeWithEnvironment} from '../../testing/EnvironmentHelpers.js';\nimport {createViewFunctionStub, type ViewFunctionStub} from '../../testing/ViewFunctionHelpers.js';\nimport * as UI from '../../ui/legacy/legacy.js';\n\nimport * as AiAssistance from './ai_assistance.js';\n\ndescribeWithEnvironment('SelectWorkspaceDialog', () => {\n  const root = '/path/to/my-automatic-file-system';\n\n  beforeEach(() => {\n    setupAutomaticFileSystem();\n  });\n\n  afterEach(() => {\n    const workspace = Workspace.Workspace.WorkspaceImpl.instance();\n    for (const project of workspace.projects()) {\n      workspace.removeProject(project);\n    }\n    Persistence.AutomaticFileSystemManager.AutomaticFileSystemManager.removeInstance();\n  });\n\n  async function createComponent(): Promise<{\n    view: ViewFunctionStub<typeof AiAssistance.SelectWorkspaceDialog>,\n    component: AiAssistance.SelectWorkspaceDialog,\n    onProjectSelected: sinon.SinonSpy<[Workspace.Workspace.Project], void>,\n    hideDialogSpy: sinon.SinonSpy<[], void>,\n    project: Persistence.FileSystemWorkspaceBinding.FileSystem,\n  }> {\n    createTestFilesystem('file://test1');\n    const {project} = createTestFilesystem('file://test2');\n    const dialog = new UI.Dialog.Dialog('select-workspace');\n    const hideDialogSpy = sinon.spy(dialog, 'hide');\n\n    const view = createViewFunctionStub(AiAssistance.SelectWorkspaceDialog);\n    const onProjectSelected = sinon.spy() as sinon.SinonSpy<[Workspace.Workspace.Project], void>;\n    const component = new AiAssistance.SelectWorkspaceDialog({dialog, onProjectSelected}, view);\n    component.markAsRoot();\n    const container = document.createElement('div');\n    renderElementIntoDOM(container);\n    component.show(container);\n    await view.nextInput;\n    sinon.assert.callCount(view, 1);\n    assert.strictEqual(view.input.selectedIndex, 0);\n\n    return {view, component, onProjectSelected, hideDialogSpy, project};\n  }\n\n  describe('screenshots', () => {\n    function renderViewForScreenshots() {\n      const noop = () => {};\n      const target = document.createElement('div');\n      target.style.maxWidth = '420px';\n      target.style.maxHeight = '600px';\n      target.style.padding = '12px';\n      renderElementIntoDOM(target);\n      AiAssistance.SELECT_WORKSPACE_DIALOG_DEFAULT_VIEW(\n          {\n            folders: [\n              {\n                name: 'workspace-project',\n                path: 'workspace-project',\n              },\n              {\n                name: 'another-project',\n                path: 'another-project',\n              }\n            ],\n            selectedIndex: 0,\n            showAutomaticWorkspaceNudge: false,\n            onProjectSelected: noop,\n            onSelectButtonClick: noop,\n            onCancelButtonClick: noop,\n            onAddFolderButtonClick: noop,\n            onListItemKeyDown: noop,\n          },\n          undefined, target);\n    }\n\n    it('should render correctly in light mode', async () => {\n      renderViewForScreenshots();\n      await assertScreenshot('ai_assistance/select-workspace-dialog-light-default.png');\n    });\n\n    it('should render correctly in dark mode', async () => {\n      setColorScheme('dark');\n      renderViewForScreenshots();\n      await assertScreenshot('ai_assistance/select-workspace-dialog-dark-default.png');\n    });\n  });\n\n  it('selects a project', async () => {\n    const {view, onProjectSelected, hideDialogSpy, project} = await createComponent();\n    view.input.onProjectSelected(1);\n    const input = await view.nextInput;\n    sinon.assert.callCount(view, 2);\n    assert.strictEqual(input.selectedIndex, 1);\n\n    view.input.onSelectButtonClick();\n    assert.isTrue(onProjectSelected.calledOnceWith(project));\n    sinon.assert.calledOnce(hideDialogSpy);\n  });\n\n  it('can be canceled', async () => {\n    const {view, onProjectSelected, hideDialogSpy} = await createComponent();\n    view.input.onProjectSelected(1);\n    const input = await view.nextInput;\n    sinon.assert.callCount(view, 2);\n    assert.strictEqual(input.selectedIndex, 1);\n\n    view.input.onCancelButtonClick();\n    sinon.assert.notCalled(onProjectSelected);\n    sinon.assert.calledOnce(hideDialogSpy);\n  });\n\n  it('listens to ArrowUp/Down', async () => {\n    const {view} = await createComponent();\n    view.input.onListItemKeyDown(new KeyboardEvent('keydown', {key: 'ArrowDown'}));\n    let input = await view.nextInput;\n    sinon.assert.callCount(view, 2);\n    assert.strictEqual(input.selectedIndex, 1);\n\n    view.input.onListItemKeyDown(new KeyboardEvent('keydown', {key: 'ArrowUp'}));\n    input = await view.nextInput;\n    sinon.assert.callCount(view, 3);\n    assert.strictEqual(input.selectedIndex, 0);\n  });\n\n  it('can add projects', async () => {\n    const addProjectSpy =\n        sinon.spy(Persistence.IsolatedFileSystemManager.IsolatedFileSystemManager.instance(), 'addFileSystem');\n    const {view} = await createComponent();\n    sinon.assert.callCount(view, 1);\n    assert.lengthOf(view.input.folders, 2);\n    assert.strictEqual(view.input.selectedIndex, 0);\n\n    view.input.onAddFolderButtonClick();\n    sinon.assert.calledOnce(addProjectSpy);\n\n    createTestFilesystem('file://test3');\n    const input = await view.nextInput;\n    sinon.assert.callCount(view, 2);\n    assert.lengthOf(input.folders, 3);\n    assert.strictEqual(input.folders[2].name, 'test3');\n    assert.strictEqual(input.selectedIndex, 2);\n  });\n\n  it('handles project removal', async () => {\n    const addProjectSpy =\n        sinon.spy(Persistence.IsolatedFileSystemManager.IsolatedFileSystemManager.instance(), 'addFileSystem');\n    const {view, project} = await createComponent();\n\n    view.input.onProjectSelected(1);\n    let input = await view.nextInput;\n    sinon.assert.callCount(view, 2);\n    assert.lengthOf(input.folders, 2);\n    assert.strictEqual(input.selectedIndex, 1);\n\n    input.onAddFolderButtonClick();\n    sinon.assert.calledOnce(addProjectSpy);\n\n    Workspace.Workspace.WorkspaceImpl.instance().removeProject(project);\n    input = await view.nextInput;\n    assert.lengthOf(input.folders, 1);\n    assert.strictEqual(input.selectedIndex, 0);\n  });\n\n  it('allows selecting an automatic workspace', async () => {\n    setupAutomaticFileSystem({hasFileSystem: true});\n    const {view, onProjectSelected, hideDialogSpy} = await createComponent();\n\n    sinon.assert.callCount(view, 1);\n    assert.lengthOf(view.input.folders, 3);\n    assert.strictEqual(view.input.selectedIndex, 0);\n    assert.strictEqual(view.input.folders[0].name, 'my-automatic-file-system');\n\n    view.input.onSelectButtonClick();\n    await new Promise(resolve => setTimeout(resolve, 0));\n    const {project: automaticFileSystemProject} = createTestFilesystem(`file://${root}`);\n\n    assert.isTrue(onProjectSelected.calledOnceWith(automaticFileSystemProject));\n    sinon.assert.calledOnce(hideDialogSpy);\n  });\n});\n"]}