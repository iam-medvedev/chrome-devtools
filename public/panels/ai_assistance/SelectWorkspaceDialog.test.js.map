{"version":3,"file":"SelectWorkspaceDialog.test.js","sourceRoot":"","sources":["../../../../../../front_end/panels/ai_assistance/SelectWorkspaceDialog.test.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright 2025 The Chromium Authors. All rights reserved.\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport * as Persistence from '../../models/persistence/persistence.js';\nimport type * as Workspace from '../../models/workspace/workspace.js';\nimport {createTestFilesystem} from '../../testing/AiAssistanceHelpers.js';\nimport {dispatchKeyDownEvent} from '../../testing/DOMHelpers.js';\nimport {describeWithEnvironment} from '../../testing/EnvironmentHelpers.js';\nimport {createViewFunctionStub, type ViewFunctionStub} from '../../testing/ViewFunctionHelpers.js';\nimport * as UI from '../../ui/legacy/legacy.js';\n\nimport * as AiAssistance from './ai_assistance.js';\n\ndescribeWithEnvironment('SelectWorkspaceDialog', () => {\n  function createComponent(): {\n    view: ViewFunctionStub<typeof AiAssistance.SelectWorkspaceDialog>,\n    component: AiAssistance.SelectWorkspaceDialog,\n    handleProjectSelected: sinon.SinonSpy<[Workspace.Workspace.Project], void>,\n    hideDialogSpy: sinon.SinonSpy<[], void>,\n    project: Persistence.FileSystemWorkspaceBinding.FileSystem,\n  } {\n    createTestFilesystem('file://test1');\n    const {project} = createTestFilesystem('file://test2');\n    const dialog = new UI.Dialog.Dialog('select-workspace');\n    const hideDialogSpy = sinon.spy(dialog, 'hide');\n\n    const view = createViewFunctionStub(AiAssistance.SelectWorkspaceDialog);\n    const handleProjectSelected = sinon.spy() as sinon.SinonSpy<[Workspace.Workspace.Project], void>;\n    const component = new AiAssistance.SelectWorkspaceDialog({dialog, handleProjectSelected}, view);\n    component.markAsRoot();\n    component.show(document.body);\n    assert.strictEqual(view.callCount, 1);\n    assert.strictEqual(view.input.selectedIndex, 0);\n\n    return {view, component, handleProjectSelected, hideDialogSpy, project};\n  }\n\n  it('selects a project', async () => {\n    const {view, handleProjectSelected, hideDialogSpy, project} = createComponent();\n    view.input.onProjectSelected(1);\n    const input = await view.nextInput;\n    assert.strictEqual(view.callCount, 2);\n    assert.strictEqual(input.selectedIndex, 1);\n\n    view.input.onSelectButtonClick();\n    assert.isTrue(handleProjectSelected.calledOnceWith(project));\n    assert.isTrue(hideDialogSpy.calledOnce);\n  });\n\n  it('can be canceled', async () => {\n    const {view, handleProjectSelected, hideDialogSpy} = createComponent();\n    view.input.onProjectSelected(1);\n    const input = await view.nextInput;\n    assert.strictEqual(view.callCount, 2);\n    assert.strictEqual(input.selectedIndex, 1);\n\n    view.input.onCancelButtonClick();\n    assert.isTrue(handleProjectSelected.notCalled);\n    assert.isTrue(hideDialogSpy.calledOnce);\n  });\n\n  it('listens to ArrowUp/Down', async () => {\n    const {view, component} = createComponent();\n    dispatchKeyDownEvent(component.element, {key: 'ArrowDown', bubbles: true, composed: true});\n    let input = await view.nextInput;\n    assert.strictEqual(view.callCount, 2);\n    assert.strictEqual(input.selectedIndex, 1);\n\n    dispatchKeyDownEvent(component.element, {key: 'ArrowUp', bubbles: true, composed: true});\n    input = await view.nextInput;\n    assert.strictEqual(view.callCount, 3);\n    assert.strictEqual(input.selectedIndex, 0);\n  });\n\n  it('can add projects', async () => {\n    const addProjectSpy =\n        sinon.spy(Persistence.IsolatedFileSystemManager.IsolatedFileSystemManager.instance(), 'addFileSystem');\n    const {view} = createComponent();\n    assert.strictEqual(view.callCount, 1);\n    assert.lengthOf(view.input.projects, 2);\n    view.input.onAddFolderButtonClick();\n    assert.isTrue(addProjectSpy.calledOnce);\n\n    createTestFilesystem('file://test3');\n    const input = await view.nextInput;\n    assert.strictEqual(view.callCount, 2);\n    assert.lengthOf(input.projects, 3);\n  });\n});\n"]}