{"version":3,"file":"PatchWidget.test.js","sourceRoot":"","sources":["../../../../../../front_end/panels/ai_assistance/PatchWidget.test.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright 2025 The Chromium Authors. All rights reserved.\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport * as Common from '../../core/common/common.js';\nimport * as Host from '../../core/host/host.js';\nimport * as Root from '../../core/root/root.js';\nimport * as AiAssistanceModel from '../../models/ai_assistance/ai_assistance.js';\nimport type * as Persistence from '../../models/persistence/persistence.js';\nimport * as Workspace from '../../models/workspace/workspace.js';\nimport * as PanelCommon from '../../panels/common/common.js';\nimport {\n  cleanup,\n  createPatchWidget,\n  createPatchWidgetWithDiffView,\n  createTestFilesystem,\n  initializePersistenceImplForTests,\n  MockAidaAbortError,\n  mockAidaClient,\n  MockAidaFetchError,\n  setupAutomaticFileSystem,\n} from '../../testing/AiAssistanceHelpers.js';\nimport {updateHostConfig} from '../../testing/EnvironmentHelpers.js';\nimport {expectCall} from '../../testing/ExpectStubCall.js';\nimport {describeWithMockConnection} from '../../testing/MockConnection.js';\n\nimport * as AiAssistance from './ai_assistance.js';\n\ndescribeWithMockConnection('PatchWidget', () => {\n  let showFreDialogStub: sinon.SinonStub<Parameters<typeof PanelCommon.FreDialog.show>, Promise<boolean>>;\n  beforeEach(() => {\n    Common.Settings.moduleSetting('ai-assistance-patching-fre-completed').set(true);\n    showFreDialogStub = sinon.stub(PanelCommon.FreDialog, 'show');\n\n    initializePersistenceImplForTests();\n    setupAutomaticFileSystem();\n  });\n\n  afterEach(() => {\n    cleanup();\n  });\n\n  describe('applyToWorkspace', () => {\n    beforeEach(() => {\n      createTestFilesystem('file://test');\n      Common.Settings.Settings.instance().createSetting('ai-assistance-patching-selected-project-id', 'file://test');\n      updateHostConfig({\n        devToolsFreestyler: {\n          enabled: true,\n          patching: true,\n        },\n      });\n    });\n\n    describe('enterprise text cases', () => {\n      it('should FRE text include no logging case when the enterprise policy value is ALLOW_WITHOUT_LOGGING',\n         async () => {\n           Common.Settings.moduleSetting('ai-assistance-patching-fre-completed').set(false);\n           updateHostConfig({\n             devToolsFreestyler: {\n               enabled: true,\n               patching: true,\n             },\n             aidaAvailability: {enterprisePolicyValue: Root.Runtime.GenAiEnterprisePolicyValue.ALLOW_WITHOUT_LOGGING}\n           });\n           const {view, widget} = await createPatchWidget();\n           widget.changeSummary = 'body { background-color: red; }';\n\n           view.input.onApplyToWorkspace();\n\n           assert.isTrue(showFreDialogStub.called, 'Expected FreDialog to be shown but it\\'s not shown');\n           assert.exists(showFreDialogStub.lastCall.args[0].reminderItems.find(\n               reminderItem => reminderItem.content.toString().includes(\n                   'This data will not be used to improve Google’s AI models.')));\n         });\n\n      it('should FRE text not include no logging case when the enterprise policy value is ALLOW_WITHOUT_LOGGING',\n         async () => {\n           Common.Settings.moduleSetting('ai-assistance-patching-fre-completed').set(false);\n           updateHostConfig({\n             devToolsFreestyler: {\n               enabled: true,\n               patching: true,\n             },\n             aidaAvailability: {enterprisePolicyValue: Root.Runtime.GenAiEnterprisePolicyValue.ALLOW}\n           });\n           const {view, widget} = await createPatchWidget();\n           widget.changeSummary = 'body { background-color: red; }';\n\n           view.input.onApplyToWorkspace();\n\n           assert.isTrue(showFreDialogStub.called, 'Expected FreDialog to be shown but it\\'s not shown');\n           assert.notExists(showFreDialogStub.lastCall.args[0].reminderItems.find(\n               reminderItem => reminderItem.content.toString().includes(\n                   'This data will not be used to improve Google’s AI models.')));\n         });\n\n      it('should tooltip text include no logging case when the enterprise policy value is ALLOW_WITHOUT_LOGGING',\n         async () => {\n           Common.Settings.moduleSetting('ai-assistance-patching-fre-completed').set(false);\n           updateHostConfig({\n             devToolsFreestyler: {\n               enabled: true,\n               patching: true,\n             },\n             aidaAvailability: {enterprisePolicyValue: Root.Runtime.GenAiEnterprisePolicyValue.ALLOW_WITHOUT_LOGGING}\n           });\n           const {view} = await createPatchWidget();\n\n           assert.include(\n               view.input.applyToWorkspaceTooltipText, 'This data will not be used to improve Google’s AI models.');\n         });\n\n      it('should tooltip text not include no logging case when the enterprise policy value is ALLOW', async () => {\n        Common.Settings.moduleSetting('ai-assistance-patching-fre-completed').set(false);\n        updateHostConfig({\n          devToolsFreestyler: {\n            enabled: true,\n            patching: true,\n          },\n          aidaAvailability: {enterprisePolicyValue: Root.Runtime.GenAiEnterprisePolicyValue.ALLOW}\n        });\n        const {view} = await createPatchWidget();\n\n        assert.notInclude(\n            view.input.applyToWorkspaceTooltipText, 'This data will not be used to improve Google’s AI models.');\n      });\n    });\n\n    it('should show FRE dialog on applyToWorkspace click if the setting is false', async () => {\n      Common.Settings.moduleSetting('ai-assistance-patching-fre-completed').set(false);\n      const {view, widget} = await createPatchWidget();\n      widget.changeSummary = 'body { background-color: red; }';\n\n      view.input.onApplyToWorkspace();\n\n      assert.isTrue(showFreDialogStub.called, 'Expected FreDialog to be shown but it\\'s not shown');\n    });\n\n    it('should not show FRE dialog on applyToWorkspace click if the setting is true', async () => {\n      Common.Settings.moduleSetting('ai-assistance-patching-fre-completed').set(true);\n      const {view, widget} = await createPatchWidget();\n      widget.changeSummary = 'body { background-color: red; }';\n\n      view.input.onApplyToWorkspace();\n\n      assert.isFalse(showFreDialogStub.called, 'Expected FreDialog to be not shown but it\\'s shown');\n    });\n\n    it('should show files uploaded', async () => {\n      const {view, widget} = await createPatchWidget({\n        aidaClient: mockAidaClient([\n          [{explanation: '', functionCalls: [{name: 'updateFiles', args: {files: ['index.html']}}]}], [{\n            explanation: 'done',\n          }]\n        ]),\n      });\n      widget.changeSummary = 'body { background-color: red; }';\n\n      view.input.onApplyToWorkspace();\n\n      assert.strictEqual((await view.nextInput).sources, `Filenames in test.\nFiles:\n* index.html`);\n    });\n\n    it('should show error state when applyToWorkspace fails', async () => {\n      const {view, widget} = await createPatchWidget({aidaClient: mockAidaClient([[MockAidaFetchError]])});\n      widget.changeSummary = 'body { background-color: red; }';\n\n      view.input.onApplyToWorkspace();\n\n      const input = await view.nextInput;\n      assert.strictEqual(input.patchSuggestionState, AiAssistance.PatchWidget.PatchSuggestionState.ERROR);\n    });\n\n    it('should return back to initial state when the user aborts applying to workspace', async () => {\n      const {view, widget} = await createPatchWidget({aidaClient: mockAidaClient([[MockAidaAbortError]])});\n      widget.changeSummary = 'body { background-color: red; }';\n\n      view.input.onApplyToWorkspace();\n\n      const input = await view.nextInput;\n      assert.strictEqual(input.patchSuggestionState, AiAssistance.PatchWidget.PatchSuggestionState.INITIAL);\n    });\n  });\n\n  describe('workspace', () => {\n    let project: Persistence.FileSystemWorkspaceBinding.FileSystem;\n\n    beforeEach(() => {\n      project = createTestFilesystem('file://test').project;\n      updateHostConfig({\n        devToolsFreestyler: {\n          enabled: true,\n          patching: true,\n        },\n      });\n    });\n\n    it('does not select a workspace project if patching is disabled', async () => {\n      updateHostConfig({\n        devToolsFreestyler: {\n          enabled: true,\n          patching: false,\n        },\n      });\n      const {view} = await createPatchWidget();\n      assert.strictEqual(view.input.projectName, '');\n    });\n\n    it('does not select a workspace project if setting does not exist', async () => {\n      const {view} = await createPatchWidget();\n      assert.strictEqual(view.input.projectName, '');\n    });\n\n    it('selects a workspace project matching the setting', async () => {\n      Common.Settings.Settings.instance().createSetting('ai-assistance-patching-selected-project-id', 'file://test');\n      const {view} = await createPatchWidget();\n      assert.strictEqual(view.input.projectName, 'test');\n    });\n\n    it('removes a selected workspace project upon workspace removal', async () => {\n      Common.Settings.Settings.instance().createSetting('ai-assistance-patching-selected-project-id', 'file://test');\n      const {view} = await createPatchWidget();\n      assert.strictEqual(view.input.projectName, 'test');\n\n      Workspace.Workspace.WorkspaceImpl.instance().removeProject(project);\n      const input = await view.nextInput;\n      assert.strictEqual(input.projectName, '');\n    });\n\n    it('selection is triggered by applyToWorkspace click if no workspace is (pre-)selected', async () => {\n      let handler: (project: Workspace.Workspace.Project) => void = () => {};\n      const showSelectWorkspaceDialogStub =\n          sinon.stub(AiAssistance.SelectWorkspaceDialog, 'show').callsFake((handleProjectSelected, _project) => {\n            handler = handleProjectSelected;\n          });\n      const {view, widget} =\n          await createPatchWidget({aidaClient: mockAidaClient([[{explanation: 'suggested patch'}]])});\n      widget.changeSummary = 'body { background-color: red; }';\n      assert.strictEqual(view.input.projectName, '');\n\n      // Simulate clicking the \"Apply to workspace\" button\n      view.input.onApplyToWorkspace();\n      await new Promise(resolve => setTimeout(resolve, 0));\n      sinon.assert.calledOnce(showSelectWorkspaceDialogStub);\n\n      // Simulate selecting a workspace with the SelectWorkspaceDialog\n      handler(project);\n      const input = await view.nextInput;\n\n      // Assert that a patch has been generated and a project has been selected\n      assert.strictEqual(input.patchSuggestionState, AiAssistance.PatchWidget.PatchSuggestionState.SUCCESS);\n      assert.strictEqual(input.projectName, 'test');\n    });\n\n    it('selection is triggered by the \"change\"-button if a workspace is already (pre-)selected', async () => {\n      const {project: project2} = createTestFilesystem('file://test2');\n      Common.Settings.Settings.instance().createSetting('ai-assistance-patching-selected-project-id', 'file://test');\n      let handler: (project: Workspace.Workspace.Project) => void = () => {};\n      const showSelectWorkspaceDialogStub =\n          sinon.stub(AiAssistance.SelectWorkspaceDialog, 'show').callsFake((onProjectSelected, _project) => {\n            handler = onProjectSelected;\n          });\n      const {view, widget} = await createPatchWidget();\n      widget.changeSummary = 'body { background-color: red; }';\n      assert.strictEqual(view.input.projectName, 'test');\n\n      // Simulate clicking the \"Change\" button\n      sinon.assert.notCalled(showSelectWorkspaceDialogStub);\n      assert.isDefined(view.input.onChangeWorkspaceClick);\n      view.input.onChangeWorkspaceClick();\n      sinon.assert.calledOnce(showSelectWorkspaceDialogStub);\n\n      // Simulate selecting a different workspace with the SelectWorkspaceDialog\n      handler(project2);\n      const input = await view.nextInput;\n\n      // Assert that the project has been updated\n      assert.strictEqual(input.projectName, 'test2');\n    });\n\n    it('preselects an automatic workspace folder and allows connecting to it', async () => {\n      setupAutomaticFileSystem({hasFileSystem: true});\n      const showSelectWorkspaceDialogSpy = sinon.spy(AiAssistance.SelectWorkspaceDialog, 'show');\n      const applyChangesSpy = sinon.spy(AiAssistanceModel.PatchAgent.prototype, 'applyChanges');\n\n      const {view, widget} = await createPatchWidget();\n      widget.changeSummary = 'body { background-color: red; }';\n      assert.strictEqual(view.input.projectName, 'my-automatic-file-system');\n      assert.strictEqual(view.input.projectPath, '/path/to/my-automatic-file-system');\n\n      // Clicking on \"Apply to workspace\" does not open a SelectWorkspaceDialog\n      view.input.onApplyToWorkspace();\n      sinon.assert.notCalled(showSelectWorkspaceDialogSpy);\n      await new Promise(resolve => setTimeout(resolve, 0));\n      sinon.assert.notCalled(applyChangesSpy);\n\n      // This simulates the user confirming the file permissions dialog\n      createTestFilesystem('file:///path/to/my-automatic-file-system');\n      sinon.assert.calledOnce(applyChangesSpy);\n    });\n  });\n\n  describe('diff view', () => {\n    let uiSourceCode: Workspace.UISourceCode.UISourceCode;\n    let commitWorkingCopyStub:\n        sinon.SinonStub<Parameters<typeof Workspace.UISourceCode.UISourceCode.prototype.commitWorkingCopy>>;\n\n    beforeEach(() => {\n      uiSourceCode = createTestFilesystem('file://test').uiSourceCode;\n      Common.Settings.Settings.instance().createSetting('ai-assistance-patching-selected-project-id', 'file://test');\n      updateHostConfig({\n        devToolsFreestyler: {\n          enabled: true,\n          patching: true,\n        },\n      });\n\n      commitWorkingCopyStub =\n          sinon.stub(Workspace.UISourceCode.UISourceCode.prototype, 'commitWorkingCopy').callThrough();\n    });\n\n    it('on apply should should not call stashChanges', async () => {\n      const {\n        view,\n        widget,\n      } = await createPatchWidget({\n        aidaClient: mockAidaClient([[{explanation: 'patch applied'}]]),\n      });\n      widget.changeSummary = 'body { background-color: red; }';\n      const changeManager = sinon.createStubInstance(AiAssistanceModel.ChangeManager);\n      changeManager.stashChanges.returns(Promise.resolve());\n      widget.changeManager = changeManager;\n      view.input.onApplyToWorkspace();\n      await view.nextInput;\n      sinon.assert.notCalled(changeManager.stashChanges);\n    });\n\n    it('on save should stash changes', async () => {\n      const {view, widget} = await createPatchWidgetWithDiffView();\n      const changeManager = sinon.createStubInstance(AiAssistanceModel.ChangeManager);\n      changeManager.stashChanges.returns(Promise.resolve());\n      widget.changeManager = changeManager;\n      uiSourceCode.setWorkingCopy('working copy');\n\n      view.input.onSaveAll();\n      const nextInput = await view.nextInput;\n\n      assert.isTrue(nextInput.savedToDisk);\n      assert.isTrue(commitWorkingCopyStub.called, 'Expected commitWorkingCopy to be called but it is not called');\n      sinon.assert.calledOnce(changeManager.stashChanges);\n    });\n\n    it('discard should discard the working copy and render the view without patchSuggestion', async () => {\n      const {view, widget} = await createPatchWidgetWithDiffView();\n      const changeManager = sinon.createStubInstance(AiAssistanceModel.ChangeManager);\n      changeManager.stashChanges.returns(Promise.resolve());\n      widget.changeManager = changeManager;\n      uiSourceCode.setWorkingCopy('working copy');\n\n      view.input.onDiscard();\n      const nextInput = await view.nextInput;\n\n      assert.strictEqual(nextInput.patchSuggestionState, AiAssistance.PatchWidget.PatchSuggestionState.INITIAL);\n      sinon.assert.calledOnce(changeManager.popStashedChanges);\n    });\n\n    it('on discard should submit a negative rating if rpcId exists', async () => {\n      const rpcId = 'discard-test-123';\n      const aidaClientMock = mockAidaClient([[{\n        explanation: 'patch',\n        metadata: {rpcGlobalId: rpcId},\n      }]]);\n      const {view, aidaClient} = await createPatchWidgetWithDiffView({aidaClient: aidaClientMock});\n\n      const aidaClientCall = expectCall(aidaClient.registerClientEvent as sinon.SinonStub);\n      view.input.onDiscard();\n      await view.nextInput;\n      const [aidaClientEvent] = await aidaClientCall;\n\n      assert.strictEqual(aidaClientEvent.corresponding_aida_rpc_global_id, rpcId);\n      assert.strictEqual(\n          aidaClientEvent.do_conversation_client_event?.user_feedback?.sentiment, Host.AidaClient.Rating.NEGATIVE);\n      assert.isTrue(aidaClientEvent.disable_user_content_logging, 'Logging should always be disabled');\n    });\n\n    it('on save should submit a positive rating if rpcId exists', async () => {\n      const rpcId = 'save-test-456';\n      const aidaClientMock = mockAidaClient([[{\n        explanation: 'patch',\n        metadata: {rpcGlobalId: rpcId},\n      }]]);\n      const {view, aidaClient} = await createPatchWidgetWithDiffView({aidaClient: aidaClientMock});\n\n      const aidaClientCall = expectCall(aidaClient.registerClientEvent as sinon.SinonStub);\n      view.input.onSaveAll();\n      await view.nextInput;\n      const [aidaClientEvent] = await aidaClientCall;\n\n      assert.strictEqual(aidaClientEvent.corresponding_aida_rpc_global_id, rpcId);\n      assert.strictEqual(\n          aidaClientEvent.do_conversation_client_event?.user_feedback?.sentiment, Host.AidaClient.Rating.POSITIVE);\n      assert.isTrue(aidaClientEvent.disable_user_content_logging, 'Logging should always be disabled');\n    });\n\n    it('on discard should not submit a rating if rpcId does not exist in apply response', async () => {\n      const aidaClientMock = mockAidaClient([[{\n        explanation: 'patch',\n      }]]);\n      const {view, aidaClient} = await createPatchWidgetWithDiffView({aidaClient: aidaClientMock});\n\n      view.input.onDiscard();\n      await view.nextInput;\n\n      sinon.assert.notCalled(aidaClient.registerClientEvent as sinon.SinonStub);\n    });\n\n    it('on save should not submit a rating if rpcId does not exist in apply response', async () => {\n      const aidaClientMock = mockAidaClient([[{\n        explanation: 'patch',\n      }]]);\n      const {view, aidaClient} = await createPatchWidgetWithDiffView({aidaClient: aidaClientMock});\n\n      view.input.onSaveAll();\n      await view.nextInput;\n\n      sinon.assert.notCalled(aidaClient.registerClientEvent as sinon.SinonStub);\n    });\n  });\n});\n"]}