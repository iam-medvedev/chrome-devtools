{"version":3,"file":"PatchWidget.js","sourceRoot":"","sources":["../../../../../../front_end/panels/ai_assistance/PatchWidget.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright 2025 The Chromium Authors. All rights reserved.\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport '../../ui/legacy/legacy.js';\nimport '../../ui/components/markdown_view/markdown_view.js';\nimport '../../ui/components/spinners/spinners.js';\nimport '../../ui/components/tooltips/tooltips.js';\n\nimport * as Common from '../../core/common/common.js';\nimport * as Host from '../../core/host/host.js';\nimport * as i18n from '../../core/i18n/i18n.js';\nimport type * as Platform from '../../core/platform/platform.js';\nimport * as Root from '../../core/root/root.js';\nimport * as Persistence from '../../models/persistence/persistence.js';\nimport * as Workspace from '../../models/workspace/workspace.js';\nimport * as WorkspaceDiff from '../../models/workspace_diff/workspace_diff.js';\nimport * as Buttons from '../../ui/components/buttons/buttons.js';\nimport * as UI from '../../ui/legacy/legacy.js';\nimport {Directives, html, type LitTemplate, nothing, render} from '../../ui/lit/lit.js';\nimport * as VisualLogging from '../../ui/visual_logging/visual_logging.js';\nimport * as ChangesPanel from '../changes/changes.js';\nimport * as PanelCommon from '../common/common.js';\n\nimport {type ResponseData, ResponseType} from './agents/AiAgent.js';\nimport {PatchAgent} from './agents/PatchAgent.js';\nimport {SelectWorkspaceDialog} from './SelectWorkspaceDialog.js';\n\nconst {classMap} = Directives;\n\n/*\n* Strings that don't need to be translated at this time.\n*/\nconst UIStringsNotTranslate = {\n  /**\n   *@description Text displayed for showing patch widget view.\n   */\n  unsavedChanges: 'Unsaved changes',\n  /**\n   *@description Loading text displayed as a summary title when the patch suggestion is getting loaded\n   */\n  applyingToWorkspace: 'Applying to workspace…',\n  /**\n   *@description Button text for staging changes to workspace.\n   */\n  applyToWorkspace: 'Apply to workspace',\n  /*\n   *@description Button text to change the selected workspace\n   */\n  change: 'Change',\n  /*\n   *@description Button text to cancel applying to workspace\n   */\n  cancel: 'Cancel',\n  /*\n   *@description Button text to discard the suggested changes and not save them to file system\n   */\n  discard: 'Discard',\n  /*\n   *@description Button text to save all the suggested changes to file system\n   */\n  saveAll: 'Save all',\n  /**\n   *@description Button text while data is being loaded\n   */\n  loading: 'Loading...',\n  /**\n   *@description Header text after the user saved the changes to the disk.\n   */\n  savedToDisk: 'Saved to disk',\n  /**\n   *@description Disclaimer text shown for using code snippets with caution\n   */\n  codeDisclaimer: 'Use code snippets with caution',\n  /**\n   *@description Tooltip text for the info icon beside the \"Apply to workspace\" button\n   */\n  applyToWorkspaceTooltip: 'Source code from the selected folder is sent to Google to generate code suggestions.',\n  /**\n   *@description Tooltip text for the info icon beside the \"Apply to workspace\" button when enterprise logging is off\n   */\n  applyToWorkspaceTooltipNoLogging:\n      'Source code from the selected folder is sent to Google to generate code suggestions. This data will not be used to improve Google’s AI models.',\n  /**\n   *@description Tooltip link for the navigating to \"AI innovations\" page in settings.\n   */\n  learnMore: 'Learn more',\n  /**\n   *@description Header text for the AI-powered code suggestions disclaimer dialog.\n   */\n  freDisclaimerHeader: 'Get AI-powered code suggestions for your workspace',\n  /**\n   *@description First disclaimer item text for the fre dialog.\n   */\n  freDisclaimerTextAiWontAlwaysGetItRight: 'This feature uses AI and won’t always get it right',\n  /**\n   *@description Second disclaimer item text for the fre dialog.\n   */\n  freDisclaimerTextPrivacy: 'Source code from the selected folder is sent to Google to generate code suggestions',\n  /**\n   *@description Second disclaimer item text for the fre dialog when enterprise logging is off.\n   */\n  freDisclaimerTextPrivacyNoLogging:\n      'Source code from the selected folder is sent to Google to generate code suggestions. This data will not be used to improve Google’s AI models.',\n  /**\n   *@description Third disclaimer item text for the fre dialog.\n   */\n  freDisclaimerTextUseWithCaution: 'Use generated code snippets with caution',\n  /**\n   * @description Title of the link opening data that was used to\n   * produce a code suggestion.\n   */\n  viewUploadedFiles: 'View data sent to Google',\n  /**\n   * @description Text indicating that a link opens in a new tab (for a11y).\n   */\n  opensInNewTab: '(opens in a new tab)',\n} as const;\n\nconst lockedString = i18n.i18n.lockedString;\n\nconst CODE_SNIPPET_WARNING_URL = 'https://support.google.com/legal/answer/13505487';\nexport interface ViewInput {\n  workspaceDiff: WorkspaceDiff.WorkspaceDiff.WorkspaceDiffImpl;\n  changeSummary?: string;\n  patchSuggestion?: string;\n  patchSuggestionLoading?: boolean;\n  sources?: string;\n  projectName?: string;\n  savedToDisk?: boolean;\n  projectPath: Platform.DevToolsPath.UrlString;\n  applyToWorkspaceTooltipText: Platform.UIString.LocalizedString;\n  onLearnMoreTooltipClick: () => void;\n  onApplyToWorkspace: () => void;\n  onCancel: () => void;\n  onDiscard: () => void;\n  onSaveAll: () => void;\n  onChangeWorkspaceClick: () => void;\n}\n\nexport interface ViewOutput {\n  tooltipRef?: Directives.Ref<HTMLElement>;\n}\n\ntype View = (input: ViewInput, output: ViewOutput, target: HTMLElement) => void;\n\nexport class PatchWidget extends UI.Widget.Widget {\n  changeSummary = '';\n\n  // Whether the user completed first run experience dialog or not.\n  #aiPatchingFreCompletedSetting =\n      Common.Settings.Settings.instance().createSetting('ai-assistance-patching-fre-completed', false);\n  #projectIdSetting =\n      Common.Settings.Settings.instance().createSetting('ai-assistance-patching-selected-project-id', '');\n  #view: View;\n  #viewOutput: ViewOutput = {};\n  #aidaClient: Host.AidaClient.AidaClient;\n  #applyPatchAbortController?: AbortController;\n  #project?: Workspace.Workspace.Project;\n  #patchSuggestion?: string;\n  #patchSources?: string;\n  #patchSuggestionLoading?: boolean;\n  #savedToDisk?: boolean;\n  #noLogging: boolean;  // Whether the enterprise setting is `ALLOW_WITHOUT_LOGGING` or not.\n  #workspaceDiff = WorkspaceDiff.WorkspaceDiff.workspaceDiff();\n  #workspace = Workspace.Workspace.WorkspaceImpl.instance();\n\n  constructor(element?: HTMLElement, view?: View, opts?: {\n    aidaClient: Host.AidaClient.AidaClient,\n  }) {\n    super(false, false, element);\n    this.#aidaClient = opts?.aidaClient ?? new Host.AidaClient.AidaClient();\n    this.#noLogging = Root.Runtime.hostConfig.aidaAvailability?.enterprisePolicyValue ===\n        Root.Runtime.GenAiEnterprisePolicyValue.ALLOW_WITHOUT_LOGGING;\n\n    // clang-format off\n    this.#view = view ?? ((input, output, target) => {\n      if (!input.changeSummary) {\n        return;\n      }\n      output.tooltipRef = output.tooltipRef ?? Directives.createRef<HTMLElement>();\n\n      function renderHeader(): LitTemplate {\n        if (input.savedToDisk) {\n          return html`\n            <devtools-icon class=\"green-bright-icon summary-badge\" .name=${'check-circle'}></devtools-icon>\n            <span class=\"header-text\">\n              ${lockedString(UIStringsNotTranslate.savedToDisk)}\n            </span>\n          `;\n        }\n\n        if (input.patchSuggestion) {\n          return html`\n            <devtools-icon class=\"on-tonal-icon summary-badge\" .name=${'difference'}></devtools-icon>\n            <span class=\"header-text\">\n              ${lockedString(`File changes in ${input.projectName}`)}\n            </span>\n            <devtools-icon\n              class=\"arrow\"\n              .name=${'chevron-down'}\n            ></devtools-icon>\n          `;\n        }\n\n        return html`\n          <devtools-icon class=\"on-tonal-icon summary-badge\" .name=${'pen-spark'}></devtools-icon>\n          <span class=\"header-text\">\n            ${lockedString(UIStringsNotTranslate.unsavedChanges)}\n          </span>\n          <devtools-icon\n            class=\"arrow\"\n            .name=${'chevron-down'}\n          ></devtools-icon>\n        `;\n      }\n\n      function renderContent(): LitTemplate {\n        if (!input.changeSummary || input.savedToDisk) {\n          return nothing;\n        }\n\n        if (input.patchSuggestion) {\n          return html`<devtools-widget .widgetConfig=${UI.Widget.widgetConfig(ChangesPanel.CombinedDiffView.CombinedDiffView, {\n            workspaceDiff: input.workspaceDiff,\n          })}></devtools-widget>`;\n        }\n\n        return html`<devtools-code-block\n          .code=${input.changeSummary}\n          .codeLang=${'css'}\n          .displayNotice=${true}\n        ></devtools-code-block>`;\n      }\n\n      function renderFooter(): LitTemplate {\n        if (input.savedToDisk) {\n          return nothing;\n        }\n\n        if (input.patchSuggestion) {\n          return html`\n          <div class=\"footer\">\n            <x-link class=\"link disclaimer-link\" href=\"https://support.google.com/legal/answer/13505487\" jslog=${\n              VisualLogging.link('code-disclaimer').track({\n                click: true,\n              })}>\n              ${lockedString(UIStringsNotTranslate.codeDisclaimer)}\n            </x-link>\n            ${input.sources ? html`<x-link\n              class=\"link sources-link\"\n              title=\"${UIStringsNotTranslate.viewUploadedFiles} ${UIStringsNotTranslate.opensInNewTab}\"\n              href=\"data:text/plain,${encodeURIComponent(input.sources)}\"\n              jslog=${VisualLogging.link('files-used-in-patching').track({click: true})}>\n              ${UIStringsNotTranslate.viewUploadedFiles}\n            </x-link>`: nothing}\n            <div class=\"save-or-discard-buttons\">\n              <devtools-button\n                @click=${input.onDiscard}\n                .jslogContext=${'discard'}\n                .variant=${Buttons.Button.Variant.OUTLINED}>\n                  ${lockedString(UIStringsNotTranslate.discard)}\n              </devtools-button>\n              <devtools-button\n                @click=${input.onSaveAll}\n                .jslogContext=${'save-all'}\n                .variant=${Buttons.Button.Variant.PRIMARY}>\n                  ${lockedString(UIStringsNotTranslate.saveAll)}\n              </devtools-button>\n            </div>\n          </div>\n          `;\n        }\n\n        return html`\n        <div class=\"footer\">\n          ${input.projectName ? html`\n            <div class=\"change-workspace\">\n              <div class=\"selected-folder\">\n                <devtools-icon .name=${'folder'}></devtools-icon> <span title=${input.projectPath}>${input.projectName}</span>\n              </div>\n              <devtools-button\n                @click=${input.onChangeWorkspaceClick}\n                .jslogContext=${'change-workspace'}\n                .variant=${Buttons.Button.Variant.TEXT}>\n                  ${lockedString(UIStringsNotTranslate.change)}\n              </devtools-button>\n            </div>\n          ` : nothing}\n          <div class=\"apply-to-workspace-container\">\n            ${input.patchSuggestionLoading ? html`\n              <div class=\"loading-text-container\">\n                <devtools-spinner></devtools-spinner>\n                <span>\n                  ${lockedString(UIStringsNotTranslate.applyingToWorkspace)}\n                </span>\n              </div>\n            ` : html`\n              <devtools-button\n                @click=${input.onApplyToWorkspace}\n                .jslogContext=${'stage-to-workspace'}\n                .variant=${Buttons.Button.Variant.OUTLINED}>\n                ${lockedString(UIStringsNotTranslate.applyToWorkspace)}\n              </devtools-button>\n            `}\n            ${input.patchSuggestionLoading ? html`<devtools-button\n              @click=${input.onCancel}\n              .jslogContext=${'cancel'}\n              .variant=${Buttons.Button.Variant.OUTLINED}>\n              ${lockedString(UIStringsNotTranslate.cancel)}\n            </devtools-button>` : nothing}\n            <devtools-button\n              aria-details=\"info-tooltip\"\n              .iconName=${'info'}\n              .variant=${Buttons.Button.Variant.ICON}\n              ></devtools-button>\n            <devtools-tooltip variant=\"rich\" id=\"info-tooltip\" ${Directives.ref(output.tooltipRef)}>\n              <div class=\"info-tooltip-container\">\n                ${input.applyToWorkspaceTooltipText}\n                <button\n                  class=\"link tooltip-link\"\n                  role=\"link\"\n                  jslog=${VisualLogging.link('open-ai-settings').track({\n                    click: true,\n                  })}\n                  @click=${input.onLearnMoreTooltipClick}\n                >${lockedString(UIStringsNotTranslate.learnMore)}</button>\n              </div>\n            </devtools-tooltip>\n          </div>\n        </div>`;\n      }\n\n      render(\n        html`\n          <details class=${classMap({\n            'change-summary': true,\n            'saved-to-disk': Boolean(input.savedToDisk)\n          })}>\n            <summary>\n              ${renderHeader()}\n            </summary>\n            ${renderContent()}\n            ${renderFooter()}\n          </details>\n        `,\n        target,\n        {host: target}\n      );\n    });\n    // clang-format on\n    this.requestUpdate();\n  }\n\n  #onLearnMoreTooltipClick(): void {\n    this.#viewOutput.tooltipRef?.value?.hidePopover();\n    void UI.ViewManager.ViewManager.instance().showView('chrome-ai');\n  }\n\n  override performUpdate(): void {\n    this.#view(\n        {\n          workspaceDiff: this.#workspaceDiff,\n          changeSummary: this.changeSummary,\n          patchSuggestion: this.#patchSuggestion,\n          patchSuggestionLoading: this.#patchSuggestionLoading,\n          sources: this.#patchSources,\n          projectName: this.#project?.displayName(),\n          projectPath: Persistence.FileSystemWorkspaceBinding.FileSystemWorkspaceBinding.fileSystemPath(\n              (this.#project?.id() || '') as Platform.DevToolsPath.UrlString),\n          savedToDisk: this.#savedToDisk,\n          applyToWorkspaceTooltipText: this.#noLogging ?\n              lockedString(UIStringsNotTranslate.applyToWorkspaceTooltipNoLogging) :\n              lockedString(UIStringsNotTranslate.applyToWorkspaceTooltip),\n          onLearnMoreTooltipClick: this.#onLearnMoreTooltipClick.bind(this),\n          onApplyToWorkspace: this.#onApplyToWorkspace.bind(this),\n          onCancel: () => {\n            this.#applyPatchAbortController?.abort();\n          },\n          onDiscard: this.#onDiscard.bind(this),\n          onSaveAll: this.#onSaveAll.bind(this),\n          onChangeWorkspaceClick: this.#showSelectWorkspaceDialog.bind(this, {applyPatch: false}),\n        },\n        this.#viewOutput, this.contentElement);\n  }\n\n  override wasShown(): void {\n    super.wasShown();\n    this.#selectDefaultProject();\n\n    if (isAiAssistancePatchingEnabled()) {\n      this.#workspace.addEventListener(Workspace.Workspace.Events.ProjectRemoved, this.#onProjectRemoved, this);\n\n      // @ts-expect-error temporary global function for local testing.\n      window.aiAssistanceTestPatchPrompt = async (changeSummary: string) => {\n        return await this.#applyPatch(changeSummary);\n      };\n    }\n  }\n\n  override willHide(): void {\n    if (isAiAssistancePatchingEnabled()) {\n      this.#workspace.removeEventListener(Workspace.Workspace.Events.ProjectRemoved, this.#onProjectRemoved, this);\n    }\n  }\n\n  async #showFreDisclaimerIfNeeded(): Promise<boolean> {\n    const isAiPatchingFreCompleted = this.#aiPatchingFreCompletedSetting.get();\n    if (isAiPatchingFreCompleted) {\n      return true;\n    }\n\n    const result = await PanelCommon.FreDialog.show({\n      header: {iconName: 'smart-assistant', text: lockedString(UIStringsNotTranslate.freDisclaimerHeader)},\n      reminderItems: [\n        {\n          iconName: 'psychiatry',\n          content: lockedString(UIStringsNotTranslate.freDisclaimerTextAiWontAlwaysGetItRight),\n        },\n        {\n          iconName: 'google',\n          content: this.#noLogging ? lockedString(UIStringsNotTranslate.freDisclaimerTextPrivacyNoLogging) :\n                                     lockedString(UIStringsNotTranslate.freDisclaimerTextPrivacy),\n        },\n        {\n          iconName: 'warning',\n          // clang-format off\n          content: html`<x-link\n            href=${CODE_SNIPPET_WARNING_URL}\n            class=\"link\"\n            jslog=${VisualLogging.link('code-snippets-explainer.patch-widget').track({\n              click: true\n            })}\n          >${lockedString(UIStringsNotTranslate.freDisclaimerTextUseWithCaution)}</x-link>`,\n          // clang-format on\n        }\n      ],\n      onLearnMoreClick: () => {\n        void UI.ViewManager.ViewManager.instance().showView('chrome-ai');\n      }\n    });\n\n    if (result) {\n      this.#aiPatchingFreCompletedSetting.set(true);\n    }\n    return result;\n  }\n\n  #selectDefaultProject(): void {\n    const project = this.#workspace.project(this.#projectIdSetting.get());\n    if (project) {\n      this.#project = project;\n    } else {\n      this.#project = undefined;\n      this.#projectIdSetting.set('');\n    }\n    this.requestUpdate();\n  }\n\n  #onProjectRemoved(): void {\n    if (this.#project && !this.#workspace.project(this.#project.id())) {\n      this.#projectIdSetting.set('');\n      this.#project = undefined;\n      this.requestUpdate();\n    }\n  }\n\n  #showSelectWorkspaceDialog(options: {applyPatch: boolean} = {applyPatch: false}): void {\n    const onProjectSelected = (project: Workspace.Workspace.Project): void => {\n      this.#project = project;\n      this.#projectIdSetting.set(project.id());\n      if (options.applyPatch) {\n        void this.#applyPatchAndUpdateUI();\n      } else {\n        this.requestUpdate();\n      }\n    };\n\n    SelectWorkspaceDialog.show(onProjectSelected, this.#project);\n  }\n\n  async #onApplyToWorkspace(): Promise<void> {\n    if (!isAiAssistancePatchingEnabled()) {\n      return;\n    }\n\n    // Show the FRE dialog if needed and only continue when\n    // the user accepted the disclaimer.\n    const freDisclaimerCompleted = await this.#showFreDisclaimerIfNeeded();\n    if (!freDisclaimerCompleted) {\n      return;\n    }\n\n    if (this.#project) {\n      await this.#applyPatchAndUpdateUI();\n    } else {\n      this.#showSelectWorkspaceDialog({applyPatch: true});\n    }\n  }\n\n  async #applyPatchAndUpdateUI(): Promise<void> {\n    const changeSummary = this.changeSummary;\n    if (!changeSummary) {\n      throw new Error('Change summary does not exist');\n    }\n\n    this.#patchSuggestionLoading = true;\n    this.requestUpdate();\n    const {response, processedFiles} = await this.#applyPatch(changeSummary);\n    // TODO: Handle error state\n    if (response?.type === ResponseType.ANSWER) {\n      this.#patchSuggestion = response.text;\n    }\n    this.#patchSources = `Filenames in ${this.#project?.displayName()}.\nFiles:\n${processedFiles.map(filename => `* ${filename}`).join('\\n')}`;\n    this.#patchSuggestionLoading = false;\n    this.requestUpdate();\n  }\n\n  #onDiscard(): void {\n    this.#workspaceDiff.modifiedUISourceCodes().forEach(modifiedUISourceCode => {\n      modifiedUISourceCode.resetWorkingCopy();\n    });\n\n    this.#patchSuggestion = undefined;\n    this.#patchSources = undefined;\n    this.requestUpdate();\n  }\n\n  #onSaveAll(): void {\n    // TODO: What should we do for the inspector stylesheet?\n    this.#workspaceDiff.modifiedUISourceCodes().forEach(modifiedUISourceCode => {\n      modifiedUISourceCode.commitWorkingCopy();\n    });\n\n    this.#savedToDisk = true;\n    this.requestUpdate();\n  }\n\n  async #applyPatch(changeSummary: string): Promise<{\n    response: ResponseData | undefined,\n    processedFiles: string[],\n  }> {\n    if (!this.#project) {\n      throw new Error('Project does not exist');\n    }\n    this.#applyPatchAbortController = new AbortController();\n    const agent = new PatchAgent({\n      aidaClient: this.#aidaClient,\n      serverSideLoggingEnabled: false,\n      project: this.#project,\n    });\n    const {responses, processedFiles} =\n        await agent.applyChanges(changeSummary, {signal: this.#applyPatchAbortController.signal});\n    return {\n      response: responses.at(-1),\n      processedFiles,\n    };\n  }\n}\n\nexport function isAiAssistancePatchingEnabled(): boolean {\n  return Boolean(Root.Runtime.hostConfig.devToolsFreestyler?.patching);\n}\n"]}