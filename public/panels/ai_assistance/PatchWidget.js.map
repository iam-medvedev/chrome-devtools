{"version":3,"file":"PatchWidget.js","sourceRoot":"","sources":["../../../../../../front_end/panels/ai_assistance/PatchWidget.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright 2025 The Chromium Authors. All rights reserved.\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport '../../ui/legacy/legacy.js';\nimport '../../ui/components/markdown_view/markdown_view.js';\nimport '../../ui/components/spinners/spinners.js';\nimport '../../ui/components/tooltips/tooltips.js';\n\nimport * as Host from '../../core/host/host.js';\nimport * as i18n from '../../core/i18n/i18n.js';\nimport type * as Platform from '../../core/platform/platform.js';\nimport * as Root from '../../core/root/root.js';\nimport * as Persistence from '../../models/persistence/persistence.js';\nimport * as Workspace from '../../models/workspace/workspace.js';\nimport * as WorkspaceDiff from '../../models/workspace_diff/workspace_diff.js';\nimport * as Buttons from '../../ui/components/buttons/buttons.js';\nimport * as UI from '../../ui/legacy/legacy.js';\nimport {html, type LitTemplate, nothing, render} from '../../ui/lit/lit.js';\nimport * as VisualLogging from '../../ui/visual_logging/visual_logging.js';\nimport * as ChangesPanel from '../changes/changes.js';\n\nimport {type ResponseData, ResponseType} from './agents/AiAgent.js';\nimport {PatchAgent} from './agents/PatchAgent.js';\nimport {SelectWorkspaceDialog} from './SelectWorkspaceDialog.js';\n\n/*\n* Strings that don't need to be translated at this time.\n*/\nconst UIStringsNotTranslate = {\n  /**\n   *@description Text displayed for showing change summary view.\n   */\n  changeSummary: 'Changes summary',\n  /**\n   *@description Loading text displayed as a summary title when the patch suggestion is getting loaded\n   */\n  loadingPatchSuggestion: 'Applying to workspaceâ€¦',\n  /**\n   *@description Button text for staging changes to workspace.\n   */\n  applyToWorkspace: 'Apply to workspace',\n  /*\n   *@description Button text to change the selected workspace\n   */\n  change: 'Change',\n  /*\n   *@description Button text to discard the suggested changes and not save them to file system\n   */\n  discard: 'Discard',\n  /*\n   *@description Button text to save all the suggested changes to file system\n   */\n  saveAll: 'Save all',\n  /**\n   *@description Button text while data is being loaded\n   */\n  loading: 'Loading...',\n  /**\n   *@description Label for the selected workspace/folder\n   */\n  selectedFolder: 'Selected folder:',\n  /**\n   *@description Disclaimer text shown for using code snippets with caution\n   */\n  codeDisclaimer: 'Use code snippets with caution',\n  /**\n   *@description Tooltip text for the info icon beside the \"Apply to workspace\" button\n   */\n  applyToWorkspaceTooltip: 'Source code from the selected folder is sent to Google to generate code suggestions'\n} as const;\n\nconst lockedString = i18n.i18n.lockedString;\n\nexport interface ViewInput {\n  workspaceDiff: WorkspaceDiff.WorkspaceDiff.WorkspaceDiffImpl;\n  changeSummary?: string;\n  patchSuggestion?: string;\n  patchSuggestionLoading?: boolean;\n  projectName?: string;\n  projectPath: Platform.DevToolsPath.UrlString;\n  onApplyToWorkspace?: () => void;\n  onDiscard: () => void;\n  onSaveAll: () => void;\n  onChangeWorkspaceClick: () => void;\n}\n\ntype View = (input: ViewInput, output: undefined, target: HTMLElement) => void;\n\nexport class PatchWidget extends UI.Widget.Widget {\n  changeSummary = '';\n\n  #view: View;\n  #aidaClient: Host.AidaClient.AidaClient;\n  #project?: Workspace.Workspace.Project;\n  #patchSuggestion?: string;\n  #patchSuggestionLoading?: boolean;\n  #workspaceDiff = WorkspaceDiff.WorkspaceDiff.workspaceDiff();\n  #workspace = Workspace.Workspace.WorkspaceImpl.instance();\n\n  constructor(element?: HTMLElement, view?: View, opts?: {\n    aidaClient: Host.AidaClient.AidaClient,\n  }) {\n    super(false, false, element);\n    this.#aidaClient = opts?.aidaClient ?? new Host.AidaClient.AidaClient();\n    // clang-format off\n    this.#view = view ?? ((input, output, target) => {\n      if (!input.changeSummary) {\n        return;\n      }\n\n      function renderHeader(): LitTemplate {\n        if (input.patchSuggestionLoading) {\n          return html`\n            <devtools-spinner></devtools-spinner>\n            <span class=\"header-text\">\n              ${lockedString(UIStringsNotTranslate.loadingPatchSuggestion)}\n            </span>\n          `;\n        }\n\n        if (input.patchSuggestion) {\n          return html`\n            <devtools-icon class=\"difference-icon\" .name=${'difference'}></devtools-icon>\n            <span class=\"header-text\">\n              ${lockedString(`File changes in ${input.projectName}`)}\n            </span>\n          `;\n        }\n\n        return html`\n          <devtools-icon class=\"difference-icon\" .name=${'pen-spark'}></devtools-icon>\n          <span class=\"header-text\">\n            ${lockedString(UIStringsNotTranslate.changeSummary)}\n          </span>\n        `;\n      }\n\n      function renderContent(): LitTemplate {\n        if (!input.changeSummary) {\n          return nothing;\n        }\n\n        if (input.patchSuggestion) {\n          return html`<devtools-widget .widgetConfig=${UI.Widget.widgetConfig(ChangesPanel.CombinedDiffView.CombinedDiffView, {\n            workspaceDiff: input.workspaceDiff,\n          })}></devtools-widget>`;\n        }\n\n        return html`<devtools-code-block\n          .code=${input.changeSummary}\n          .codeLang=${'css'}\n          .displayNotice=${true}\n        ></devtools-code-block>`;\n      }\n\n      function renderFooter(): LitTemplate {\n        if (input.patchSuggestionLoading) {\n          return nothing;\n        }\n\n        if (input.patchSuggestion) {\n          return html`\n          <div class=\"footer\">\n            <x-link class=\"link disclaimer-link\" href=\"https://support.google.com/legal/answer/13505487\" jslog=${\n              VisualLogging.link('code-disclaimer').track({\n                click: true,\n              })}>\n              ${lockedString(UIStringsNotTranslate.codeDisclaimer)}\n            </x-link>\n            <div class=\"save-or-discard-buttons\">\n              <devtools-button\n                @click=${input.onDiscard}\n                .jslogContext=${'discard'}\n                .variant=${Buttons.Button.Variant.OUTLINED}>\n                  ${lockedString(UIStringsNotTranslate.discard)}\n              </devtools-button>\n              <devtools-button\n                @click=${input.onSaveAll}\n                .jslogContext=${'save-all'}\n                .variant=${Buttons.Button.Variant.PRIMARY}>\n                  ${lockedString(UIStringsNotTranslate.saveAll)}\n              </devtools-button>\n            </div>\n          </div>\n          `;\n        }\n\n        return html`\n        <div class=\"footer\">\n          <div class=\"change-workspace\">\n            <div class=\"selected-folder\">\n              ${lockedString(UIStringsNotTranslate.selectedFolder)} <span title=${input.projectPath}>${input.projectName}</span>\n            </div>\n            <devtools-button\n              @click=${input.onChangeWorkspaceClick}\n              .jslogContext=${'change-workspace'}\n              .variant=${Buttons.Button.Variant.TEXT}>\n                ${lockedString(UIStringsNotTranslate.change)}\n            </devtools-button>\n          </div>\n          <div class=\"apply-to-workspace-container\">\n            <devtools-button\n              class=\"apply-to-workspace\"\n              @click=${input.onApplyToWorkspace}\n              .jslogContext=${'stage-to-workspace'}\n              .variant=${Buttons.Button.Variant.OUTLINED}>\n              ${lockedString(UIStringsNotTranslate.applyToWorkspace)}\n            </devtools-button>\n            <devtools-icon aria-describedby=\"info-tooltip\" .name=${'info'}></devtools-icon>\n            <devtools-tooltip id=\"info-tooltip\">${lockedString(UIStringsNotTranslate.applyToWorkspaceTooltip)}</devtools-tooltip>\n          </div>\n        </div>`;\n      }\n\n      render(\n        html`\n          <details class=\"change-summary\">\n            <summary>\n              ${renderHeader()}\n              <devtools-icon\n                class=\"arrow\"\n                .name=${'chevron-down'}\n              ></devtools-icon>\n            </summary>\n            ${renderContent()}\n            ${renderFooter()}\n          </details>\n        `,\n        target,\n        {host: target}\n      );\n    });\n    // clang-format on\n    this.requestUpdate();\n  }\n\n  #onChangeWorkspaceClick(): void {\n    const dialog = new UI.Dialog.Dialog('select-workspace');\n    dialog.setMaxContentSize(new UI.Geometry.Size(384, 340));\n    dialog.setSizeBehavior(UI.GlassPane.SizeBehavior.SET_EXACT_WIDTH_MAX_HEIGHT);\n    dialog.setDimmed(true);\n\n    const handleProjectSelected = (project: Workspace.Workspace.Project): void => {\n      this.#project = project;\n      this.requestUpdate();\n    };\n\n    new SelectWorkspaceDialog({dialog, handleProjectSelected, currentProject: this.#project})\n        .show(dialog.contentElement);\n    dialog.show();\n  }\n\n  override performUpdate(): void {\n    const viewInput = {\n      workspaceDiff: this.#workspaceDiff,\n      changeSummary: this.changeSummary,\n      patchSuggestion: this.#patchSuggestion,\n      patchSuggestionLoading: this.#patchSuggestionLoading,\n      projectName: this.#project?.displayName(),\n      projectPath: Persistence.FileSystemWorkspaceBinding.FileSystemWorkspaceBinding.fileSystemPath(\n          (this.#project?.id() || '') as Platform.DevToolsPath.UrlString),\n      onApplyToWorkspace: this.#onApplyToWorkspace.bind(this),\n      onDiscard: this.#onDiscard.bind(this),\n      onSaveAll: this.#onSaveAll.bind(this),\n      onChangeWorkspaceClick: this.#onChangeWorkspaceClick.bind(this),\n    };\n    this.#view(viewInput, undefined, this.contentElement);\n  }\n\n  override wasShown(): void {\n    super.wasShown();\n    this.#selectDefaultProject();\n\n    if (isAiAssistancePatchingEnabled()) {\n      this.#workspace.addEventListener(Workspace.Workspace.Events.ProjectAdded, this.#onProjectAddedOrRemoved, this);\n      this.#workspace.addEventListener(Workspace.Workspace.Events.ProjectRemoved, this.#onProjectAddedOrRemoved, this);\n\n      // @ts-expect-error temporary global function for local testing.\n      window.aiAssistanceTestPatchPrompt = async (changeSummary: string) => {\n        return await this.#applyPatch(changeSummary);\n      };\n    }\n  }\n\n  override willHide(): void {\n    if (isAiAssistancePatchingEnabled()) {\n      this.#workspace.removeEventListener(Workspace.Workspace.Events.ProjectAdded, this.#onProjectAddedOrRemoved, this);\n      this.#workspace.removeEventListener(\n          Workspace.Workspace.Events.ProjectRemoved, this.#onProjectAddedOrRemoved, this);\n    }\n  }\n\n  #selectDefaultProject(): void {\n    if (isAiAssistancePatchingEnabled()) {\n      // TODO: this is temporary code that should be replaced with\n      // workflow selection flow. For now it picks the first Workspace\n      // project that is not Snippets.\n      const projects = this.#workspace.projectsForType(Workspace.Workspace.projectTypes.FileSystem);\n      this.#project = undefined;\n      for (const project of projects) {\n        // This is for TypeScript to narrow the types. projectsForType()\n        // probably only returns instances of\n        // Persistence.FileSystemWorkspaceBinding.FileSystem.\n        if (!(project instanceof Persistence.FileSystemWorkspaceBinding.FileSystem)) {\n          continue;\n        }\n        if (project.fileSystem().type() !== Persistence.PlatformFileSystem.PlatformFileSystemType.WORKSPACE_PROJECT) {\n          continue;\n        }\n        this.#project = project;\n        this.requestUpdate();\n        break;\n      }\n    }\n  }\n\n  #onProjectAddedOrRemoved(): void {\n    this.#selectDefaultProject();\n  }\n\n  async #onApplyToWorkspace(): Promise<void> {\n    if (!isAiAssistancePatchingEnabled()) {\n      return;\n    }\n    const changeSummary = this.changeSummary;\n    if (!changeSummary) {\n      throw new Error('Change summary does not exist');\n    }\n\n    this.#patchSuggestionLoading = true;\n    this.requestUpdate();\n    const response = await this.#applyPatch(changeSummary);\n    this.#patchSuggestion = response?.type === ResponseType.ANSWER ? response.text : 'Could not update files';\n    this.#patchSuggestionLoading = false;\n    this.requestUpdate();\n  }\n\n  #onDiscard(): void {\n    // TODO: Remove changes from the working copies as well.\n    this.#patchSuggestion = undefined;\n    this.requestUpdate();\n  }\n\n  #onSaveAll(): void {\n    // TODO: Handle saving all the files.\n  }\n\n  async #applyPatch(changeSummary: string): Promise<ResponseData|undefined> {\n    if (!this.#project) {\n      throw new Error('Project does not exist');\n    }\n    const agent = new PatchAgent({\n      aidaClient: this.#aidaClient,\n      serverSideLoggingEnabled: false,\n      project: this.#project,\n    });\n    const responses = await Array.fromAsync(agent.applyChanges(changeSummary));\n    return responses.at(-1);\n  }\n}\n\nexport function isAiAssistancePatchingEnabled(): boolean {\n  const {hostConfig} = Root.Runtime;\n  return Boolean(hostConfig.devToolsFreestyler?.patching);\n}\n"]}