{"version":3,"file":"PatchWidget.js","sourceRoot":"","sources":["../../../../../../front_end/panels/ai_assistance/PatchWidget.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright 2025 The Chromium Authors. All rights reserved.\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n/* eslint-disable rulesdir/no-lit-render-outside-of-view */\n\nimport '../../ui/legacy/legacy.js';\nimport '../../ui/components/markdown_view/markdown_view.js';\nimport '../../ui/components/spinners/spinners.js';\n\nimport * as Common from '../../core/common/common.js';\nimport * as Host from '../../core/host/host.js';\nimport * as i18n from '../../core/i18n/i18n.js';\nimport * as Platform from '../../core/platform/platform.js';\nimport * as Root from '../../core/root/root.js';\nimport * as AiAssistanceModel from '../../models/ai_assistance/ai_assistance.js';\nimport * as Persistence from '../../models/persistence/persistence.js';\nimport * as Workspace from '../../models/workspace/workspace.js';\nimport * as WorkspaceDiff from '../../models/workspace_diff/workspace_diff.js';\nimport * as Buttons from '../../ui/components/buttons/buttons.js';\nimport * as UI from '../../ui/legacy/legacy.js';\nimport {Directives, html, type LitTemplate, nothing, render} from '../../ui/lit/lit.js';\nimport * as VisualLogging from '../../ui/visual_logging/visual_logging.js';\nimport * as ChangesPanel from '../changes/changes.js';\nimport * as PanelCommon from '../common/common.js';\n\nimport {SelectWorkspaceDialog} from './SelectWorkspaceDialog.js';\n\n/*\n* Strings that don't need to be translated at this time.\n*/\nconst UIStringsNotTranslate = {\n  /**\n   *@description Text displayed for showing patch widget view.\n   */\n  unsavedChanges: 'Unsaved changes',\n  /**\n   *@description Loading text displayed as a summary title when the patch suggestion is getting loaded\n   */\n  applyingToWorkspace: 'Applying to workspace…',\n  /**\n   *@description Button text for staging changes to workspace.\n   */\n  applyToWorkspace: 'Apply to workspace',\n  /**\n   *@description Button text to change the selected workspace\n   */\n  change: 'Change',\n  /**\n   * @description Accessible title of the Change button to indicate that\n   * the button can be used to change the root folder.\n   */\n  changeRootFolder: 'Change project root folder',\n  /**\n   *@description Button text to cancel applying to workspace\n   */\n  cancel: 'Cancel',\n  /**\n   *@description Button text to discard the suggested changes and not save them to file system\n   */\n  discard: 'Discard',\n  /**\n   *@description Button text to save all the suggested changes to file system\n   */\n  saveAll: 'Save all',\n  /**\n   *@description Header text after the user saved the changes to the disk.\n   */\n  savedToDisk: 'Saved to disk',\n  /**\n   *@description Disclaimer text shown for using code snippets with caution\n   */\n  codeDisclaimer: 'Use code snippets with caution',\n  /**\n   *@description Tooltip text for the info icon beside the \"Apply to workspace\" button\n   */\n  applyToWorkspaceTooltip: 'Source code from the selected folder is sent to Google to generate code suggestions.',\n  /**\n   *@description Tooltip text for the info icon beside the \"Apply to workspace\" button when enterprise logging is off\n   */\n  applyToWorkspaceTooltipNoLogging:\n      'Source code from the selected folder is sent to Google to generate code suggestions. This data will not be used to improve Google’s AI models.',\n  /**\n   *@description The footer disclaimer that links to more information\n   * about the AI feature. Same text as in ChatView.\n   */\n  learnMore: 'Learn about AI in DevTools',\n  /**\n   *@description Header text for the AI-powered code suggestions disclaimer dialog.\n   */\n  freDisclaimerHeader: 'Get AI-powered code suggestions for your workspace',\n  /**\n   *@description First disclaimer item text for the fre dialog.\n   */\n  freDisclaimerTextAiWontAlwaysGetItRight: 'This feature uses AI and won’t always get it right',\n  /**\n   *@description Second disclaimer item text for the fre dialog.\n   */\n  freDisclaimerTextPrivacy: 'Source code from the selected folder is sent to Google to generate code suggestions',\n  /**\n   *@description Second disclaimer item text for the fre dialog when enterprise logging is off.\n   */\n  freDisclaimerTextPrivacyNoLogging:\n      'Source code from the selected folder is sent to Google to generate code suggestions. This data will not be used to improve Google’s AI models.',\n  /**\n   *@description Third disclaimer item text for the fre dialog.\n   */\n  freDisclaimerTextUseWithCaution: 'Use generated code snippets with caution',\n  /**\n   * @description Title of the link opening data that was used to\n   * produce a code suggestion.\n   */\n  viewUploadedFiles: 'View data sent to Google',\n  /**\n   * @description Text indicating that a link opens in a new tab (for a11y).\n   */\n  opensInNewTab: '(opens in a new tab)',\n  /**\n   * @description Generic error text for the case the changes were not applied to the workspace.\n   */\n  genericErrorMessage: 'Changes couldn’t be applied to your workspace.',\n} as const;\n\nconst lockedString = i18n.i18n.lockedString;\n\nconst CODE_SNIPPET_WARNING_URL = 'https://support.google.com/legal/answer/13505487';\n\nexport enum PatchSuggestionState {\n  /**\n   * The user did not attempt patching yet\n   */\n  INITIAL = 'initial',\n  /**\n   * Applying to page tree is in progress\n   */\n  LOADING = 'loading',\n  /**\n   * Applying to page tree succeeded\n   */\n  SUCCESS = 'success',\n  /**\n   * Applying to page tree failed\n   */\n  ERROR = 'error',\n}\n\nenum SelectedProjectType {\n  /**\n   * No project selected\n   */\n  NONE = 'none',\n  /**\n   * The selected project is not an automatic workspace project\n   */\n  REGULAR = 'regular',\n  /**\n   * The selected project is a disconnected automatic workspace project\n   */\n  AUTOMATIC_DISCONNECTED = 'automaticDisconncted',\n  /**\n   * The selected project is a connected automatic workspace project\n   */\n  AUTOMATIC_CONNECTED = 'automaticConnected',\n}\n\nexport interface ViewInput {\n  workspaceDiff: WorkspaceDiff.WorkspaceDiff.WorkspaceDiffImpl;\n  patchSuggestionState: PatchSuggestionState;\n  changeSummary?: string;\n  sources?: string;\n  projectName: string;\n  projectPath: Platform.DevToolsPath.RawPathString;\n  projectType: SelectedProjectType;\n  savedToDisk?: boolean;\n  applyToWorkspaceTooltipText: Platform.UIString.LocalizedString;\n  onLearnMoreTooltipClick: () => void;\n  onApplyToWorkspace: () => void;\n  onCancel: () => void;\n  onDiscard: () => void;\n  onSaveAll: () => void;\n  onChangeWorkspaceClick?: () => void;\n}\n\nexport interface ViewOutput {\n  tooltipRef?: Directives.Ref<HTMLElement>;\n  changeRef?: Directives.Ref<HTMLElement>;\n  summaryRef?: Directives.Ref<HTMLElement>;\n}\n\ntype View = (input: ViewInput, output: ViewOutput, target: HTMLElement) => void;\n\nexport class PatchWidget extends UI.Widget.Widget {\n  changeSummary = '';\n  changeManager: AiAssistanceModel.ChangeManager|undefined;\n  // Whether the user completed first run experience dialog or not.\n  #aiPatchingFreCompletedSetting =\n      Common.Settings.Settings.instance().createSetting('ai-assistance-patching-fre-completed', false);\n  #projectIdSetting =\n      Common.Settings.Settings.instance().createSetting('ai-assistance-patching-selected-project-id', '');\n  #view: View;\n  #viewOutput: ViewOutput = {};\n  #aidaClient: Host.AidaClient.AidaClient;\n  #applyPatchAbortController?: AbortController;\n  #project?: Workspace.Workspace.Project;\n  #patchSources?: string;\n  #savedToDisk?: boolean;\n  #noLogging: boolean;  // Whether the enterprise setting is `ALLOW_WITHOUT_LOGGING` or not.\n  #patchSuggestionState = PatchSuggestionState.INITIAL;\n  #workspaceDiff = WorkspaceDiff.WorkspaceDiff.workspaceDiff();\n  #workspace = Workspace.Workspace.WorkspaceImpl.instance();\n  #automaticFileSystem =\n      Persistence.AutomaticFileSystemManager.AutomaticFileSystemManager.instance().automaticFileSystem;\n  #applyToDisconnectedAutomaticWorkspace = false;\n  #popoverHelper: UI.PopoverHelper.PopoverHelper|null = null;\n\n  constructor(element?: HTMLElement, view?: View, opts?: {\n    aidaClient: Host.AidaClient.AidaClient,\n  }) {\n    super(false, false, element);\n    this.#aidaClient = opts?.aidaClient ?? new Host.AidaClient.AidaClient();\n    this.#noLogging = Root.Runtime.hostConfig.aidaAvailability?.enterprisePolicyValue ===\n        Root.Runtime.GenAiEnterprisePolicyValue.ALLOW_WITHOUT_LOGGING;\n\n    // clang-format off\n    this.#view = view ?? ((input, output, target) => {\n      if (!input.changeSummary && input.patchSuggestionState === PatchSuggestionState.INITIAL) {\n        return;\n      }\n      output.tooltipRef = output.tooltipRef ?? Directives.createRef<HTMLElement>();\n      output.changeRef = output.changeRef ?? Directives.createRef<HTMLElement>();\n      output.summaryRef = output.summaryRef ?? Directives.createRef<HTMLElement>();\n\n      function renderSourcesLink(): LitTemplate {\n        if (!input.sources) {\n          return nothing;\n        }\n\n        return html`<x-link\n          class=\"link\"\n          title=\"${UIStringsNotTranslate.viewUploadedFiles} ${UIStringsNotTranslate.opensInNewTab}\"\n          href=\"data:text/plain,${encodeURIComponent(input.sources)}\"\n          jslog=${VisualLogging.link('files-used-in-patching').track({click: true})}>\n          ${UIStringsNotTranslate.viewUploadedFiles}\n        </x-link>`;\n      }\n\n      function renderHeader(): LitTemplate {\n        if (input.savedToDisk) {\n          return html`\n            <devtools-icon class=\"green-bright-icon summary-badge\" .name=${'check-circle'}></devtools-icon>\n            <span class=\"header-text\">\n              ${lockedString(UIStringsNotTranslate.savedToDisk)}\n            </span>\n          `;\n        }\n\n        if (input.patchSuggestionState === PatchSuggestionState.SUCCESS) {\n          return html`\n            <devtools-icon class=\"on-tonal-icon summary-badge\" .name=${'difference'}></devtools-icon>\n            <span class=\"header-text\">\n              ${lockedString(`File changes in ${input.projectName}`)}\n            </span>\n            <devtools-icon\n              class=\"arrow\"\n              .name=${'chevron-down'}\n            ></devtools-icon>\n          `;\n        }\n\n        return html`\n          <devtools-icon class=\"on-tonal-icon summary-badge\" .name=${'pen-spark'}></devtools-icon>\n          <span class=\"header-text\">\n            ${lockedString(UIStringsNotTranslate.unsavedChanges)}\n          </span>\n          <devtools-icon\n            class=\"arrow\"\n            .name=${'chevron-down'}\n          ></devtools-icon>\n        `;\n      }\n\n      function renderContent(): LitTemplate {\n        if ((!input.changeSummary && input.patchSuggestionState === PatchSuggestionState.INITIAL) || input.savedToDisk) {\n          return nothing;\n        }\n\n        if (input.patchSuggestionState === PatchSuggestionState.SUCCESS) {\n          return html`<devtools-widget .widgetConfig=${UI.Widget.widgetConfig(ChangesPanel.CombinedDiffView.CombinedDiffView, {\n            workspaceDiff: input.workspaceDiff,\n            // Ignore user creates inspector-stylesheets\n            ignoredUrls: ['inspector://']\n          })}></devtools-widget>`;\n        }\n\n        return html`<devtools-code-block\n          .code=${input.changeSummary ?? ''}\n          .codeLang=${'css'}\n          .displayNotice=${true}\n        ></devtools-code-block>\n        ${input.patchSuggestionState === PatchSuggestionState.ERROR\n          ? html`<div class=\"error-container\">\n              <devtools-icon .name=${'cross-circle-filled'}></devtools-icon>${\n              lockedString(UIStringsNotTranslate.genericErrorMessage)\n              } ${renderSourcesLink()}\n            </div>`\n          : nothing\n        }`;\n      }\n\n      function renderFooter(): LitTemplate {\n        if (input.savedToDisk) {\n          return nothing;\n        }\n\n        if (input.patchSuggestionState === PatchSuggestionState.SUCCESS) {\n          return html`\n          <div class=\"footer\">\n            <div class=\"left-side\">\n              <x-link class=\"link disclaimer-link\" href=\"https://support.google.com/legal/answer/13505487\" jslog=${\n                VisualLogging.link('code-disclaimer').track({\n                  click: true,\n                })}>\n                ${lockedString(UIStringsNotTranslate.codeDisclaimer)}\n              </x-link>\n              ${renderSourcesLink()}\n            </div>\n            <div class=\"save-or-discard-buttons\">\n              <devtools-button\n                @click=${input.onDiscard}\n                .jslogContext=${'patch-widget.discard'}\n                .variant=${Buttons.Button.Variant.OUTLINED}>\n                  ${lockedString(UIStringsNotTranslate.discard)}\n              </devtools-button>\n              <devtools-button\n                @click=${input.onSaveAll}\n                .jslogContext=${'patch-widget.save-all'}\n                .variant=${Buttons.Button.Variant.PRIMARY}>\n                  ${lockedString(UIStringsNotTranslate.saveAll)}\n              </devtools-button>\n            </div>\n          </div>\n          `;\n        }\n\n        const iconName = input.projectType === SelectedProjectType.AUTOMATIC_DISCONNECTED ? 'folder-off' : input.projectType === SelectedProjectType.AUTOMATIC_CONNECTED ? 'folder-asterisk' : 'folder';\n        return html`\n        <div class=\"footer\">\n          ${input.projectName ? html`\n            <div class=\"change-workspace\">\n                <devtools-icon .name=${iconName}></devtools-icon>\n                <span class=\"folder-name\" title=${input.projectPath}>${input.projectName}</span>\n              ${input.onChangeWorkspaceClick ? html`\n                <devtools-button\n                  @click=${input.onChangeWorkspaceClick}\n                  .jslogContext=${'change-workspace'}\n                  .variant=${Buttons.Button.Variant.TEXT}\n                  .title=${lockedString(UIStringsNotTranslate.changeRootFolder)}\n                  .disabled=${input.patchSuggestionState === PatchSuggestionState.LOADING}\n                  ${Directives.ref(output.changeRef)}\n                >${lockedString(UIStringsNotTranslate.change)}</devtools-button>\n              ` : nothing}\n            </div>\n          ` : nothing}\n          <div class=\"apply-to-workspace-container\" aria-live=\"polite\">\n            ${input.patchSuggestionState === PatchSuggestionState.LOADING ? html`\n              <div class=\"loading-text-container\">\n                <devtools-spinner></devtools-spinner>\n                <span>\n                  ${lockedString(UIStringsNotTranslate.applyingToWorkspace)}\n                </span>\n              </div>\n            ` : html`\n                <devtools-button\n                @click=${input.onApplyToWorkspace}\n                .jslogContext=${'stage-to-workspace'}\n                .variant=${Buttons.Button.Variant.OUTLINED}>\n                ${lockedString(UIStringsNotTranslate.applyToWorkspace)}\n              </devtools-button>\n            `}\n            ${input.patchSuggestionState === PatchSuggestionState.LOADING ? html`<devtools-button\n              @click=${input.onCancel}\n              .jslogContext=${'cancel'}\n              .variant=${Buttons.Button.Variant.OUTLINED}>\n              ${lockedString(UIStringsNotTranslate.cancel)}\n            </devtools-button>` : nothing}\n            <devtools-button\n              aria-details=\"info-tooltip\"\n              .iconName=${'info'}\n              .variant=${Buttons.Button.Variant.ICON}\n              .title=${input.applyToWorkspaceTooltipText}\n            ></devtools-button>\n          </div>\n        </div>`;\n      }\n\n      // Use a simple div for the \"Saved to disk\" state as it's not expandable,\n      // otherwise use the interactive <details> element.\n      const template = input.savedToDisk\n        ? html`\n          <div class=\"change-summary saved-to-disk\" role=\"status\" aria-live=\"polite\">\n            <div class=\"header-container\">\n             ${renderHeader()}\n             </div>\n          </div>`\n        : html`\n          <details class=\"change-summary\">\n            <summary class=\"header-container\" ${Directives.ref(output.summaryRef)}>\n              ${renderHeader()}\n            </summary>\n            ${renderContent()}\n            ${renderFooter()}\n          </details>\n        `;\n\n      render(template, target, {host: target});\n    });\n    // We're using PopoverHelper as a workaround instead of using <devtools-tooltip>. See the bug for more details.\n    // TODO: Update here when b/409965560 is fixed.\n    this.#popoverHelper = new UI.PopoverHelper.PopoverHelper(this.contentElement, event => {\n      // There are two ways this event is received for showing a popover case:\n      // * The latest element on the composed path is `<devtools-button>`\n      // * The 2nd element on the composed path is `<devtools-button>` (the last element is the `<button>` inside it.)\n      const hoveredNode = event.composedPath()[0];\n      const maybeDevToolsButton = event.composedPath()[2];\n\n      const popoverShownNode = hoveredNode instanceof HTMLElement && hoveredNode.getAttribute('aria-details') === 'info-tooltip' ? hoveredNode\n        : maybeDevToolsButton instanceof HTMLElement && maybeDevToolsButton.getAttribute('aria-details') === 'info-tooltip' ? maybeDevToolsButton\n        : null;\n      if (!popoverShownNode) {\n        return null;\n      }\n      return {\n        box: popoverShownNode.boxInWindow(),\n        show: async (popover: UI.GlassPane.GlassPane) => {\n          // clang-format off\n          render(html`\n            <style>\n              .info-tooltip-container {\n                max-width: var(--sys-size-28);\n                padding: var(--sys-size-4) var(--sys-size-5);\n\n                .tooltip-link {\n                  display: block;\n                  margin-top: var(--sys-size-4);\n                  color: var(--sys-color-primary);\n                  padding-left: 0;\n                }\n              }\n            </style>\n            <div class=\"info-tooltip-container\">\n              ${UIStringsNotTranslate.applyToWorkspaceTooltip}\n              <button\n                class=\"link tooltip-link\"\n                role=\"link\"\n                jslog=${VisualLogging.link('open-ai-settings').track({\n                  click: true,\n                })}\n                @click=${this.#onLearnMoreTooltipClick}\n              >${lockedString(UIStringsNotTranslate.learnMore)}</button>\n            </div>`, popover.contentElement, {host: this});\n          // clang-forat on\n          return true;\n        },\n      };\n    }, 'patch-widget.info-tooltip');\n    this.#popoverHelper.setTimeout(0);\n    // clang-format on\n    this.requestUpdate();\n  }\n\n  #onLearnMoreTooltipClick(): void {\n    this.#viewOutput.tooltipRef?.value?.hidePopover();\n    void UI.ViewManager.ViewManager.instance().showView('chrome-ai');\n  }\n\n  #getDisplayedProject(): {projectName: string, projectPath: Platform.DevToolsPath.RawPathString} {\n    if (this.#project) {\n      return {\n        projectName: Common.ParsedURL.ParsedURL.encodedPathToRawPathString(\n            this.#project.displayName() as Platform.DevToolsPath.EncodedPathString),\n        projectPath: Common.ParsedURL.ParsedURL.urlToRawPathString(\n            this.#project.id() as Platform.DevToolsPath.UrlString, Host.Platform.isWin()),\n      };\n    }\n    if (this.#automaticFileSystem) {\n      return {\n        projectName: Common.ParsedURL.ParsedURL.extractName(this.#automaticFileSystem.root),\n        projectPath: this.#automaticFileSystem.root,\n      };\n    }\n    return {\n      projectName: '',\n      projectPath: Platform.DevToolsPath.EmptyRawPathString,\n    };\n  }\n\n  #shouldShowChangeButton(): boolean {\n    const automaticFileSystemProject =\n        this.#automaticFileSystem ? this.#workspace.projectForFileSystemRoot(this.#automaticFileSystem.root) : null;\n    const regularProjects = this.#workspace.projectsForType(Workspace.Workspace.projectTypes.FileSystem)\n                                .filter(\n                                    project => project instanceof Persistence.FileSystemWorkspaceBinding.FileSystem &&\n                                        project.fileSystem().type() ===\n                                            Persistence.PlatformFileSystem.PlatformFileSystemType.WORKSPACE_PROJECT)\n                                .filter(project => project !== automaticFileSystemProject);\n    return regularProjects.length > 0;\n  }\n\n  #getSelectedProjectType(projectPath: Platform.DevToolsPath.RawPathString): SelectedProjectType {\n    if (this.#automaticFileSystem && this.#automaticFileSystem.root === projectPath) {\n      return this.#project ? SelectedProjectType.AUTOMATIC_CONNECTED : SelectedProjectType.AUTOMATIC_DISCONNECTED;\n    }\n    return this.#project ? SelectedProjectType.NONE : SelectedProjectType.REGULAR;\n  }\n\n  override performUpdate(): void {\n    const {projectName, projectPath} = this.#getDisplayedProject();\n\n    this.#view(\n        {\n          workspaceDiff: this.#workspaceDiff,\n          changeSummary: this.changeSummary,\n          patchSuggestionState: this.#patchSuggestionState,\n          sources: this.#patchSources,\n          projectName,\n          projectPath,\n          projectType: this.#getSelectedProjectType(projectPath),\n          savedToDisk: this.#savedToDisk,\n          applyToWorkspaceTooltipText: this.#noLogging ?\n              lockedString(UIStringsNotTranslate.applyToWorkspaceTooltipNoLogging) :\n              lockedString(UIStringsNotTranslate.applyToWorkspaceTooltip),\n          onLearnMoreTooltipClick: this.#onLearnMoreTooltipClick.bind(this),\n          onApplyToWorkspace: this.#onApplyToWorkspace.bind(this),\n          onCancel: () => {\n            this.#applyPatchAbortController?.abort();\n          },\n          onDiscard: this.#onDiscard.bind(this),\n          onSaveAll: this.#onSaveAll.bind(this),\n          onChangeWorkspaceClick: this.#shouldShowChangeButton() ?\n              this.#showSelectWorkspaceDialog.bind(this, {applyPatch: false}) :\n              undefined,\n        },\n        this.#viewOutput, this.contentElement);\n  }\n\n  override wasShown(): void {\n    super.wasShown();\n    this.#selectDefaultProject();\n\n    if (isAiAssistancePatchingEnabled()) {\n      this.#workspace.addEventListener(Workspace.Workspace.Events.ProjectAdded, this.#onProjectAdded, this);\n      this.#workspace.addEventListener(Workspace.Workspace.Events.ProjectRemoved, this.#onProjectRemoved, this);\n    }\n  }\n\n  override willHide(): void {\n    this.#applyToDisconnectedAutomaticWorkspace = false;\n    if (isAiAssistancePatchingEnabled()) {\n      this.#workspace.removeEventListener(Workspace.Workspace.Events.ProjectAdded, this.#onProjectAdded, this);\n      this.#workspace.removeEventListener(Workspace.Workspace.Events.ProjectRemoved, this.#onProjectRemoved, this);\n    }\n  }\n\n  async #showFreDisclaimerIfNeeded(): Promise<boolean> {\n    const isAiPatchingFreCompleted = this.#aiPatchingFreCompletedSetting.get();\n    if (isAiPatchingFreCompleted) {\n      return true;\n    }\n\n    const result = await PanelCommon.FreDialog.show({\n      header: {iconName: 'smart-assistant', text: lockedString(UIStringsNotTranslate.freDisclaimerHeader)},\n      reminderItems: [\n        {\n          iconName: 'psychiatry',\n          content: lockedString(UIStringsNotTranslate.freDisclaimerTextAiWontAlwaysGetItRight),\n        },\n        {\n          iconName: 'google',\n          content: this.#noLogging ? lockedString(UIStringsNotTranslate.freDisclaimerTextPrivacyNoLogging) :\n                                     lockedString(UIStringsNotTranslate.freDisclaimerTextPrivacy),\n        },\n        {\n          iconName: 'warning',\n          // clang-format off\n          content: html`<x-link\n            href=${CODE_SNIPPET_WARNING_URL}\n            class=\"link devtools-link\"\n            jslog=${VisualLogging.link('code-snippets-explainer.patch-widget').track({\n              click: true\n            })}\n          >${lockedString(UIStringsNotTranslate.freDisclaimerTextUseWithCaution)}</x-link>`,\n          // clang-format on\n        }\n      ],\n      onLearnMoreClick: () => {\n        void UI.ViewManager.ViewManager.instance().showView('chrome-ai');\n      },\n      ariaLabel: lockedString(UIStringsNotTranslate.freDisclaimerHeader),\n      learnMoreButtonTitle: lockedString(UIStringsNotTranslate.learnMore),\n    });\n\n    if (result) {\n      this.#aiPatchingFreCompletedSetting.set(true);\n    }\n    return result;\n  }\n\n  #selectDefaultProject(): void {\n    const project = this.#automaticFileSystem ?\n        this.#workspace.projectForFileSystemRoot(this.#automaticFileSystem.root) :\n        this.#workspace.project(this.#projectIdSetting.get());\n    if (project) {\n      this.#project = project;\n    } else {\n      this.#project = undefined;\n      this.#projectIdSetting.set('');\n    }\n    this.requestUpdate();\n  }\n\n  #onProjectAdded(event: Common.EventTarget.EventTargetEvent<Workspace.Workspace.Project>): void {\n    const addedProject = event.data;\n    if (this.#applyToDisconnectedAutomaticWorkspace && this.#automaticFileSystem &&\n        addedProject === this.#workspace.projectForFileSystemRoot(this.#automaticFileSystem.root)) {\n      this.#applyToDisconnectedAutomaticWorkspace = false;\n      this.#project = addedProject;\n      void this.#applyPatchAndUpdateUI();\n    } else if (this.#project === undefined) {\n      this.#selectDefaultProject();\n    }\n  }\n\n  #onProjectRemoved(): void {\n    if (this.#project && !this.#workspace.project(this.#project.id())) {\n      this.#projectIdSetting.set('');\n      this.#project = undefined;\n      this.requestUpdate();\n    }\n  }\n\n  #showSelectWorkspaceDialog(options: {applyPatch: boolean} = {applyPatch: false}): void {\n    const onProjectSelected = (project: Workspace.Workspace.Project): void => {\n      this.#project = project;\n      this.#projectIdSetting.set(project.id());\n      if (options.applyPatch) {\n        void this.#applyPatchAndUpdateUI();\n      } else {\n        this.requestUpdate();\n        void this.updateComplete.then(() => {\n          this.contentElement?.querySelector('.apply-to-workspace-container devtools-button')\n              ?.shadowRoot?.querySelector('button')\n              ?.focus();\n        });\n      }\n    };\n\n    SelectWorkspaceDialog.show(onProjectSelected, this.#project);\n  }\n\n  async #onApplyToWorkspace(): Promise<void> {\n    if (!isAiAssistancePatchingEnabled()) {\n      return;\n    }\n\n    // Show the FRE dialog if needed and only continue when\n    // the user accepted the disclaimer.\n    const freDisclaimerCompleted = await this.#showFreDisclaimerIfNeeded();\n    if (!freDisclaimerCompleted) {\n      return;\n    }\n\n    if (this.#project) {\n      await this.#applyPatchAndUpdateUI();\n    } else if (this.#automaticFileSystem) {\n      this.#applyToDisconnectedAutomaticWorkspace = true;\n      await Persistence.AutomaticFileSystemManager.AutomaticFileSystemManager.instance().connectAutomaticFileSystem(\n          /* addIfMissing= */ true);\n    } else {\n      this.#showSelectWorkspaceDialog({applyPatch: true});\n    }\n  }\n\n  async #applyPatchAndUpdateUI(): Promise<void> {\n    const changeSummary = this.changeSummary;\n    if (!changeSummary) {\n      throw new Error('Change summary does not exist');\n    }\n\n    this.#patchSuggestionState = PatchSuggestionState.LOADING;\n    this.requestUpdate();\n    const {response, processedFiles} = await this.#applyPatch(changeSummary);\n    if (response?.type === AiAssistanceModel.ResponseType.ANSWER) {\n      this.#patchSuggestionState = PatchSuggestionState.SUCCESS;\n    } else if (\n        response?.type === AiAssistanceModel.ResponseType.ERROR &&\n        response.error === AiAssistanceModel.ErrorType.ABORT) {\n      // If this is an abort error, we're returning back to the initial state.\n      this.#patchSuggestionState = PatchSuggestionState.INITIAL;\n    } else {\n      this.#patchSuggestionState = PatchSuggestionState.ERROR;\n    }\n    this.#patchSources = `Filenames in ${this.#project?.displayName()}.\nFiles:\n${processedFiles.map(filename => `* ${filename}`).join('\\n')}`;\n    this.requestUpdate();\n\n    if (this.#patchSuggestionState === PatchSuggestionState.SUCCESS) {\n      void this.updateComplete.then(() => {\n        this.#viewOutput.summaryRef?.value?.focus();\n      });\n    }\n  }\n\n  #onDiscard(): void {\n    this.#workspaceDiff.modifiedUISourceCodes().forEach(modifiedUISourceCode => {\n      modifiedUISourceCode.resetWorkingCopy();\n    });\n\n    this.#patchSuggestionState = PatchSuggestionState.INITIAL;\n    this.#patchSources = undefined;\n    void this.changeManager?.popStashedChanges();\n    this.requestUpdate();\n    void this.updateComplete.then(() => {\n      this.#viewOutput.changeRef?.value?.focus();\n    });\n  }\n\n  #onSaveAll(): void {\n    this.#workspaceDiff.modifiedUISourceCodes().forEach(modifiedUISourceCode => {\n      if (!modifiedUISourceCode.url().startsWith('inspector://')) {\n        modifiedUISourceCode.commitWorkingCopy();\n      }\n    });\n    void this.changeManager?.stashChanges().then(() => {\n      this.changeManager?.dropStashedChanges();\n    });\n\n    this.#savedToDisk = true;\n    this.requestUpdate();\n  }\n\n  async #applyPatch(changeSummary: string): Promise<{\n    response: AiAssistanceModel.ResponseData | undefined,\n    processedFiles: string[],\n  }> {\n    if (!this.#project) {\n      throw new Error('Project does not exist');\n    }\n    this.#applyPatchAbortController = new AbortController();\n    const agent = new AiAssistanceModel.PatchAgent({\n      aidaClient: this.#aidaClient,\n      serverSideLoggingEnabled: false,\n      project: this.#project,\n    });\n    const {responses, processedFiles} =\n        await agent.applyChanges(changeSummary, {signal: this.#applyPatchAbortController.signal});\n    return {\n      response: responses.at(-1),\n      processedFiles,\n    };\n  }\n}\n\nexport function isAiAssistancePatchingEnabled(): boolean {\n  return Boolean(Root.Runtime.hostConfig.devToolsFreestyler?.patching);\n}\n\ninterface ExpectedChange {\n  path: string;\n  matches: string[];\n  doesNotMatch?: string[];\n}\n\n// @ts-expect-error temporary global function for local testing.\nwindow.aiAssistanceTestPatchPrompt =\n    async (projectName: string, changeSummary: string, expectedChanges: ExpectedChange[]) => {\n  if (!isAiAssistancePatchingEnabled()) {\n    return;\n  }\n  const workspaceDiff = WorkspaceDiff.WorkspaceDiff.workspaceDiff();\n  const workspace = Workspace.Workspace.WorkspaceImpl.instance();\n  const project = workspace.projectsForType(Workspace.Workspace.projectTypes.FileSystem)\n                      .filter(\n                          project => project instanceof Persistence.FileSystemWorkspaceBinding.FileSystem &&\n                              project.fileSystem().type() ===\n                                  Persistence.PlatformFileSystem.PlatformFileSystemType.WORKSPACE_PROJECT)\n                      .find(project => project.displayName() === projectName);\n\n  if (!project) {\n    throw new Error('project not found');\n  }\n  const aidaClient = new Host.AidaClient.AidaClient();\n  const agent = new AiAssistanceModel.PatchAgent({\n    aidaClient,\n    serverSideLoggingEnabled: false,\n    project,\n  });\n  const results = [];\n  try {\n    const {processedFiles} = await agent.applyChanges(changeSummary);\n    for (const file of processedFiles) {\n      const change = expectedChanges.find(change => change.path === file);\n      if (!change) {\n        results.push(`Patched ${file} that was not expected`);\n        break;\n      }\n      const agentProject = agent.agentProject;\n      const content = await agentProject.readFile(file);\n      if (!content) {\n        throw new Error(`${file} has no content`);\n      }\n      for (const m of change.matches) {\n        if (!content.match(new RegExp(m, 'gm'))) {\n          results.push({\n            message: `Did not match ${m} in ${file}`,\n            file,\n            content,\n          });\n        }\n      }\n      for (const m of change.doesNotMatch || []) {\n        if (content.match(new RegExp(m, 'gm'))) {\n          results.push({\n            message: `Unexpectedly matched ${m} in ${file}`,\n            file,\n            content,\n          });\n        }\n      }\n    }\n  } finally {\n    workspaceDiff.modifiedUISourceCodes().forEach(modifiedUISourceCode => {\n      modifiedUISourceCode.resetWorkingCopy();\n    });\n  }\n  return results;\n};\n"]}