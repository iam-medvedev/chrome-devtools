{"version":3,"file":"AiAssistancePanel.js","sourceRoot":"","sources":["../../../../../../front_end/panels/ai_assistance/AiAssistancePanel.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright 2024 The Chromium Authors. All rights reserved.\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport '../../ui/legacy/legacy.js';\n\nimport * as Common from '../../core/common/common.js';\nimport * as Host from '../../core/host/host.js';\nimport * as i18n from '../../core/i18n/i18n.js';\nimport type * as Platform from '../../core/platform/platform.js';\nimport * as Root from '../../core/root/root.js';\nimport * as SDK from '../../core/sdk/sdk.js';\nimport * as Protocol from '../../generated/protocol.js';\nimport * as Persistence from '../../models/persistence/persistence.js';\nimport * as Workspace from '../../models/workspace/workspace.js';\nimport * as Buttons from '../../ui/components/buttons/buttons.js';\nimport * as UI from '../../ui/legacy/legacy.js';\nimport * as Lit from '../../ui/lit/lit.js';\nimport * as VisualLogging from '../../ui/visual_logging/visual_logging.js';\nimport * as ElementsPanel from '../elements/elements.js';\nimport * as NetworkForward from '../network/forward/forward.js';\nimport * as NetworkPanel from '../network/network.js';\nimport * as SourcesPanel from '../sources/sources.js';\nimport * as TimelinePanel from '../timeline/timeline.js';\nimport * as TimelineUtils from '../timeline/utils/utils.js';\n\nimport {\n  AgentType,\n  type AiAgent,\n  type ConversationContext,\n  ErrorType,\n  type ResponseData,\n  ResponseType,\n} from './agents/AiAgent.js';\nimport {\n  FileAgent,\n  FileContext,\n} from './agents/FileAgent.js';\nimport {\n  NetworkAgent,\n  RequestContext,\n} from './agents/NetworkAgent.js';\nimport {PatchAgent} from './agents/PatchAgent.js';\nimport {CallTreeContext, PerformanceAgent} from './agents/PerformanceAgent.js';\nimport {InsightContext, PerformanceInsightsAgent} from './agents/PerformanceInsightsAgent.js';\nimport {NodeContext, StylingAgent, StylingAgentWithFunctionCalling} from './agents/StylingAgent.js';\nimport aiAssistancePanelStyles from './aiAssistancePanel.css.js';\nimport {AiHistoryStorage, Conversation, ConversationType} from './AiHistoryStorage.js';\nimport {ChangeManager} from './ChangeManager.js';\nimport {\n  type ChatMessage,\n  ChatMessageEntity,\n  ChatView,\n  type ModelChatMessage,\n  type Props as ChatViewProps,\n  State as ChatViewState,\n  type Step\n} from './components/ChatView.js';\n\nconst {html} = Lit;\n\nconst AI_ASSISTANCE_SEND_FEEDBACK = 'https://crbug.com/364805393' as Platform.DevToolsPath.UrlString;\nconst AI_ASSISTANCE_HELP = 'https://goo.gle/devtools-ai-assistance' as Platform.DevToolsPath.UrlString;\nconst SCREENSHOT_QUALITY = 100;\n\nconst UIStrings = {\n  /**\n   *@description AI assistance UI text creating a new chat.\n   */\n  newChat: 'New chat',\n  /**\n   *@description AI assistance UI tooltip text for the help button.\n   */\n  help: 'Help',\n  /**\n   *@description AI assistant UI tooltip text for the settings button (gear icon).\n   */\n  settings: 'Settings',\n  /**\n   *@description AI assistant UI tooltip sending feedback.\n   */\n  sendFeedback: 'Send feedback',\n  /**\n   *@description Announcement text for screen readers when a new chat is created.\n   */\n  newChatCreated: 'New chat created',\n  /**\n   *@description Announcement text for screen readers when the chat is deleted.\n   */\n  chatDeleted: 'Chat deleted',\n  /**\n   *@description AI assistance UI text creating selecting a history entry.\n   */\n  history: 'History',\n  /**\n   *@description AI assistance UI text deleting the current chat session from local history.\n   */\n  deleteChat: 'Delete local chat',\n  /**\n   *@description AI assistance UI text that deletes all local history entries.\n   */\n  clearChatHistory: 'Clear local chats',\n  /**\n   *@description AI assistance UI text explains that he user had no pas conversations.\n   */\n  noPastConversations: 'No past conversations',\n} as const;\n\n/*\n* Strings that don't need to be translated at this time.\n*/\nconst UIStringsNotTranslate = {\n\n  /**\n   *@description Announcement text for screen readers when the conversation starts.\n   */\n  answerLoading: 'Answer loading',\n  /**\n   *@description Announcement text for screen readers when the answer comes.\n   */\n  answerReady: 'Answer ready',\n} as const;\n\nconst str_ = i18n.i18n.registerUIStrings('panels/ai_assistance/AiAssistancePanel.ts', UIStrings);\nconst i18nString = i18n.i18n.getLocalizedString.bind(undefined, str_);\nconst lockedString = i18n.i18n.lockedString;\n\nfunction selectedElementFilter(maybeNode: SDK.DOMModel.DOMNode|null): SDK.DOMModel.DOMNode|null {\n  if (maybeNode) {\n    return maybeNode.nodeType() === Node.ELEMENT_NODE ? maybeNode : null;\n  }\n\n  return null;\n}\n\ninterface ToolbarViewInput {\n  onNewChatClick: () => void;\n  onHistoryClick: (event: MouseEvent) => void;\n  onDeleteClick: () => void;\n  onHelpClick: () => void;\n  onSettingsClick: () => void;\n  isDeleteHistoryButtonVisible: boolean;\n}\n\nexport type ViewInput = ChatViewProps&ToolbarViewInput;\ninterface ViewOutput {\n  chatView?: ChatView;\n}\n\ntype View = (input: ViewInput, output: ViewOutput, target: HTMLElement) => void;\n\nfunction toolbarView(input: ToolbarViewInput): Lit.LitTemplate {\n  // clang-format off\n  return html`\n    <div class=\"toolbar-container\" role=\"toolbar\" .jslogContext=${VisualLogging.toolbar()}>\n      <devtools-toolbar class=\"freestyler-left-toolbar\" role=\"presentation\">\n        <devtools-button\n          title=${i18nString(UIStrings.newChat)}\n          aria-label=${i18nString(UIStrings.newChat)}\n          .iconName=${'plus'}\n          .jslogContext=${'freestyler.new-chat'}\n          .variant=${Buttons.Button.Variant.TOOLBAR}\n          @click=${input.onNewChatClick}></devtools-button>\n        <div class=\"toolbar-divider\"></div>\n        <devtools-button\n          title=${i18nString(UIStrings.history)}\n          aria-label=${i18nString(UIStrings.history)}\n          .iconName=${'history'}\n          .jslogContext=${'freestyler.history'}\n          .variant=${Buttons.Button.Variant.TOOLBAR}\n          @click=${input.onHistoryClick}></devtools-button>\n        ${input.isDeleteHistoryButtonVisible\n          ? html`<devtools-button\n              title=${i18nString(UIStrings.deleteChat)}\n              aria-label=${i18nString(UIStrings.deleteChat)}\n              .iconName=${'bin'}\n              .jslogContext=${'freestyler.delete'}\n              .variant=${Buttons.Button.Variant.TOOLBAR}\n              @click=${input.onDeleteClick}></devtools-button>`\n          : Lit.nothing}\n      </devtools-toolbar>\n      <devtools-toolbar class=\"freestyler-right-toolbar\" role=\"presentation\">\n        <x-link\n          class=\"toolbar-feedback-link devtools-link\"\n          title=${UIStrings.sendFeedback}\n          href=${AI_ASSISTANCE_SEND_FEEDBACK}\n          jslog=${VisualLogging.link().track({click: true, keydown:'Enter|Space'}).context('freestyler.send-feedback')}\n        >${UIStrings.sendFeedback}</x-link>\n        <div class=\"toolbar-divider\"></div>\n        <devtools-button\n          title=${i18nString(UIStrings.help)}\n          aria-label=${i18nString(UIStrings.help)}\n          .iconName=${'help'}\n          .jslogContext=${'freestyler.help'}\n          .variant=${Buttons.Button.Variant.TOOLBAR}\n          @click=${input.onHelpClick}></devtools-button>\n        <devtools-button\n          title=${i18nString(UIStrings.settings)}\n          aria-label=${i18nString(UIStrings.settings)}\n          .iconName=${'gear'}\n          .jslogContext=${'freestyler.settings'}\n          .variant=${Buttons.Button.Variant.TOOLBAR}\n          @click=${input.onSettingsClick}></devtools-button>\n      </devtools-toolbar>\n    </div>\n  `;\n  // clang-format on\n}\n\nfunction defaultView(input: ViewInput, output: ViewOutput, target: HTMLElement): void {\n  // clang-format off\n  Lit.render(html`\n    ${toolbarView(input)}\n    <div class=\"chat-container\">\n      <devtools-ai-chat-view .props=${input} ${Lit.Directives.ref((el: Element|undefined) => {\n        if (!el || !(el instanceof ChatView)) {\n          return;\n        }\n\n        output.chatView = el;\n      })}></devtools-ai-chat-view>\n    </div>\n  `, target, {host: input});\n  // clang-format on\n}\n\nfunction createNodeContext(node: SDK.DOMModel.DOMNode|null): NodeContext|null {\n  if (!node) {\n    return null;\n  }\n  return new NodeContext(node);\n}\n\nfunction createFileContext(file: Workspace.UISourceCode.UISourceCode|null): FileContext|null {\n  if (!file) {\n    return null;\n  }\n  return new FileContext(file);\n}\n\nfunction createRequestContext(request: SDK.NetworkRequest.NetworkRequest|null): RequestContext|null {\n  if (!request) {\n    return null;\n  }\n  return new RequestContext(request);\n}\n\nfunction createCallTreeContext(callTree: TimelineUtils.AICallTree.AICallTree|null): CallTreeContext|null {\n  if (!callTree) {\n    return null;\n  }\n  return new CallTreeContext(callTree);\n}\nfunction createPerfInsightContext(insight: TimelineUtils.InsightAIContext.ActiveInsight|null): InsightContext|null {\n  if (!insight) {\n    return null;\n  }\n  return new InsightContext(insight);\n}\n\nfunction agentTypeToConversationType(type: AgentType): ConversationType {\n  switch (type) {\n    case AgentType.STYLING:\n      return ConversationType.STYLING;\n    case AgentType.NETWORK:\n      return ConversationType.NETWORK;\n    case AgentType.FILE:\n      return ConversationType.FILE;\n    case AgentType.PERFORMANCE:\n      return ConversationType.PERFORMANCE;\n    case AgentType.PERFORMANCE_INSIGHT:\n      return ConversationType.PERFORMANCE_INSIGHT;\n    case AgentType.PATCH:\n      throw new Error('PATCH AgentType does not have a corresponding ConversationType.');\n  }\n}\n\nlet panelInstance: AiAssistancePanel;\nexport class AiAssistancePanel extends UI.Panel.Panel {\n  static panelName = 'freestyler';\n\n  #toggleSearchElementAction: UI.ActionRegistration.Action;\n  #aidaClient: Host.AidaClient.AidaClient;\n  #viewOutput: ViewOutput = {};\n  #serverSideLoggingEnabled = isAiAssistanceServerSideLoggingEnabled();\n  #aiAssistanceEnabledSetting: Common.Settings.Setting<boolean>|undefined;\n  #changeManager = new ChangeManager();\n  #mutex = new Common.Mutex.Mutex();\n\n  #currentAgent?: AiAgent<unknown>;\n  #currentConversation?: Conversation;\n  #conversations: Conversation[] = [];\n\n  #previousSameOriginContext?: ConversationContext<unknown>;\n  #selectedFile: FileContext|null = null;\n  #selectedElement: NodeContext|null = null;\n  #selectedCallTree: CallTreeContext|null = null;\n  #selectedPerformanceInsight: InsightContext|null = null;\n  #selectedRequest: RequestContext|null = null;\n\n  // Messages displayed in the `ChatView` component.\n  #messages: ChatMessage[] = [];\n  // Indicates whether the new conversation context is blocked due to cross-origin restrictions.\n  // This happens when the conversation's context has a different\n  // origin than the selected context.\n  #blockedByCrossOrigin = false;\n  // Whether the UI should show loading or not.\n  #isLoading = false;\n  // Selected conversation context. The reason we keep this as a\n  // state field rather than using `#getConversationContext` is that,\n  // there is a case where the context differs from the selectedElement (or other selected context type).\n  // Specifically, it allows restoring the previous context when a new selection is cross-origin.\n  // See `#onContextSelectionChanged` for details.\n  #selectedContext: ConversationContext<unknown>|null = null;\n  // Stores the availability status of the `AidaClient` and the reason for unavailability, if any.\n  #aidaAvailability: Host.AidaClient.AidaAccessPreconditions;\n  // Info of the currently logged in user.\n  #userInfo: {\n    accountImage?: string,\n    accountFullName?: string,\n  };\n  #project?: Workspace.Workspace.Project;\n  #patchSuggestion?: string;\n  #patchSuggestionLoading?: boolean;\n  #imageInput = '';\n  #workspace = Workspace.Workspace.WorkspaceImpl.instance();\n\n  constructor(private view: View = defaultView, {aidaClient, aidaAvailability, syncInfo}: {\n    aidaClient: Host.AidaClient.AidaClient,\n    aidaAvailability: Host.AidaClient.AidaAccessPreconditions,\n    syncInfo: Host.InspectorFrontendHostAPI.SyncInformation,\n  }) {\n    super(AiAssistancePanel.panelName);\n    this.registerRequiredCSS(aiAssistancePanelStyles);\n    this.#aiAssistanceEnabledSetting = this.#getAiAssistanceEnabledSetting();\n\n    this.#toggleSearchElementAction =\n        UI.ActionRegistry.ActionRegistry.instance().getAction('elements.toggle-element-search');\n    this.#aidaClient = aidaClient;\n    this.#aidaAvailability = aidaAvailability;\n    this.#userInfo = {\n      accountImage: syncInfo.accountImage,\n      accountFullName: syncInfo.accountFullName,\n    };\n\n    this.#conversations = AiHistoryStorage.instance().getHistory().map(item => {\n      return new Conversation(item.type, item.history, item.id, true);\n    });\n\n    this.#selectProject();\n  }\n\n  #selectProject(): void {\n    if (isAiAssistancePatchingEnabled()) {\n      // TODO: this is temporary code that should be replaced with\n      // workflow selection flow. For now it picks the first Workspace\n      // project that is not Snippets.\n      const projects = this.#workspace.projectsForType(Workspace.Workspace.projectTypes.FileSystem);\n      this.#project = undefined;\n      for (const project of projects) {\n        // This is for TypeScript to narrow the types. projectsForType()\n        // probably only returns instances of\n        // Persistence.FileSystemWorkspaceBinding.FileSystem.\n        if (!(project instanceof Persistence.FileSystemWorkspaceBinding.FileSystem)) {\n          continue;\n        }\n        // Workspace projects do not have a type. Only snippets and\n        // overrides do.\n        if (project.fileSystem().type()) {\n          continue;\n        }\n        this.#project = project;\n        this.requestUpdate();\n        break;\n      }\n    }\n  }\n\n  #onProjectAddedOrRemoved(): void {\n    this.#selectProject();\n  }\n\n  #getChatUiState(): ChatViewState {\n    const blockedByAge = Root.Runtime.hostConfig.aidaAvailability?.blockedByAge === true;\n    return (this.#aiAssistanceEnabledSetting?.getIfNotDisabled() && !blockedByAge) ? ChatViewState.CHAT_VIEW :\n                                                                                     ChatViewState.CONSENT_VIEW;\n  }\n\n  #getAiAssistanceEnabledSetting(): Common.Settings.Setting<boolean>|undefined {\n    try {\n      return Common.Settings.moduleSetting('ai-assistance-enabled') as Common.Settings.Setting<boolean>;\n    } catch {\n      return;\n    }\n  }\n\n  #createAgent(agentType: AgentType): AiAgent<unknown> {\n    const options = {\n      aidaClient: this.#aidaClient,\n      serverSideLoggingEnabled: this.#serverSideLoggingEnabled,\n    };\n    let agent: AiAgent<unknown>;\n    switch (agentType) {\n      case AgentType.STYLING: {\n        agent = new StylingAgent({\n          ...options,\n          changeManager: this.#changeManager,\n        });\n        if (isAiAssistanceStylingWithFunctionCallingEnabled()) {\n          agent = new StylingAgentWithFunctionCalling({\n            ...options,\n            changeManager: this.#changeManager,\n          });\n        }\n\n        break;\n      }\n      case AgentType.NETWORK: {\n        agent = new NetworkAgent(options);\n        break;\n      }\n      case AgentType.FILE: {\n        agent = new FileAgent(options);\n        break;\n      }\n      case AgentType.PERFORMANCE: {\n        agent = new PerformanceAgent(options);\n        break;\n      }\n      case AgentType.PERFORMANCE_INSIGHT: {\n        agent = new PerformanceInsightsAgent(options);\n        break;\n      }\n      case AgentType.PATCH: {\n        throw new Error('AI Assistance does not support direct usage of the patch agent');\n      }\n    }\n    return agent;\n  }\n\n  static async instance(opts: {\n    forceNew: boolean|null,\n  }|undefined = {forceNew: null}): Promise<AiAssistancePanel> {\n    const {forceNew} = opts;\n    if (!panelInstance || forceNew) {\n      const aidaClient = new Host.AidaClient.AidaClient();\n      const syncInfoPromise = new Promise<Host.InspectorFrontendHostAPI.SyncInformation>(\n          resolve => Host.InspectorFrontendHost.InspectorFrontendHostInstance.getSyncInformation(resolve));\n      const [aidaAvailability, syncInfo] =\n          await Promise.all([Host.AidaClient.AidaClient.checkAccessPreconditions(), syncInfoPromise]);\n      panelInstance = new AiAssistancePanel(defaultView, {aidaClient, aidaAvailability, syncInfo});\n    }\n\n    return panelInstance;\n  }\n\n  // We select the default agent based on the open panels if\n  // there isn't any active conversation.\n  #selectDefaultAgentIfNeeded(): void {\n    // If there already is an agent and if it is not empty,\n    // we don't automatically change the agent. In addition to this,\n    // we don't change the current agent when there is a message in flight.\n    if ((this.#currentAgent && !this.#currentAgent.isEmpty) || this.#isLoading) {\n      return;\n    }\n\n    const {hostConfig} = Root.Runtime;\n    const isElementsPanelVisible =\n        Boolean(UI.Context.Context.instance().flavor(ElementsPanel.ElementsPanel.ElementsPanel));\n    const isNetworkPanelVisible = Boolean(UI.Context.Context.instance().flavor(NetworkPanel.NetworkPanel.NetworkPanel));\n    const isSourcesPanelVisible = Boolean(UI.Context.Context.instance().flavor(SourcesPanel.SourcesPanel.SourcesPanel));\n    const isPerformancePanelVisible =\n        Boolean(UI.Context.Context.instance().flavor(TimelinePanel.TimelinePanel.TimelinePanel));\n\n    let targetAgentType: AgentType|undefined = undefined;\n    if (isElementsPanelVisible && hostConfig.devToolsFreestyler?.enabled) {\n      targetAgentType = AgentType.STYLING;\n    } else if (isNetworkPanelVisible && hostConfig.devToolsAiAssistanceNetworkAgent?.enabled) {\n      targetAgentType = AgentType.NETWORK;\n    } else if (isSourcesPanelVisible && hostConfig.devToolsAiAssistanceFileAgent?.enabled) {\n      targetAgentType = AgentType.FILE;\n    } else if (\n        isPerformancePanelVisible && hostConfig.devToolsAiAssistancePerformanceAgent?.enabled &&\n        hostConfig.devToolsAiAssistancePerformanceAgent?.insightsEnabled) {\n      targetAgentType = AgentType.PERFORMANCE_INSIGHT;\n    } else if (isPerformancePanelVisible && hostConfig.devToolsAiAssistancePerformanceAgent?.enabled) {\n      targetAgentType = AgentType.PERFORMANCE;\n    }\n\n    const agent = targetAgentType ? this.#createAgent(targetAgentType) : undefined;\n    this.#updateAgentState(agent);\n  }\n\n  #updateAgentState(agent?: AiAgent<unknown>): void {\n    if (this.#currentAgent !== agent) {\n      this.#cancel();\n      this.#messages = [];\n      this.#isLoading = false;\n      this.#currentAgent = agent;\n      this.#currentConversation?.archiveConversation();\n      if (this.#currentAgent?.type) {\n        this.#currentConversation =\n            new Conversation(agentTypeToConversationType(this.#currentAgent.type), [], agent?.id, false);\n        this.#conversations.push(this.#currentConversation);\n      }\n    }\n\n    this.#onContextSelectionChanged();\n    this.requestUpdate();\n  }\n\n  override wasShown(): void {\n    super.wasShown();\n    this.#viewOutput.chatView?.restoreScrollPosition();\n    this.#viewOutput.chatView?.focusTextInput();\n    this.#selectDefaultAgentIfNeeded();\n    void this.#handleAidaAvailabilityChange();\n    this.#selectedElement =\n        createNodeContext(selectedElementFilter(UI.Context.Context.instance().flavor(SDK.DOMModel.DOMNode)));\n    this.#selectedRequest =\n        createRequestContext(UI.Context.Context.instance().flavor(SDK.NetworkRequest.NetworkRequest));\n    this.#selectedCallTree =\n        createCallTreeContext(UI.Context.Context.instance().flavor(TimelineUtils.AICallTree.AICallTree));\n    this.#selectedPerformanceInsight =\n        createPerfInsightContext(UI.Context.Context.instance().flavor(TimelineUtils.InsightAIContext.ActiveInsight));\n    this.#selectedFile = createFileContext(UI.Context.Context.instance().flavor(Workspace.UISourceCode.UISourceCode));\n    this.#selectedContext = this.#getConversationContext();\n    this.requestUpdate();\n\n    this.#aiAssistanceEnabledSetting?.addChangeListener(this.requestUpdate, this);\n    Host.AidaClient.HostConfigTracker.instance().addEventListener(\n        Host.AidaClient.Events.AIDA_AVAILABILITY_CHANGED, this.#handleAidaAvailabilityChange);\n    this.#toggleSearchElementAction.addEventListener(UI.ActionRegistration.Events.TOGGLED, this.requestUpdate, this);\n\n    UI.Context.Context.instance().addFlavorChangeListener(SDK.DOMModel.DOMNode, this.#handleDOMNodeFlavorChange);\n    UI.Context.Context.instance().addFlavorChangeListener(\n        SDK.NetworkRequest.NetworkRequest, this.#handleNetworkRequestFlavorChange);\n    UI.Context.Context.instance().addFlavorChangeListener(\n        TimelineUtils.AICallTree.AICallTree, this.#handleTraceEntryNodeFlavorChange);\n    UI.Context.Context.instance().addFlavorChangeListener(\n        Workspace.UISourceCode.UISourceCode, this.#handleUISourceCodeFlavorChange);\n    UI.Context.Context.instance().addFlavorChangeListener(\n        TimelineUtils.InsightAIContext.ActiveInsight, this.#handlePerfInsightFlavorChange);\n\n    UI.Context.Context.instance().addFlavorChangeListener(\n        ElementsPanel.ElementsPanel.ElementsPanel, this.#selectDefaultAgentIfNeeded, this);\n    UI.Context.Context.instance().addFlavorChangeListener(\n        NetworkPanel.NetworkPanel.NetworkPanel, this.#selectDefaultAgentIfNeeded, this);\n    UI.Context.Context.instance().addFlavorChangeListener(\n        SourcesPanel.SourcesPanel.SourcesPanel, this.#selectDefaultAgentIfNeeded, this);\n    UI.Context.Context.instance().addFlavorChangeListener(\n        TimelinePanel.TimelinePanel.TimelinePanel, this.#selectDefaultAgentIfNeeded, this);\n    SDK.TargetManager.TargetManager.instance().addModelListener(\n        SDK.DOMModel.DOMModel, SDK.DOMModel.Events.AttrModified, this.#handleDOMNodeAttrChange, this);\n    SDK.TargetManager.TargetManager.instance().addModelListener(\n        SDK.DOMModel.DOMModel, SDK.DOMModel.Events.AttrRemoved, this.#handleDOMNodeAttrChange, this);\n    Host.userMetrics.actionTaken(Host.UserMetrics.Action.AiAssistancePanelOpened);\n\n    if (isAiAssistancePatchingEnabled()) {\n      this.#workspace.addEventListener(Workspace.Workspace.Events.ProjectAdded, this.#onProjectAddedOrRemoved, this);\n      this.#workspace.addEventListener(Workspace.Workspace.Events.ProjectRemoved, this.#onProjectAddedOrRemoved, this);\n\n      // @ts-expect-error temporary global function for local testing.\n      window.aiAssistanceTestPatchPrompt = async (changeSummary: string) => {\n        return await this.#applyPatch(changeSummary);\n      };\n    }\n  }\n\n  override willHide(): void {\n    this.#aiAssistanceEnabledSetting?.removeChangeListener(this.requestUpdate, this);\n    Host.AidaClient.HostConfigTracker.instance().removeEventListener(\n        Host.AidaClient.Events.AIDA_AVAILABILITY_CHANGED, this.#handleAidaAvailabilityChange);\n    this.#toggleSearchElementAction.removeEventListener(UI.ActionRegistration.Events.TOGGLED, this.requestUpdate, this);\n    UI.Context.Context.instance().removeFlavorChangeListener(SDK.DOMModel.DOMNode, this.#handleDOMNodeFlavorChange);\n    UI.Context.Context.instance().removeFlavorChangeListener(\n        SDK.NetworkRequest.NetworkRequest, this.#handleNetworkRequestFlavorChange);\n    UI.Context.Context.instance().removeFlavorChangeListener(\n        TimelineUtils.AICallTree.AICallTree, this.#handleTraceEntryNodeFlavorChange);\n    UI.Context.Context.instance().removeFlavorChangeListener(\n        TimelineUtils.InsightAIContext.ActiveInsight, this.#handlePerfInsightFlavorChange);\n    UI.Context.Context.instance().removeFlavorChangeListener(\n        Workspace.UISourceCode.UISourceCode, this.#handleUISourceCodeFlavorChange);\n    UI.Context.Context.instance().removeFlavorChangeListener(\n        ElementsPanel.ElementsPanel.ElementsPanel, this.#selectDefaultAgentIfNeeded, this);\n    UI.Context.Context.instance().removeFlavorChangeListener(\n        NetworkPanel.NetworkPanel.NetworkPanel, this.#selectDefaultAgentIfNeeded, this);\n    UI.Context.Context.instance().removeFlavorChangeListener(\n        SourcesPanel.SourcesPanel.SourcesPanel, this.#selectDefaultAgentIfNeeded, this);\n    UI.Context.Context.instance().removeFlavorChangeListener(\n        TimelinePanel.TimelinePanel.TimelinePanel, this.#selectDefaultAgentIfNeeded, this);\n    SDK.TargetManager.TargetManager.instance().removeModelListener(\n        SDK.DOMModel.DOMModel,\n        SDK.DOMModel.Events.AttrModified,\n        this.#handleDOMNodeAttrChange,\n        this,\n    );\n    SDK.TargetManager.TargetManager.instance().removeModelListener(\n        SDK.DOMModel.DOMModel,\n        SDK.DOMModel.Events.AttrRemoved,\n        this.#handleDOMNodeAttrChange,\n        this,\n    );\n\n    if (isAiAssistancePatchingEnabled()) {\n      this.#workspace.removeEventListener(Workspace.Workspace.Events.ProjectAdded, this.#onProjectAddedOrRemoved, this);\n      this.#workspace.removeEventListener(\n          Workspace.Workspace.Events.ProjectRemoved, this.#onProjectAddedOrRemoved, this);\n    }\n  }\n\n  #handleAidaAvailabilityChange = async(): Promise<void> => {\n    const currentAidaAvailability = await Host.AidaClient.AidaClient.checkAccessPreconditions();\n    if (currentAidaAvailability !== this.#aidaAvailability) {\n      this.#aidaAvailability = currentAidaAvailability;\n      const syncInfo = await new Promise<Host.InspectorFrontendHostAPI.SyncInformation>(\n          resolve => Host.InspectorFrontendHost.InspectorFrontendHostInstance.getSyncInformation(resolve));\n      this.#userInfo = {\n        accountImage: syncInfo.accountImage,\n        accountFullName: syncInfo.accountFullName,\n      };\n      this.requestUpdate();\n    }\n  };\n\n  #handleDOMNodeFlavorChange = (ev: Common.EventTarget.EventTargetEvent<SDK.DOMModel.DOMNode>): void => {\n    if (this.#selectedElement?.getItem() === ev.data) {\n      return;\n    }\n\n    this.#selectedElement = createNodeContext(selectedElementFilter(ev.data));\n    this.#updateAgentState(this.#currentAgent);\n  };\n\n  #handleDOMNodeAttrChange =\n      (ev: Common.EventTarget.EventTargetEvent<{node: SDK.DOMModel.DOMNode, name: string}>): void => {\n        if (this.#selectedElement?.getItem() === ev.data.node) {\n          if (ev.data.name === 'class' || ev.data.name === 'id') {\n            this.requestUpdate();\n          }\n        }\n      };\n\n  #handleNetworkRequestFlavorChange =\n      (ev: Common.EventTarget.EventTargetEvent<SDK.NetworkRequest.NetworkRequest>): void => {\n        if (this.#selectedRequest?.getItem() === ev.data) {\n          return;\n        }\n\n        this.#selectedRequest = Boolean(ev.data) ? new RequestContext(ev.data) : null;\n        this.#updateAgentState(this.#currentAgent);\n      };\n\n  #handleTraceEntryNodeFlavorChange =\n      (ev: Common.EventTarget.EventTargetEvent<TimelineUtils.AICallTree.AICallTree>): void => {\n        if (this.#selectedCallTree?.getItem() === ev.data) {\n          return;\n        }\n\n        this.#selectedCallTree = Boolean(ev.data) ? new CallTreeContext(ev.data) : null;\n        this.#updateAgentState(this.#currentAgent);\n      };\n\n  #handlePerfInsightFlavorChange =\n      (ev: Common.EventTarget.EventTargetEvent<TimelineUtils.InsightAIContext.ActiveInsight>): void => {\n        if (this.#selectedPerformanceInsight?.getItem() === ev.data) {\n          return;\n        }\n\n        this.#selectedPerformanceInsight = Boolean(ev.data) ? new InsightContext(ev.data) : null;\n        this.#updateAgentState(this.#currentAgent);\n      };\n\n  #handleUISourceCodeFlavorChange =\n      (ev: Common.EventTarget.EventTargetEvent<Workspace.UISourceCode.UISourceCode>): void => {\n        const newFile = ev.data;\n        if (!newFile) {\n          return;\n        }\n        if (this.#selectedFile?.getItem() === newFile) {\n          return;\n        }\n        this.#selectedFile = new FileContext(ev.data);\n        this.#updateAgentState(this.#currentAgent);\n      };\n\n  #getChangeSummary(): string|undefined {\n    return (isAiAssistancePatchingEnabled() && this.#currentAgent && !this.#currentConversation?.isReadOnly) ?\n        this.#changeManager.formatChanges(this.#currentAgent.id) :\n        undefined;\n  }\n\n  override async performUpdate(): Promise<void> {\n    this.view(\n        {\n          state: this.#getChatUiState(),\n          blockedByCrossOrigin: this.#blockedByCrossOrigin,\n          aidaAvailability: this.#aidaAvailability,\n          isLoading: this.#isLoading,\n          messages: this.#messages,\n          selectedContext: this.#selectedContext,\n          agentType: this.#currentAgent?.type,\n          isReadOnly: this.#currentConversation?.isReadOnly ?? false,\n          changeSummary: this.#getChangeSummary(),\n          patchSuggestion: this.#patchSuggestion,\n          patchSuggestionLoading: this.#patchSuggestionLoading,\n          stripLinks: this.#currentAgent?.type === AgentType.PERFORMANCE,\n          inspectElementToggled: this.#toggleSearchElementAction.toggled(),\n          userInfo: this.#userInfo,\n          canShowFeedbackForm: this.#serverSideLoggingEnabled,\n          multimodalInputEnabled:\n              isAiAssistanceMultimodalInputEnabled() && this.#currentAgent?.type === AgentType.STYLING,\n          imageInput: this.#imageInput,\n          projectName: this.#project?.displayName() ?? '',\n          isDeleteHistoryButtonVisible: Boolean(this.#currentConversation && !this.#currentConversation.isEmpty),\n          onNewChatClick: this.#handleNewChatRequest.bind(this),\n          onHistoryClick: this.#onHistoryClicked.bind(this),\n          onDeleteClick: this.#onDeleteClicked.bind(this),\n          onHelpClick: () => {\n            Host.InspectorFrontendHost.InspectorFrontendHostInstance.openInNewTab(AI_ASSISTANCE_HELP);\n          },\n          onSettingsClick: () => {\n            void UI.ViewManager.ViewManager.instance().showView('chrome-ai');\n          },\n          onTextSubmit: async (text: string, imageInput?: Host.AidaClient.Part) => {\n            this.#imageInput = '';\n            Host.userMetrics.actionTaken(Host.UserMetrics.Action.AiAssistanceQuerySubmitted);\n            await this.#startConversation(text, imageInput);\n          },\n          onInspectElementClick: this.#handleSelectElementClick.bind(this),\n          onFeedbackSubmit: this.#handleFeedbackSubmit.bind(this),\n          onCancelClick: this.#cancel.bind(this),\n          onContextClick: this.#handleContextClick.bind(this),\n          onNewConversation: this.#handleNewChatRequest.bind(this),\n          onCancelCrossOriginChat: this.#blockedByCrossOrigin && this.#previousSameOriginContext ?\n              this.#handleCrossOriginChatCancellation.bind(this) :\n              undefined,\n          onTakeScreenshot: isAiAssistanceMultimodalInputEnabled() ? this.#handleTakeScreenshot.bind(this) : undefined,\n          onRemoveImageInput: isAiAssistanceMultimodalInputEnabled() ? this.#handleRemoveImageInput.bind(this) :\n                                                                       undefined,\n          onApplyToWorkspace: this.#onApplyToWorkspace.bind(this)\n        },\n        this.#viewOutput, this.contentElement);\n  }\n\n  #handleSelectElementClick(): void {\n    void this.#toggleSearchElementAction.execute();\n  }\n\n  async #handleFeedbackSubmit(rpcId: Host.AidaClient.RpcGlobalId, rating: Host.AidaClient.Rating, feedback?: string):\n      Promise<void> {\n    void this.#aidaClient.registerClientEvent({\n      corresponding_aida_rpc_global_id: rpcId,\n      disable_user_content_logging: !this.#serverSideLoggingEnabled,\n      do_conversation_client_event: {\n        user_feedback: {\n          sentiment: rating,\n          user_input: {\n            comment: feedback,\n          },\n        },\n      },\n    });\n  }\n\n  #handleContextClick(): void|Promise<void> {\n    const context = this.#selectedContext;\n    if (context instanceof RequestContext) {\n      const requestLocation = NetworkForward.UIRequestLocation.UIRequestLocation.tab(\n          context.getItem(), NetworkForward.UIRequestLocation.UIRequestTabs.HEADERS_COMPONENT);\n      return Common.Revealer.reveal(requestLocation);\n    }\n    if (context instanceof FileContext) {\n      return Common.Revealer.reveal(context.getItem().uiLocation(0, 0));\n    }\n    if (context instanceof CallTreeContext) {\n      const item = context.getItem();\n      const event = item.selectedNode?.event ?? item.rootNode.event;\n      const trace = new SDK.TraceObject.RevealableEvent(event);\n      return Common.Revealer.reveal(trace);\n    }\n    // Node picker is using linkifier.\n  }\n\n  handleAction(actionId: string): void {\n    if (this.#isLoading) {\n      // If running some queries already, focus the input with the abort\n      // button and do nothing.\n      this.#viewOutput.chatView?.focusTextInput();\n      return;\n    }\n\n    let targetAgentType: AgentType|undefined;\n    switch (actionId) {\n      case 'freestyler.elements-floating-button': {\n        Host.userMetrics.actionTaken(Host.UserMetrics.Action.AiAssistanceOpenedFromElementsPanelFloatingButton);\n        targetAgentType = AgentType.STYLING;\n        break;\n      }\n      case 'freestyler.element-panel-context': {\n        Host.userMetrics.actionTaken(Host.UserMetrics.Action.AiAssistanceOpenedFromElementsPanel);\n        targetAgentType = AgentType.STYLING;\n        break;\n      }\n      case 'drjones.network-floating-button': {\n        Host.userMetrics.actionTaken(Host.UserMetrics.Action.AiAssistanceOpenedFromNetworkPanelFloatingButton);\n        targetAgentType = AgentType.NETWORK;\n        break;\n      }\n      case 'drjones.network-panel-context': {\n        Host.userMetrics.actionTaken(Host.UserMetrics.Action.AiAssistanceOpenedFromNetworkPanel);\n        targetAgentType = AgentType.NETWORK;\n        break;\n      }\n      case 'drjones.performance-panel-context': {\n        Host.userMetrics.actionTaken(Host.UserMetrics.Action.AiAssistanceOpenedFromPerformancePanel);\n        targetAgentType = AgentType.PERFORMANCE;\n        break;\n      }\n      case 'drjones.performance-insight-context': {\n        Host.userMetrics.actionTaken(Host.UserMetrics.Action.AiAssistanceOpenedFromPerformanceInsight);\n        targetAgentType = AgentType.PERFORMANCE_INSIGHT;\n        break;\n      }\n      case 'drjones.sources-floating-button': {\n        Host.userMetrics.actionTaken(Host.UserMetrics.Action.AiAssistanceOpenedFromSourcesPanelFloatingButton);\n        targetAgentType = AgentType.FILE;\n        break;\n      }\n      case 'drjones.sources-panel-context': {\n        Host.userMetrics.actionTaken(Host.UserMetrics.Action.AiAssistanceOpenedFromSourcesPanel);\n        targetAgentType = AgentType.FILE;\n        break;\n      }\n    }\n\n    if (!targetAgentType) {\n      return;\n    }\n\n    let agent = this.#currentAgent;\n    if (!this.#currentConversation || !this.#currentAgent || this.#currentAgent.type !== targetAgentType ||\n        this.#currentConversation?.isEmpty || targetAgentType === AgentType.PERFORMANCE) {\n      agent = this.#createAgent(targetAgentType);\n    }\n    this.#updateAgentState(agent);\n    this.#viewOutput.chatView?.focusTextInput();\n  }\n\n  #onHistoryClicked(event: Event): void {\n    const target = event.target as Element | undefined;\n    const clientRect = target?.getBoundingClientRect();\n    const contextMenu = new UI.ContextMenu.ContextMenu(event, {\n      useSoftMenu: true,\n      x: clientRect?.left,\n      y: clientRect?.bottom,\n    });\n\n    for (const conversation of [...this.#conversations].reverse()) {\n      if (conversation.isEmpty) {\n        continue;\n      }\n      const title = conversation.title;\n      if (!title) {\n        continue;\n      }\n\n      contextMenu.defaultSection().appendCheckboxItem(title, () => {\n        void this.#openConversation(conversation);\n      }, {checked: (this.#currentConversation === conversation)});\n    }\n\n    const historyEmpty = contextMenu.defaultSection().items.length === 0;\n    if (historyEmpty) {\n      contextMenu.defaultSection().appendItem(i18nString(UIStrings.noPastConversations), () => {}, {\n        disabled: true,\n      });\n    }\n\n    contextMenu.footerSection().appendItem(\n        i18nString(UIStrings.clearChatHistory),\n        () => {\n          this.#clearHistory();\n        },\n        {\n          disabled: historyEmpty,\n        },\n    );\n\n    void contextMenu.show();\n  }\n\n  #clearHistory(): void {\n    this.#conversations = [];\n    this.#currentConversation = undefined;\n    void AiHistoryStorage.instance().deleteAll();\n    this.#updateAgentState();\n  }\n\n  #onDeleteClicked(): void {\n    if (this.#currentAgent) {\n      this.#conversations = this.#conversations.filter(conversation => conversation !== this.#currentConversation);\n      this.#currentConversation = undefined;\n      void AiHistoryStorage.instance().deleteHistoryEntry(this.#currentAgent.id);\n    }\n    this.#updateAgentState();\n    this.#selectDefaultAgentIfNeeded();\n    UI.ARIAUtils.alert(i18nString(UIStrings.chatDeleted));\n  }\n\n  async #openConversation(conversation: Conversation): Promise<void> {\n    if (this.#currentConversation === conversation) {\n      return;\n    }\n    this.#currentConversation = conversation;\n    this.#messages = [];\n    await this.#doConversation(conversation.history);\n  }\n\n  #handleNewChatRequest(): void {\n    this.#updateAgentState();\n    this.#selectDefaultAgentIfNeeded();\n    UI.ARIAUtils.alert(i18nString(UIStrings.newChatCreated));\n  }\n\n  #handleCrossOriginChatCancellation(): void {\n    if (this.#previousSameOriginContext) {\n      this.#onContextSelectionChanged(this.#previousSameOriginContext);\n      this.requestUpdate();\n    }\n  }\n\n  async #handleTakeScreenshot(): Promise<void> {\n    const mainTarget = SDK.TargetManager.TargetManager.instance().primaryPageTarget();\n    if (!mainTarget) {\n      throw new Error('Could not find main target');\n    }\n    const model = mainTarget.model(SDK.ScreenCaptureModel.ScreenCaptureModel);\n    if (!model) {\n      throw new Error('Could not find model');\n    }\n    const bytes = await model.captureScreenshot(\n        Protocol.Page.CaptureScreenshotRequestFormat.Jpeg,\n        SCREENSHOT_QUALITY,\n        SDK.ScreenCaptureModel.ScreenshotMode.FROM_VIEWPORT,\n    );\n    if (bytes) {\n      this.#imageInput = bytes;\n      this.requestUpdate();\n    }\n  }\n\n  #handleRemoveImageInput(): void {\n    this.#imageInput = '';\n    this.requestUpdate();\n  }\n\n  #runAbortController = new AbortController();\n  #cancel(): void {\n    this.#runAbortController.abort();\n    this.#isLoading = false;\n    this.requestUpdate();\n  }\n\n  #onContextSelectionChanged(contextToRestore?: ConversationContext<unknown>): void {\n    if (!this.#currentAgent) {\n      this.#blockedByCrossOrigin = false;\n      return;\n    }\n    const currentContext = contextToRestore ?? this.#getConversationContext();\n    this.#selectedContext = currentContext;\n    if (!currentContext) {\n      this.#blockedByCrossOrigin = false;\n      return;\n    }\n    this.#blockedByCrossOrigin = !currentContext.isOriginAllowed(this.#currentAgent.origin);\n    if (!this.#blockedByCrossOrigin) {\n      this.#previousSameOriginContext = currentContext;\n    }\n  }\n\n  #getConversationContext(): ConversationContext<unknown>|null {\n    if (!this.#currentAgent) {\n      return null;\n    }\n    let context: ConversationContext<unknown>|null;\n    switch (this.#currentAgent.type) {\n      case AgentType.STYLING:\n        context = this.#selectedElement;\n        break;\n      case AgentType.FILE:\n        context = this.#selectedFile;\n        break;\n      case AgentType.NETWORK:\n        context = this.#selectedRequest;\n        break;\n      case AgentType.PERFORMANCE:\n        context = this.#selectedCallTree;\n        break;\n      case AgentType.PERFORMANCE_INSIGHT:\n        context = this.#selectedPerformanceInsight;\n        break;\n      case AgentType.PATCH:\n        throw new Error('AI Assistance does not support direct usage of the patch agent');\n    }\n    return context;\n  }\n\n  async #startConversation(text: string, imageInput?: Host.AidaClient.Part): Promise<void> {\n    if (!this.#currentAgent) {\n      return;\n    }\n    // Cancel any previous in-flight conversation.\n    this.#cancel();\n    this.#runAbortController = new AbortController();\n    const signal = this.#runAbortController.signal;\n    const context = this.#getConversationContext();\n    // If a different context is provided, it must be from the same origin.\n    if (context && !context.isOriginAllowed(this.#currentAgent.origin)) {\n      // This error should not be reached. If it happens, some\n      // invariants do not hold anymore.\n      throw new Error('cross-origin context data should not be included');\n    }\n\n    const image = isAiAssistanceMultimodalInputEnabled() ? imageInput : undefined;\n    const imageId = image ? crypto.randomUUID() : undefined;\n    const runner = this.#currentAgent.run(\n        text, {\n          signal,\n          selected: context,\n        },\n        image, imageId);\n    UI.ARIAUtils.alert(lockedString(UIStringsNotTranslate.answerLoading));\n    await this.#doConversation(this.#saveResponsesToCurrentConversation(runner));\n    UI.ARIAUtils.alert(lockedString(UIStringsNotTranslate.answerReady));\n  }\n\n  async #onApplyToWorkspace(): Promise<void> {\n    if (!isAiAssistancePatchingEnabled()) {\n      return;\n    }\n    const changeSummary = this.#getChangeSummary();\n    if (!changeSummary) {\n      throw new Error('Change summary does not exist');\n    }\n\n    this.#patchSuggestionLoading = true;\n    this.requestUpdate();\n    const response = await this.#applyPatch(changeSummary);\n    this.#patchSuggestion = response?.type === ResponseType.ANSWER ? response.text : 'Could not update files';\n    this.#patchSuggestionLoading = false;\n    this.requestUpdate();\n  }\n\n  async #applyPatch(changeSummary: string): Promise<ResponseData|undefined> {\n    if (!this.#project) {\n      throw new Error('Project does not exist');\n    }\n    const agent = new PatchAgent({\n      aidaClient: this.#aidaClient,\n      serverSideLoggingEnabled: this.#serverSideLoggingEnabled,\n      project: this.#project,\n    });\n    const responses = await Array.fromAsync(agent.applyChanges(changeSummary));\n    return responses.at(-1);\n  }\n\n  async *\n      #saveResponsesToCurrentConversation(items: AsyncIterable<ResponseData, void, void>):\n          AsyncGenerator<ResponseData, void, void> {\n    for await (const data of items) {\n      // We don't want to save partial responses to the conversation history.\n      if (data.type !== ResponseType.ANSWER || data.complete) {\n        this.#currentConversation?.addHistoryItem(data);\n      }\n      yield data;\n    }\n  }\n\n  async #doConversation(items: Iterable<ResponseData, void, void>|AsyncIterable<ResponseData, void, void>):\n      Promise<void> {\n    const release = await this.#mutex.acquire();\n    try {\n      let systemMessage: ModelChatMessage = {\n        entity: ChatMessageEntity.MODEL,\n        steps: [],\n      };\n      let step: Step = {isLoading: true};\n\n      /**\n       * Commits the step to props only if necessary.\n       */\n      function commitStep(): void {\n        if (systemMessage.steps.at(-1) !== step) {\n          systemMessage.steps.push(step);\n        }\n      }\n\n      this.#isLoading = true;\n      for await (const data of items) {\n        step.sideEffect = undefined;\n        switch (data.type) {\n          case ResponseType.USER_QUERY: {\n            this.#messages.push({\n              entity: ChatMessageEntity.USER,\n              text: data.query,\n              imageInput: data.imageInput,\n            });\n            systemMessage = {\n              entity: ChatMessageEntity.MODEL,\n              steps: [],\n            };\n            this.#messages.push(systemMessage);\n            break;\n          }\n          case ResponseType.QUERYING: {\n            step = {isLoading: true};\n            if (!systemMessage.steps.length) {\n              systemMessage.steps.push(step);\n            }\n\n            break;\n          }\n          case ResponseType.CONTEXT: {\n            step.title = data.title;\n            step.contextDetails = data.details;\n            step.isLoading = false;\n            commitStep();\n            break;\n          }\n          case ResponseType.TITLE: {\n            step.title = data.title;\n            commitStep();\n            break;\n          }\n          case ResponseType.THOUGHT: {\n            step.isLoading = false;\n            step.thought = data.thought;\n            commitStep();\n            break;\n          }\n          case ResponseType.SUGGESTIONS: {\n            systemMessage.suggestions = data.suggestions;\n            break;\n          }\n          case ResponseType.SIDE_EFFECT: {\n            step.isLoading = false;\n            step.code ??= data.code;\n            step.sideEffect = {\n              onAnswer: (result: boolean) => {\n                data.confirm(result);\n                step.sideEffect = undefined;\n                this.requestUpdate();\n              },\n            };\n            commitStep();\n            break;\n          }\n          case ResponseType.ACTION: {\n            step.isLoading = false;\n            step.code ??= data.code;\n            step.output ??= data.output;\n            step.canceled = data.canceled;\n            commitStep();\n            break;\n          }\n          case ResponseType.ANSWER: {\n            systemMessage.suggestions ??= data.suggestions;\n            systemMessage.answer = data.text;\n            systemMessage.rpcId = data.rpcId;\n            // When there is an answer without any thinking steps, we don't want to show the thinking step.\n            if (systemMessage.steps.length === 1 && systemMessage.steps[0].isLoading) {\n              systemMessage.steps.pop();\n            }\n            step.isLoading = false;\n            break;\n          }\n          case ResponseType.ERROR: {\n            systemMessage.error = data.error;\n            systemMessage.rpcId = undefined;\n            const lastStep = systemMessage.steps.at(-1);\n            if (lastStep) {\n              // Mark the last step as cancelled to make the UI feel better.\n              if (data.error === ErrorType.ABORT) {\n                lastStep.canceled = true;\n                // If error happens while the step is still loading remove it.\n              } else if (lastStep.isLoading) {\n                systemMessage.steps.pop();\n              }\n            }\n            if (data.error === ErrorType.BLOCK) {\n              systemMessage.answer = undefined;\n            }\n          }\n        }\n\n        // Commit update intermediated step when not\n        // in read only mode.\n        if (!this.#currentConversation?.isReadOnly) {\n          this.requestUpdate();\n\n          // This handles scrolling to the bottom for live conversations when:\n          // * User submits the query & the context step is shown.\n          // * There is a side effect dialog  shown.\n          if (data.type === ResponseType.CONTEXT || data.type === ResponseType.SIDE_EFFECT) {\n            this.#viewOutput.chatView?.scrollToBottom();\n          }\n        }\n      }\n\n      this.#isLoading = false;\n      this.#viewOutput.chatView?.finishTextAnimations();\n      this.requestUpdate();\n    } finally {\n      release();\n    }\n  }\n}\n\nexport class ActionDelegate implements UI.ActionRegistration.ActionDelegate {\n  handleAction(\n      _context: UI.Context.Context,\n      actionId: string,\n      ): boolean {\n    switch (actionId) {\n      case 'freestyler.elements-floating-button':\n      case 'freestyler.element-panel-context':\n      case 'drjones.network-floating-button':\n      case 'drjones.network-panel-context':\n      case 'drjones.performance-panel-context':\n      case 'drjones.performance-insight-context':\n      case 'drjones.sources-floating-button':\n      case 'drjones.sources-panel-context': {\n        void (async () => {\n          const view = UI.ViewManager.ViewManager.instance().view(\n              AiAssistancePanel.panelName,\n          );\n\n          if (view) {\n            await UI.ViewManager.ViewManager.instance().showView(\n                AiAssistancePanel.panelName,\n            );\n            const widget = (await view.widget()) as AiAssistancePanel;\n            widget.handleAction(actionId);\n          }\n        })();\n        return true;\n      }\n    }\n\n    return false;\n  }\n}\n\nfunction isAiAssistanceMultimodalInputEnabled(): boolean {\n  const {hostConfig} = Root.Runtime;\n  return Boolean(hostConfig.devToolsFreestyler?.multimodal);\n}\n\nfunction isAiAssistancePatchingEnabled(): boolean {\n  const {hostConfig} = Root.Runtime;\n  return Boolean(hostConfig.devToolsFreestyler?.patching);\n}\n\nfunction isAiAssistanceServerSideLoggingEnabled(): boolean {\n  const {hostConfig} = Root.Runtime;\n  return !hostConfig.aidaAvailability?.disallowLogging;\n}\n\nfunction isAiAssistanceStylingWithFunctionCallingEnabled(): boolean {\n  const {hostConfig} = Root.Runtime;\n  return Boolean(hostConfig.devToolsFreestyler?.functionCalling);\n}\n"]}