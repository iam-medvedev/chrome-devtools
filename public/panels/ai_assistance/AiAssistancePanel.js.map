{"version":3,"file":"AiAssistancePanel.js","sourceRoot":"","sources":["../../../../../../front_end/panels/ai_assistance/AiAssistancePanel.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright 2024 The Chromium Authors. All rights reserved.\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport '../../ui/legacy/legacy.js';\n\nimport * as Common from '../../core/common/common.js';\nimport * as Host from '../../core/host/host.js';\nimport * as i18n from '../../core/i18n/i18n.js';\nimport type * as Platform from '../../core/platform/platform.js';\nimport * as Root from '../../core/root/root.js';\nimport * as SDK from '../../core/sdk/sdk.js';\nimport * as Protocol from '../../generated/protocol.js';\nimport * as AiAssistanceModel from '../../models/ai_assistance/ai_assistance.js';\nimport * as Workspace from '../../models/workspace/workspace.js';\nimport * as Buttons from '../../ui/components/buttons/buttons.js';\nimport * as UI from '../../ui/legacy/legacy.js';\nimport * as Lit from '../../ui/lit/lit.js';\nimport * as VisualLogging from '../../ui/visual_logging/visual_logging.js';\nimport * as ElementsPanel from '../elements/elements.js';\nimport * as NetworkForward from '../network/forward/forward.js';\nimport * as NetworkPanel from '../network/network.js';\nimport * as SourcesPanel from '../sources/sources.js';\nimport * as TimelinePanel from '../timeline/timeline.js';\nimport * as TimelineUtils from '../timeline/utils/utils.js';\n\nimport aiAssistancePanelStyles from './aiAssistancePanel.css.js';\nimport {\n  type ChatMessage,\n  ChatMessageEntity,\n  ChatView,\n  type ImageInputData,\n  type ModelChatMessage,\n  type Props as ChatViewProps,\n  State as ChatViewState,\n  type Step\n} from './components/ChatView.js';\nimport {isAiAssistancePatchingEnabled} from './PatchWidget.js';\n\nconst {html} = Lit;\n\nconst AI_ASSISTANCE_SEND_FEEDBACK = 'https://crbug.com/364805393' as Platform.DevToolsPath.UrlString;\nconst AI_ASSISTANCE_HELP = 'https://developer.chrome.com/docs/devtools/ai-assistance';\nconst SCREENSHOT_QUALITY = 100;\nconst SHOW_LOADING_STATE_TIMEOUT = 100;\n\nconst UIStrings = {\n  /**\n   *@description AI assistance UI text creating a new chat.\n   */\n  newChat: 'New chat',\n  /**\n   *@description AI assistance UI tooltip text for the help button.\n   */\n  help: 'Help',\n  /**\n   *@description AI assistant UI tooltip text for the settings button (gear icon).\n   */\n  settings: 'Settings',\n  /**\n   *@description AI assistant UI tooltip sending feedback.\n   */\n  sendFeedback: 'Send feedback',\n  /**\n   *@description Announcement text for screen readers when a new chat is created.\n   */\n  newChatCreated: 'New chat created',\n  /**\n   *@description Announcement text for screen readers when the chat is deleted.\n   */\n  chatDeleted: 'Chat deleted',\n  /**\n   *@description AI assistance UI text creating selecting a history entry.\n   */\n  history: 'History',\n  /**\n   *@description AI assistance UI text deleting the current chat session from local history.\n   */\n  deleteChat: 'Delete local chat',\n  /**\n   *@description AI assistance UI text that deletes all local history entries.\n   */\n  clearChatHistory: 'Clear local chats',\n  /**\n   *@description AI assistance UI text explains that he user had no pas conversations.\n   */\n  noPastConversations: 'No past conversations',\n  /**\n   * @description Placeholder text for an inactive text field. When active, it's used for the user's input to the GenAI assistance.\n   */\n  followTheSteps: 'Follow the steps above to ask a question',\n  /**\n   *@description Disclaimer text right after the chat input.\n   */\n  inputDisclaimerForEmptyState: 'This is an experimental AI feature and won\\'t always get it right.',\n} as const;\n\n/*\n* Strings that don't need to be translated at this time.\n*/\nconst UIStringsNotTranslate = {\n  /**\n   *@description Announcement text for screen readers when the conversation starts.\n   */\n  answerLoading: 'Answer loading',\n  /**\n   *@description Announcement text for screen readers when the answer comes.\n   */\n  answerReady: 'Answer ready',\n  /**\n   * @description Placeholder text for the input shown when the conversation is blocked because a cross-origin context was selected.\n   */\n  crossOriginError: 'To talk about data from another origin, start a new chat',\n  /**\n   *@description Placeholder text for the chat UI input.\n   */\n  inputPlaceholderForStyling: 'Ask a question about the selected element',\n  /**\n   *@description Placeholder text for the chat UI input.\n   */\n  inputPlaceholderForNetwork: 'Ask a question about the selected network request',\n  /**\n   *@description Placeholder text for the chat UI input.\n   */\n  inputPlaceholderForFile: 'Ask a question about the selected file',\n  /**\n   *@description Placeholder text for the chat UI input.\n   */\n  inputPlaceholderForPerformance: 'Ask a question about the selected item and its call tree',\n  /**\n   *@description Placeholder text for the chat UI input when there is no context selected.\n   */\n  inputPlaceholderForStylingNoContext: 'Select an element to ask a question',\n  /**\n   *@description Placeholder text for the chat UI input when there is no context selected.\n   */\n  inputPlaceholderForNetworkNoContext: 'Select a network request to ask a question',\n  /**\n   *@description Placeholder text for the chat UI input when there is no context selected.\n   */\n  inputPlaceholderForFileNoContext: 'Select a file to ask a question',\n  /**\n   *@description Placeholder text for the chat UI input when there is no context selected.\n   */\n  inputPlaceholderForPerformanceNoContext: 'Select an item to ask a question',\n  /**\n   *@description Placeholder text for the chat UI input.\n   */\n  inputPlaceholderForPerformanceInsights: 'Ask a question about the selected performance insight',\n  /**\n   *@description Placeholder text for the chat UI input.\n   */\n  inputPlaceholderForPerformanceInsightsNoContext: 'Select a performance insight to ask a question',\n  /**\n   *@description Disclaimer text right after the chat input.\n   */\n  inputDisclaimerForStyling:\n      'Chat messages and any data the inspected page can access via Web APIs are sent to Google and may be seen by human reviewers to improve this feature. This is an experimental AI feature and won’t always get it right.',\n  /**\n   *@description Disclaimer text right after the chat input.\n   */\n  inputDisclaimerForStylingEnterpriseNoLogging:\n      'Chat messages and any data the inspected page can access via Web APIs are sent to Google. The content you submit and that is generated by this feature will not be used to improve Google’s AI models. This is an experimental AI feature and won’t always get it right.',\n  /**\n   *@description Disclaimer text right after the chat input.\n   */\n  inputDisclaimerForNetwork:\n      'Chat messages and the selected network request are sent to Google and may be seen by human reviewers to improve this feature. This is an experimental AI feature and won’t always get it right.',\n  /**\n   *@description Disclaimer text right after the chat input.\n   */\n  inputDisclaimerForNetworkEnterpriseNoLogging:\n      'Chat messages and the selected network request are sent to Google. The content you submit and that is generated by this feature will not be used to improve Google’s AI models. This is an experimental AI feature and won’t always get it right.',\n  /**\n   *@description Disclaimer text right after the chat input.\n   */\n  inputDisclaimerForFile:\n      'Chat messages and the selected file are sent to Google and may be seen by human reviewers to improve this feature. This is an experimental AI feature and won\\'t always get it right.',\n  /**\n   *@description Disclaimer text right after the chat input.\n   */\n  inputDisclaimerForFileEnterpriseNoLogging:\n      'Chat messages and the selected file are sent to Google. The content you submit and that is generated by this feature will not be used to improve Google’s AI models. This is an experimental AI feature and won’t always get it right.',\n  /**\n   *@description Disclaimer text right after the chat input.\n   */\n  inputDisclaimerForPerformance:\n      'Chat messages and the selected call tree are sent to Google and may be seen by human reviewers to improve this feature. This is an experimental AI feature and won\\'t always get it right.',\n  /**\n   *@description Disclaimer text right after the chat input.\n   */\n  inputDisclaimerForPerformanceEnterpriseNoLogging:\n      'Chat messages and the selected call stack are sent to Google. The content you submit and that is generated by this feature will not be used to improve Google’s AI models. This is an experimental AI feature and won’t always get it right.',\n} as const;\n\nconst str_ = i18n.i18n.registerUIStrings('panels/ai_assistance/AiAssistancePanel.ts', UIStrings);\nconst i18nString = i18n.i18n.getLocalizedString.bind(undefined, str_);\nconst lockedString = i18n.i18n.lockedString;\n\nfunction selectedElementFilter(maybeNode: SDK.DOMModel.DOMNode|null): SDK.DOMModel.DOMNode|null {\n  if (maybeNode) {\n    return maybeNode.nodeType() === Node.ELEMENT_NODE ? maybeNode : null;\n  }\n\n  return null;\n}\n\nfunction getEmptyStateSuggestions(\n    context: AiAssistanceModel.ConversationContext<unknown>|null,\n    conversationType?: AiAssistanceModel.ConversationType): string[] {\n  if (context) {\n    const specialSuggestions = context.getSuggestions();\n\n    if (specialSuggestions) {\n      return specialSuggestions;\n    }\n  }\n\n  if (!conversationType) {\n    return [];\n  }\n\n  switch (conversationType) {\n    case AiAssistanceModel.ConversationType.STYLING:\n      return [\n        'What can you help me with?',\n        'Why isn’t this element visible?',\n        'How do I center this element?',\n      ];\n    case AiAssistanceModel.ConversationType.FILE:\n      return [\n        'What does this script do?',\n        'Is the script optimized for performance?',\n        'Does the script handle user input safely?',\n      ];\n    case AiAssistanceModel.ConversationType.NETWORK:\n      return [\n        'Why is this network request taking so long?',\n        'Are there any security headers present?',\n        'Why is the request failing?',\n      ];\n    case AiAssistanceModel.ConversationType.PERFORMANCE:\n      return [\n        'Identify performance issues in this call tree',\n        'Where is most of the time being spent in this call tree?',\n        'How can I reduce the time of this call tree?',\n      ];\n    case AiAssistanceModel.ConversationType.PERFORMANCE_INSIGHT:\n      // TODO(b/393061683): Define these.\n      return ['Help me optimize my LCP', 'Suggestions', 'For now'];\n  }\n}\n\ninterface ToolbarViewInput {\n  onNewChatClick: () => void;\n  onHistoryClick: (event: MouseEvent) => void;\n  onDeleteClick: () => void;\n  onHelpClick: () => void;\n  onSettingsClick: () => void;\n  isDeleteHistoryButtonVisible: boolean;\n}\n\nexport type ViewInput = ChatViewProps&ToolbarViewInput;\nexport interface PanelViewOutput {\n  chatView?: ChatView;\n}\n\ntype View = (input: ViewInput, output: PanelViewOutput, target: HTMLElement) => void;\n\nfunction toolbarView(input: ToolbarViewInput): Lit.LitTemplate {\n  // clang-format off\n  return html`\n    <div class=\"toolbar-container\" role=\"toolbar\" .jslogContext=${VisualLogging.toolbar()}>\n      <devtools-toolbar class=\"freestyler-left-toolbar\" role=\"presentation\">\n        <devtools-button\n          title=${i18nString(UIStrings.newChat)}\n          aria-label=${i18nString(UIStrings.newChat)}\n          .iconName=${'plus'}\n          .jslogContext=${'freestyler.new-chat'}\n          .variant=${Buttons.Button.Variant.TOOLBAR}\n          @click=${input.onNewChatClick}></devtools-button>\n        <div class=\"toolbar-divider\"></div>\n        <devtools-button\n          title=${i18nString(UIStrings.history)}\n          aria-label=${i18nString(UIStrings.history)}\n          .iconName=${'history'}\n          .jslogContext=${'freestyler.history'}\n          .variant=${Buttons.Button.Variant.TOOLBAR}\n          @click=${input.onHistoryClick}></devtools-button>\n        ${input.isDeleteHistoryButtonVisible\n          ? html`<devtools-button\n              title=${i18nString(UIStrings.deleteChat)}\n              aria-label=${i18nString(UIStrings.deleteChat)}\n              .iconName=${'bin'}\n              .jslogContext=${'freestyler.delete'}\n              .variant=${Buttons.Button.Variant.TOOLBAR}\n              @click=${input.onDeleteClick}></devtools-button>`\n          : Lit.nothing}\n      </devtools-toolbar>\n      <devtools-toolbar class=\"freestyler-right-toolbar\" role=\"presentation\">\n        <x-link\n          class=\"toolbar-feedback-link devtools-link\"\n          title=${UIStrings.sendFeedback}\n          href=${AI_ASSISTANCE_SEND_FEEDBACK}\n          jslog=${VisualLogging.link().track({click: true, keydown:'Enter|Space'}).context('freestyler.send-feedback')}\n        >${UIStrings.sendFeedback}</x-link>\n        <div class=\"toolbar-divider\"></div>\n        <devtools-button\n          title=${i18nString(UIStrings.help)}\n          aria-label=${i18nString(UIStrings.help)}\n          .iconName=${'help'}\n          .jslogContext=${'freestyler.help'}\n          .variant=${Buttons.Button.Variant.TOOLBAR}\n          @click=${input.onHelpClick}></devtools-button>\n        <devtools-button\n          title=${i18nString(UIStrings.settings)}\n          aria-label=${i18nString(UIStrings.settings)}\n          .iconName=${'gear'}\n          .jslogContext=${'freestyler.settings'}\n          .variant=${Buttons.Button.Variant.TOOLBAR}\n          @click=${input.onSettingsClick}></devtools-button>\n      </devtools-toolbar>\n    </div>\n  `;\n  // clang-format on\n}\n\nfunction defaultView(input: ViewInput, output: PanelViewOutput, target: HTMLElement): void {\n  // clang-format off\n  Lit.render(html`\n    ${toolbarView(input)}\n    <div class=\"chat-container\">\n      <devtools-ai-chat-view .props=${input} ${Lit.Directives.ref((el: Element|undefined) => {\n        if (!el || !(el instanceof ChatView)) {\n          return;\n        }\n\n        output.chatView = el;\n      })}></devtools-ai-chat-view>\n    </div>\n  `, target, {host: input});\n  // clang-format on\n}\n\nfunction createNodeContext(node: SDK.DOMModel.DOMNode|null): AiAssistanceModel.NodeContext|null {\n  if (!node) {\n    return null;\n  }\n  return new AiAssistanceModel.NodeContext(node);\n}\n\nfunction createFileContext(file: Workspace.UISourceCode.UISourceCode|null): AiAssistanceModel.FileContext|null {\n  if (!file) {\n    return null;\n  }\n  return new AiAssistanceModel.FileContext(file);\n}\n\nfunction createRequestContext(request: SDK.NetworkRequest.NetworkRequest|null): AiAssistanceModel.RequestContext|null {\n  if (!request) {\n    return null;\n  }\n  return new AiAssistanceModel.RequestContext(request);\n}\n\nfunction createCallTreeContext(callTree: TimelineUtils.AICallTree.AICallTree|null): AiAssistanceModel.CallTreeContext|\n    null {\n  if (!callTree) {\n    return null;\n  }\n  return new AiAssistanceModel.CallTreeContext(callTree);\n}\nfunction createPerfInsightContext(insight: TimelineUtils.InsightAIContext.ActiveInsight|null):\n    AiAssistanceModel.InsightContext|null {\n  if (!insight) {\n    return null;\n  }\n  return new AiAssistanceModel.InsightContext(insight);\n}\n\nfunction agentTypeToConversationType(type: AiAssistanceModel.AgentType): AiAssistanceModel.ConversationType {\n  switch (type) {\n    case AiAssistanceModel.AgentType.STYLING:\n      return AiAssistanceModel.ConversationType.STYLING;\n    case AiAssistanceModel.AgentType.NETWORK:\n      return AiAssistanceModel.ConversationType.NETWORK;\n    case AiAssistanceModel.AgentType.FILE:\n      return AiAssistanceModel.ConversationType.FILE;\n    case AiAssistanceModel.AgentType.PERFORMANCE:\n      return AiAssistanceModel.ConversationType.PERFORMANCE;\n    case AiAssistanceModel.AgentType.PERFORMANCE_INSIGHT:\n      return AiAssistanceModel.ConversationType.PERFORMANCE_INSIGHT;\n    case AiAssistanceModel.AgentType.PATCH:\n      throw new Error(\n          'PATCH AiAssistanceModel.AgentType does not have a corresponding AiAssistanceModels.ConversationType.');\n  }\n}\n\nlet panelInstance: AiAssistancePanel;\nexport class AiAssistancePanel extends UI.Panel.Panel {\n  static panelName = 'freestyler';\n\n  #toggleSearchElementAction: UI.ActionRegistration.Action;\n  #aidaClient: Host.AidaClient.AidaClient;\n  #viewOutput: PanelViewOutput = {};\n  #serverSideLoggingEnabled = isAiAssistanceServerSideLoggingEnabled();\n  #aiAssistanceEnabledSetting: Common.Settings.Setting<boolean>|undefined;\n  #changeManager = new AiAssistanceModel.ChangeManager();\n  #mutex = new Common.Mutex.Mutex();\n\n  #conversationAgent?: AiAssistanceModel.AiAgent<unknown>;\n  #conversation?: AiAssistanceModel.Conversation;\n  #historicalConversations: AiAssistanceModel.Conversation[] = [];\n\n  #selectedFile: AiAssistanceModel.FileContext|null = null;\n  #selectedElement: AiAssistanceModel.NodeContext|null = null;\n  #selectedCallTree: AiAssistanceModel.CallTreeContext|null = null;\n  #selectedPerformanceInsight: AiAssistanceModel.InsightContext|null = null;\n  #selectedRequest: AiAssistanceModel.RequestContext|null = null;\n\n  // Messages displayed in the `ChatView` component.\n  #messages: ChatMessage[] = [];\n  // Indicates whether the new conversation context is blocked due to cross-origin restrictions.\n  // This happens when the conversation's context has a different\n  // origin than the selected context.\n  #blockedByCrossOrigin = false;\n  // Whether the UI should show loading or not.\n  #isLoading = false;\n  // Selected conversation context. The reason we keep this as a\n  // state field rather than using `#getConversationContext` is that,\n  // there is a case where the context differs from the selectedElement (or other selected context type).\n  // Specifically, it allows restoring the previous context when a new selection is cross-origin.\n  // See `#onContextSelectionChanged` for details.\n  #selectedContext: AiAssistanceModel.ConversationContext<unknown>|null = null;\n  // Stores the availability status of the `AidaClient` and the reason for unavailability, if any.\n  #aidaAvailability: Host.AidaClient.AidaAccessPreconditions;\n  // Info of the currently logged in user.\n  #userInfo: {\n    accountImage?: string,\n    accountFullName?: string,\n  };\n  #imageInput?: ImageInputData;\n  // Used to disable send button when there is not text input.\n  #isTextInputEmpty = true;\n\n  constructor(private view: View = defaultView, {aidaClient, aidaAvailability, syncInfo}: {\n    aidaClient: Host.AidaClient.AidaClient,\n    aidaAvailability: Host.AidaClient.AidaAccessPreconditions,\n    syncInfo: Host.InspectorFrontendHostAPI.SyncInformation,\n  }) {\n    super(AiAssistancePanel.panelName);\n    this.registerRequiredCSS(aiAssistancePanelStyles);\n    this.#aiAssistanceEnabledSetting = this.#getAiAssistanceEnabledSetting();\n\n    this.#toggleSearchElementAction =\n        UI.ActionRegistry.ActionRegistry.instance().getAction('elements.toggle-element-search');\n    this.#aidaClient = aidaClient;\n    this.#aidaAvailability = aidaAvailability;\n    this.#userInfo = {\n      accountImage: syncInfo.accountImage,\n      accountFullName: syncInfo.accountFullName,\n    };\n\n    this.#historicalConversations = AiAssistanceModel.AiHistoryStorage.instance().getHistory().map(item => {\n      return new AiAssistanceModel.Conversation(item.type, item.history, item.id, true);\n    });\n  }\n\n  #getChatUiState(): ChatViewState {\n    const blockedByAge = Root.Runtime.hostConfig.aidaAvailability?.blockedByAge === true;\n    return (this.#aiAssistanceEnabledSetting?.getIfNotDisabled() && !blockedByAge) ? ChatViewState.CHAT_VIEW :\n                                                                                     ChatViewState.CONSENT_VIEW;\n  }\n\n  #getAiAssistanceEnabledSetting(): Common.Settings.Setting<boolean>|undefined {\n    try {\n      return Common.Settings.moduleSetting('ai-assistance-enabled') as Common.Settings.Setting<boolean>;\n    } catch {\n      return;\n    }\n  }\n\n  #createAgent(conversationType: AiAssistanceModel.ConversationType): AiAssistanceModel.AiAgent<unknown> {\n    const options = {\n      aidaClient: this.#aidaClient,\n      serverSideLoggingEnabled: this.#serverSideLoggingEnabled,\n    };\n    let agent: AiAssistanceModel.AiAgent<unknown>;\n    switch (conversationType) {\n      case AiAssistanceModel.ConversationType.STYLING: {\n        agent = new AiAssistanceModel.StylingAgent({\n          ...options,\n          changeManager: this.#changeManager,\n        });\n        if (isAiAssistanceStylingWithFunctionCallingEnabled()) {\n          agent = new AiAssistanceModel.StylingAgentWithFunctionCalling({\n            ...options,\n            changeManager: this.#changeManager,\n          });\n        }\n\n        break;\n      }\n      case AiAssistanceModel.ConversationType.NETWORK: {\n        agent = new AiAssistanceModel.NetworkAgent(options);\n        break;\n      }\n      case AiAssistanceModel.ConversationType.FILE: {\n        agent = new AiAssistanceModel.FileAgent(options);\n        break;\n      }\n      case AiAssistanceModel.ConversationType.PERFORMANCE: {\n        agent = new AiAssistanceModel.PerformanceAgent(options);\n        break;\n      }\n      case AiAssistanceModel.ConversationType.PERFORMANCE_INSIGHT: {\n        agent = new AiAssistanceModel.PerformanceInsightsAgent(options);\n        break;\n      }\n    }\n    return agent;\n  }\n\n  static async instance(opts: {\n    forceNew: boolean|null,\n  }|undefined = {forceNew: null}): Promise<AiAssistancePanel> {\n    const {forceNew} = opts;\n    if (!panelInstance || forceNew) {\n      const aidaClient = new Host.AidaClient.AidaClient();\n      const syncInfoPromise = new Promise<Host.InspectorFrontendHostAPI.SyncInformation>(\n          resolve => Host.InspectorFrontendHost.InspectorFrontendHostInstance.getSyncInformation(resolve));\n      const [aidaAvailability, syncInfo] =\n          await Promise.all([Host.AidaClient.AidaClient.checkAccessPreconditions(), syncInfoPromise]);\n      panelInstance = new AiAssistancePanel(defaultView, {aidaClient, aidaAvailability, syncInfo});\n    }\n\n    return panelInstance;\n  }\n\n  // We select the default agent based on the open panels if\n  // there isn't any active conversation.\n  #selectDefaultAgentIfNeeded(): void {\n    // If there already is an agent and if it is not empty,\n    // we don't automatically change the agent. In addition to this,\n    // we don't change the current agent when there is a message in flight.\n    if ((this.#conversationAgent && this.#conversation && !this.#conversation.isEmpty) || this.#isLoading) {\n      return;\n    }\n    const {hostConfig} = Root.Runtime;\n    const isElementsPanelVisible =\n        Boolean(UI.Context.Context.instance().flavor(ElementsPanel.ElementsPanel.ElementsPanel));\n    const isNetworkPanelVisible = Boolean(UI.Context.Context.instance().flavor(NetworkPanel.NetworkPanel.NetworkPanel));\n    const isSourcesPanelVisible = Boolean(UI.Context.Context.instance().flavor(SourcesPanel.SourcesPanel.SourcesPanel));\n    const isPerformancePanelVisible =\n        Boolean(UI.Context.Context.instance().flavor(TimelinePanel.TimelinePanel.TimelinePanel));\n\n    // Check if the user has an insight expanded in the performance panel sidebar.\n    // If they have, we default to the Insights agent; otherwise we fallback to\n    // the regular Performance agent.\n    // Note that we do not listen to this flavor changing; this code is here to\n    // ensure that by default we do not pick the Insights agent if the user has\n    // just imported a trace and not done anything else. It doesn't make sense\n    // to select the Insights AI agent in that case.\n    const userHasExpandedPerfInsight =\n        Boolean(UI.Context.Context.instance().flavor(TimelinePanel.TimelinePanel.SelectedInsight));\n    let targetConversationType: AiAssistanceModel.ConversationType|undefined = undefined;\n    if (isElementsPanelVisible && hostConfig.devToolsFreestyler?.enabled) {\n      targetConversationType = AiAssistanceModel.ConversationType.STYLING;\n    } else if (isNetworkPanelVisible && hostConfig.devToolsAiAssistanceNetworkAgent?.enabled) {\n      targetConversationType = AiAssistanceModel.ConversationType.NETWORK;\n    } else if (isSourcesPanelVisible && hostConfig.devToolsAiAssistanceFileAgent?.enabled) {\n      targetConversationType = AiAssistanceModel.ConversationType.FILE;\n    } else if (\n        isPerformancePanelVisible && hostConfig.devToolsAiAssistancePerformanceAgent?.enabled &&\n        hostConfig.devToolsAiAssistancePerformanceAgent?.insightsEnabled && userHasExpandedPerfInsight) {\n      targetConversationType = AiAssistanceModel.ConversationType.PERFORMANCE_INSIGHT;\n    } else if (isPerformancePanelVisible && hostConfig.devToolsAiAssistancePerformanceAgent?.enabled) {\n      targetConversationType = AiAssistanceModel.ConversationType.PERFORMANCE;\n    }\n\n    if (this.#conversationAgent?.type === targetConversationType) {\n      // The above if makes sure even if we have an active agent it's empty\n      // So we can just reuse it\n      return;\n    }\n\n    const agent = targetConversationType ? this.#createAgent(targetConversationType) : undefined;\n    this.#updateConversationState(agent);\n  }\n\n  #updateConversationState(input?: AiAssistanceModel.AiAgent<unknown>|AiAssistanceModel.Conversation): void {\n    const agent = input instanceof AiAssistanceModel.AiAgent ? input : undefined;\n    const conversation = input instanceof AiAssistanceModel.Conversation ? input : undefined;\n\n    if (this.#conversationAgent !== agent) {\n      // Cancel any previous conversation\n      this.#cancel();\n      this.#messages = [];\n      this.#isLoading = false;\n      this.#conversation?.archiveConversation();\n      this.#conversationAgent = agent;\n\n      // If we get a new agent we need to\n      // create a new conversation along side it\n      if (agent) {\n        this.#conversation = new AiAssistanceModel.Conversation(\n            agentTypeToConversationType(agent.type),\n            [],\n            agent.id,\n            false,\n        );\n        this.#historicalConversations.push(this.#conversation);\n      }\n    }\n\n    if (!agent) {\n      this.#conversation = undefined;\n      // We need to run doConversation separately\n      this.#messages = [];\n      // If a no new agent is provided\n      // but conversation is\n      // update with history conversation\n      if (conversation) {\n        this.#conversation = conversation;\n      }\n    }\n\n    if (!this.#conversationAgent && !this.#conversation) {\n      this.#selectDefaultAgentIfNeeded();\n    }\n\n    this.#onContextSelectionChanged();\n    this.requestUpdate();\n  }\n\n  override wasShown(): void {\n    super.wasShown();\n    this.#viewOutput.chatView?.restoreScrollPosition();\n    this.#viewOutput.chatView?.focusTextInput();\n    void this.#handleAidaAvailabilityChange();\n    this.#selectedElement =\n        createNodeContext(selectedElementFilter(UI.Context.Context.instance().flavor(SDK.DOMModel.DOMNode)));\n    this.#selectedRequest =\n        createRequestContext(UI.Context.Context.instance().flavor(SDK.NetworkRequest.NetworkRequest));\n    this.#selectedCallTree =\n        createCallTreeContext(UI.Context.Context.instance().flavor(TimelineUtils.AICallTree.AICallTree));\n    this.#selectedPerformanceInsight =\n        createPerfInsightContext(UI.Context.Context.instance().flavor(TimelineUtils.InsightAIContext.ActiveInsight));\n    this.#selectedFile = createFileContext(UI.Context.Context.instance().flavor(Workspace.UISourceCode.UISourceCode));\n    this.#updateConversationState(this.#conversationAgent);\n\n    this.#aiAssistanceEnabledSetting?.addChangeListener(this.requestUpdate, this);\n    Host.AidaClient.HostConfigTracker.instance().addEventListener(\n        Host.AidaClient.Events.AIDA_AVAILABILITY_CHANGED, this.#handleAidaAvailabilityChange);\n    this.#toggleSearchElementAction.addEventListener(UI.ActionRegistration.Events.TOGGLED, this.requestUpdate, this);\n\n    UI.Context.Context.instance().addFlavorChangeListener(SDK.DOMModel.DOMNode, this.#handleDOMNodeFlavorChange);\n    UI.Context.Context.instance().addFlavorChangeListener(\n        SDK.NetworkRequest.NetworkRequest, this.#handleNetworkRequestFlavorChange);\n    UI.Context.Context.instance().addFlavorChangeListener(\n        TimelineUtils.AICallTree.AICallTree, this.#handleTraceEntryNodeFlavorChange);\n    UI.Context.Context.instance().addFlavorChangeListener(\n        Workspace.UISourceCode.UISourceCode, this.#handleUISourceCodeFlavorChange);\n    UI.Context.Context.instance().addFlavorChangeListener(\n        TimelineUtils.InsightAIContext.ActiveInsight, this.#handlePerfInsightFlavorChange);\n\n    UI.Context.Context.instance().addFlavorChangeListener(\n        ElementsPanel.ElementsPanel.ElementsPanel, this.#selectDefaultAgentIfNeeded, this);\n    UI.Context.Context.instance().addFlavorChangeListener(\n        NetworkPanel.NetworkPanel.NetworkPanel, this.#selectDefaultAgentIfNeeded, this);\n    UI.Context.Context.instance().addFlavorChangeListener(\n        SourcesPanel.SourcesPanel.SourcesPanel, this.#selectDefaultAgentIfNeeded, this);\n    UI.Context.Context.instance().addFlavorChangeListener(\n        TimelinePanel.TimelinePanel.TimelinePanel, this.#selectDefaultAgentIfNeeded, this);\n    SDK.TargetManager.TargetManager.instance().addModelListener(\n        SDK.DOMModel.DOMModel, SDK.DOMModel.Events.AttrModified, this.#handleDOMNodeAttrChange, this);\n    SDK.TargetManager.TargetManager.instance().addModelListener(\n        SDK.DOMModel.DOMModel, SDK.DOMModel.Events.AttrRemoved, this.#handleDOMNodeAttrChange, this);\n\n    SDK.TargetManager.TargetManager.instance().addModelListener(\n        SDK.ResourceTreeModel.ResourceTreeModel, SDK.ResourceTreeModel.Events.PrimaryPageChanged,\n        this.#onPrimaryPageChanged, this);\n\n    Host.userMetrics.actionTaken(Host.UserMetrics.Action.AiAssistancePanelOpened);\n  }\n\n  override willHide(): void {\n    this.#aiAssistanceEnabledSetting?.removeChangeListener(this.requestUpdate, this);\n    Host.AidaClient.HostConfigTracker.instance().removeEventListener(\n        Host.AidaClient.Events.AIDA_AVAILABILITY_CHANGED, this.#handleAidaAvailabilityChange);\n    this.#toggleSearchElementAction.removeEventListener(UI.ActionRegistration.Events.TOGGLED, this.requestUpdate, this);\n    UI.Context.Context.instance().removeFlavorChangeListener(SDK.DOMModel.DOMNode, this.#handleDOMNodeFlavorChange);\n    UI.Context.Context.instance().removeFlavorChangeListener(\n        SDK.NetworkRequest.NetworkRequest, this.#handleNetworkRequestFlavorChange);\n    UI.Context.Context.instance().removeFlavorChangeListener(\n        TimelineUtils.AICallTree.AICallTree, this.#handleTraceEntryNodeFlavorChange);\n    UI.Context.Context.instance().removeFlavorChangeListener(\n        TimelineUtils.InsightAIContext.ActiveInsight, this.#handlePerfInsightFlavorChange);\n    UI.Context.Context.instance().removeFlavorChangeListener(\n        Workspace.UISourceCode.UISourceCode, this.#handleUISourceCodeFlavorChange);\n    UI.Context.Context.instance().removeFlavorChangeListener(\n        ElementsPanel.ElementsPanel.ElementsPanel, this.#selectDefaultAgentIfNeeded, this);\n    UI.Context.Context.instance().removeFlavorChangeListener(\n        NetworkPanel.NetworkPanel.NetworkPanel, this.#selectDefaultAgentIfNeeded, this);\n    UI.Context.Context.instance().removeFlavorChangeListener(\n        SourcesPanel.SourcesPanel.SourcesPanel, this.#selectDefaultAgentIfNeeded, this);\n    UI.Context.Context.instance().removeFlavorChangeListener(\n        TimelinePanel.TimelinePanel.TimelinePanel, this.#selectDefaultAgentIfNeeded, this);\n    SDK.TargetManager.TargetManager.instance().removeModelListener(\n        SDK.DOMModel.DOMModel,\n        SDK.DOMModel.Events.AttrModified,\n        this.#handleDOMNodeAttrChange,\n        this,\n    );\n    SDK.TargetManager.TargetManager.instance().removeModelListener(\n        SDK.DOMModel.DOMModel,\n        SDK.DOMModel.Events.AttrRemoved,\n        this.#handleDOMNodeAttrChange,\n        this,\n    );\n    SDK.TargetManager.TargetManager.instance().removeModelListener(\n        SDK.ResourceTreeModel.ResourceTreeModel, SDK.ResourceTreeModel.Events.PrimaryPageChanged,\n        this.#onPrimaryPageChanged, this);\n  }\n\n  #handleAidaAvailabilityChange = async(): Promise<void> => {\n    const currentAidaAvailability = await Host.AidaClient.AidaClient.checkAccessPreconditions();\n    if (currentAidaAvailability !== this.#aidaAvailability) {\n      this.#aidaAvailability = currentAidaAvailability;\n      const syncInfo = await new Promise<Host.InspectorFrontendHostAPI.SyncInformation>(\n          resolve => Host.InspectorFrontendHost.InspectorFrontendHostInstance.getSyncInformation(resolve));\n      this.#userInfo = {\n        accountImage: syncInfo.accountImage,\n        accountFullName: syncInfo.accountFullName,\n      };\n      this.requestUpdate();\n    }\n  };\n\n  #handleDOMNodeFlavorChange = (ev: Common.EventTarget.EventTargetEvent<SDK.DOMModel.DOMNode>): void => {\n    if (this.#selectedElement?.getItem() === ev.data) {\n      return;\n    }\n\n    this.#selectedElement = createNodeContext(selectedElementFilter(ev.data));\n    this.#updateConversationState(this.#conversationAgent);\n  };\n\n  #handleDOMNodeAttrChange =\n      (ev: Common.EventTarget.EventTargetEvent<{node: SDK.DOMModel.DOMNode, name: string}>): void => {\n        if (this.#selectedElement?.getItem() === ev.data.node) {\n          if (ev.data.name === 'class' || ev.data.name === 'id') {\n            this.requestUpdate();\n          }\n        }\n      };\n\n  #handleNetworkRequestFlavorChange =\n      (ev: Common.EventTarget.EventTargetEvent<SDK.NetworkRequest.NetworkRequest>): void => {\n        if (this.#selectedRequest?.getItem() === ev.data) {\n          return;\n        }\n\n        this.#selectedRequest = Boolean(ev.data) ? new AiAssistanceModel.RequestContext(ev.data) : null;\n        this.#updateConversationState(this.#conversationAgent);\n      };\n\n  #handleTraceEntryNodeFlavorChange =\n      (ev: Common.EventTarget.EventTargetEvent<TimelineUtils.AICallTree.AICallTree>): void => {\n        if (this.#selectedCallTree?.getItem() === ev.data) {\n          return;\n        }\n\n        this.#selectedCallTree = Boolean(ev.data) ? new AiAssistanceModel.CallTreeContext(ev.data) : null;\n        this.#updateConversationState(this.#conversationAgent);\n      };\n\n  #handlePerfInsightFlavorChange =\n      (ev: Common.EventTarget.EventTargetEvent<TimelineUtils.InsightAIContext.ActiveInsight>): void => {\n        if (this.#selectedPerformanceInsight?.getItem() === ev.data) {\n          return;\n        }\n\n        this.#selectedPerformanceInsight = Boolean(ev.data) ? new AiAssistanceModel.InsightContext(ev.data) : null;\n        this.#updateConversationState(this.#conversationAgent);\n      };\n\n  #handleUISourceCodeFlavorChange =\n      (ev: Common.EventTarget.EventTargetEvent<Workspace.UISourceCode.UISourceCode>): void => {\n        const newFile = ev.data;\n        if (!newFile) {\n          return;\n        }\n        if (this.#selectedFile?.getItem() === newFile) {\n          return;\n        }\n        this.#selectedFile = new AiAssistanceModel.FileContext(ev.data);\n        this.#updateConversationState(this.#conversationAgent);\n      };\n\n  #onPrimaryPageChanged(): void {\n    if (!this.#imageInput) {\n      return;\n    }\n\n    this.#imageInput = undefined;\n    this.requestUpdate();\n  }\n\n  #getChangeSummary(): string|undefined {\n    if (!isAiAssistancePatchingEnabled() || !this.#conversationAgent || this.#conversation?.isReadOnly) {\n      return;\n    }\n\n    return this.#changeManager.formatChangesForPatching(this.#conversationAgent.id, /* includeSourceLocation= */ true);\n  }\n\n  override async performUpdate(): Promise<void> {\n    this.view(\n        {\n          state: this.#getChatUiState(),\n          blockedByCrossOrigin: this.#blockedByCrossOrigin,\n          aidaAvailability: this.#aidaAvailability,\n          isLoading: this.#isLoading,\n          messages: this.#messages,\n          selectedContext: this.#selectedContext,\n          conversationType: this.#conversation?.type,\n          isReadOnly: this.#conversation?.isReadOnly ?? false,\n          changeSummary: this.#getChangeSummary(),\n          inspectElementToggled: this.#toggleSearchElementAction.toggled(),\n          userInfo: this.#userInfo,\n          canShowFeedbackForm: this.#serverSideLoggingEnabled,\n          multimodalInputEnabled: isAiAssistanceMultimodalInputEnabled() &&\n              this.#conversation?.type === AiAssistanceModel.ConversationType.STYLING,\n          imageInput: this.#imageInput,\n          isDeleteHistoryButtonVisible: Boolean(this.#conversation && !this.#conversation.isEmpty),\n          isTextInputDisabled: this.#isTextInputDisabled(),\n          emptyStateSuggestions: getEmptyStateSuggestions(this.#selectedContext, this.#conversation?.type),\n          inputPlaceholder: this.#getChatInputPlaceholder(),\n          disclaimerText: this.#getDisclaimerText(),\n          isTextInputEmpty: this.#isTextInputEmpty,\n          onNewChatClick: this.#handleNewChatRequest.bind(this),\n          onHistoryClick: this.#onHistoryClicked.bind(this),\n          onDeleteClick: this.#onDeleteClicked.bind(this),\n          onHelpClick: () => {\n            UI.UIUtils.openInNewTab(AI_ASSISTANCE_HELP);\n          },\n          onSettingsClick: () => {\n            void UI.ViewManager.ViewManager.instance().showView('chrome-ai');\n          },\n          onTextSubmit: async (text: string, imageInput?: Host.AidaClient.Part) => {\n            this.#imageInput = undefined;\n            this.#isTextInputEmpty = true;\n            Host.userMetrics.actionTaken(Host.UserMetrics.Action.AiAssistanceQuerySubmitted);\n            await this.#startConversation(text, imageInput);\n          },\n          onInspectElementClick: this.#handleSelectElementClick.bind(this),\n          onFeedbackSubmit: this.#handleFeedbackSubmit.bind(this),\n          onCancelClick: this.#cancel.bind(this),\n          onContextClick: this.#handleContextClick.bind(this),\n          onNewConversation: this.#handleNewChatRequest.bind(this),\n          onTakeScreenshot: isAiAssistanceMultimodalInputEnabled() ? this.#handleTakeScreenshot.bind(this) : undefined,\n          onRemoveImageInput: isAiAssistanceMultimodalInputEnabled() ? this.#handleRemoveImageInput.bind(this) :\n                                                                       undefined,\n          onTextInputChange: this.#handleTextInputChange.bind(this),\n        },\n        this.#viewOutput, this.contentElement);\n  }\n\n  #handleSelectElementClick(): void {\n    void this.#toggleSearchElementAction.execute();\n  }\n\n  #isTextInputDisabled(): boolean {\n    // If the `aiAssistanceSetting` is not enabled\n    // or if the user is blocked by age, the text input is disabled.\n    const aiAssistanceSetting = this.#aiAssistanceEnabledSetting?.getIfNotDisabled();\n    const isBlockedByAge = Root.Runtime.hostConfig.aidaAvailability?.blockedByAge === true;\n    if (!aiAssistanceSetting || isBlockedByAge) {\n      return true;\n    }\n\n    // If the Aida is not available, the text input is disabled.\n    const isAidaAvailable = this.#aidaAvailability === Host.AidaClient.AidaAccessPreconditions.AVAILABLE;\n    if (!isAidaAvailable) {\n      return true;\n    }\n\n    // If sending a new message is blocked by cross origin context\n    // the text input is disabled.\n    if (this.#blockedByCrossOrigin) {\n      return true;\n    }\n\n    // If there is no current agent if there is no selected context\n    // the text input is disabled.\n    if (!this.#conversation || !this.#selectedContext) {\n      return true;\n    }\n\n    return false;\n  }\n\n  #getChatInputPlaceholder(): Platform.UIString.LocalizedString {\n    const state = this.#getChatUiState();\n    if (state === ChatViewState.CONSENT_VIEW || !this.#conversation) {\n      return i18nString(UIStrings.followTheSteps);\n    }\n\n    if (this.#blockedByCrossOrigin) {\n      return lockedString(UIStringsNotTranslate.crossOriginError);\n    }\n\n    switch (this.#conversation.type) {\n      case AiAssistanceModel.ConversationType.STYLING:\n        return this.#selectedContext ? lockedString(UIStringsNotTranslate.inputPlaceholderForStyling) :\n                                       lockedString(UIStringsNotTranslate.inputPlaceholderForStylingNoContext);\n      case AiAssistanceModel.ConversationType.FILE:\n        return this.#selectedContext ? lockedString(UIStringsNotTranslate.inputPlaceholderForFile) :\n                                       lockedString(UIStringsNotTranslate.inputPlaceholderForFileNoContext);\n      case AiAssistanceModel.ConversationType.NETWORK:\n        return this.#selectedContext ? lockedString(UIStringsNotTranslate.inputPlaceholderForNetwork) :\n                                       lockedString(UIStringsNotTranslate.inputPlaceholderForNetworkNoContext);\n      case AiAssistanceModel.ConversationType.PERFORMANCE:\n        return this.#selectedContext ? lockedString(UIStringsNotTranslate.inputPlaceholderForPerformance) :\n                                       lockedString(UIStringsNotTranslate.inputPlaceholderForPerformanceNoContext);\n      case AiAssistanceModel.ConversationType.PERFORMANCE_INSIGHT:\n        return this.#selectedContext ?\n            lockedString(UIStringsNotTranslate.inputPlaceholderForPerformanceInsights) :\n            lockedString(UIStringsNotTranslate.inputPlaceholderForPerformanceInsightsNoContext);\n    }\n  }\n\n  #getDisclaimerText(): Platform.UIString.LocalizedString {\n    const state = this.#getChatUiState();\n    if (state === ChatViewState.CONSENT_VIEW || !this.#conversation || this.#conversation.isReadOnly) {\n      return i18nString(UIStrings.inputDisclaimerForEmptyState);\n    }\n\n    const noLogging = Root.Runtime.hostConfig.aidaAvailability?.enterprisePolicyValue ===\n        Root.Runtime.GenAiEnterprisePolicyValue.ALLOW_WITHOUT_LOGGING;\n    switch (this.#conversation.type) {\n      case AiAssistanceModel.ConversationType.STYLING:\n        if (noLogging) {\n          return lockedString(UIStringsNotTranslate.inputDisclaimerForStylingEnterpriseNoLogging);\n        }\n        return lockedString(UIStringsNotTranslate.inputDisclaimerForStyling);\n      case AiAssistanceModel.ConversationType.FILE:\n        if (noLogging) {\n          return lockedString(UIStringsNotTranslate.inputDisclaimerForFileEnterpriseNoLogging);\n        }\n        return lockedString(UIStringsNotTranslate.inputDisclaimerForFile);\n      case AiAssistanceModel.ConversationType.NETWORK:\n        if (noLogging) {\n          return lockedString(UIStringsNotTranslate.inputDisclaimerForNetworkEnterpriseNoLogging);\n        }\n        return lockedString(UIStringsNotTranslate.inputDisclaimerForNetwork);\n      case AiAssistanceModel.ConversationType.PERFORMANCE:\n        if (noLogging) {\n          return lockedString(UIStringsNotTranslate.inputDisclaimerForPerformanceEnterpriseNoLogging);\n        }\n        return lockedString(UIStringsNotTranslate.inputDisclaimerForPerformance);\n      case AiAssistanceModel.ConversationType.PERFORMANCE_INSIGHT:\n        // TODO(b/393061683): Define these rather than reuse the existing performance agent.\n        if (noLogging) {\n          return lockedString(UIStringsNotTranslate.inputDisclaimerForPerformanceEnterpriseNoLogging);\n        }\n        return lockedString(UIStringsNotTranslate.inputDisclaimerForPerformance);\n    }\n  }\n\n  #handleFeedbackSubmit(rpcId: Host.AidaClient.RpcGlobalId, rating: Host.AidaClient.Rating, feedback?: string): void {\n    void this.#aidaClient.registerClientEvent({\n      corresponding_aida_rpc_global_id: rpcId,\n      disable_user_content_logging: !this.#serverSideLoggingEnabled,\n      do_conversation_client_event: {\n        user_feedback: {\n          sentiment: rating,\n          user_input: {\n            comment: feedback,\n          },\n        },\n      },\n    });\n  }\n\n  #handleContextClick(): void|Promise<void> {\n    const context = this.#selectedContext;\n    if (context instanceof AiAssistanceModel.RequestContext) {\n      const requestLocation = NetworkForward.UIRequestLocation.UIRequestLocation.tab(\n          context.getItem(), NetworkForward.UIRequestLocation.UIRequestTabs.HEADERS_COMPONENT);\n      return Common.Revealer.reveal(requestLocation);\n    }\n    if (context instanceof AiAssistanceModel.FileContext) {\n      return Common.Revealer.reveal(context.getItem().uiLocation(0, 0));\n    }\n    if (context instanceof AiAssistanceModel.CallTreeContext) {\n      const item = context.getItem();\n      const event = item.selectedNode?.event ?? item.rootNode.event;\n      const trace = new SDK.TraceObject.RevealableEvent(event);\n      return Common.Revealer.reveal(trace);\n    }\n    // Node picker is using linkifier.\n  }\n\n  handleAction(actionId: string): void {\n    if (this.#isLoading) {\n      // If running some queries already, focus the input with the abort\n      // button and do nothing.\n      this.#viewOutput.chatView?.focusTextInput();\n      return;\n    }\n\n    let targetConversationType: AiAssistanceModel.ConversationType|undefined;\n    switch (actionId) {\n      case 'freestyler.elements-floating-button': {\n        Host.userMetrics.actionTaken(Host.UserMetrics.Action.AiAssistanceOpenedFromElementsPanelFloatingButton);\n        targetConversationType = AiAssistanceModel.ConversationType.STYLING;\n        break;\n      }\n      case 'freestyler.element-panel-context': {\n        Host.userMetrics.actionTaken(Host.UserMetrics.Action.AiAssistanceOpenedFromElementsPanel);\n        targetConversationType = AiAssistanceModel.ConversationType.STYLING;\n        break;\n      }\n      case 'drjones.network-floating-button': {\n        Host.userMetrics.actionTaken(Host.UserMetrics.Action.AiAssistanceOpenedFromNetworkPanelFloatingButton);\n        targetConversationType = AiAssistanceModel.ConversationType.NETWORK;\n        break;\n      }\n      case 'drjones.network-panel-context': {\n        Host.userMetrics.actionTaken(Host.UserMetrics.Action.AiAssistanceOpenedFromNetworkPanel);\n        targetConversationType = AiAssistanceModel.ConversationType.NETWORK;\n        break;\n      }\n      case 'drjones.performance-panel-context': {\n        Host.userMetrics.actionTaken(Host.UserMetrics.Action.AiAssistanceOpenedFromPerformancePanel);\n        targetConversationType = AiAssistanceModel.ConversationType.PERFORMANCE;\n        break;\n      }\n      case 'drjones.performance-insight-context': {\n        Host.userMetrics.actionTaken(Host.UserMetrics.Action.AiAssistanceOpenedFromPerformanceInsight);\n        targetConversationType = AiAssistanceModel.ConversationType.PERFORMANCE_INSIGHT;\n        break;\n      }\n      case 'drjones.sources-floating-button': {\n        Host.userMetrics.actionTaken(Host.UserMetrics.Action.AiAssistanceOpenedFromSourcesPanelFloatingButton);\n        targetConversationType = AiAssistanceModel.ConversationType.FILE;\n        break;\n      }\n      case 'drjones.sources-panel-context': {\n        Host.userMetrics.actionTaken(Host.UserMetrics.Action.AiAssistanceOpenedFromSourcesPanel);\n        targetConversationType = AiAssistanceModel.ConversationType.FILE;\n        break;\n      }\n    }\n\n    if (!targetConversationType) {\n      return;\n    }\n\n    let agent = this.#conversationAgent;\n    if (!this.#conversation || !this.#conversationAgent || this.#conversation.type !== targetConversationType ||\n        this.#conversation?.isEmpty || targetConversationType === AiAssistanceModel.ConversationType.PERFORMANCE) {\n      agent = this.#createAgent(targetConversationType);\n    }\n    this.#updateConversationState(agent);\n    this.#viewOutput.chatView?.focusTextInput();\n  }\n\n  #onHistoryClicked(event: Event): void {\n    const target = event.target as Element | undefined;\n    const clientRect = target?.getBoundingClientRect();\n    const contextMenu = new UI.ContextMenu.ContextMenu(event, {\n      useSoftMenu: true,\n      x: clientRect?.left,\n      y: clientRect?.bottom,\n    });\n\n    for (const conversation of [...this.#historicalConversations].reverse()) {\n      if (conversation.isEmpty) {\n        continue;\n      }\n      const title = conversation.title;\n      if (!title) {\n        continue;\n      }\n\n      contextMenu.defaultSection().appendCheckboxItem(title, () => {\n        void this.#openConversation(conversation);\n      }, {checked: (this.#conversation === conversation)});\n    }\n\n    const historyEmpty = contextMenu.defaultSection().items.length === 0;\n    if (historyEmpty) {\n      contextMenu.defaultSection().appendItem(i18nString(UIStrings.noPastConversations), () => {}, {\n        disabled: true,\n      });\n    }\n\n    contextMenu.footerSection().appendItem(\n        i18nString(UIStrings.clearChatHistory),\n        () => {\n          this.#clearHistory();\n        },\n        {\n          disabled: historyEmpty,\n        },\n    );\n\n    void contextMenu.show();\n  }\n\n  #clearHistory(): void {\n    this.#historicalConversations = [];\n    void AiAssistanceModel.AiHistoryStorage.instance().deleteAll();\n    this.#updateConversationState();\n  }\n\n  #onDeleteClicked(): void {\n    if (!this.#conversation) {\n      return;\n    }\n\n    this.#historicalConversations =\n        this.#historicalConversations.filter(conversation => conversation !== this.#conversation);\n    void AiAssistanceModel.AiHistoryStorage.instance().deleteHistoryEntry(this.#conversation.id);\n    this.#updateConversationState();\n    UI.ARIAUtils.alert(i18nString(UIStrings.chatDeleted));\n  }\n\n  async #openConversation(conversation: AiAssistanceModel.Conversation): Promise<void> {\n    if (this.#conversation === conversation) {\n      return;\n    }\n\n    this.#updateConversationState(conversation);\n    await this.#doConversation(conversation.history);\n  }\n\n  #handleNewChatRequest(): void {\n    this.#updateConversationState();\n    UI.ARIAUtils.alert(i18nString(UIStrings.newChatCreated));\n  }\n\n  async #handleTakeScreenshot(): Promise<void> {\n    const mainTarget = SDK.TargetManager.TargetManager.instance().primaryPageTarget();\n    if (!mainTarget) {\n      throw new Error('Could not find main target');\n    }\n    const model = mainTarget.model(SDK.ScreenCaptureModel.ScreenCaptureModel);\n    if (!model) {\n      throw new Error('Could not find model');\n    }\n    const showLoadingTimeout = setTimeout(() => {\n      this.#imageInput = {isLoading: true};\n      this.requestUpdate();\n    }, SHOW_LOADING_STATE_TIMEOUT);\n    const bytes = await model.captureScreenshot(\n        Protocol.Page.CaptureScreenshotRequestFormat.Jpeg,\n        SCREENSHOT_QUALITY,\n        SDK.ScreenCaptureModel.ScreenshotMode.FROM_VIEWPORT,\n    );\n    clearTimeout(showLoadingTimeout);\n    if (bytes) {\n      this.#imageInput = {isLoading: false, data: bytes};\n      this.requestUpdate();\n      void this.updateComplete.then(() => {\n        this.#viewOutput.chatView?.focusTextInput();\n      });\n    }\n  }\n\n  #handleRemoveImageInput(): void {\n    this.#imageInput = undefined;\n    this.requestUpdate();\n    void this.updateComplete.then(() => {\n      this.#viewOutput.chatView?.focusTextInput();\n    });\n  }\n\n  #handleTextInputChange(value: string): void {\n    const disableSubmit = !value;\n    if (disableSubmit !== this.#isTextInputEmpty) {\n      this.#isTextInputEmpty = disableSubmit;\n      void this.requestUpdate();\n    }\n  }\n\n  #runAbortController = new AbortController();\n  #cancel(): void {\n    this.#runAbortController.abort();\n    this.#runAbortController = new AbortController();\n  }\n\n  #onContextSelectionChanged(contextToRestore?: AiAssistanceModel.ConversationContext<unknown>): void {\n    if (!this.#conversationAgent) {\n      this.#blockedByCrossOrigin = false;\n      return;\n    }\n    const currentContext = contextToRestore ?? this.#getConversationContext();\n    this.#selectedContext = currentContext;\n    if (!currentContext) {\n      this.#blockedByCrossOrigin = false;\n      return;\n    }\n    this.#blockedByCrossOrigin = !currentContext.isOriginAllowed(this.#conversationAgent.origin);\n  }\n\n  #getConversationContext(): AiAssistanceModel.ConversationContext<unknown>|null {\n    if (!this.#conversation) {\n      return null;\n    }\n    let context: AiAssistanceModel.ConversationContext<unknown>|null;\n    switch (this.#conversation.type) {\n      case AiAssistanceModel.ConversationType.STYLING:\n        context = this.#selectedElement;\n        break;\n      case AiAssistanceModel.ConversationType.FILE:\n        context = this.#selectedFile;\n        break;\n      case AiAssistanceModel.ConversationType.NETWORK:\n        context = this.#selectedRequest;\n        break;\n      case AiAssistanceModel.ConversationType.PERFORMANCE:\n        context = this.#selectedCallTree;\n        break;\n      case AiAssistanceModel.ConversationType.PERFORMANCE_INSIGHT:\n        context = this.#selectedPerformanceInsight;\n        break;\n    }\n    return context;\n  }\n\n  async #startConversation(text: string, imageInput?: Host.AidaClient.Part): Promise<void> {\n    if (!this.#conversationAgent) {\n      return;\n    }\n    // Cancel any previous in-flight conversation.\n    this.#cancel();\n    const signal = this.#runAbortController.signal;\n    const context = this.#getConversationContext();\n    // If a different context is provided, it must be from the same origin.\n    if (context && !context.isOriginAllowed(this.#conversationAgent.origin)) {\n      // This error should not be reached. If it happens, some\n      // invariants do not hold anymore.\n      throw new Error('cross-origin context data should not be included');\n    }\n\n    const image = isAiAssistanceMultimodalInputEnabled() ? imageInput : undefined;\n    const imageId = image ? crypto.randomUUID() : undefined;\n    const runner = this.#conversationAgent.run(\n        text, {\n          signal,\n          selected: context,\n        },\n        image, imageId);\n    UI.ARIAUtils.alert(lockedString(UIStringsNotTranslate.answerLoading));\n    await this.#doConversation(this.#saveResponsesToCurrentConversation(runner));\n    UI.ARIAUtils.alert(lockedString(UIStringsNotTranslate.answerReady));\n  }\n\n  async *\n      #saveResponsesToCurrentConversation(items: AsyncIterable<AiAssistanceModel.ResponseData, void, void>):\n          AsyncGenerator<AiAssistanceModel.ResponseData, void, void> {\n    const currentConversation = this.#conversation;\n\n    for await (const data of items) {\n      // We don't want to save partial responses to the conversation history.\n      if (data.type !== AiAssistanceModel.ResponseType.ANSWER || data.complete) {\n        void currentConversation?.addHistoryItem(data);\n      }\n      yield data;\n    }\n  }\n\n  async #doConversation(\n      items: Iterable<AiAssistanceModel.ResponseData, void, void>|\n      AsyncIterable<AiAssistanceModel.ResponseData, void, void>): Promise<void> {\n    const release = await this.#mutex.acquire();\n    try {\n      let systemMessage: ModelChatMessage = {\n        entity: ChatMessageEntity.MODEL,\n        steps: [],\n      };\n      let step: Step = {isLoading: true};\n\n      /**\n       * Commits the step to props only if necessary.\n       */\n      function commitStep(): void {\n        if (systemMessage.steps.at(-1) !== step) {\n          systemMessage.steps.push(step);\n        }\n      }\n\n      this.#isLoading = true;\n      for await (const data of items) {\n        step.sideEffect = undefined;\n        switch (data.type) {\n          case AiAssistanceModel.ResponseType.USER_QUERY: {\n            this.#messages.push({\n              entity: ChatMessageEntity.USER,\n              text: data.query,\n              imageInput: data.imageInput,\n            });\n            systemMessage = {\n              entity: ChatMessageEntity.MODEL,\n              steps: [],\n            };\n            this.#messages.push(systemMessage);\n            break;\n          }\n          case AiAssistanceModel.ResponseType.QUERYING: {\n            step = {isLoading: true};\n            if (!systemMessage.steps.length) {\n              systemMessage.steps.push(step);\n            }\n\n            break;\n          }\n          case AiAssistanceModel.ResponseType.CONTEXT: {\n            step.title = data.title;\n            step.contextDetails = data.details;\n            step.isLoading = false;\n            commitStep();\n            break;\n          }\n          case AiAssistanceModel.ResponseType.TITLE: {\n            step.title = data.title;\n            commitStep();\n            break;\n          }\n          case AiAssistanceModel.ResponseType.THOUGHT: {\n            step.isLoading = false;\n            step.thought = data.thought;\n            commitStep();\n            break;\n          }\n          case AiAssistanceModel.ResponseType.SUGGESTIONS: {\n            systemMessage.suggestions = data.suggestions;\n            break;\n          }\n          case AiAssistanceModel.ResponseType.SIDE_EFFECT: {\n            step.isLoading = false;\n            step.code ??= data.code;\n            step.sideEffect = {\n              onAnswer: (result: boolean) => {\n                data.confirm(result);\n                step.sideEffect = undefined;\n                this.requestUpdate();\n              },\n            };\n            commitStep();\n            break;\n          }\n          case AiAssistanceModel.ResponseType.ACTION: {\n            step.isLoading = false;\n            step.code ??= data.code;\n            step.output ??= data.output;\n            step.canceled = data.canceled;\n            commitStep();\n            break;\n          }\n          case AiAssistanceModel.ResponseType.ANSWER: {\n            systemMessage.suggestions ??= data.suggestions;\n            systemMessage.answer = data.text;\n            systemMessage.rpcId = data.rpcId;\n            // When there is an answer without any thinking steps, we don't want to show the thinking step.\n            if (systemMessage.steps.length === 1 && systemMessage.steps[0].isLoading) {\n              systemMessage.steps.pop();\n            }\n            step.isLoading = false;\n            break;\n          }\n          case AiAssistanceModel.ResponseType.ERROR: {\n            systemMessage.error = data.error;\n            systemMessage.rpcId = undefined;\n            const lastStep = systemMessage.steps.at(-1);\n            if (lastStep) {\n              // Mark the last step as cancelled to make the UI feel better.\n              if (data.error === AiAssistanceModel.ErrorType.ABORT) {\n                lastStep.canceled = true;\n                // If error happens while the step is still loading remove it.\n              } else if (lastStep.isLoading) {\n                systemMessage.steps.pop();\n              }\n            }\n            if (data.error === AiAssistanceModel.ErrorType.BLOCK) {\n              systemMessage.answer = undefined;\n            }\n          }\n        }\n\n        // Commit update intermediated step when not\n        // in read only mode.\n        if (!this.#conversation?.isReadOnly) {\n          this.requestUpdate();\n\n          // This handles scrolling to the bottom for live conversations when:\n          // * User submits the query & the context step is shown.\n          // * There is a side effect dialog  shown.\n          if (data.type === AiAssistanceModel.ResponseType.CONTEXT ||\n              data.type === AiAssistanceModel.ResponseType.SIDE_EFFECT) {\n            this.#viewOutput.chatView?.scrollToBottom();\n          }\n        }\n      }\n\n      this.#isLoading = false;\n      this.requestUpdate();\n    } finally {\n      release();\n    }\n  }\n}\n\nexport class ActionDelegate implements UI.ActionRegistration.ActionDelegate {\n  handleAction(\n      _context: UI.Context.Context,\n      actionId: string,\n      ): boolean {\n    switch (actionId) {\n      case 'freestyler.elements-floating-button':\n      case 'freestyler.element-panel-context':\n      case 'drjones.network-floating-button':\n      case 'drjones.network-panel-context':\n      case 'drjones.performance-panel-context':\n      case 'drjones.performance-insight-context':\n      case 'drjones.sources-floating-button':\n      case 'drjones.sources-panel-context': {\n        void (async () => {\n          const view = UI.ViewManager.ViewManager.instance().view(\n              AiAssistancePanel.panelName,\n          );\n\n          if (view) {\n            await UI.ViewManager.ViewManager.instance().showView(\n                AiAssistancePanel.panelName,\n            );\n            const widget = (await view.widget()) as AiAssistancePanel;\n            widget.handleAction(actionId);\n          }\n        })();\n        return true;\n      }\n    }\n\n    return false;\n  }\n}\n\nfunction isAiAssistanceMultimodalInputEnabled(): boolean {\n  return Boolean(Root.Runtime.hostConfig.devToolsFreestyler?.multimodal);\n}\n\nfunction isAiAssistanceServerSideLoggingEnabled(): boolean {\n  return !Root.Runtime.hostConfig.aidaAvailability?.disallowLogging;\n}\n\nfunction isAiAssistanceStylingWithFunctionCallingEnabled(): boolean {\n  return Boolean(Root.Runtime.hostConfig.devToolsFreestyler?.functionCalling);\n}\n"]}