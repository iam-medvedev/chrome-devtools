{"version":3,"file":"ChatView.js","sourceRoot":"","sources":["../../../../../../../front_end/panels/ai_assistance/components/ChatView.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright 2024 The Chromium Authors. All rights reserved.\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport '../../../ui/components/spinners/spinners.js';\n\nimport * as Host from '../../../core/host/host.js';\nimport * as i18n from '../../../core/i18n/i18n.js';\nimport type * as Platform from '../../../core/platform/platform.js';\nimport * as Root from '../../../core/root/root.js';\nimport * as AiAssistanceModel from '../../../models/ai_assistance/ai_assistance.js';\nimport * as Marked from '../../../third_party/marked/marked.js';\nimport * as Buttons from '../../../ui/components/buttons/buttons.js';\nimport type * as IconButton from '../../../ui/components/icon_button/icon_button.js';\nimport type * as MarkdownView from '../../../ui/components/markdown_view/markdown_view.js';\nimport * as UI from '../../../ui/legacy/legacy.js';\nimport * as Lit from '../../../ui/lit/lit.js';\nimport * as VisualLogging from '../../../ui/visual_logging/visual_logging.js';\nimport {PatchWidget} from '../PatchWidget.js';\n\nimport stylesRaw from './chatView.css.js';\nimport {MarkdownRendererWithCodeBlock} from './MarkdownRendererWithCodeBlock.js';\nimport {UserActionRow} from './UserActionRow.js';\n\n// TODO(crbug.com/391381439): Fully migrate off of constructed style sheets.\nconst styles = new CSSStyleSheet();\nstyles.replaceSync(stylesRaw.cssText);\n\nconst {html, Directives: {ifDefined, ref}} = Lit;\n\nconst UIStrings = {\n  /**\n   * @description The error message when the user is not logged in into Chrome.\n   */\n  notLoggedIn: 'This feature is only available when you are signed into Chrome with your Google account',\n  /**\n   * @description Message shown when the user is offline.\n   */\n  offline: 'Check your internet connection and try again',\n  /**\n   * @description Text for a link to Chrome DevTools Settings.\n   */\n  settingsLink: 'AI assistance in Settings',\n  /**\n   *@description Text for asking the user to turn the AI assistance feature in settings first before they are able to use it.\n   *@example {AI assistance in Settings} PH1\n   */\n  turnOnForStyles: 'Turn on {PH1} to get help with understanding CSS styles',\n  /**\n   *@description Text for asking the user to turn the AI assistance feature in settings first before they are able to use it.\n   *@example {AI assistance in Settings} PH1\n   */\n  turnOnForStylesAndRequests: 'Turn on {PH1} to get help with styles and network requests',\n  /**\n   *@description Text for asking the user to turn the AI assistance feature in settings first before they are able to use it.\n   *@example {AI assistance in Settings} PH1\n   */\n  turnOnForStylesRequestsAndFiles: 'Turn on {PH1} to get help with styles, network requests, and files',\n  /**\n   *@description Text for asking the user to turn the AI assistance feature in settings first before they are able to use it.\n   *@example {AI assistance in Settings} PH1\n   */\n  turnOnForStylesRequestsPerformanceAndFiles:\n      'Turn on {PH1} to get help with styles, network requests, performance, and files',\n  /**\n   *@description The footer disclaimer that links to more information about the AI feature.\n   */\n  learnAbout: 'Learn about AI in DevTools',\n} as const;\n\n/*\n* Strings that don't need to be translated at this time.\n*/\nconst UIStringsNotTranslate = {\n  /**\n   *@description Title for the send icon button.\n   */\n  sendButtonTitle: 'Send',\n  /**\n   *@description Title for the start new chat\n   */\n  startNewChat: 'Start new chat',\n  /**\n   *@description Title for the cancel icon button.\n   */\n  cancelButtonTitle: 'Cancel',\n  /**\n   *@description Label for the \"select an element\" button.\n   */\n  selectAnElement: 'Select an element',\n  /**\n   *@description Label for the \"select an element\" button.\n   */\n  noElementSelected: 'No element selected',\n  /**\n   *@description Text for the empty state of the AI assistance panel.\n   */\n  emptyStateText: 'How can I help you?',\n  /**\n   *@description Text for the empty state of the AI assistance panel when there is no agent selected.\n   */\n  noAgentStateText: 'Explore AI assistance',\n  /**\n   * @description The error message when the request to the LLM failed for some reason.\n   */\n  systemError:\n      'Something unforeseen happened and I can no longer continue. Try your request again and see if that resolves the issue. If this keeps happening, update Chrome to the latest version.',\n  /**\n   * @description The error message when the LLM gets stuck in a loop (max steps reached).\n   */\n  maxStepsError: 'Seems like I am stuck with the investigation. It would be better if you start over.',\n  /**\n   *@description Displayed when the user stop the response\n   */\n  stoppedResponse: 'You stopped this response',\n  /**\n   * @description Prompt for user to confirm code execution that may affect the page.\n   */\n  sideEffectConfirmationDescription: 'This code may modify page content. Continue?',\n  /**\n   * @description Button text that confirm code execution that may affect the page.\n   */\n  positiveSideEffectConfirmation: 'Continue',\n  /**\n   * @description Button text that cancels code execution that may affect the page.\n   */\n  negativeSideEffectConfirmation: 'Cancel',\n  /**\n   *@description The generic name of the AI agent (do not translate)\n   */\n  ai: 'AI',\n  /**\n   *@description The fallback text when we can't find the user full name\n   */\n  you: 'You',\n  /**\n   *@description The fallback text when a step has no title yet\n   */\n  investigating: 'Investigating',\n  /**\n   *@description Prefix to the title of each thinking step of a user action is required to continue\n   */\n  paused: 'Paused',\n  /**\n   *@description Heading text for the code block that shows the executed code.\n   */\n  codeExecuted: 'Code executed',\n  /**\n   *@description Heading text for the code block that shows the code to be executed after side effect confirmation.\n   */\n  codeToExecute: 'Code to execute',\n  /**\n   *@description Heading text for the code block that shows the returned data.\n   */\n  dataReturned: 'Data returned',\n  /**\n   *@description Aria label for the check mark icon to be read by screen reader\n   */\n  completed: 'Completed',\n  /**\n   *@description Aria label for the cancel icon to be read by screen reader\n   */\n  canceled: 'Canceled',\n  /**\n   *@description Text displayed when the chat input is disabled due to reading past conversation.\n   */\n  pastConversation: 'You\\'re viewing a past conversation.',\n  /**\n   *@description Title for the take screenshot button.\n   */\n  takeScreenshotButtonTitle: 'Take screenshot',\n  /**\n   *@description Title for the remove image input button.\n   */\n  removeImageInputButtonTitle: 'Remove image input',\n  /**\n   *@description Alt text for the image input (displayed in the chat messages) that has been sent to the model.\n   */\n  imageInputSentToTheModel: 'Image input sent to the model',\n  /**\n   *@description Alt text for the account avatar.\n   */\n  accountAvatar: 'Account avatar',\n  /**\n   *@description Title for the x-link which wraps the image input rendered in chat messages.\n   */\n  openImageInNewTab: 'Open image in a new tab',\n  /**\n   *@description Alt text for image when it is not available.\n   */\n  imageUnavailable: 'Image unavailable',\n} as const;\n\nconst str_ = i18n.i18n.registerUIStrings('panels/ai_assistance/components/ChatView.ts', UIStrings);\nconst i18nString = i18n.i18n.getLocalizedString.bind(undefined, str_);\nconst lockedString = i18n.i18n.lockedString;\n\nconst SCROLL_ROUNDING_OFFSET = 1;\nconst JPEG_MIME_TYPE = 'image/jpeg';\n\nexport interface Step {\n  isLoading: boolean;\n  thought?: string;\n  title?: string;\n  code?: string;\n  output?: string;\n  canceled?: boolean;\n  sideEffect?: ConfirmSideEffectDialog;\n  contextDetails?: [AiAssistanceModel.ContextDetail, ...AiAssistanceModel.ContextDetail[]];\n}\n\ninterface ConfirmSideEffectDialog {\n  onAnswer: (result: boolean) => void;\n}\n\nexport const enum ChatMessageEntity {\n  MODEL = 'model',\n  USER = 'user',\n}\n\nexport type ImageInputData = {\n  isLoading: true,\n}|{\n  isLoading: false,\n  data: string,\n};\n\nexport interface UserChatMessage {\n  entity: ChatMessageEntity.USER;\n  text: string;\n  imageInput?: Host.AidaClient.Part;\n}\nexport interface ModelChatMessage {\n  entity: ChatMessageEntity.MODEL;\n  steps: Step[];\n  suggestions?: [string, ...string[]];\n  answer?: string;\n  error?: AiAssistanceModel.ErrorType;\n  rpcId?: Host.AidaClient.RpcGlobalId;\n}\n\nexport type ChatMessage = UserChatMessage|ModelChatMessage;\n\nexport const enum State {\n  CONSENT_VIEW = 'consent-view',\n  CHAT_VIEW = 'chat-view',\n}\n\nexport interface Props {\n  onTextSubmit: (text: string, imageInput?: Host.AidaClient.Part) => void;\n  onInspectElementClick: () => void;\n  onFeedbackSubmit: (rpcId: Host.AidaClient.RpcGlobalId, rate: Host.AidaClient.Rating, feedback?: string) => void;\n  onCancelClick: () => void;\n  onContextClick: () => void;\n  onNewConversation: () => void;\n  onTakeScreenshot?: () => void;\n  onRemoveImageInput?: () => void;\n  onTextInputChange: (input: string) => void;\n  inspectElementToggled: boolean;\n  state: State;\n  aidaAvailability: Host.AidaClient.AidaAccessPreconditions;\n  messages: ChatMessage[];\n  selectedContext: AiAssistanceModel.ConversationContext<unknown>|null;\n  isLoading: boolean;\n  canShowFeedbackForm: boolean;\n  userInfo: Pick<Host.InspectorFrontendHostAPI.SyncInformation, 'accountImage'|'accountFullName'>;\n  conversationType?: AiAssistanceModel.ConversationType;\n  isReadOnly: boolean;\n  blockedByCrossOrigin: boolean;\n  changeSummary?: string;\n  patchSuggestion?: string;\n  patchSuggestionLoading?: boolean;\n  projectName?: string;\n  multimodalInputEnabled?: boolean;\n  imageInput?: ImageInputData;\n  onApplyToWorkspace?: () => void;\n  isTextInputDisabled: boolean;\n  emptyStateSuggestions: string[];\n  inputPlaceholder: Platform.UIString.LocalizedString;\n  disclaimerText: Platform.UIString.LocalizedString;\n  isTextInputEmpty: boolean;\n}\n\nexport class ChatView extends HTMLElement {\n  readonly #shadow = this.attachShadow({mode: 'open'});\n  #markdownRenderer = new MarkdownRendererWithCodeBlock();\n  #scrollTop?: number;\n  #props: Props;\n  #messagesContainerElement?: Element;\n  #mainElementRef?: Lit.Directives.Ref<Element> = Lit.Directives.createRef();\n  #messagesContainerResizeObserver = new ResizeObserver(() => this.#handleMessagesContainerResize());\n  /**\n   * Indicates whether the chat scroll position should be pinned to the bottom.\n   *\n   * This is true when:\n   *   - The scroll is at the very bottom, allowing new messages to push the scroll down automatically.\n   *   - The panel is initially rendered and the user hasn't scrolled yet.\n   *\n   * It is set to false when the user scrolls up to view previous messages.\n   */\n  #pinScrollToBottom = true;\n\n  constructor(props: Props) {\n    super();\n    this.#props = props;\n  }\n\n  set props(props: Props) {\n    this.#markdownRenderer = new MarkdownRendererWithCodeBlock();\n    this.#props = props;\n    this.#render();\n  }\n\n  connectedCallback(): void {\n    this.#shadow.adoptedStyleSheets = [styles];\n    this.#render();\n\n    if (this.#messagesContainerElement) {\n      this.#messagesContainerResizeObserver.observe(this.#messagesContainerElement);\n    }\n  }\n\n  disconnectedCallback(): void {\n    this.#messagesContainerResizeObserver.disconnect();\n  }\n\n  focusTextInput(): void {\n    const textArea = this.#shadow.querySelector('.chat-input') as HTMLTextAreaElement;\n    if (!textArea) {\n      return;\n    }\n\n    textArea.focus();\n  }\n\n  restoreScrollPosition(): void {\n    if (this.#scrollTop === undefined) {\n      return;\n    }\n\n    if (!this.#mainElementRef?.value) {\n      return;\n    }\n\n    this.#mainElementRef.value.scrollTop = this.#scrollTop;\n  }\n\n  scrollToBottom(): void {\n    if (!this.#mainElementRef?.value) {\n      return;\n    }\n\n    this.#mainElementRef.value.scrollTop = this.#mainElementRef.value.scrollHeight;\n  }\n\n  #handleMessagesContainerResize(): void {\n    if (!this.#pinScrollToBottom) {\n      return;\n    }\n\n    if (!this.#mainElementRef?.value) {\n      return;\n    }\n\n    if (this.#pinScrollToBottom) {\n      this.#mainElementRef.value.scrollTop = this.#mainElementRef.value.scrollHeight;\n    }\n  }\n\n  #setInputText(text: string): void {\n    const textArea = this.#shadow.querySelector('.chat-input') as HTMLTextAreaElement;\n    if (!textArea) {\n      return;\n    }\n\n    textArea.value = text;\n    this.#props.onTextInputChange(text);\n  }\n\n  #handleMessageContainerRef(el: Element|undefined): void {\n    this.#messagesContainerElement = el;\n\n    if (el) {\n      this.#messagesContainerResizeObserver.observe(el);\n    } else {\n      this.#pinScrollToBottom = true;\n      this.#messagesContainerResizeObserver.disconnect();\n    }\n  }\n\n  #handleScroll = (ev: Event): void => {\n    if (!ev.target || !(ev.target instanceof HTMLElement)) {\n      return;\n    }\n\n    this.#scrollTop = ev.target.scrollTop;\n    this.#pinScrollToBottom =\n        ev.target.scrollTop + ev.target.clientHeight + SCROLL_ROUNDING_OFFSET > ev.target.scrollHeight;\n  };\n\n  #handleSubmit = (ev: SubmitEvent): void => {\n    ev.preventDefault();\n    if (this.#props.imageInput?.isLoading) {\n      return;\n    }\n\n    const textArea = this.#shadow.querySelector('.chat-input') as HTMLTextAreaElement;\n    if (!textArea?.value) {\n      return;\n    }\n    const imageInput = !this.#props.imageInput?.isLoading && this.#props.imageInput?.data ?\n        {inlineData: {data: this.#props.imageInput.data, mimeType: JPEG_MIME_TYPE}} :\n        undefined;\n    void this.#props.onTextSubmit(textArea.value, imageInput);\n    textArea.value = '';\n  };\n\n  #handleTextAreaKeyDown = (ev: KeyboardEvent): void => {\n    if (!ev.target || !(ev.target instanceof HTMLTextAreaElement)) {\n      return;\n    }\n\n    // Go to a new line only when Shift + Enter is pressed.\n    if (ev.key === 'Enter' && !ev.shiftKey) {\n      ev.preventDefault();\n      if (!ev.target?.value || this.#props.imageInput?.isLoading) {\n        return;\n      }\n      const imageInput = !this.#props.imageInput?.isLoading && this.#props.imageInput?.data ?\n          {inlineData: {data: this.#props.imageInput.data, mimeType: JPEG_MIME_TYPE}} :\n          undefined;\n      void this.#props.onTextSubmit(ev.target.value, imageInput);\n      ev.target.value = '';\n    }\n  };\n\n  #handleCancel = (ev: SubmitEvent): void => {\n    ev.preventDefault();\n\n    if (!this.#props.isLoading) {\n      return;\n    }\n\n    this.#props.onCancelClick();\n  };\n\n  #handleSuggestionClick = (suggestion: string): void => {\n    this.#setInputText(suggestion);\n    this.focusTextInput();\n    Host.userMetrics.actionTaken(Host.UserMetrics.Action.AiAssistanceDynamicSuggestionClicked);\n  };\n\n  #render(): void {\n    // clang-format off\n    Lit.render(html`\n      <div class=\"chat-ui\">\n        <main @scroll=${this.#handleScroll} ${ref(this.#mainElementRef)}>\n          ${renderMainContents({\n            state: this.#props.state,\n            aidaAvailability: this.#props.aidaAvailability,\n            messages: this.#props.messages,\n            isLoading: this.#props.isLoading,\n            isReadOnly: this.#props.isReadOnly,\n            canShowFeedbackForm: this.#props.canShowFeedbackForm,\n            isTextInputDisabled: this.#props.isTextInputDisabled,\n            suggestions: this.#props.emptyStateSuggestions,\n            userInfo: this.#props.userInfo,\n            markdownRenderer: this.#markdownRenderer,\n            conversationType: this.#props.conversationType,\n            changeSummary: this.#props.changeSummary,\n            onSuggestionClick: this.#handleSuggestionClick,\n            onFeedbackSubmit: this.#props.onFeedbackSubmit,\n            onMessageContainerRef: this.#handleMessageContainerRef,\n          })}\n          ${this.#props.isReadOnly\n            ? renderReadOnlySection({\n                conversationType: this.#props.conversationType,\n                onNewConversation: this.#props.onNewConversation,\n              })\n            : renderChatInput({\n                isLoading: this.#props.isLoading,\n                blockedByCrossOrigin: this.#props.blockedByCrossOrigin,\n                isTextInputDisabled: this.#props.isTextInputDisabled,\n                inputPlaceholder: this.#props.inputPlaceholder,\n                state: this.#props.state,\n                selectedContext: this.#props.selectedContext,\n                inspectElementToggled: this.#props.inspectElementToggled,\n                multimodalInputEnabled: this.#props.multimodalInputEnabled,\n                conversationType: this.#props.conversationType,\n                imageInput: this.#props.imageInput,\n                isTextInputEmpty: this.#props.isTextInputEmpty,\n                onContextClick: this.#props.onContextClick,\n                onInspectElementClick: this.#props.onInspectElementClick,\n                onSubmit: this.#handleSubmit,\n                onTextAreaKeyDown: this.#handleTextAreaKeyDown,\n                onCancel: this.#handleCancel,\n                onNewConversation: this.#props.onNewConversation,\n                onTakeScreenshot: this.#props.onTakeScreenshot,\n                onRemoveImageInput: this.#props.onRemoveImageInput,\n                onTextInputChange: this.#props.onTextInputChange,\n              })\n          }\n        </main>\n        <footer class=\"disclaimer\" jslog=${VisualLogging.section('footer')}>\n          <p class=\"disclaimer-text\">\n            ${this.#props.disclaimerText}\n            <button\n              class=\"link\"\n              role=\"link\"\n              jslog=${VisualLogging.link('open-ai-settings').track({\n                click: true,\n              })}\n              @click=${() => {\n                void UI.ViewManager.ViewManager.instance().showView('chrome-ai');\n              }}\n            >${i18nString(UIStrings.learnAbout)}</button>\n          </p>\n        </footer>\n      </div>\n    `, this.#shadow, {host: this});\n    // clang-format on\n  }\n}\n\nfunction renderTextAsMarkdown(text: string, markdownRenderer: MarkdownRendererWithCodeBlock, {animate, ref: refFn}: {\n  animate?: boolean,\n  ref?: (element?: Element) => void,\n} = {}): Lit.TemplateResult {\n  let tokens = [];\n  try {\n    tokens = Marked.Marked.lexer(text);\n    for (const token of tokens) {\n      // Try to render all the tokens to make sure that\n      // they all have a template defined for them. If there\n      // isn't any template defined for a token, we'll fallback\n      // to rendering the text as plain text instead of markdown.\n      markdownRenderer.renderToken(token);\n    }\n  } catch {\n    // The tokens were not parsed correctly or\n    // one of the tokens are not supported, so we\n    // continue to render this as text.\n    return html`${text}`;\n  }\n\n  // clang-format off\n  return html`<devtools-markdown-view\n    .data=${{tokens, renderer: markdownRenderer, animationEnabled: animate} as MarkdownView.MarkdownView.MarkdownViewData}\n    ${refFn ? ref(refFn) : Lit.nothing}>\n  </devtools-markdown-view>`;\n  // clang-format on\n}\n\nfunction renderTitle(step: Step): Lit.LitTemplate {\n  const paused =\n      step.sideEffect ? html`<span class=\"paused\">${lockedString(UIStringsNotTranslate.paused)}: </span>` : Lit.nothing;\n  const actionTitle = step.title ?? `${lockedString(UIStringsNotTranslate.investigating)}â€¦`;\n\n  return html`<span class=\"title\">${paused}${actionTitle}</span>`;\n}\n\nfunction renderStepCode(step: Step): Lit.LitTemplate {\n  if (!step.code && !step.output) {\n    return Lit.nothing;\n  }\n\n  // If there is no \"output\" yet, it means we didn't execute the code yet (e.g. maybe it is still waiting for confirmation from the user)\n  // thus we show \"Code to execute\" text rather than \"Code executed\" text on the heading of the code block.\n  const codeHeadingText = (step.output && !step.canceled) ? lockedString(UIStringsNotTranslate.codeExecuted) :\n                                                            lockedString(UIStringsNotTranslate.codeToExecute);\n\n  // If there is output, we don't show notice on this code block and instead show\n  // it in the data returned code block.\n  // clang-format off\n  const code = step.code ? html`<div class=\"action-result\">\n      <devtools-code-block\n        .code=${step.code.trim()}\n        .codeLang=${'js'}\n        .displayNotice=${!Boolean(step.output)}\n        .header=${codeHeadingText}\n        .showCopyButton=${true}\n      ></devtools-code-block>\n  </div>` :\n                           Lit.nothing;\n  const output = step.output ? html`<div class=\"js-code-output\">\n    <devtools-code-block\n      .code=${step.output}\n      .codeLang=${'js'}\n      .displayNotice=${true}\n      .header=${lockedString(UIStringsNotTranslate.dataReturned)}\n      .showCopyButton=${false}\n    ></devtools-code-block>\n  </div>` :\n                               Lit.nothing;\n\n  return html`<div class=\"step-code\">${code}${output}</div>`;\n  // clang-format on\n}\n\nfunction renderStepDetails({\n  step,\n  markdownRenderer,\n  isLast,\n}: {\n  step: Step,\n  markdownRenderer: MarkdownRendererWithCodeBlock,\n  isLast: boolean,\n}): Lit.LitTemplate {\n  const sideEffects = isLast && step.sideEffect ? renderSideEffectConfirmationUi(step) : Lit.nothing;\n  const thought = step.thought ? html`<p>${renderTextAsMarkdown(step.thought, markdownRenderer)}</p>` : Lit.nothing;\n\n  // clang-format off\n  const contextDetails = step.contextDetails ?\n  html`${Lit.Directives.repeat(\n    step.contextDetails,\n      contextDetail => {\n        return html`<div class=\"context-details\">\n      <devtools-code-block\n        .code=${contextDetail.text}\n        .codeLang=${contextDetail.codeLang || ''}\n        .displayNotice=${false}\n        .header=${contextDetail.title}\n        .showCopyButton=${true}\n      ></devtools-code-block>\n    </div>`;\n      },\n    )}` : Lit.nothing;\n\n  return html`<div class=\"step-details\">\n    ${thought}\n    ${renderStepCode(step)}\n    ${sideEffects}\n    ${contextDetails}\n  </div>`;\n  // clang-format on\n}\n\nfunction renderStepBadge({step, isLoading, isLast}: {\n  step: Step,\n  isLoading: boolean,\n  isLast: boolean,\n}): Lit.LitTemplate {\n  if (isLoading && isLast && !step.sideEffect) {\n    return html`<devtools-spinner></devtools-spinner>`;\n  }\n\n  let iconName = 'checkmark';\n  let ariaLabel: string|undefined = lockedString(UIStringsNotTranslate.completed);\n  let role: 'button'|undefined = 'button';\n  if (isLast && step.sideEffect) {\n    role = undefined;\n    ariaLabel = undefined;\n    iconName = 'pause-circle';\n  } else if (step.canceled) {\n    ariaLabel = lockedString(UIStringsNotTranslate.canceled);\n    iconName = 'cross';\n  }\n\n  return html`<devtools-icon\n      class=\"indicator\"\n      role=${ifDefined(role)}\n      aria-label=${ifDefined(ariaLabel)}\n      .name=${iconName}\n    ></devtools-icon>`;\n}\n\nfunction renderStep({step, isLoading, markdownRenderer, isLast}: {\n  step: Step,\n  isLoading: boolean,\n  markdownRenderer: MarkdownRendererWithCodeBlock,\n  isLast: boolean,\n}): Lit.LitTemplate {\n  const stepClasses = Lit.Directives.classMap({\n    step: true,\n    empty: !step.thought && !step.code && !step.contextDetails,\n    paused: Boolean(step.sideEffect),\n    canceled: Boolean(step.canceled),\n  });\n  // clang-format off\n  return html`\n    <details class=${stepClasses}\n      jslog=${VisualLogging.section('step')}\n      .open=${Boolean(step.sideEffect)}>\n      <summary>\n        <div class=\"summary\">\n          ${renderStepBadge({ step, isLoading, isLast })}\n          ${renderTitle(step)}\n          <devtools-icon\n            class=\"arrow\"\n            .name=${'chevron-down'}\n          ></devtools-icon>\n        </div>\n      </summary>\n      ${renderStepDetails({step, markdownRenderer, isLast})}\n    </details>`;\n  // clang-format on\n}\n\nfunction renderSideEffectConfirmationUi(step: Step): Lit.LitTemplate {\n  if (!step.sideEffect) {\n    return Lit.nothing;\n  }\n\n  // clang-format off\n  return html`<div\n    class=\"side-effect-confirmation\"\n    jslog=${VisualLogging.section('side-effect-confirmation')}\n  >\n    <p>${lockedString(UIStringsNotTranslate.sideEffectConfirmationDescription)}</p>\n    <div class=\"side-effect-buttons-container\">\n      <devtools-button\n        .data=${\n          {\n            variant: Buttons.Button.Variant.OUTLINED,\n            jslogContext: 'decline-execute-code',\n          } as Buttons.Button.ButtonData\n        }\n        @click=${() => step.sideEffect?.onAnswer(false)}\n      >${lockedString(\n        UIStringsNotTranslate.negativeSideEffectConfirmation,\n      )}</devtools-button>\n      <devtools-button\n        .data=${\n          {\n            variant: Buttons.Button.Variant.PRIMARY,\n            jslogContext: 'accept-execute-code',\n            iconName: 'play',\n          } as Buttons.Button.ButtonData\n        }\n        @click=${() => step.sideEffect?.onAnswer(true)}\n      >${\n          lockedString(UIStringsNotTranslate.positiveSideEffectConfirmation)\n      }</devtools-button>\n    </div>\n  </div>`;\n  // clang-format on\n}\n\nfunction renderError(message: ModelChatMessage): Lit.LitTemplate {\n  if (message.error) {\n    let errorMessage;\n    switch (message.error) {\n      case AiAssistanceModel.ErrorType.UNKNOWN:\n      case AiAssistanceModel.ErrorType.BLOCK:\n        errorMessage = UIStringsNotTranslate.systemError;\n        break;\n      case AiAssistanceModel.ErrorType.MAX_STEPS:\n        errorMessage = UIStringsNotTranslate.maxStepsError;\n        break;\n      case AiAssistanceModel.ErrorType.ABORT:\n        return html`<p class=\"aborted\" jslog=${VisualLogging.section('aborted')}>${\n            lockedString(UIStringsNotTranslate.stoppedResponse)}</p>`;\n    }\n\n    return html`<p class=\"error\" jslog=${VisualLogging.section('error')}>${lockedString(errorMessage)}</p>`;\n  }\n\n  return Lit.nothing;\n}\n\nfunction renderChatMessage({\n  message,\n  isLoading,\n  isReadOnly,\n  canShowFeedbackForm,\n  isLast,\n  userInfo,\n  markdownRenderer,\n  onSuggestionClick,\n  onFeedbackSubmit,\n}: {\n  message: ChatMessage,\n  isLoading: boolean,\n  isReadOnly: boolean,\n  canShowFeedbackForm: boolean,\n  isLast: boolean,\n  userInfo: Pick<Host.InspectorFrontendHostAPI.SyncInformation, 'accountImage'|'accountFullName'>,\n  markdownRenderer: MarkdownRendererWithCodeBlock,\n  onSuggestionClick: (suggestion: string) => void,\n  onFeedbackSubmit: (rpcId: Host.AidaClient.RpcGlobalId, rate: Host.AidaClient.Rating, feedback?: string) => void,\n}): Lit.TemplateResult {\n  if (message.entity === ChatMessageEntity.USER) {\n    const name = userInfo.accountFullName || lockedString(UIStringsNotTranslate.you);\n    const image = userInfo.accountImage ?\n        html`<img src=\"data:image/png;base64, ${userInfo.accountImage}\" alt=${UIStringsNotTranslate.accountAvatar} />` :\n        html`<devtools-icon\n          .name=${'profile'}\n        ></devtools-icon>`;\n    const imageInput = message.imageInput && 'inlineData' in message.imageInput ?\n        renderImageChatMessage(message.imageInput.inlineData) :\n        Lit.nothing;\n    // clang-format off\n    return html`<section\n      class=\"chat-message query\"\n      jslog=${VisualLogging.section('question')}\n    >\n      <div class=\"message-info\">\n        ${image}\n        <div class=\"message-name\">\n          <h2>${name}</h2>\n        </div>\n      </div>\n      ${imageInput}\n      <div class=\"message-content\">${renderTextAsMarkdown(message.text, markdownRenderer)}</div>\n    </section>`;\n    // clang-format on\n  }\n\n  // clang-format off\n  return html`\n    <section\n      class=\"chat-message answer\"\n      jslog=${VisualLogging.section('answer')}\n    >\n      <div class=\"message-info\">\n        <devtools-icon name=\"smart-assistant\"></devtools-icon>\n        <div class=\"message-name\">\n          <h2>${lockedString(UIStringsNotTranslate.ai)}</h2>\n        </div>\n      </div>\n      ${Lit.Directives.repeat(\n        message.steps,\n        (_, index) => index,\n        step => {\n          return renderStep({\n            step,\n            isLoading,\n            markdownRenderer,\n            isLast: [...message.steps.values()].at(-1) === step && isLast,\n          });\n        },\n      )}\n      ${message.answer\n        ? html`<p>${renderTextAsMarkdown(message.answer, markdownRenderer, { animate: !isReadOnly && isLoading && isLast })}</p>`\n        : Lit.nothing}\n      ${renderError(message)}\n      ${isLast && isLoading\n        ? Lit.nothing\n        : html`<devtools-widget class=\"actions\" .widgetConfig=${UI.Widget.widgetConfig(UserActionRow, {\n            showRateButtons: message.rpcId !== undefined,\n            onFeedbackSubmit: (rating: Host.AidaClient.Rating, feedback: string) => {\n              if (!message.rpcId) {\n                return;\n              }\n              onFeedbackSubmit(message.rpcId, rating, feedback);\n            },\n            suggestions: isLast ? message.suggestions : undefined,\n            onSuggestionClick,\n            canShowFeedbackForm,\n          })}></devtools-widget>`\n      }\n    </section>\n  `;\n  // clang-format on\n}\n\nfunction renderImageChatMessage(inlineData: Host.AidaClient.MediaBlob): Lit.LitTemplate {\n  if (inlineData.data === AiAssistanceModel.NOT_FOUND_IMAGE_DATA) {\n    // clang-format off\n    return html`<div class=\"unavailable-image\" title=${UIStringsNotTranslate.imageUnavailable}>\n      <devtools-icon name='file-image'></devtools-icon>\n    </div>`;\n    // clang-format on\n  }\n  const imageUrl = `data:image/jpeg;base64,${inlineData.data}`;\n  // clang-format off\n    return html`<x-link\n      class=\"image-link\" title=${UIStringsNotTranslate.openImageInNewTab}\n      href=${imageUrl}\n    >\n      <img src=${imageUrl} alt=${UIStringsNotTranslate.imageInputSentToTheModel} />\n    </x-link>`;\n  // clang-format on\n}\n\nfunction renderSelection({\n  selectedContext,\n  inspectElementToggled,\n  conversationType,\n  onContextClick,\n  onInspectElementClick,\n}: {\n  selectedContext: AiAssistanceModel.ConversationContext<unknown>|null,\n  inspectElementToggled: boolean,\n  conversationType?: AiAssistanceModel.ConversationType,\n                  onContextClick: () => void | Promise<void>,\n                  onInspectElementClick: () => void,\n}): Lit.LitTemplate {\n  if (!conversationType) {\n    return Lit.nothing;\n  }\n\n  // TODO: currently the picker behavior is SDKNode specific.\n  const hasPickerBehavior = conversationType === AiAssistanceModel.ConversationType.STYLING;\n\n  const resourceClass = Lit.Directives.classMap({\n    'not-selected': !selectedContext,\n    'resource-link': true,\n    'allow-overflow': hasPickerBehavior,\n  });\n\n  if (!selectedContext && !hasPickerBehavior) {\n    return Lit.nothing;\n  }\n\n  const icon = selectedContext?.getIcon() ?? Lit.nothing;\n\n  const handleKeyDown = (ev: KeyboardEvent): void => {\n    if (ev.key === 'Enter' || ev.key === ' ') {\n      void onContextClick();\n    }\n  };\n\n  // clang-format off\n  return html`<div class=\"select-element\">\n    ${\n      hasPickerBehavior ? html`\n        <devtools-button\n          .data=${{\n              variant: Buttons.Button.Variant.ICON_TOGGLE,\n              size: Buttons.Button.Size.REGULAR,\n              iconName: 'select-element',\n              toggledIconName: 'select-element',\n              toggleType: Buttons.Button.ToggleType.PRIMARY,\n              toggled: inspectElementToggled,\n              title: lockedString(UIStringsNotTranslate.selectAnElement),\n              jslogContext: 'select-element',\n          } as Buttons.Button.ButtonData}\n          @click=${onInspectElementClick}\n        ></devtools-button>\n      ` : Lit.nothing\n    }\n    <div\n      role=button\n      class=${resourceClass}\n      tabindex=${hasPickerBehavior ? '-1' : '0'}\n      @click=${onContextClick}\n      @keydown=${handleKeyDown}\n    >\n      ${icon}${selectedContext?.getTitle() ?? html`<span>${\n        lockedString(UIStringsNotTranslate.noElementSelected)\n      }</span>`}\n    </div>\n  </div>`;\n  // clang-format on\n}\n\nfunction renderMessages({\n  messages,\n  isLoading,\n  isReadOnly,\n  canShowFeedbackForm,\n  userInfo,\n  markdownRenderer,\n  changeSummary,\n  onSuggestionClick,\n  onFeedbackSubmit,\n  onMessageContainerRef,\n}: {\n  messages: ChatMessage[],\n  isLoading: boolean,\n  isReadOnly: boolean,\n  canShowFeedbackForm: boolean,\n  userInfo: Pick<Host.InspectorFrontendHostAPI.SyncInformation, 'accountImage'|'accountFullName'>,\n  markdownRenderer: MarkdownRendererWithCodeBlock,\n  changeSummary?: string,\n               onSuggestionClick: (suggestion: string) => void,\n               onFeedbackSubmit:\n                   (rpcId: Host.AidaClient.RpcGlobalId, rate: Host.AidaClient.Rating, feedback?: string) => void,\n               onMessageContainerRef: (el: Element|undefined) => void,\n}): Lit.TemplateResult {\n  // clang-format off\n  return html`\n    <div class=\"messages-container\" ${ref(onMessageContainerRef)}>\n      ${messages.map((message, _, array) =>\n        renderChatMessage({\n          message,\n          isLoading,\n          isReadOnly,\n          canShowFeedbackForm,\n          isLast: array.at(-1) === message,\n          userInfo,\n          markdownRenderer,\n          onSuggestionClick,\n          onFeedbackSubmit,\n        }),\n      )}\n      ${(changeSummary && !isLoading) ? html`<devtools-widget .widgetConfig=${UI.Widget.widgetConfig(PatchWidget, {\n        changeSummary,\n      })}></devtools-widget>` : Lit.nothing}\n    </div>\n  `;\n  // clang-format on\n}\n\nfunction renderEmptyState({isTextInputDisabled, suggestions, onSuggestionClick}: {\n  isTextInputDisabled: boolean,\n  suggestions: string[],\n  onSuggestionClick: (suggestion: string) => void,\n}): Lit.TemplateResult {\n  // clang-format off\n  return html`<div class=\"empty-state-container\">\n    <div class=\"header\">\n      <div class=\"icon\">\n        <devtools-icon\n          name=\"smart-assistant\"\n        ></devtools-icon>\n      </div>\n      <h1>${lockedString(UIStringsNotTranslate.emptyStateText)}</h1>\n    </div>\n    <div class=\"empty-state-content\">\n      ${suggestions.map(suggestion => {\n        return html`<devtools-button\n          class=\"suggestion\"\n          @click=${() => onSuggestionClick(suggestion)}\n          .data=${\n            {\n              variant: Buttons.Button.Variant.OUTLINED,\n              size: Buttons.Button.Size.REGULAR,\n              title: suggestion,\n              jslogContext: 'suggestion',\n              disabled: isTextInputDisabled,\n            } as Buttons.Button.ButtonData\n          }\n        >${suggestion}</devtools-button>`;\n      })}\n    </div>\n  </div>`;\n  // clang-format on\n}\n\nfunction renderReadOnlySection({onNewConversation, conversationType}: {\n  onNewConversation: () => void,\n  conversationType?: AiAssistanceModel.ConversationType,\n}): Lit.LitTemplate {\n  if (!conversationType) {\n    return Lit.nothing;\n  }\n\n  // clang-format off\n  return html`<div\n    class=\"chat-readonly-container\"\n    jslog=${VisualLogging.section('read-only')}\n  >\n    <span>${lockedString(UIStringsNotTranslate.pastConversation)}</span>\n    <devtools-button\n      aria-label=${lockedString(UIStringsNotTranslate.startNewChat)}\n      class=\"chat-inline-button\"\n      @click=${onNewConversation}\n      .data=${{\n        variant: Buttons.Button.Variant.TEXT,\n        title: lockedString(UIStringsNotTranslate.startNewChat),\n        jslogContext: 'start-new-chat',\n      } as Buttons.Button.ButtonData}\n    >${lockedString(UIStringsNotTranslate.startNewChat)}</devtools-button>\n  </div>`;\n  // clang-format on\n}\n\nfunction renderChatInputButtons(\n    {isLoading, blockedByCrossOrigin, isTextInputDisabled, isTextInputEmpty, imageInput, onCancel, onNewConversation}: {\n      isLoading: boolean,\n      blockedByCrossOrigin: boolean,\n      isTextInputDisabled: boolean,\n      isTextInputEmpty: boolean,\n      imageInput?: ImageInputData, onCancel: (ev: SubmitEvent) => void, onNewConversation: () => void,\n    }): Lit.TemplateResult {\n  if (isLoading) {\n    // clang-format off\n    return html`<devtools-button\n      class=\"chat-input-button\"\n      aria-label=${lockedString(UIStringsNotTranslate.cancelButtonTitle)}\n      @click=${onCancel}\n      .data=${\n        {\n          variant: Buttons.Button.Variant.ICON,\n          size: Buttons.Button.Size.REGULAR,\n          iconName: 'record-stop',\n          title: lockedString(UIStringsNotTranslate.cancelButtonTitle),\n          jslogContext: 'stop',\n        } as Buttons.Button.ButtonData\n      }\n    ></devtools-button>`;\n    // clang-format on\n  }\n  if (blockedByCrossOrigin) {\n    // clang-format off\n    return html`\n      <devtools-button\n        class=\"chat-input-button\"\n        aria-label=${lockedString(UIStringsNotTranslate.startNewChat)}\n        @click=${onNewConversation}\n        .data=${\n          {\n            variant: Buttons.Button.Variant.PRIMARY,\n            size: Buttons.Button.Size.REGULAR,\n            title: lockedString(UIStringsNotTranslate.startNewChat),\n            jslogContext: 'start-new-chat',\n          } as Buttons.Button.ButtonData\n        }\n      >${lockedString(UIStringsNotTranslate.startNewChat)}</devtools-button>\n    `;\n    // clang-format on\n  }\n  // clang-format off\n  return html`<devtools-button\n    class=\"chat-input-button\"\n    aria-label=${lockedString(UIStringsNotTranslate.sendButtonTitle)}\n    .data=${\n      {\n        type: 'submit',\n        variant: Buttons.Button.Variant.ICON,\n        size: Buttons.Button.Size.REGULAR,\n        disabled: isTextInputDisabled || isTextInputEmpty || imageInput?.isLoading,\n        iconName: 'send',\n        title: lockedString(UIStringsNotTranslate.sendButtonTitle),\n        jslogContext: 'send',\n      } as Buttons.Button.ButtonData\n    }\n  ></devtools-button>`;\n}\n\nfunction renderTakeScreenshotButton({\n  multimodalInputEnabled,\n  blockedByCrossOrigin,\n  isTextInputDisabled,\n  imageInput,\n  onTakeScreenshot,\n}: {\n  isTextInputDisabled: boolean,\n  blockedByCrossOrigin: boolean,\n  multimodalInputEnabled?: boolean,\n  imageInput?: ImageInputData,\n  onTakeScreenshot?: () => void,\n}): Lit.LitTemplate {\n    if (!multimodalInputEnabled || blockedByCrossOrigin) {\n      return Lit.nothing;\n    }\n    return html`<devtools-button\n      class=\"chat-input-button\"\n      aria-label=${lockedString(UIStringsNotTranslate.takeScreenshotButtonTitle)}\n      @click=${onTakeScreenshot}\n      .data=${\n        {\n          variant: Buttons.Button.Variant.ICON,\n          size: Buttons.Button.Size.REGULAR,\n          disabled: isTextInputDisabled || imageInput?.isLoading,\n          iconName: 'photo-camera',\n          title: lockedString(UIStringsNotTranslate.takeScreenshotButtonTitle),\n          jslogContext: 'take-screenshot',\n        } as Buttons.Button.ButtonData\n      }\n    ></devtools-button>`;\n  }\n\nfunction renderImageInput({\n  multimodalInputEnabled,\n  imageInput,\n  onRemoveImageInput,\n}: {\n  multimodalInputEnabled?: boolean,\n  imageInput?: ImageInputData,\n  onRemoveImageInput?: () => void,\n}): Lit.LitTemplate {\n    if (!multimodalInputEnabled || !imageInput) {\n      return Lit.nothing;\n    }\n\n    const crossButton = html`<devtools-button\n      aria-label=${lockedString(UIStringsNotTranslate.removeImageInputButtonTitle)}\n      @click=${onRemoveImageInput}\n      .data=${\n        {\n          variant: Buttons.Button.Variant.ICON,\n          size: Buttons.Button.Size.MICRO,\n          iconName: 'cross',\n          title: lockedString(UIStringsNotTranslate.removeImageInputButtonTitle),\n        } as Buttons.Button.ButtonData\n      }\n    ></devtools-button>`;\n\n    if (imageInput.isLoading) {\n      return html`<div class=\"image-input-container\">\n        ${crossButton}\n        <div class=\"loading\">\n          <devtools-spinner></devtools-spinner>\n        </div>\n      </div>`;\n    }\n    return  html`\n    <div class=\"image-input-container\">\n      ${crossButton}\n      <img src=\"data:image/jpeg;base64, ${imageInput.data}\" alt=\"Screenshot input\" />\n    </div>`;\n  }\n\nfunction renderChatInput({\n  isLoading,\n  blockedByCrossOrigin,\n  isTextInputDisabled,\n  inputPlaceholder,\n  state,\n  selectedContext,\n  inspectElementToggled,\n  multimodalInputEnabled,\n  conversationType,\n  imageInput,\n  isTextInputEmpty,\n  onContextClick,\n  onInspectElementClick,\n  onSubmit,\n  onTextAreaKeyDown,\n  onCancel,\n  onNewConversation,\n  onTakeScreenshot,\n  onRemoveImageInput,\n  onTextInputChange,\n}: {\n  isLoading: boolean,\n  blockedByCrossOrigin: boolean,\n  isTextInputDisabled: boolean,\n  inputPlaceholder: Platform.UIString.LocalizedString,\n  state: State,\n  selectedContext: AiAssistanceModel.ConversationContext<unknown> | null,\n  inspectElementToggled: boolean,\n  multimodalInputEnabled?: boolean,\n  conversationType?: AiAssistanceModel.ConversationType,\n  imageInput?: ImageInputData,\n  isTextInputEmpty: boolean,\n  onContextClick: () => void ,\n  onInspectElementClick: () => void,\n  onSubmit: (ev: SubmitEvent) => void,\n  onTextAreaKeyDown: (ev: KeyboardEvent) => void,\n  onCancel: (ev: SubmitEvent) => void,\n  onNewConversation: () => void,\n  onTakeScreenshot?: () => void,\n  onRemoveImageInput?: () => void,\n  onTextInputChange: (input: string) => void,\n}): Lit.LitTemplate {\n  if (!conversationType) {\n    return Lit.nothing;\n  }\n\n  const chatInputCls = Lit.Directives.classMap({\n    'chat-input': true,\n    'two-big-buttons': blockedByCrossOrigin,\n    'screenshot-button': Boolean(multimodalInputEnabled) && !blockedByCrossOrigin,\n  });\n\n  const chatInputContainerCls = Lit.Directives.classMap({\n    'chat-input-container': true,\n    disabled: isTextInputDisabled,\n  });\n\n  // clang-format off\n  return html`\n  <form class=\"input-form\" @submit=${onSubmit}>\n    <div class=\"input-form-shadow-container\">\n      <div class=\"input-form-shadow\"></div>\n    </div>\n    ${state !== State.CONSENT_VIEW ? html`\n      <div class=\"input-header\">\n        <div class=\"header-link-container\">\n          ${renderSelection({\n            selectedContext,\n            inspectElementToggled,\n            conversationType,\n            onContextClick,\n            onInspectElementClick,\n          })}\n        </div>\n      </div>\n    ` : Lit.nothing}\n    <div class=${chatInputContainerCls}>\n      ${renderImageInput(\n        {multimodalInputEnabled, imageInput, onRemoveImageInput}\n      )}\n      <textarea class=${chatInputCls}\n        .disabled=${isTextInputDisabled}\n        wrap=\"hard\"\n        maxlength=\"10000\"\n        @keydown=${onTextAreaKeyDown}\n        @input=${(event: KeyboardEvent) => onTextInputChange((event.target as HTMLInputElement).value)}\n        placeholder=${inputPlaceholder}\n        jslog=${VisualLogging.textField('query').track({ keydown: 'Enter' })}\n      ></textarea>\n      <div class=\"chat-input-buttons\">\n        ${renderTakeScreenshotButton({\n          multimodalInputEnabled, blockedByCrossOrigin, isTextInputDisabled, imageInput, onTakeScreenshot\n        })}\n        ${renderChatInputButtons({\n          isLoading, blockedByCrossOrigin, isTextInputDisabled, isTextInputEmpty, imageInput, onCancel, onNewConversation\n        })}\n      </div>\n    </div>\n  </form>`;\n    // clang-format on\n  }\n\nfunction renderAidaUnavailableContents(\n    aidaAvailability:\n        Exclude<Host.AidaClient.AidaAccessPreconditions, Host.AidaClient.AidaAccessPreconditions.AVAILABLE>):\n    Lit.TemplateResult {\n  switch (aidaAvailability) {\n    case Host.AidaClient.AidaAccessPreconditions.NO_ACCOUNT_EMAIL:\n    case Host.AidaClient.AidaAccessPreconditions.SYNC_IS_PAUSED: {\n      return html`${i18nString(UIStrings.notLoggedIn)}`;\n    }\n    case Host.AidaClient.AidaAccessPreconditions.NO_INTERNET: {\n      return html`${i18nString(UIStrings.offline)}`;\n    }\n  }\n}\n\nfunction renderConsentViewContents(): Lit.TemplateResult {\n  const settingsLink = document.createElement('button');\n  settingsLink.textContent = i18nString(UIStrings.settingsLink);\n  settingsLink.classList.add('link');\n  UI.ARIAUtils.markAsLink(settingsLink);\n  settingsLink.addEventListener('click', () => {\n    void UI.ViewManager.ViewManager.instance().showView('chrome-ai');\n  });\n  settingsLink.setAttribute('jslog', `${VisualLogging.action('open-ai-settings').track({click: true})}`);\n\n  let consentViewContents: HTMLSpanElement;\n  // TODO(ergunsh): Should this `view` access `hostConfig` at all?\n  const config = Root.Runtime.hostConfig;\n  if (config.devToolsAiAssistancePerformanceAgent?.enabled) {\n    consentViewContents = i18n.i18n.getFormatLocalizedString(\n        str_, UIStrings.turnOnForStylesRequestsPerformanceAndFiles, {PH1: settingsLink});\n  } else if (config.devToolsAiAssistanceFileAgent?.enabled) {\n    consentViewContents =\n        i18n.i18n.getFormatLocalizedString(str_, UIStrings.turnOnForStylesRequestsAndFiles, {PH1: settingsLink});\n  } else if (config.devToolsAiAssistanceNetworkAgent?.enabled) {\n    consentViewContents =\n        i18n.i18n.getFormatLocalizedString(str_, UIStrings.turnOnForStylesAndRequests, {PH1: settingsLink});\n  } else {\n    consentViewContents = i18n.i18n.getFormatLocalizedString(str_, UIStrings.turnOnForStyles, {PH1: settingsLink});\n  }\n\n  return html`${consentViewContents}`;\n}\n\nfunction renderDisabledState(contents: Lit.TemplateResult): Lit.TemplateResult {\n  // clang-format off\n  return html`\n    <div class=\"empty-state-container\">\n      <div class=\"disabled-view\">\n        <div class=\"disabled-view-icon-container\">\n          <devtools-icon .data=${{\n            iconName: 'smart-assistant',\n            width: 'var(--sys-size-8)',\n            height: 'var(--sys-size-8)',\n          } as IconButton.Icon.IconData}>\n          </devtools-icon>\n        </div>\n        <div>\n          ${contents}\n        </div>\n      </div>\n    </div>\n  `;\n  // clang-format on\n}\n\nfunction renderNoAgentState(): Lit.TemplateResult {\n  const config = Root.Runtime.hostConfig;\n  const featureCards: Array<{\n    icon: string,\n    heading: string,\n    content: Lit.TemplateResult,\n  }> =\n      [\n        ...(config.devToolsFreestyler?.enabled ? [{\n          icon: 'brush-2',\n          heading: 'CSS styles',\n          content: html`Open <button class=\"link\" role=\"link\" jslog=${\n              VisualLogging.link('open-elements-panel').track({click: true})} @click=${() => {\n            void UI.ViewManager.ViewManager.instance().showView('elements');\n          }}>Elements</button> to ask about CSS styles`,\n        }] :\n                                                 []),\n        ...(config.devToolsAiAssistanceNetworkAgent?.enabled) ? [{\n          icon: 'arrow-up-down',\n          heading: 'Network',\n          content: html`Open <button class=\"link\" role=\"link\" jslog=${\n              VisualLogging.link('open-network-panel').track({click: true})} @click=${() => {\n            void UI.ViewManager.ViewManager.instance().showView('network');\n          }}>Network</button> to ask about a request's details`,\n        }] :\n                                                                [],\n        ...(config.devToolsAiAssistanceFileAgent?.enabled) ? [{\n          icon: 'document',\n          heading: 'Files',\n          content: html`Open <button class=\"link\" role=\"link\" jslog=${\n              VisualLogging.link('open-sources-panel').track({click: true})} @click=${() => {\n            void UI.ViewManager.ViewManager.instance().showView('sources');\n          }}>Sources</button> to ask about a file's content`,\n        }] :\n                                                             [],\n        ...(config.devToolsAiAssistancePerformanceAgent?.enabled ? [{\n          icon: 'performance',\n          heading: 'Performance',\n          content: html`Open <button class=\"link\" role=\"link\" jslog=${\n              VisualLogging.link('open-performance-panel').track({click: true})} @click=${() => {\n            void UI.ViewManager.ViewManager.instance().showView('timeline');\n          }}>Performance</button> to ask about a trace item`,\n        }] :\n                                                                   []),\n      ];\n\n  // clang-format off\n  return html`\n    <div class=\"empty-state-container\">\n      <div class=\"header\">\n        <div class=\"icon\">\n          <devtools-icon\n            name=\"smart-assistant\"\n          ></devtools-icon>\n        </div>\n        <h1>${lockedString(UIStringsNotTranslate.noAgentStateText)}</h1>\n        <p>To chat about an item, right-click and select <strong>Ask AI</strong></p>\n      </div>\n      <div class=\"empty-state-content\">\n        ${featureCards.map(featureCard => html`\n          <div class=\"feature-card\">\n            <div class=\"feature-card-icon\">\n              <devtools-icon name=${featureCard.icon}></devtools-icon>\n            </div>\n            <div class=\"feature-card-content\">\n              <h3>${featureCard.heading}</h3>\n              <p>${featureCard.content}</p>\n            </div>\n          </div>\n        `)}\n      </div>\n    </div>`;\n  // clang-format on\n}\n\nfunction renderMainContents({\n  state,\n  aidaAvailability,\n  messages,\n  isLoading,\n  isReadOnly,\n  canShowFeedbackForm,\n  isTextInputDisabled,\n  suggestions,\n  userInfo,\n  markdownRenderer,\n  conversationType,\n  changeSummary,\n  onSuggestionClick,\n  onFeedbackSubmit,\n  onMessageContainerRef,\n}: {\n  state: State,\n  aidaAvailability: Host.AidaClient.AidaAccessPreconditions,\n  messages: ChatMessage[],\n  isLoading: boolean,\n  isReadOnly: boolean,\n  canShowFeedbackForm: boolean,\n  isTextInputDisabled: boolean,\n  suggestions: string[],\n  userInfo: Pick<Host.InspectorFrontendHostAPI.SyncInformation, 'accountImage'|'accountFullName'>,\n  markdownRenderer: MarkdownRendererWithCodeBlock,\n  conversationType?: AiAssistanceModel.ConversationType,\n  changeSummary?: string,\n               onSuggestionClick: (suggestion: string) => void,\n               onFeedbackSubmit:\n                   (rpcId: Host.AidaClient.RpcGlobalId, rate: Host.AidaClient.Rating, feedback?: string) => void,\n               onMessageContainerRef: (el: Element|undefined) => void,\n}): Lit.TemplateResult {\n  if (state === State.CONSENT_VIEW) {\n    return renderDisabledState(renderConsentViewContents());\n  }\n\n  if (aidaAvailability !== Host.AidaClient.AidaAccessPreconditions.AVAILABLE) {\n    return renderDisabledState(renderAidaUnavailableContents(aidaAvailability));\n  }\n\n  if (!conversationType) {\n    return renderNoAgentState();\n  }\n\n  if (messages.length > 0) {\n    return renderMessages({\n      messages,\n      isLoading,\n      isReadOnly,\n      canShowFeedbackForm,\n      userInfo,\n      markdownRenderer,\n      changeSummary,\n      onSuggestionClick,\n      onFeedbackSubmit,\n      onMessageContainerRef,\n    });\n  }\n\n  return renderEmptyState({isTextInputDisabled, suggestions, onSuggestionClick});\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    'devtools-ai-chat-view': ChatView;\n  }\n}\n\ncustomElements.define('devtools-ai-chat-view', ChatView);\n"]}