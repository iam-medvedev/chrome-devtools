{"version":3,"file":"ChatInput.test.js","sourceRoot":"","sources":["../../../../../../../front_end/panels/ai_assistance/components/ChatInput.test.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright 2025 The Chromium Authors\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport type * as Platform from '../../../core/platform/platform.js';\nimport * as SDK from '../../../core/sdk/sdk.js';\nimport * as AiAssistanceModel from '../../../models/ai_assistance/ai_assistance.js';\nimport {assertScreenshot, renderElementIntoDOM} from '../../../testing/DOMHelpers.js';\nimport {\n  createTarget,\n  describeWithEnvironment,\n} from '../../../testing/EnvironmentHelpers.js';\nimport {createViewFunctionStub, type ViewFunctionStub} from '../../../testing/ViewFunctionHelpers.js';\nimport * as AiAssistance from '../ai_assistance.js';\n\ndescribeWithEnvironment('ChatInput', () => {\n  function createComponent():\n      [ViewFunctionStub<typeof AiAssistance.ChatInput.ChatInput>, AiAssistance.ChatInput.ChatInput] {\n    const view = createViewFunctionStub(AiAssistance.ChatInput.ChatInput);\n    const component = new AiAssistance.ChatInput.ChatInput(undefined, view);\n    component.wasShown();\n    component.performUpdate();\n    return [view, component];\n  }\n\n  class MockFileReader {\n    result: string|null = null;\n    onload: ((this: FileReader, ev: ProgressEvent<FileReader>) => void)|null = null;\n\n    readAsDataURL(_file: Blob): void {\n      if (this.onload) {\n        this.result = 'data:image/png;base64,dGVzdA==';\n        this.onload.call(this as unknown as FileReader, new ProgressEvent('load') as ProgressEvent<FileReader>);\n      }\n    }\n  }\n\n  it('should disable the send button when the input is empty', async () => {\n    const [view, component] = createComponent();\n\n    sinon.assert.callCount(view, 1);\n    const mockTextArea = document.createElement('textarea');\n    assert.isDefined(view.input.textAreaRef);\n    (view.input.textAreaRef as {value: HTMLTextAreaElement}).value = mockTextArea;\n    assert.isTrue(view.input.isTextInputEmpty);\n\n    component.setInputValue('test');\n\n    sinon.assert.callCount(view, 2);\n    assert.isFalse(view.input.isTextInputEmpty);\n\n    component.setInputValue('');\n\n    sinon.assert.callCount(view, 3);\n    assert.isTrue(view.input.isTextInputEmpty);\n\n    component.setInputValue('test');\n\n    sinon.assert.callCount(view, 4);\n    assert.isFalse(view.input.isTextInputEmpty);\n  });\n\n  it('should render read-only state correctly', async () => {\n    const [view, component] = createComponent();\n    component.isReadOnly = true;\n    component.performUpdate();\n\n    sinon.assert.callCount(view, 2);\n    assert.isTrue(view.input.isReadOnly);\n  });\n\n  describe('multimodal input', () => {\n    let target: SDK.Target.Target;\n    let model: SDK.ScreenCaptureModel.ScreenCaptureModel;\n\n    async function triggerImageUpload(view: ViewFunctionStub<typeof AiAssistance.ChatInput.ChatInput>, file: File) {\n      const mockInput = document.createElement('input');\n      const createElementStub = sinon.stub(document, 'createElement');\n      createElementStub.callThrough();\n      createElementStub.withArgs('input').returns(mockInput);\n      view.input.onImageUpload(new Event('click'));\n      createElementStub.restore();\n\n      Object.defineProperty(mockInput, 'files', {\n        value: [file],\n        writable: false,\n      });\n      mockInput.dispatchEvent(new Event('change'));\n      await new Promise(resolve => setTimeout(resolve, 0));\n    }\n\n    beforeEach(() => {\n      target = createTarget();\n      const maybeModel = target.model(SDK.ScreenCaptureModel.ScreenCaptureModel);\n      assert.exists(maybeModel);\n      model = maybeModel;\n      SDK.TargetManager.TargetManager.instance().setScopeTarget(target);\n    });\n\n    it('handles screenshot capture', async () => {\n      const captureScreenshotStub = sinon.stub(model, 'captureScreenshot').resolves('screenshot-data');\n      sinon.stub(SDK.TargetManager.TargetManager.instance(), 'primaryPageTarget').returns(target);\n      const [view] = createComponent();\n\n      // Simulate screenshot button click\n      view.input.onTakeScreenshot();\n\n      // Wait for async operations\n      await new Promise(resolve => setTimeout(resolve, 0));\n\n      sinon.assert.calledOnce(captureScreenshotStub);\n      assert.deepEqual(view.input.imageInput, {\n        isLoading: false,\n        data: 'screenshot-data',\n        mimeType: 'image/jpeg',\n        inputType: AiAssistanceModel.AiAgent.MultimodalInputType.SCREENSHOT\n      });\n    });\n\n    it('handles image upload', async () => {\n      const [view] = createComponent();\n      const file = new File(['test'], 'image.png', {type: 'image/png'});\n      const fileReaderStub = sinon.stub(window, 'FileReader');\n      fileReaderStub.returns(new MockFileReader() as unknown as FileReader);\n\n      await triggerImageUpload(view, file);\n\n      assert.deepEqual(view.input.imageInput, {\n        isLoading: false,\n        data: 'dGVzdA==',\n        mimeType: 'image/png',\n        inputType: AiAssistanceModel.AiAgent.MultimodalInputType.UPLOADED_IMAGE\n      });\n    });\n\n    it('removes image input', async () => {\n      const [view] = createComponent();\n      const file = new File(['test'], 'image.png', {type: 'image/png'});\n      const fileReaderStub = sinon.stub(window, 'FileReader');\n      fileReaderStub.returns(new MockFileReader() as unknown as FileReader);\n\n      await triggerImageUpload(view, file);\n      assert.isDefined(view.input.imageInput);\n\n      view.input.onRemoveImageInput();\n      assert.isUndefined(view.input.imageInput);\n    });\n\n    it('clears image input on submit', async () => {\n      const [view, component] = createComponent();\n      const file = new File(['test'], 'image.png', {type: 'image/png'});\n      const fileReaderStub = sinon.stub(window, 'FileReader');\n      fileReaderStub.returns(new MockFileReader() as unknown as FileReader);\n\n      await triggerImageUpload(view, file);\n      component.setInputValue('test');\n\n      const submitEvent = new SubmitEvent('submit', {cancelable: true});\n      view.input.onSubmit(submitEvent);\n\n      assert.isUndefined(view.input.imageInput);\n    });\n\n    it('should clear image input on primary page change', async () => {\n      const target = createTarget();\n      const [view] = createComponent();\n\n      // Set up initial state with an image and non-empty conversation\n      const file = new File(['test'], 'image.png', {type: 'image/png'});\n      const fileReaderStub = sinon.stub(window, 'FileReader');\n      fileReaderStub.returns(new MockFileReader() as unknown as FileReader);\n\n      await triggerImageUpload(view, file);\n\n      // Verify image input is present\n      assert.isDefined(view.input.imageInput);\n\n      // Trigger primary page changed\n      const resourceTreeModel = target.model(SDK.ResourceTreeModel.ResourceTreeModel);\n      assert.exists(resourceTreeModel);\n      resourceTreeModel.dispatchEventToListeners(SDK.ResourceTreeModel.Events.PrimaryPageChanged, {\n        frame: {url: 'https://example.com/new'} as SDK.ResourceTreeModel.ResourceTreeFrame,\n        type: SDK.ResourceTreeModel.PrimaryPageChangeType.NAVIGATION,\n      });\n\n      // Verify image input is cleared\n      assert.isUndefined(view.input.imageInput);\n    });\n  });\n\n  describe('view', () => {\n    it('renders correctly when multimodal is enabled', async () => {\n      const target = document.createElement('div');\n      renderElementIntoDOM(target);\n      AiAssistance.ChatInput.DEFAULT_VIEW(\n          {\n            isLoading: false,\n            isTextInputEmpty: true,\n            blockedByCrossOrigin: false,\n            isTextInputDisabled: false,\n            inputPlaceholder: 'Type a message...' as Platform.UIString.LocalizedString,\n            selectedContext: null,\n            inspectElementToggled: false,\n            additionalFloatyContext: [],\n            disclaimerText: 'Disclaimer text',\n            conversationType: AiAssistanceModel.AiHistoryStorage.ConversationType.STYLING,\n            multimodalInputEnabled: true,\n            uploadImageInputEnabled: true,\n            isReadOnly: false,\n            textAreaRef: {value: undefined},\n            onContextClick: () => {},\n            onInspectElementClick: () => {},\n            onSubmit: () => {},\n            onTextAreaKeyDown: () => {},\n            onCancel: () => {},\n            onNewConversation: () => {},\n            onTextInputChange: () => {},\n            onTakeScreenshot: () => {},\n            onRemoveImageInput: () => {},\n            onImageUpload: () => {},\n          },\n          undefined, target);\n      await assertScreenshot('ai_assistance/chat_input_multimodal_enabled.png');\n    });\n\n    it('renders correctly when multimodal is disabled', async () => {\n      const target = document.createElement('div');\n      renderElementIntoDOM(target);\n      AiAssistance.ChatInput.DEFAULT_VIEW(\n          {\n            isLoading: false,\n            isTextInputEmpty: true,\n            blockedByCrossOrigin: false,\n            isTextInputDisabled: false,\n            inputPlaceholder: 'Type a message...' as Platform.UIString.LocalizedString,\n            selectedContext: null,\n            inspectElementToggled: false,\n            additionalFloatyContext: [],\n            disclaimerText: 'Disclaimer text',\n            conversationType: AiAssistanceModel.AiHistoryStorage.ConversationType.STYLING,\n            multimodalInputEnabled: false,\n            uploadImageInputEnabled: false,\n            isReadOnly: false,\n            textAreaRef: {value: undefined},\n            onContextClick: () => {},\n            onInspectElementClick: () => {},\n            onSubmit: () => {},\n            onTextAreaKeyDown: () => {},\n            onCancel: () => {},\n            onNewConversation: () => {},\n            onTextInputChange: () => {},\n            onTakeScreenshot: () => {},\n            onRemoveImageInput: () => {},\n            onImageUpload: () => {},\n          },\n          undefined, target);\n      await assertScreenshot('ai_assistance/chat_input_multimodal_disabled.png');\n    });\n  });\n});\n"]}