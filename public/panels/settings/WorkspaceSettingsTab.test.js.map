{"version":3,"file":"WorkspaceSettingsTab.test.js","sourceRoot":"","sources":["../../../../../../front_end/panels/settings/WorkspaceSettingsTab.test.ts"],"names":[],"mappings":"AAAA,sCAAsC;AACtC,yEAAyE;AACzE,6BAA6B;AAE7B,OAAO,KAAK,QAAQ,MAAM,iCAAiC,CAAC;AAC5D,OAAO,KAAK,WAAW,MAAM,yCAAyC,CAAC;AACvE,OAAO,EAAC,gBAAgB,EAAE,oBAAoB,EAAC,MAAM,6BAA6B,CAAC;AACnF,OAAO,EAAC,uBAAuB,EAAE,uBAAuB,EAAC,MAAM,qCAAqC,CAAC;AACrG,OAAO,EAAC,sBAAsB,EAAC,MAAM,sCAAsC,CAAC;AAE5E,OAAO,KAAK,QAAQ,MAAM,eAAe,CAAC;AAE1C,MAAM,EAAC,YAAY,EAAE,oBAAoB,EAAC,GAAG,QAAQ,CAAC,oBAAoB,CAAC;AAC3E,MAAM,EAAC,SAAS,EAAC,GAAG,QAAQ,CAAC,YAAY,CAAC;AAE1C,uBAAuB,CAAC,2BAA2B,EAAE,GAAG,EAAE;IACxD,EAAE,CAAC,uEAAuE,EAAE,KAAK,IAAI,EAAE;QACrF,MAAM,MAAM,GAAG,QAAQ,CAAC,aAAa,CAAC,KAAK,CAAC,CAAC;QAC7C,oBAAoB,CAAC,MAAM,CAAC,CAAC;QAE7B,MAAM,UAAU,GAAG,KAAK,CAAC,kBAAkB,CAAC,WAAW,CAAC,kBAAkB,CAAC,kBAAkB,CAAC,CAAC;QAC/F,UAAU,CAAC,IAAI,CAAC,OAAO,CAAC,SAAS,CAAA,uBAAuB,CAAC,CAAC;QAC1D,UAAU,CAAC,eAAe,CAAC,OAAO,CAAC,IAAI,GAAG,EAAE,CAAC,CAAC;QAE9C,YAAY,CACR;YACE,qBAAqB,EAAE,uBAAuB,CAAC,sBAAsB,EAAE,mBAAmB,CAAC;YAC3F,WAAW,EAAE,CAAC,EAAC,WAAW,EAAE,KAAK,EAAE,UAAU,EAAC,CAAC;YAC/C,YAAY,EAAE,GAAG,EAAE,GAAE,CAAC;YACtB,eAAe,EAAE,GAAG,EAAE,GAAE,CAAC;SAC1B,EACD,EAAE,EAAE,MAAM,CAAC,CAAC;QAEhB,MAAM,gBAAgB,CAAC,wCAAwC,CAAC,CAAC;IACnE,CAAC,CAAC,CAAC;AACL,CAAC,CAAC,CAAC;AAEH,uBAAuB,CAAC,6BAA6B,EAAE,GAAG,EAAE;IAC1D,SAAS,oBAAoB,CAAC,IAAY;QACxC,MAAM,UAAU,GAAG,KAAK,CAAC,kBAAkB,CAAC,WAAW,CAAC,kBAAkB,CAAC,kBAAkB,CAAC,CAAC;QAC/F,UAAU,CAAC,IAAI,CAAC,OAAO,CAAC,SAAS,CAAC,IAAI,CAAC,CAAC,CAAC;QACzC,OAAO,UAAU,CAAC;IACpB,CAAC;IAED,KAAK,UAAU,KAAK,CAAC,yBAAmC,EAAE;QACxD,MAAM,iBAAiB,GACnB,WAAW,CAAC,yBAAyB,CAAC,yBAAyB,CAAC,QAAQ,CAAC,EAAC,QAAQ,EAAE,IAAI,EAAC,CAAC,CAAC;QAC/F,MAAM,WAAW,GAAG,sBAAsB,CAAC,GAAG,CAAC,oBAAoB,CAAC,CAAC;QACrE,KAAK,CAAC,IAAI,CAAC,iBAAiB,EAAE,aAAa,CAAC,CAAC,OAAO,CAAC,WAAW,CAAC,CAAC;QAClE,MAAM,iBAAiB,GAAG,KAAK,CAAC,IAAI,CAAC,iBAAiB,EAAE,eAAe,CAAC,CAAC;QACzE,MAAM,oBAAoB,GAAG,KAAK,CAAC,IAAI,CAAC,iBAAiB,EAAE,kBAAkB,CAAC,CAAC;QAC/E,MAAM,yBAAyB,GAC3B,KAAK,CAAC,kBAAkB,CAAC,WAAW,CAAC,yBAAyB,CAAC,yBAAyB,CAAC,CAAC;QAC9F,KAAK,CAAC,IAAI,CAAC,WAAW,CAAC,yBAAyB,CAAC,yBAAyB,EAAE,UAAU,CAAC;aAClF,OAAO,CAAC,yBAAyB,CAAC,CAAC;QAExC,MAAM,IAAI,GAAG,sBAAsB,CAAC,oBAAoB,CAAC,CAAC;QAC1D,MAAM,MAAM,GAAG,IAAI,oBAAoB,CAAC,IAAI,CAAC,CAAC;QAE9C,MAAM,SAAS,GAAG,QAAQ,CAAC,aAAa,CAAC,KAAK,CAAC,CAAC;QAChD,oBAAoB,CAAC,SAAS,CAAC,CAAC;QAChC,MAAM,CAAC,UAAU,EAAE,CAAC;QACpB,MAAM,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC;QACvB,MAAM,IAAI,CAAC,SAAS,CAAC;QAErB,OAAO,EAAC,IAAI,EAAE,iBAAiB,EAAE,WAAW,EAAE,iBAAiB,EAAE,oBAAoB,EAAE,yBAAyB,EAAC,CAAC;IACpH,CAAC;IAED,EAAE,CAAC,uCAAuC,EAAE,KAAK,IAAI,EAAE;QACrD,MAAM,EAAC,IAAI,EAAE,iBAAiB,EAAC,GAAG,MAAM,KAAK,EAAE,CAAC;QAEhD,MAAM,CAAC,WAAW,CAAC,IAAI,CAAC,KAAK,CAAC,qBAAqB,EAAE,iBAAiB,CAAC,oCAAoC,EAAE,CAAC,CAAC;IACjH,CAAC,CAAC,CAAC;IAEH,EAAE,CAAC,8CAA8C,EAAE,KAAK,IAAI,EAAE;QAC5D,MAAM,EAAC,IAAI,EAAC,GAAG,MAAM,KAAK,CAAC,CAAC,uBAAuB,CAAC,CAAC,CAAC;QAEtD,MAAM,CAAC,QAAQ,CAAC,IAAI,CAAC,KAAK,CAAC,WAAW,EAAE,CAAC,CAAC,CAAC;QAC3C,MAAM,CAAC,WAAW,CAAC,IAAI,CAAC,KAAK,CAAC,WAAW,CAAC,CAAC,CAAC,CAAC,WAAW,EAAE,KAAK,CAAC,CAAC;IACnE,CAAC,CAAC,CAAC;IAEH,EAAE,CAAC,mCAAmC,EAAE,KAAK,IAAI,EAAE;QACjD,MAAM,EAAC,IAAI,EAAC,GAAG,MAAM,KAAK,CAAC,CAAC,uBAAuB,EAAE,uBAAuB,CAAC,CAAC,CAAC;QAE/E,MAAM,CAAC,QAAQ,CAAC,IAAI,CAAC,KAAK,CAAC,WAAW,EAAE,CAAC,CAAC,CAAC;QAC3C,MAAM,CAAC,WAAW,CAAC,IAAI,CAAC,KAAK,CAAC,WAAW,CAAC,CAAC,CAAC,CAAC,UAAU,CAAC,IAAI,EAAE,EAAE,uBAAuB,CAAC,CAAC;QACzF,MAAM,CAAC,WAAW,CAAC,IAAI,CAAC,KAAK,CAAC,WAAW,CAAC,CAAC,CAAC,CAAC,UAAU,CAAC,IAAI,EAAE,EAAE,uBAAuB,CAAC,CAAC;IAC3F,CAAC,CAAC,CAAC;IAEH,EAAE,CAAC,mCAAmC,EAAE,KAAK,IAAI,EAAE;QACjD,MAAM,EAAC,IAAI,EAAE,WAAW,EAAE,iBAAiB,EAAC,GAAG,MAAM,KAAK,EAAE,CAAC;QAC7D,MAAM,UAAU,GAAG,oBAAoB,CAAC,2BAA2B,CAAC,CAAC;QACrE,WAAW,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC;QAE7B,iBAAiB,CAAC,wBAAwB,CACtC,WAAW,CAAC,yBAAyB,CAAC,MAAM,CAAC,eAAe,EAAE,UAAU,CAAC,CAAC;QAC9E,MAAM,IAAI,CAAC,SAAS,CAAC;QAErB,MAAM,CAAC,QAAQ,CAAC,IAAI,CAAC,KAAK,CAAC,WAAW,EAAE,CAAC,CAAC,CAAC;QAC3C,MAAM,CAAC,WAAW,CAAC,IAAI,CAAC,KAAK,CAAC,WAAW,CAAC,CAAC,CAAC,CAAC,UAAU,EAAE,UAAU,CAAC,CAAC;IACvE,CAAC,CAAC,CAAC;IAEH,EAAE,CAAC,qCAAqC,EAAE,KAAK,IAAI,EAAE;QACnD,MAAM,EAAC,IAAI,EAAE,WAAW,EAAE,iBAAiB,EAAC,GAAG,MAAM,KAAK,CAAC,CAAC,uBAAuB,CAAC,CAAC,CAAC;QAEtF,MAAM,UAAU,GAAG,WAAW,CAAC,CAAC,CAAC,CAAC;QAClC,WAAW,CAAC,MAAM,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC;QACzB,iBAAiB,CAAC,wBAAwB,CACtC,WAAW,CAAC,yBAAyB,CAAC,MAAM,CAAC,iBAAiB,EAAE,UAAU,CAAC,CAAC;QAChF,MAAM,IAAI,CAAC,SAAS,CAAC;QAErB,MAAM,CAAC,QAAQ,CAAC,IAAI,CAAC,KAAK,CAAC,WAAW,EAAE,CAAC,CAAC,CAAC;IAC7C,CAAC,CAAC,CAAC;IAEH,EAAE,CAAC,yDAAyD,EAAE,KAAK,IAAI,EAAE;QACvE,MAAM,EAAC,IAAI,EAAE,WAAW,EAAE,iBAAiB,EAAE,yBAAyB,EAAC,GAAG,MAAM,KAAK,EAAE,CAAC;QACxF,MAAM,UAAU,GAAG,oBAAoB,CAAC,4BAA4B,CAAC,CAAC;QACtE,WAAW,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC;QAC7B,MAAM,OAAO,GAAG,KAAK,CAAC,kBAAkB,CAAC,WAAW,CAAC,0BAA0B,CAAC,UAAU,CAAC,CAAC;QAC5F,OAAO,CAAC,cAAc,CAAC,OAAO,CAAC,SAAS,CAAA,4BAA4B,CAAC,CAAC;QACtE,yBAAyB,CAAC,OAAO,CAAC,OAAO,CAAC,OAAO,CAAC,CAAC;QACnD,KAAK,CAAC,IAAI,CAAC,iBAAiB,EAAE,YAAY,CAAC,CAAC,OAAO,CAAC,UAAU,CAAC,CAAC;QAEhE,iBAAiB,CAAC,wBAAwB,CACtC,WAAW,CAAC,yBAAyB,CAAC,MAAM,CAAC,eAAe,EAAE,UAAU,CAAC,CAAC;QAC9E,MAAM,IAAI,CAAC,SAAS,CAAC;QAErB,MAAM,CAAC,QAAQ,CAAC,IAAI,CAAC,KAAK,CAAC,WAAW,EAAE,CAAC,CAAC,CAAC;IAC7C,CAAC,CAAC,CAAC;IAEH,EAAE,CAAC,wBAAwB,EAAE,KAAK,IAAI,EAAE;QACtC,MAAM,EAAC,IAAI,EAAE,iBAAiB,EAAC,GAAG,MAAM,KAAK,EAAE,CAAC;QAEhD,IAAI,CAAC,KAAK,CAAC,YAAY,EAAE,CAAC;QAE1B,KAAK,CAAC,MAAM,CAAC,UAAU,CAAC,iBAAiB,CAAC,CAAC;IAC7C,CAAC,CAAC,CAAC;IAEH,EAAE,CAAC,2BAA2B,EAAE,KAAK,IAAI,EAAE;QACzC,MAAM,EAAC,IAAI,EAAE,iBAAiB,EAAE,oBAAoB,EAAC,GAAG,MAAM,KAAK,CAAC,CAAC,uBAAuB,CAAC,CAAC,CAAC;QAC/F,MAAM,UAAU,GAAG,iBAAiB,CAAC,WAAW,EAAE,CAAC,CAAC,CAAC,CAAC;QAEtD,IAAI,CAAC,KAAK,CAAC,eAAe,CAAC,UAA+D,CAAC,CAAC;QAE5F,KAAK,CAAC,MAAM,CAAC,qBAAqB,CAAC,oBAAoB,EAAE,UAAU,CAAC,CAAC;IACvE,CAAC,CAAC,CAAC;AACL,CAAC,CAAC,CAAC","sourcesContent":["// Copyright 2025 The Chromium Authors\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport * as Platform from '../../core/platform/platform.js';\nimport * as Persistence from '../../models/persistence/persistence.js';\nimport {assertScreenshot, renderElementIntoDOM} from '../../testing/DOMHelpers.js';\nimport {createFakeRegExpSetting, describeWithEnvironment} from '../../testing/EnvironmentHelpers.js';\nimport {createViewFunctionStub} from '../../testing/ViewFunctionHelpers.js';\n\nimport * as Settings from './settings.js';\n\nconst {DEFAULT_VIEW, WorkspaceSettingsTab} = Settings.WorkspaceSettingsTab;\nconst {urlString} = Platform.DevToolsPath;\n\ndescribeWithEnvironment('WorkspaceSettingsTab view', () => {\n  it('renders the exclude regex setting and one card per mapped file system', async () => {\n    const target = document.createElement('div');\n    renderElementIntoDOM(target);\n\n    const fileSystem = sinon.createStubInstance(Persistence.IsolatedFileSystem.IsolatedFileSystem);\n    fileSystem.path.returns(urlString`file:///home/user/foo`);\n    fileSystem.excludedFolders.returns(new Set());\n\n    DEFAULT_VIEW(\n        {\n          excludePatternSetting: createFakeRegExpSetting('fake-exclude-pattern', 'node_modules|.git'),\n          fileSystems: [{displayName: 'foo', fileSystem}],\n          onAddClicked: () => {},\n          onRemoveClicked: () => {},\n        },\n        {}, target);\n\n    await assertScreenshot('persistence/workspace_settings_tab.png');\n  });\n});\n\ndescribeWithEnvironment('WorkspaceSettingsTab widget', () => {\n  function createStubFileSystem(path: string) {\n    const fileSystem = sinon.createStubInstance(Persistence.IsolatedFileSystem.IsolatedFileSystem);\n    fileSystem.path.returns(urlString(path));\n    return fileSystem;\n  }\n\n  async function setup(initialFileSystemPaths: string[] = []) {\n    const fileSystemManager =\n        Persistence.IsolatedFileSystemManager.IsolatedFileSystemManager.instance({forceNew: true});\n    const fileSystems = initialFileSystemPaths.map(createStubFileSystem);\n    sinon.stub(fileSystemManager, 'fileSystems').returns(fileSystems);\n    const addFileSystemStub = sinon.stub(fileSystemManager, 'addFileSystem');\n    const removeFileSystemStub = sinon.stub(fileSystemManager, 'removeFileSystem');\n    const networkPersistenceManager =\n        sinon.createStubInstance(Persistence.NetworkPersistenceManager.NetworkPersistenceManager);\n    sinon.stub(Persistence.NetworkPersistenceManager.NetworkPersistenceManager, 'instance')\n        .returns(networkPersistenceManager);\n\n    const view = createViewFunctionStub(WorkspaceSettingsTab);\n    const widget = new WorkspaceSettingsTab(view);\n\n    const container = document.createElement('div');\n    renderElementIntoDOM(container);\n    widget.markAsRoot();\n    widget.show(container);\n    await view.nextInput;\n\n    return {view, fileSystemManager, fileSystems, addFileSystemStub, removeFileSystemStub, networkPersistenceManager};\n  }\n\n  it('uses the exclude folder regex pattern', async () => {\n    const {view, fileSystemManager} = await setup();\n\n    assert.strictEqual(view.input.excludePatternSetting, fileSystemManager.workspaceFolderExcludePatternSetting());\n  });\n\n  it('shows the directory name as the card heading', async () => {\n    const {view} = await setup(['file:///home/user/foo']);\n\n    assert.lengthOf(view.input.fileSystems, 1);\n    assert.strictEqual(view.input.fileSystems[0].displayName, 'foo');\n  });\n\n  it('sorts file systems alphabetically', async () => {\n    const {view} = await setup(['file:///home/user/zoo', 'file:///home/user/foo']);\n\n    assert.lengthOf(view.input.fileSystems, 2);\n    assert.strictEqual(view.input.fileSystems[0].fileSystem.path(), 'file:///home/user/foo');\n    assert.strictEqual(view.input.fileSystems[1].fileSystem.path(), 'file:///home/user/zoo');\n  });\n\n  it('listens to FileSystemAdded events', async () => {\n    const {view, fileSystems, fileSystemManager} = await setup();\n    const fileSystem = createStubFileSystem('file:///home/user/dev/foo');\n    fileSystems.push(fileSystem);\n\n    fileSystemManager.dispatchEventToListeners(\n        Persistence.IsolatedFileSystemManager.Events.FileSystemAdded, fileSystem);\n    await view.nextInput;\n\n    assert.lengthOf(view.input.fileSystems, 1);\n    assert.strictEqual(view.input.fileSystems[0].fileSystem, fileSystem);\n  });\n\n  it('listens to FileSystemRemoved events', async () => {\n    const {view, fileSystems, fileSystemManager} = await setup(['file:///home/user/foo']);\n\n    const fileSystem = fileSystems[0];\n    fileSystems.splice(0, 1);\n    fileSystemManager.dispatchEventToListeners(\n        Persistence.IsolatedFileSystemManager.Events.FileSystemRemoved, fileSystem);\n    await view.nextInput;\n\n    assert.lengthOf(view.input.fileSystems, 0);\n  });\n\n  it('filters out the network persistence file system project', async () => {\n    const {view, fileSystems, fileSystemManager, networkPersistenceManager} = await setup();\n    const fileSystem = createStubFileSystem('file:///special-network-fs');\n    fileSystems.push(fileSystem);\n    const project = sinon.createStubInstance(Persistence.FileSystemWorkspaceBinding.FileSystem);\n    project.fileSystemPath.returns(urlString`file:///special-network-fs`);\n    networkPersistenceManager.project.returns(project);\n    sinon.stub(fileSystemManager, 'fileSystem').returns(fileSystem);\n\n    fileSystemManager.dispatchEventToListeners(\n        Persistence.IsolatedFileSystemManager.Events.FileSystemAdded, fileSystem);\n    await view.nextInput;\n\n    assert.lengthOf(view.input.fileSystems, 0);\n  });\n\n  it('wires up addFileSystem', async () => {\n    const {view, addFileSystemStub} = await setup();\n\n    view.input.onAddClicked();\n\n    sinon.assert.calledOnce(addFileSystemStub);\n  });\n\n  it('wires up removeFileSystem', async () => {\n    const {view, fileSystemManager, removeFileSystemStub} = await setup(['file:///home/user/foo']);\n    const fileSystem = fileSystemManager.fileSystems()[0];\n\n    view.input.onRemoveClicked(fileSystem as Persistence.IsolatedFileSystem.IsolatedFileSystem);\n\n    sinon.assert.calledOnceWithExactly(removeFileSystemStub, fileSystem);\n  });\n});\n"]}