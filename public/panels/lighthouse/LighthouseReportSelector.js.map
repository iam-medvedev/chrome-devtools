{"version":3,"file":"LighthouseReportSelector.js","sourceRoot":"","sources":["../../../../../../front_end/panels/lighthouse/LighthouseReportSelector.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright 2018 The Chromium Authors\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport * as Common from '../../core/common/common.js';\nimport * as i18n from '../../core/i18n/i18n.js';\nimport * as UI from '../../ui/legacy/legacy.js';\n\nimport type * as ReportRenderer from './LighthouseReporterTypes.js';\n\nconst UIStrings = {\n  /**\n   * @description Title of combo box in audits report selector\n   */\n  reports: 'Reports',\n  /**\n   * @description New report item label in Lighthouse Report Selector\n   */\n  newReport: '(new report)',\n} as const;\nconst str_ = i18n.i18n.registerUIStrings('panels/lighthouse/LighthouseReportSelector.ts', UIStrings);\nconst i18nString = i18n.i18n.getLocalizedString.bind(undefined, str_);\nexport class ReportSelector {\n  private readonly renderNewLighthouseView: () => void;\n  private newLighthouseItem: HTMLOptionElement;\n  readonly #comboBox: UI.Toolbar.ToolbarComboBox;\n  private readonly itemByOptionElement: Map<Element, Item>;\n\n  constructor(renderNewLighthouseView: () => void) {\n    this.renderNewLighthouseView = renderNewLighthouseView;\n    this.newLighthouseItem = document.createElement('option');\n    this.#comboBox = new UI.Toolbar.ToolbarComboBox(\n        this.handleChange.bind(this), i18nString(UIStrings.reports), 'lighthouse-report');\n    this.itemByOptionElement = new Map();\n    this.setEmptyState();\n  }\n\n  private setEmptyState(): void {\n    this.#comboBox.removeOptions();\n\n    this.#comboBox.setEnabled(false);\n    this.newLighthouseItem = document.createElement('option');\n    this.newLighthouseItem.label = i18nString(UIStrings.newReport);\n    this.#comboBox.addOption(this.newLighthouseItem);\n    this.#comboBox.select(this.newLighthouseItem);\n  }\n\n  private handleChange(_event: Event): void {\n    const item = this.selectedItem();\n    if (item) {\n      item.select();\n    } else {\n      this.renderNewLighthouseView();\n    }\n  }\n\n  private selectedItem(): Item {\n    const option = this.#comboBox.selectedOption();\n    return this.itemByOptionElement.get(option as Element) as Item;\n  }\n\n  hasItems(): boolean {\n    return this.itemByOptionElement.size > 0;\n  }\n\n  comboBox(): UI.Toolbar.ToolbarComboBox {\n    return this.#comboBox;\n  }\n\n  prepend(item: Item): void {\n    const optionEl = item.optionElement();\n    const selectEl = this.#comboBox.element;\n\n    this.itemByOptionElement.set(optionEl, item);\n    selectEl.insertBefore(optionEl, selectEl.firstElementChild);\n    this.#comboBox.setEnabled(true);\n    this.#comboBox.select(optionEl);\n    item.select();\n  }\n\n  clearAll(): void {\n    for (const elem of this.#comboBox.options()) {\n      if (elem === this.newLighthouseItem) {\n        continue;\n      }\n\n      this.itemByOptionElement.get(elem)?.delete();\n      this.itemByOptionElement.delete(elem);\n    }\n\n    this.setEmptyState();\n  }\n\n  selectNewReport(): void {\n    this.#comboBox.select(this.newLighthouseItem);\n  }\n}\n\nexport class Item {\n  private readonly renderReport: () => void;\n  private readonly showLandingCallback: () => void;\n  private readonly element: HTMLOptionElement;\n\n  constructor(lighthouseResult: ReportRenderer.ReportJSON, renderReport: () => void, showLandingCallback: () => void) {\n    this.renderReport = renderReport;\n    this.showLandingCallback = showLandingCallback;\n\n    // In Lighthouse 10.0, `finalUrl` is not provided on snapshot or timespan reports.\n    // `finalDisplayedUrl` is the new preferred URL to use for cosmetic identification.\n    // TODO: Remove the `finalUrl` backport once Lighthouse 10.0 is rolled into DevTools.\n    const finalDisplayedUrl = lighthouseResult.finalDisplayedUrl || lighthouseResult.finalUrl || '';\n\n    const url = new Common.ParsedURL.ParsedURL(finalDisplayedUrl);\n    const timestamp = lighthouseResult.fetchTime;\n    this.element = document.createElement('option');\n    this.element.label = `${new Date(timestamp).toLocaleTimeString()} - ${url.domain()}`;\n  }\n\n  select(): void {\n    this.renderReport();\n  }\n\n  optionElement(): Element {\n    return this.element;\n  }\n\n  delete(): void {\n    if (this.element) {\n      this.element.remove();\n    }\n    this.showLandingCallback();\n  }\n}\n"]}