{"version":3,"file":"ComputedStyleModel.test.js","sourceRoot":"","sources":["../../../../../../front_end/panels/elements/ComputedStyleModel.test.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright 2023 The Chromium Authors\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport * as SDK from '../../core/sdk/sdk.js';\nimport type * as Protocol from '../../generated/protocol.js';\nimport {createTarget, stubNoopSettings} from '../../testing/EnvironmentHelpers.js';\nimport {describeWithMockConnection} from '../../testing/MockConnection.js';\n\nimport * as Elements from './elements.js';\n\nfunction createNode(target: SDK.Target.Target, {nodeId}: {nodeId: Protocol.DOM.NodeId}): SDK.DOMModel.DOMNode {\n  const domModel = target.model(SDK.DOMModel.DOMModel);\n  assert.exists(domModel);\n\n  const node = SDK.DOMModel.DOMNode.create(domModel, null, false, {\n    nodeId,\n    backendNodeId: 2 as Protocol.DOM.BackendNodeId,\n    nodeType: Node.ELEMENT_NODE,\n    nodeName: 'div',\n    localName: 'div',\n    nodeValue: '',\n  });\n\n  return node;\n}\n\ndescribeWithMockConnection('ComputedStyleModel', () => {\n  let target: SDK.Target.Target;\n  let computedStyleModel: Elements.ComputedStyleModel.ComputedStyleModel;\n  let domNode1: SDK.DOMModel.DOMNode;\n\n  beforeEach(() => {\n    stubNoopSettings();\n    target = createTarget();\n    domNode1 = createNode(target, {nodeId: 1 as Protocol.DOM.NodeId});\n    const cssModel = target.model(SDK.CSSModel.CSSModel);\n    sinon.stub(Elements.ComputedStyleModel.ComputedStyleModel.prototype, 'cssModel').returns(cssModel);\n    computedStyleModel = new Elements.ComputedStyleModel.ComputedStyleModel();\n  });\n\n  afterEach(() => {});\n\n  it('listens to events on the CSS Model when there is a node given', async () => {\n    const cssModel = domNode1.domModel().cssModel();\n    assert.isOk(cssModel);\n    const listenerSpy = sinon.spy(cssModel, 'addEventListener');\n    computedStyleModel.node = domNode1;\n\n    // Feels silly to assert each individual call; but assert 1 to verify that\n    // code path was executed as expected.\n    sinon.assert.calledWith(listenerSpy, SDK.CSSModel.Events.StyleSheetAdded);\n  });\n\n  it('does not listen to events when there is no node given', async () => {\n    const cssModel = domNode1.domModel().cssModel();\n    assert.isOk(cssModel);\n    const listenerSpy = sinon.spy(SDK.CSSModel.CSSModel.prototype, 'addEventListener');\n    computedStyleModel.node = null;\n    sinon.assert.callCount(listenerSpy, 0);\n  });\n\n  it('emits the CSS_MODEL_CHANGED event when there is a change', async () => {\n    const cssModel = domNode1.domModel().cssModel();\n    assert.isOk(cssModel);\n    computedStyleModel.node = domNode1;\n\n    const modelChangedListener = sinon.spy();\n    computedStyleModel.addEventListener(\n        Elements.ComputedStyleModel.Events.CSS_MODEL_CHANGED, event => modelChangedListener(event.data));\n\n    const FAKE_CSS_STYLESHEET_HEADER = {} as SDK.CSSStyleSheetHeader.CSSStyleSheetHeader;\n    cssModel.dispatchEventToListeners(SDK.CSSModel.Events.StyleSheetAdded, FAKE_CSS_STYLESHEET_HEADER);\n\n    sinon.assert.calledOnceWithExactly(modelChangedListener, FAKE_CSS_STYLESHEET_HEADER);\n  });\n\n  it('emits the COMPUTED_STYLE_CHANGED event when the node ID matches', async () => {\n    const cssModel = domNode1.domModel().cssModel();\n    assert.isOk(cssModel);\n    computedStyleModel.node = domNode1;\n\n    const computedStyleListener = sinon.spy();\n    computedStyleModel.addEventListener(\n        Elements.ComputedStyleModel.Events.COMPUTED_STYLE_CHANGED, computedStyleListener);\n    cssModel.dispatchEventToListeners(SDK.CSSModel.Events.ComputedStyleUpdated, {nodeId: domNode1.id});\n\n    sinon.assert.callCount(computedStyleListener, 1);\n  });\n\n  it('does not emit the COMPUTED_STYLE_CHANGED event if the Node ID is different', async () => {\n    const cssModel = domNode1.domModel().cssModel();\n    assert.isOk(cssModel);\n    computedStyleModel.node = domNode1;\n\n    const computedStyleListener = sinon.spy();\n    computedStyleModel.addEventListener(\n        Elements.ComputedStyleModel.Events.COMPUTED_STYLE_CHANGED, computedStyleListener);\n\n    cssModel.dispatchEventToListeners(\n        SDK.CSSModel.Events.ComputedStyleUpdated, {nodeId: (domNode1.id + 1) as Protocol.DOM.NodeId});\n    sinon.assert.callCount(computedStyleListener, 0);\n  });\n});\n"]}