{"version":3,"file":"ComputedStyleModel.test.js","sourceRoot":"","sources":["../../../../../../front_end/panels/elements/ComputedStyleModel.test.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright 2023 The Chromium Authors\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport * as SDK from '../../core/sdk/sdk.js';\nimport type * as Protocol from '../../generated/protocol.js';\nimport {createTarget, stubNoopSettings, updateHostConfig} from '../../testing/EnvironmentHelpers.js';\nimport {describeWithMockConnection} from '../../testing/MockConnection.js';\nimport * as UI from '../../ui/legacy/legacy.js';\n\nimport * as Elements from './elements.js';\n\nfunction createNode(target: SDK.Target.Target, {nodeId}: {nodeId: Protocol.DOM.NodeId}): SDK.DOMModel.DOMNode {\n  const domModel = target.model(SDK.DOMModel.DOMModel);\n  assert.exists(domModel);\n\n  return SDK.DOMModel.DOMNode.create(domModel, null, false, {\n    nodeId,\n    backendNodeId: 2 as Protocol.DOM.BackendNodeId,\n    nodeType: Node.ELEMENT_NODE,\n    nodeName: 'div',\n    localName: 'div',\n    nodeValue: '',\n  });\n}\n\ndescribeWithMockConnection('ComputedStyleModel', () => {\n  let target: SDK.Target.Target;\n  let computedStyleModel: Elements.ComputedStyleModel.ComputedStyleModel;\n  let trackComputedStyleUpdatesForNodeSpy: sinon.SinonSpy;\n\n  async function waitForTrackComputedStyleUpdatesForNodeCall(): Promise<void> {\n    if (trackComputedStyleUpdatesForNodeSpy.getCalls().length > 0) {\n      return;\n    }\n\n    await new Promise<void>(resolve => {\n      requestAnimationFrame(async () => {\n        await waitForTrackComputedStyleUpdatesForNodeCall();\n        resolve();\n      });\n    });\n  }\n\n  beforeEach(() => {\n    stubNoopSettings();\n    target = createTarget();\n    const cssModel = target.model(SDK.CSSModel.CSSModel);\n\n    UI.Context.Context.instance().setFlavor(Elements.StylesSidebarPane.StylesSidebarPane, null);\n    UI.Context.Context.instance().setFlavor(Elements.ComputedStyleWidget.ComputedStyleWidget, null);\n    UI.Context.Context.instance().setFlavor(SDK.DOMModel.DOMNode, null);\n\n    sinon.stub(Elements.ComputedStyleModel.ComputedStyleModel.prototype, 'cssModel').returns(cssModel);\n    trackComputedStyleUpdatesForNodeSpy =\n        sinon.spy(SDK.CSSModel.CSSModel.prototype, 'trackComputedStyleUpdatesForNode');\n    computedStyleModel = new Elements.ComputedStyleModel.ComputedStyleModel();\n  });\n\n  afterEach(() => {\n    computedStyleModel.dispose();\n    trackComputedStyleUpdatesForNodeSpy.restore();\n  });\n\n  it('should track computed style updates when computed widget is shown', async () => {\n    UI.Context.Context.instance().setFlavor(\n        SDK.DOMModel.DOMNode, createNode(target, {nodeId: 1 as Protocol.DOM.NodeId}));\n    UI.Context.Context.instance().setFlavor(\n        Elements.ComputedStyleWidget.ComputedStyleWidget,\n        sinon.createStubInstance(Elements.ComputedStyleWidget.ComputedStyleWidget));\n\n    await waitForTrackComputedStyleUpdatesForNodeCall();\n\n    sinon.assert.calledWith(trackComputedStyleUpdatesForNodeSpy, 1);\n  });\n\n  it('should track computed style updates when styles tab is shown and DevToolsAnimationStylesInStylesTab is enabled',\n     async () => {\n       updateHostConfig({\n         devToolsAnimationStylesInStylesTab: {\n           enabled: true,\n         },\n       });\n       UI.Context.Context.instance().setFlavor(\n           SDK.DOMModel.DOMNode, createNode(target, {nodeId: 1 as Protocol.DOM.NodeId}));\n       UI.Context.Context.instance().setFlavor(\n           Elements.StylesSidebarPane.StylesSidebarPane,\n           sinon.createStubInstance(Elements.StylesSidebarPane.StylesSidebarPane));\n\n       await waitForTrackComputedStyleUpdatesForNodeCall();\n\n       sinon.assert.calledWith(trackComputedStyleUpdatesForNodeSpy, 1);\n     });\n\n  it('should track computed style updates when the node is changed', async () => {\n    UI.Context.Context.instance().setFlavor(\n        SDK.DOMModel.DOMNode, createNode(target, {nodeId: 1 as Protocol.DOM.NodeId}));\n    UI.Context.Context.instance().setFlavor(\n        Elements.ComputedStyleWidget.ComputedStyleWidget,\n        sinon.createStubInstance(Elements.ComputedStyleWidget.ComputedStyleWidget));\n\n    await waitForTrackComputedStyleUpdatesForNodeCall();\n    sinon.assert.calledWith(trackComputedStyleUpdatesForNodeSpy, 1);\n    trackComputedStyleUpdatesForNodeSpy.resetHistory();\n\n    UI.Context.Context.instance().setFlavor(\n        SDK.DOMModel.DOMNode, createNode(target, {nodeId: 2 as Protocol.DOM.NodeId}));\n    await waitForTrackComputedStyleUpdatesForNodeCall();\n\n    sinon.assert.calledWith(trackComputedStyleUpdatesForNodeSpy, 2);\n  });\n\n  it('should stop tracking when computed widget is hidden', async () => {\n    UI.Context.Context.instance().setFlavor(\n        SDK.DOMModel.DOMNode, createNode(target, {nodeId: 1 as Protocol.DOM.NodeId}));\n    UI.Context.Context.instance().setFlavor(\n        Elements.ComputedStyleWidget.ComputedStyleWidget,\n        sinon.createStubInstance(Elements.ComputedStyleWidget.ComputedStyleWidget));\n\n    await waitForTrackComputedStyleUpdatesForNodeCall();\n    sinon.assert.calledWith(trackComputedStyleUpdatesForNodeSpy, 1);\n    trackComputedStyleUpdatesForNodeSpy.resetHistory();\n\n    UI.Context.Context.instance().setFlavor(Elements.ComputedStyleWidget.ComputedStyleWidget, null);\n    await waitForTrackComputedStyleUpdatesForNodeCall();\n\n    sinon.assert.calledWith(trackComputedStyleUpdatesForNodeSpy, undefined);\n  });\n\n  it('should stop tracking when computed widget is hidden and styles tab is shown but the flag is not enabled',\n     async () => {\n       updateHostConfig({\n         devToolsAnimationStylesInStylesTab: {\n           enabled: false,\n         },\n       });\n       UI.Context.Context.instance().setFlavor(\n           SDK.DOMModel.DOMNode, createNode(target, {nodeId: 1 as Protocol.DOM.NodeId}));\n       UI.Context.Context.instance().setFlavor(\n           Elements.ComputedStyleWidget.ComputedStyleWidget,\n           sinon.createStubInstance(Elements.ComputedStyleWidget.ComputedStyleWidget));\n\n       await waitForTrackComputedStyleUpdatesForNodeCall();\n       sinon.assert.calledWith(trackComputedStyleUpdatesForNodeSpy, 1);\n       trackComputedStyleUpdatesForNodeSpy.resetHistory();\n\n       UI.Context.Context.instance().setFlavor(Elements.ComputedStyleWidget.ComputedStyleWidget, null);\n       UI.Context.Context.instance().setFlavor(\n           Elements.StylesSidebarPane.StylesSidebarPane,\n           sinon.createStubInstance(Elements.StylesSidebarPane.StylesSidebarPane));\n       await waitForTrackComputedStyleUpdatesForNodeCall();\n\n       sinon.assert.calledWith(trackComputedStyleUpdatesForNodeSpy, undefined);\n     });\n});\n"]}