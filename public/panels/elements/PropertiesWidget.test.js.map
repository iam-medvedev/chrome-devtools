{"version":3,"file":"PropertiesWidget.test.js","sourceRoot":"","sources":["../../../../../../front_end/panels/elements/PropertiesWidget.test.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright 2023 The Chromium Authors\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport type * as Common from '../../core/common/common.js';\nimport type * as Platform from '../../core/platform/platform.js';\nimport * as SDK from '../../core/sdk/sdk.js';\nimport * as Protocol from '../../generated/protocol.js';\nimport {renderElementIntoDOM} from '../../testing/DOMHelpers.js';\nimport {createTarget, stubNoopSettings} from '../../testing/EnvironmentHelpers.js';\nimport {\n  describeWithMockConnection,\n  setMockConnectionResponseHandler,\n} from '../../testing/MockConnection.js';\nimport {createViewFunctionStub} from '../../testing/ViewFunctionHelpers.js';\nimport * as ObjectUI from '../../ui/legacy/components/object_ui/object_ui.js';\nimport * as UI from '../../ui/legacy/legacy.js';\n\nimport * as Elements from './elements.js';\n\nconst NODE_ID = 1 as Protocol.DOM.NodeId;\n\ndescribeWithMockConnection('PropertiesWidget', () => {\n  let target: SDK.Target.Target;\n  let view: Elements.PropertiesWidget.PropertiesWidget;\n\n  beforeEach(() => {\n    stubNoopSettings();\n    target = createTarget();\n    setMockConnectionResponseHandler(\n        'DOM.getDocument', () => ({root: {nodeId: NODE_ID}} as Protocol.DOM.GetDocumentResponse));\n    setMockConnectionResponseHandler('DOM.getNodesForSubtreeByStyle', () => ({nodeIds: []}));\n  });\n\n  afterEach(() => {\n    view.detach();\n  });\n\n  const updatesUiOnEvent = <T extends keyof SDK.DOMModel.EventTypes>(\n      event: Platform.TypeScriptUtilities.NoUnion<T>, inScope: boolean) => async () => {\n    SDK.TargetManager.TargetManager.instance().setScopeTarget(inScope ? target : null);\n    const model = target.model(SDK.DOMModel.DOMModel);\n    assert.exists(model);\n\n    const node = new SDK.DOMModel.DOMNode(model);\n    sinon.stub(node, 'resolveToObject').withArgs('properties-sidebar-pane').resolves({\n      getAllProperties: () => ({}),\n      getOwnProperties: () => ({}),\n      arrayLength: () => 0,\n    } as unknown as SDK.RemoteObject.RemoteObject);\n    UI.Context.Context.instance().setFlavor(SDK.DOMModel.DOMNode, node);\n\n    view = new Elements.PropertiesWidget.PropertiesWidget();\n    renderElementIntoDOM(view);\n    await view.updateComplete;\n\n    const populateWithProperties =\n        sinon.spy(ObjectUI.ObjectPropertiesSection.ObjectPropertyTreeElement, 'populateWithProperties');\n    model.dispatchEventToListeners(\n        event, ...[node] as unknown as Common.EventTarget.EventPayloadToRestParameters<SDK.DOMModel.EventTypes, T>);\n    await view.updateComplete;\n    assert.strictEqual(populateWithProperties.called, inScope);\n  };\n\n  it('updates UI on in scope attribute modified event', updatesUiOnEvent(SDK.DOMModel.Events.AttrModified, true));\n  it('does not update UI on out of scope attribute modified event',\n     updatesUiOnEvent(SDK.DOMModel.Events.AttrModified, false));\n  it('updates UI on in scope attribute removed event', updatesUiOnEvent(SDK.DOMModel.Events.AttrRemoved, true));\n  it('does not update UI on out of scope attribute removed event',\n     updatesUiOnEvent(SDK.DOMModel.Events.AttrModified, false));\n  it('updates UI on in scope charachter data modified event',\n     updatesUiOnEvent(SDK.DOMModel.Events.CharacterDataModified, true));\n  it('does not update UI on out of scope charachter data modified event',\n     updatesUiOnEvent(SDK.DOMModel.Events.CharacterDataModified, false));\n  it('updates UI on in scope child node count updated event',\n     updatesUiOnEvent(SDK.DOMModel.Events.ChildNodeCountUpdated, true));\n  it('does not update UI on out of scope child node count updated event',\n     updatesUiOnEvent(SDK.DOMModel.Events.ChildNodeCountUpdated, false));\n\n  it('invokes a getter when clicking on the invoke button', async () => {\n    SDK.TargetManager.TargetManager.instance().setScopeTarget(target);\n    const model = target.model(SDK.DOMModel.DOMModel);\n    assert.exists(model);\n    const runtimeModel = target.model(SDK.RuntimeModel.RuntimeModel);\n    assert.exists(runtimeModel);\n\n    const node = new SDK.DOMModel.DOMNode(model);\n    const object = runtimeModel.createRemoteObject({\n      type: Protocol.Runtime.RemoteObjectType.Object,\n      subtype: Protocol.Runtime.RemoteObjectSubtype.Null,\n      objectId: '1' as Protocol.Runtime.RemoteObjectId,\n    });\n\n    setMockConnectionResponseHandler('Runtime.getProperties', () => ({\n                                                                result: [\n                                                                  {\n                                                                    name: 'myGetter',\n                                                                    isOwn: true,\n                                                                    enumerable: true,\n                                                                    configurable: true,\n                                                                    get: {\n                                                                      type: Protocol.Runtime.RemoteObjectType.Function,\n                                                                      objectId: '2' as Protocol.Runtime.RemoteObjectId,\n                                                                      className: 'Function',\n                                                                      description: 'get myGetter()',\n                                                                    },\n                                                                  },\n                                                                ],\n                                                              }));\n    const callFunctionOn = sinon.stub().resolves({\n      result: {\n        type: Protocol.Runtime.RemoteObjectType.Object,\n        subtype: Protocol.Runtime.RemoteObjectSubtype.Null,\n        value: null,\n      },\n    });\n    setMockConnectionResponseHandler('Runtime.callFunctionOn', callFunctionOn);\n\n    sinon.stub(node, 'resolveToObject').withArgs('properties-sidebar-pane').resolves(object);\n    UI.Context.Context.instance().setFlavor(SDK.DOMModel.DOMNode, node);\n\n    const viewFunction = createViewFunctionStub(Elements.PropertiesWidget.PropertiesWidget);\n    view = new Elements.PropertiesWidget.PropertiesWidget(viewFunction);\n    renderElementIntoDOM(view);\n    await viewFunction.nextInput;\n    // Wait for the property widgets to update\n    await UI.Widget.Widget.allUpdatesComplete;\n\n    const {treeOutlineElement} = viewFunction.input;\n    const treeShadowRoot = treeOutlineElement.shadowRoot;\n    assert.exists(treeShadowRoot);\n    const invokeButton = treeShadowRoot.querySelector('.object-value-calculate-value-button');\n    assert.exists(invokeButton);\n    (invokeButton as HTMLElement).click();\n    sinon.assert.calledWith(callFunctionOn, sinon.match({\n      objectId: '1',\n      arguments: sinon.match([{objectId: '2'}]),\n    }));\n  });\n});\n"]}