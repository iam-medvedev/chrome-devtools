{"version":3,"file":"CSSValueTraceView.test.js","sourceRoot":"","sources":["../../../../../../front_end/panels/elements/CSSValueTraceView.test.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright 2025 The Chromium Authors\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport * as SDK from '../../core/sdk/sdk.js';\nimport type * as Protocol from '../../generated/protocol.js';\nimport {renderElementIntoDOM} from '../../testing/DOMHelpers.js';\nimport {createTarget, stubNoopSettings} from '../../testing/EnvironmentHelpers.js';\nimport {describeWithMockConnection, setMockConnectionResponseHandler} from '../../testing/MockConnection.js';\nimport {getMatchedStylesWithBlankRule} from '../../testing/StyleHelpers.js';\nimport {createViewFunctionStub} from '../../testing/ViewFunctionHelpers.js';\nimport * as UI from '../../ui/legacy/legacy.js';\n\nimport * as Elements from './elements.js';\n\nasync function setUpStyles() {\n  stubNoopSettings();\n  setMockConnectionResponseHandler('CSS.enable', () => ({}));\n  setMockConnectionResponseHandler('CSS.getEnvironmentVariables', () => ({}));\n  const computedStyleModel = new Elements.ComputedStyleModel.ComputedStyleModel();\n  const cssModel = new SDK.CSSModel.CSSModel(createTarget());\n  await cssModel.resumeModel();\n  const domModel = cssModel.domModel();\n  const node = new SDK.DOMModel.DOMNode(domModel);\n  node.id = 0 as Protocol.DOM.NodeId;\n  UI.Context.Context.instance().setFlavor(SDK.DOMModel.DOMNode, node);\n  const matchedStyles = await getMatchedStylesWithBlankRule({cssModel});\n  const stylesPane = new Elements.StylesSidebarPane.StylesSidebarPane(computedStyleModel);\n\n  return {matchedStyles, stylesPane};\n}\n\nasync function getTreeElement(\n    matchedStyles: SDK.CSSMatchedStyles.CSSMatchedStyles, stylesPane: Elements.StylesSidebarPane.StylesSidebarPane,\n    name: string, value: string, variables?: Record<string, {value: string, computedValue?: string}>) {\n  const property = new SDK.CSSProperty.CSSProperty(\n      matchedStyles.nodeStyles()[0], matchedStyles.nodeStyles()[0].pastLastSourcePropertyIndex(), name, value, true,\n      false, true, false, '', undefined, []);\n  const treeElement = new Elements.StylePropertyTreeElement.StylePropertyTreeElement({\n    stylesPane,\n    section: sinon.createStubInstance(Elements.StylePropertiesSection.StylePropertiesSection),\n    matchedStyles,\n    property,\n    isShorthand: false,\n    inherited: false,\n    overloaded: false,\n    newProperty: true,\n  });\n\n  if (variables) {\n    const varMap =\n        new Map(Object.getOwnPropertyNames(variables)\n                    .map(\n                        name => new SDK.CSSProperty.CSSProperty(\n                            matchedStyles.nodeStyles()[0], matchedStyles.nodeStyles()[0].pastLastSourcePropertyIndex(),\n                            name, variables[name].value, true, false, true, false, '', undefined, []))\n                    .map(property => [property.name, {\n                           value: variables[property.name].computedValue ?? variables[property.name].value,\n                           declaration: new SDK.CSSMatchedStyles.CSSValueSource(property),\n                         }]));\n    sinon.stub(matchedStyles, 'computeCSSVariable').callsFake((_, name) => varMap.get(name) ?? null);\n  }\n\n  return {matchedStyles, property, treeElement};\n}\n\nasync function showTrace(\n    property: SDK.CSSProperty.CSSProperty, matchedStyles: SDK.CSSMatchedStyles.CSSMatchedStyles,\n    treeElement: Elements.StylePropertyTreeElement.StylePropertyTreeElement):\n    Promise<Elements.CSSValueTraceView.ViewInput> {\n  const viewFunction = createViewFunctionStub(Elements.CSSValueTraceView.CSSValueTraceView);\n  const view = new Elements.CSSValueTraceView.CSSValueTraceView(undefined, viewFunction);\n  await viewFunction.nextInput;\n  void view.showTrace(\n      property, null, matchedStyles, new Map(),\n      Elements.StylePropertyTreeElement.getPropertyRenderers(\n          property.name, property.ownerStyle, treeElement.parentPane(), matchedStyles, treeElement,\n          treeElement.getComputedStyles() ?? new Map()),\n      false, 0, false);\n  return await viewFunction.nextInput;\n}\n\nfunction getLineText(line: Node[][]) {\n  for (const node of line.flat()) {\n    if (node instanceof HTMLElement) {\n      renderElementIntoDOM(node, {allowMultipleChildren: true});\n    }\n  }\n  const text = line.map(\n      nodes => nodes\n                   .map(\n                       node =>\n                           (node instanceof HTMLElement ? node.innerText :\n                                                          (node.nodeType === Node.TEXT_NODE ? node.textContent : '')))\n                   .join());\n  for (const node of line.flat()) {\n    if (node instanceof HTMLElement) {\n      node.remove();\n    }\n  }\n  return text;\n}\n\ndescribeWithMockConnection('CSSValueTraceView', () => {\n  beforeEach(() => {\n    setMockConnectionResponseHandler('CSS.resolveValues', ({values}) => {\n      const results = values.map((v: string) => {\n        if (v.endsWith('em')) {\n          return `${Number(v.substring(0, v.length - 2)) * 16}px`;\n        }\n        if (v.endsWith('vw')) {\n          return `${Number(v.substring(0, v.length - 2)) * 980 / 100}px`;\n        }\n        switch (v) {\n          case 'calc(clamp(16px, calc(1vw + 1em), 24px) + 3.2px)':\n            return '27.7px';\n          case 'clamp(16px, calc(1vw + 1em), 24px)':\n            return '24px';\n          case 'calc(1vw + 1em)':\n            return '24.53px';\n          case 'calc(1px + 1px)':\n            return '2px';\n        }\n        return v;\n      });\n      return {results};\n    });\n  });\n\n  it('shows simple values', async () => {\n    const {matchedStyles, stylesPane} = await setUpStyles();\n    for (const value of ['40', '40px', 'red']) {\n      const {property, treeElement} = await getTreeElement(matchedStyles, stylesPane, 'property', value);\n\n      const input = await showTrace(property, matchedStyles, treeElement);\n\n      const substitutions = getLineText(input.substitutions);\n      const evaluations = getLineText(input.evaluations);\n      assert.deepEqual(substitutions, []);\n      assert.deepEqual(evaluations, [value]);\n    }\n  });\n\n  it('applies substitutions', async () => {\n    const {matchedStyles, stylesPane} = await setUpStyles();\n    const {property, treeElement} =\n        await getTreeElement(matchedStyles, stylesPane, 'width', 'var(--w)', {'--w': {value: '40px'}});\n    const input = await showTrace(property, matchedStyles, treeElement);\n    const substitutions = getLineText(input.substitutions);\n    const evaluations = getLineText(input.evaluations);\n    assert.deepEqual(substitutions, ['40px']);\n    assert.deepEqual(evaluations, []);\n  });\n\n  it('substitutes the variable declaration if the variable is found (with fallback)', async () => {\n    const {matchedStyles, stylesPane} = await setUpStyles();\n    const {property, treeElement} =\n        await getTreeElement(matchedStyles, stylesPane, 'width', 'var(--w, 10px)', {'--w': {value: '40px'}});\n    const input = await showTrace(property, matchedStyles, treeElement);\n    const substitutions = getLineText(input.substitutions);\n    const evaluations = getLineText(input.evaluations);\n    assert.deepEqual(substitutions, ['40px']);\n    assert.deepEqual(evaluations, []);\n  });\n\n  it('substitutes the fallback if the variable is found', async () => {\n    const {matchedStyles, stylesPane} = await setUpStyles();\n    const {property, treeElement} = await getTreeElement(matchedStyles, stylesPane, 'width', 'var(--w, 10px)');\n    const input = await showTrace(property, matchedStyles, treeElement);\n    const substitutions = getLineText(input.substitutions);\n    const evaluations = getLineText(input.evaluations);\n    assert.deepEqual(substitutions, ['10px']);\n    assert.deepEqual(evaluations, []);\n  });\n\n  it('shows chains of substitutions', async () => {\n    const {matchedStyles, stylesPane} = await setUpStyles();\n    const {property, treeElement} = await getTreeElement(\n        matchedStyles, stylesPane, 'width', 'var(--v)', {'--w': {value: '40px'}, '--v': {value: 'var(--w)'}});\n    const input = await showTrace(property, matchedStyles, treeElement);\n    const substitutions = getLineText(input.substitutions);\n    const evaluations = getLineText(input.evaluations);\n    assert.deepEqual(substitutions, ['var(--w)', '40px']);\n    assert.deepEqual(evaluations, []);\n  });\n\n  it('shows intermediate evaluation steps', async () => {\n    const {matchedStyles, stylesPane} = await setUpStyles();\n    const {property, treeElement} = await getTreeElement(\n        matchedStyles, stylesPane, 'font-size', 'calc(clamp(16px, calc(1vw + 1em), 24px) + 3.2px)');\n    const resolveValuesSpy = sinon.spy(treeElement.parentPane().cssModel()!.resolveValues);\n    const input = await showTrace(property, matchedStyles, treeElement);\n    const substitutions = getLineText(input.substitutions);\n    const evaluations = getLineText(input.evaluations);\n    await Promise.all(resolveValuesSpy.returnValues);\n    assert.deepEqual(substitutions, []);\n    assert.deepEqual(evaluations, [\n      'calc(clamp(16px, calc(9.8px + 16px), 24px) + 3.2px)',\n      'calc(clamp(16px, 24.53px, 24px) + 3.2px)',\n      'calc(24px + 3.2px)',\n      '27.7px',\n    ]);\n  });\n\n  it('hides trace lines that contained no successful evaluations', async () => {\n    const {matchedStyles, stylesPane} = await setUpStyles();\n    const {property, treeElement} =\n        await getTreeElement(matchedStyles, stylesPane, '--a', 'calc(100% - calc(50% + calc(1px + 1px)))');\n    const input = await showTrace(property, matchedStyles, treeElement);\n    const substitutions = getLineText(input.substitutions);\n    const evaluations = getLineText(input.evaluations);\n    assert.deepEqual(substitutions, []);\n    assert.deepEqual(evaluations, ['calc(100% - calc(50% + 2px))']);\n  });\n});\n"]}