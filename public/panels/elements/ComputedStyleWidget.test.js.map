{"version":3,"file":"ComputedStyleWidget.test.js","sourceRoot":"","sources":["../../../../../../front_end/panels/elements/ComputedStyleWidget.test.ts"],"names":[],"mappings":"AAAA,4DAA4D;AAC5D,yEAAyE;AACzE,6BAA6B;AAC7B,OAAO,KAAK,GAAG,MAAM,uBAAuB,CAAC;AAE7C,OAAO,EAAC,0BAA0B,EAAC,MAAM,iCAAiC,CAAC;AAG3E,OAAO,KAAK,QAAQ,MAAM,eAAe,CAAC;AAE1C,KAAK,UAAU,mBAAmB,CAAC,WAAyD;IAC1F,MAAM,OAAO,GAAG,WAAW,CAAC,UAAU,EAAE,aAAa,CAAC,+BAA+B,CAAC,CAAC;IACvF,IAAI,OAAO,EAAE,CAAC;QACZ,OAAO,OAAO,CAAC;IACjB,CAAC;IAED,OAAO,MAAM,IAAI,OAAO,CAAc,OAAO,CAAC,EAAE;QAC9C,qBAAqB,CAAC,KAAK,IAAI,EAAE;YAC/B,MAAM,MAAM,GAAG,MAAM,mBAAmB,CAAC,WAAW,CAAC,CAAC;YACtD,OAAO,CAAC,MAAM,CAAC,CAAC;QAClB,CAAC,CAAC,CAAC;IACL,CAAC,CAAC,CAAC;AACL,CAAC;AAED,0BAA0B,CAAC,qBAAqB,EAAE,GAAG,EAAE;IACrD,IAAI,mBAAqE,CAAC;IAC1E,SAAS,CAAC,GAAG,EAAE;QACb,mBAAmB,CAAC,MAAM,EAAE,CAAC;IAC/B,CAAC,CAAC,CAAC;IAEH,QAAQ,CAAC,eAAe,EAAE,GAAG,EAAE;QAC7B,SAAS,gCAAgC,CACrC,uBAAqD,EAAE,uBAAgC,EACvF,UAAgC;YAClC,MAAM,IAAI,GAAG,KAAK,CAAC,kBAAkB,CAAC,GAAG,CAAC,QAAQ,CAAC,OAAO,CAAC,CAAC;YAC5D,IAAI,CAAC,EAAE,GAAG,CAAwB,CAAC;YAEnC,MAAM,YAAY,GAAG;gBACnB,YAAY,EAAE,gBAA6C;gBAC3D,aAAa,EAAE,CAAC;wBACd,IAAI,EAAE,OAAO;wBACb,KAAK,EAAE,KAAK;wBACZ,QAAQ,EAAE,KAAK;wBACf,QAAQ,EAAE,KAAK;wBACf,kBAAkB,EAAE,EAAE;wBACtB,KAAK,EAAE,EAAC,SAAS,EAAE,CAAC,EAAE,WAAW,EAAE,CAAC,EAAE,OAAO,EAAE,CAAC,EAAE,SAAS,EAAE,EAAE,EAAC;wBAChE,IAAI,EAAE,aAAa;qBACpB,CAAC;gBACF,gBAAgB,EAAE,EAAE;aACI,CAAC;YAE3B,MAAM,gBAAgB,GAAG,KAAK,CAAC,kBAAkB,CAAC,GAAG,CAAC,gBAAgB,CAAC,gBAAgB,EAAE;gBACvF,IAAI;gBACJ,aAAa,0DAA2C;gBACxD,UAAU,EAAE;oBACV,IAAI,GAAG,CAAC,mBAAmB,CAAC,mBAAmB,CAC3C,EAA2B,EAAE,UAAU,IAAI,IAAI,EAAE,YAAY,EAAE,uBAAuB,EACtF,uBAAuB,CAAC;iBAC7B;aACF,CAAC,CAAC;YAEH,MAAM,kBAAkB,GAAG,KAAK,CAAC,kBAAkB,CAAC,QAAQ,CAAC,kBAAkB,CAAC,kBAAkB,EAAE;gBAClG,kBAAkB,EAAE,OAAO,CAAC,OAAO,CAAC,EAAC,IAAI,EAAE,aAAa,EAAE,IAAI,GAAG,CAAC,CAAC,CAAC,OAAO,EAAE,KAAK,CAAC,CAAC,CAAC,EAAC,CAAC;gBACvF,QAAQ,EAAE,KAAK,CAAC,kBAAkB,CAC9B,GAAG,CAAC,QAAQ,CAAC,QAAQ,EAAE,EAAC,2BAA2B,EAAE,OAAO,CAAC,OAAO,CAAC,gBAAgB,CAAC,EAAC,CAAC;gBAC5F,IAAI;aACL,CAAC,CAAC;YACH,MAAM,mBAAmB,GAAG,IAAI,QAAQ,CAAC,mBAAmB,CAAC,mBAAmB,CAAC,kBAAkB,CAAC,CAAC;YACrG,mBAAmB,CAAC,UAAU,EAAE,CAAC;YACjC,mBAAmB,CAAC,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,CAAC;YAExC,OAAO,mBAAmB,CAAC;QAC7B,CAAC;QAED,EAAE,CAAC,qFAAqF,EAAE,KAAK,IAAI,EAAE;YACnG,mBAAmB;gBACf,gCAAgC,CAAC,GAAG,CAAC,mBAAmB,CAAC,IAAI,CAAC,SAAS,EAAE,kBAAkB,CAAC,CAAC;YAEjG,mBAAmB,CAAC,MAAM,EAAE,CAAC;YAC7B,MAAM,mBAAmB,CAAC,cAAc,CAAC;YAEzC,MAAM,WAAW,GAAG,mBAAmB,CAAC,cAAc,CAAC,aAAa,CAAC,uBAAuB,CAC5C,CAAC;YACjD,MAAM,WAAW,CAAC,iBAAiB,CAAC,CAAC,CAAC,CAAC;YAEvC,MAAM,YAAY,GAAG,MAAM,mBAAmB,CAAC,WAAW,CAAC,CAAC;YAC5D,MAAM,aAAa,GAAG,YAAY,CAAC,UAAU,EAAE,aAAa,CAAC,iBAAiB,CAAC,CAAC;YAChF,MAAM,CAAC,WAAW,CAAC,aAAa,EAAE,WAAW,EAAE,4BAA4B,CAAC,CAAC;QAC/E,CAAC,CAAC,CAAC;QAEH,EAAE,CAAC,2FAA2F,EAAE,KAAK,IAAI,EAAE;YACzG,mBAAmB,GAAG,gCAAgC,CAAC,GAAG,CAAC,mBAAmB,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC;YAE/F,mBAAmB,CAAC,MAAM,EAAE,CAAC;YAC7B,MAAM,mBAAmB,CAAC,cAAc,CAAC;YAEzC,MAAM,WAAW,GAAG,mBAAmB,CAAC,cAAc,CAAC,aAAa,CAAC,uBAAuB,CAC5C,CAAC;YACjD,MAAM,WAAW,CAAC,iBAAiB,CAAC,CAAC,CAAC,CAAC;YAEvC,MAAM,YAAY,GAAG,MAAM,mBAAmB,CAAC,WAAW,CAAC,CAAC;YAC5D,MAAM,aAAa,GAAG,YAAY,CAAC,UAAU,EAAE,aAAa,CAAC,iBAAiB,CAAC,CAAC;YAChF,MAAM,CAAC,WAAW,CAAC,aAAa,EAAE,WAAW,EAAE,iBAAiB,CAAC,CAAC;QACpE,CAAC,CAAC,CAAC;QAEH,EAAE,CAAC,0EAA0E,EAAE,KAAK,IAAI,EAAE;YACxF,mBAAmB,GAAG,gCAAgC,CAAC,GAAG,CAAC,mBAAmB,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC;YAEhG,mBAAmB,CAAC,MAAM,EAAE,CAAC;YAC7B,MAAM,mBAAmB,CAAC,cAAc,CAAC;YAEzC,MAAM,WAAW,GAAG,mBAAmB,CAAC,cAAc,CAAC,aAAa,CAAC,uBAAuB,CAC5C,CAAC;YACjD,MAAM,WAAW,CAAC,iBAAiB,CAAC,CAAC,CAAC,CAAC;YAEvC,MAAM,YAAY,GAAG,MAAM,mBAAmB,CAAC,WAAW,CAAC,CAAC;YAC5D,MAAM,aAAa,GAAG,YAAY,CAAC,UAAU,EAAE,aAAa,CAAC,iBAAiB,CAAC,CAAC;YAChF,MAAM,CAAC,WAAW,CAAC,aAAa,EAAE,WAAW,EAAE,mBAAmB,CAAC,CAAC;QACtE,CAAC,CAAC,CAAC;QAEH,EAAE,CAAC,oFAAoF,EAAE,KAAK,IAAI,EAAE;YAClG,mBAAmB,GAAG,gCAAgC,CAClD,GAAG,CAAC,mBAAmB,CAAC,IAAI,CAAC,OAAO,EAAE,SAAS,EAC/C,GAAG,CAAC,OAAO,CAAC,YAAY,CAAC,eAAe,CAAC,EAA2B,EAAE,YAAY,CAAC,CAAC,CAAC;YAEzF,mBAAmB,CAAC,MAAM,EAAE,CAAC;YAC7B,MAAM,mBAAmB,CAAC,cAAc,CAAC;YAEzC,MAAM,WAAW,GAAG,mBAAmB,CAAC,cAAc,CAAC,aAAa,CAAC,uBAAuB,CAC5C,CAAC;YACjD,MAAM,WAAW,CAAC,iBAAiB,CAAC,CAAC,CAAC,CAAC;YAEvC,MAAM,YAAY,GAAG,MAAM,mBAAmB,CAAC,WAAW,CAAC,CAAC;YAC5D,MAAM,aAAa,GAAG,YAAY,CAAC,UAAU,EAAE,aAAa,CAAC,iBAAiB,CAAC,CAAC;YAChF,MAAM,CAAC,WAAW,CAAC,aAAa,EAAE,WAAW,EAAE,YAAY,CAAC,CAAC;QAC/D,CAAC,CAAC,CAAC;QAEH,EAAE,CAAC,wFAAwF,EAAE,KAAK,IAAI,EAAE;YACtG,mBAAmB,GAAG,gCAAgC,CAAC,GAAG,CAAC,mBAAmB,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;YAE5F,mBAAmB,CAAC,MAAM,EAAE,CAAC;YAC7B,MAAM,mBAAmB,CAAC,cAAc,CAAC;YAEzC,MAAM,WAAW,GAAG,mBAAmB,CAAC,cAAc,CAAC,aAAa,CAAC,uBAAuB,CAC5C,CAAC;YACjD,MAAM,WAAW,CAAC,iBAAiB,CAAC,CAAC,CAAC,CAAC;YAEvC,MAAM,YAAY,GAAG,MAAM,mBAAmB,CAAC,WAAW,CAAC,CAAC;YAC5D,MAAM,aAAa,GAAG,YAAY,CAAC,UAAU,EAAE,aAAa,CAAC,iBAAiB,CAAC,CAAC;YAChF,MAAM,CAAC,WAAW,CAAC,aAAa,EAAE,WAAW,EAAE,eAAe,CAAC,CAAC;QAClE,CAAC,CAAC,CAAC;IACL,CAAC,CAAC,CAAC;AACL,CAAC,CAAC,CAAC","sourcesContent":["// Copyright 2023 The Chromium Authors. All rights reserved.\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\nimport * as SDK from '../../core/sdk/sdk.js';\nimport type * as Protocol from '../../generated/protocol.js';\nimport {describeWithMockConnection} from '../../testing/MockConnection.js';\nimport type * as TreeOutline from '../../ui/components/tree_outline/tree_outline.js';\n\nimport * as Elements from './elements.js';\n\nasync function waitForTraceElement(treeOutline: TreeOutline.TreeOutline.TreeOutline<unknown>): Promise<HTMLElement> {\n  const element = treeOutline.shadowRoot?.querySelector('devtools-computed-style-trace');\n  if (element) {\n    return element;\n  }\n\n  return await new Promise<HTMLElement>(resolve => {\n    requestAnimationFrame(async () => {\n      const result = await waitForTraceElement(treeOutline);\n      resolve(result);\n    });\n  });\n}\n\ndescribeWithMockConnection('ComputedStyleWidget', () => {\n  let computedStyleWidget: Elements.ComputedStyleWidget.ComputedStyleWidget;\n  afterEach(() => {\n    computedStyleWidget.detach();\n  });\n\n  describe('trace element', () => {\n    function createComputedStyleWidgetForTest(\n        cssStyleDeclarationType: SDK.CSSStyleDeclaration.Type, cssStyleDeclarationName?: string,\n        parentRule?: SDK.CSSRule.CSSRule): Elements.ComputedStyleWidget.ComputedStyleWidget {\n      const node = sinon.createStubInstance(SDK.DOMModel.DOMNode);\n      node.id = 1 as Protocol.DOM.NodeId;\n\n      const stubCSSStyle = {\n        styleSheetId: 'STYLE_SHEET_ID' as Protocol.CSS.StyleSheetId,\n        cssProperties: [{\n          name: 'color',\n          value: 'red',\n          disabled: false,\n          implicit: false,\n          longhandProperties: [],\n          range: {startLine: 1, startColumn: 4, endLine: 1, endColumn: 20},\n          text: 'color: red;',\n        }],\n        shorthandEntries: [],\n      } as Protocol.CSS.CSSStyle;\n\n      const cssMatchedStyles = sinon.createStubInstance(SDK.CSSMatchedStyles.CSSMatchedStyles, {\n        node,\n        propertyState: SDK.CSSMatchedStyles.PropertyState.ACTIVE,\n        nodeStyles: [\n          new SDK.CSSStyleDeclaration.CSSStyleDeclaration(\n              {} as SDK.CSSModel.CSSModel, parentRule ?? null, stubCSSStyle, cssStyleDeclarationType,\n              cssStyleDeclarationName),\n        ]\n      });\n\n      const computedStyleModel = sinon.createStubInstance(Elements.ComputedStyleModel.ComputedStyleModel, {\n        fetchComputedStyle: Promise.resolve({node, computedStyle: new Map([['color', 'red']])}),\n        cssModel: sinon.createStubInstance(\n            SDK.CSSModel.CSSModel, {cachedMatchedCascadeForNode: Promise.resolve(cssMatchedStyles)}),\n        node,\n      });\n      const computedStyleWidget = new Elements.ComputedStyleWidget.ComputedStyleWidget(computedStyleModel);\n      computedStyleWidget.markAsRoot();\n      computedStyleWidget.show(document.body);\n\n      return computedStyleWidget;\n    }\n\n    it('renders trace element with correct selector for declarations coming from animations', async () => {\n      computedStyleWidget =\n          createComputedStyleWidgetForTest(SDK.CSSStyleDeclaration.Type.Animation, '--animation-name');\n\n      computedStyleWidget.update();\n      await computedStyleWidget.updateComplete;\n\n      const treeOutline = computedStyleWidget.contentElement.querySelector('devtools-tree-outline') as\n          TreeOutline.TreeOutline.TreeOutline<unknown>;\n      await treeOutline.expandRecursively(2);\n\n      const traceElement = await waitForTraceElement(treeOutline);\n      const traceSelector = traceElement.shadowRoot?.querySelector('.trace-selector');\n      assert.strictEqual(traceSelector?.textContent, '--animation-name animation');\n    });\n\n    it('renders trace element with correct selector for declarations coming from WAAPI animations', async () => {\n      computedStyleWidget = createComputedStyleWidgetForTest(SDK.CSSStyleDeclaration.Type.Animation);\n\n      computedStyleWidget.update();\n      await computedStyleWidget.updateComplete;\n\n      const treeOutline = computedStyleWidget.contentElement.querySelector('devtools-tree-outline') as\n          TreeOutline.TreeOutline.TreeOutline<unknown>;\n      await treeOutline.expandRecursively(2);\n\n      const traceElement = await waitForTraceElement(treeOutline);\n      const traceSelector = traceElement.shadowRoot?.querySelector('.trace-selector');\n      assert.strictEqual(traceSelector?.textContent, 'animation style');\n    });\n\n    it('renders trace element with correct selector for declarations transitions', async () => {\n      computedStyleWidget = createComputedStyleWidgetForTest(SDK.CSSStyleDeclaration.Type.Transition);\n\n      computedStyleWidget.update();\n      await computedStyleWidget.updateComplete;\n\n      const treeOutline = computedStyleWidget.contentElement.querySelector('devtools-tree-outline') as\n          TreeOutline.TreeOutline.TreeOutline<unknown>;\n      await treeOutline.expandRecursively(2);\n\n      const traceElement = await waitForTraceElement(treeOutline);\n      const traceSelector = traceElement.shadowRoot?.querySelector('.trace-selector');\n      assert.strictEqual(traceSelector?.textContent, 'transitions style');\n    });\n\n    it('renders trace element with correct selector for declarations coming from CSS rules', async () => {\n      computedStyleWidget = createComputedStyleWidgetForTest(\n          SDK.CSSStyleDeclaration.Type.Regular, undefined,\n          SDK.CSSRule.CSSStyleRule.createDummyRule({} as SDK.CSSModel.CSSModel, '.container'));\n\n      computedStyleWidget.update();\n      await computedStyleWidget.updateComplete;\n\n      const treeOutline = computedStyleWidget.contentElement.querySelector('devtools-tree-outline') as\n          TreeOutline.TreeOutline.TreeOutline<unknown>;\n      await treeOutline.expandRecursively(5);\n\n      const traceElement = await waitForTraceElement(treeOutline);\n      const traceSelector = traceElement.shadowRoot?.querySelector('.trace-selector');\n      assert.strictEqual(traceSelector?.textContent, '.container');\n    });\n\n    it('renders trace element with correct selector for declarations coming from inline styles', async () => {\n      computedStyleWidget = createComputedStyleWidgetForTest(SDK.CSSStyleDeclaration.Type.Inline);\n\n      computedStyleWidget.update();\n      await computedStyleWidget.updateComplete;\n\n      const treeOutline = computedStyleWidget.contentElement.querySelector('devtools-tree-outline') as\n          TreeOutline.TreeOutline.TreeOutline<unknown>;\n      await treeOutline.expandRecursively(5);\n\n      const traceElement = await waitForTraceElement(treeOutline);\n      const traceSelector = traceElement.shadowRoot?.querySelector('.trace-selector');\n      assert.strictEqual(traceSelector?.textContent, 'element.style');\n    });\n  });\n});\n"]}