{"version":3,"file":"AiCodeGeneration.test.js","sourceRoot":"","sources":["../../../../../../front_end/models/ai_code_generation/AiCodeGeneration.test.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright 2025 The Chromium Authors\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport * as Host from '../../core/host/host.js';\nimport {\n  describeWithEnvironment,\n  updateHostConfig,\n} from '../../testing/EnvironmentHelpers.js';\n\nimport * as AiCodeGeneration from './ai_code_generation.js';\n\ndescribeWithEnvironment('AiCodeGeneration', () => {\n  beforeEach(() => {\n    updateHostConfig({\n      devToolsAiCodeGeneration: {\n        enabled: true,\n        temperature: 0.5,\n        modelId: 'test-model',\n        userTier: 'BETA',\n      },\n    });\n  });\n\n  it('builds a request and calls the AIDA client', async () => {\n    const mockAidaClient = sinon.createStubInstance(Host.AidaClient.AidaClient, {\n      generateCode: Promise.resolve(null),\n    });\n    const aiCodeGeneration = new AiCodeGeneration.AiCodeGeneration.AiCodeGeneration(\n        {aidaClient: mockAidaClient},\n    );\n\n    await aiCodeGeneration.generateCode('prompt', 'preamble');\n\n    sinon.assert.calledOnce(mockAidaClient.generateCode);\n    const request = mockAidaClient.generateCode.firstCall.args[0];\n    assert.strictEqual(request.client, 'CHROME_DEVTOOLS');\n    assert.strictEqual(request.preamble, 'preamble');\n    assert.deepEqual(request.current_message, {\n      parts: [{\n        text: 'prompt',\n      }],\n      role: Host.AidaClient.Role.USER,\n    });\n    assert.strictEqual(request.use_case, Host.AidaClient.UseCase.CODE_GENERATION);\n    assert.deepEqual(request.options, {\n      temperature: 0.5,\n      model_id: 'test-model',\n      inference_language: Host.AidaClient.AidaInferenceLanguage.JAVASCRIPT,\n      expect_code_output: true,\n    });\n    assert.isTrue(request.metadata.disable_user_content_logging);\n    assert.strictEqual(request.metadata.user_tier, Host.AidaClient.UserTier.BETA);\n  });\n\n  it('returns the response from the AIDA client', async () => {\n    const mockAidaClient = sinon.createStubInstance(Host.AidaClient.AidaClient, {\n      generateCode: Promise.resolve({\n        samples: [{\n          generationString: 'suggestion',\n          sampleId: 1,\n          score: 1,\n        }],\n        metadata: {rpcGlobalId: 1},\n      }),\n    });\n    const aiCodeGeneration = new AiCodeGeneration.AiCodeGeneration.AiCodeGeneration(\n        {aidaClient: mockAidaClient},\n    );\n\n    const response = await aiCodeGeneration.generateCode('prompt', 'preamble');\n\n    assert.deepEqual(response, {\n      samples: [{\n        generationString: 'suggestion',\n        sampleId: 1,\n        score: 1,\n      }],\n      metadata: {rpcGlobalId: 1},\n    });\n  });\n});\n"]}