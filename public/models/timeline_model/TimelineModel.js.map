{"version":3,"file":"TimelineModel.js","sourceRoot":"","sources":["../../../../../../front_end/models/timeline_model/TimelineModel.ts"],"names":[],"mappings":"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","sourcesContent":["/*\n * Copyright (C) 2012 Google Inc. All rights reserved.\n *\n * Redistribution and use in source and binary forms, with or without\n * modification, are permitted provided that the following conditions are\n * met:\n *\n *     * Redistributions of source code must retain the above copyright\n * notice, this list of conditions and the following disclaimer.\n *     * Redistributions in binary form must reproduce the above\n * copyright notice, this list of conditions and the following disclaimer\n * in the documentation and/or other materials provided with the\n * distribution.\n *     * Neither the name of Google Inc. nor the names of its\n * contributors may be used to endorse or promote products derived from\n * this software without specific prior written permission.\n *\n * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS\n * \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT\n * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR\n * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT\n * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,\n * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT\n * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,\n * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY\n * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\n * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE\n * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n */\n\n// TODO(crbug.com/1172300) Ignored during the jsdoc to ts migration)\n/* eslint-disable @typescript-eslint/no-explicit-any */\n\nimport * as Common from '../../core/common/common.js';\nimport * as Platform from '../../core/platform/platform.js';\nimport type * as SDK from '../../core/sdk/sdk.js';\nimport type * as Protocol from '../../generated/protocol.js';\nimport * as TraceEngine from '../trace/trace.js';\n\nexport class TimelineModelImpl {\n  private inspectedTargetEventsInternal!: TraceEngine.Legacy.Event[];\n  private sessionId!: string|null;\n  private mainFrameNodeId!: number|null;\n  private pageFrames!: Map<Protocol.Page.FrameId, PageFrame>;\n  private workerIdByThread!: WeakMap<TraceEngine.Legacy.Thread, string>;\n  private requestsFromBrowser!: Map<string, TraceEngine.Legacy.Event>;\n  private mainFrame!: PageFrame;\n  private minimumRecordTimeInternal: number;\n  private lastScheduleStyleRecalculation!: {\n    [x: string]: TraceEngine.Types.TraceEvents.TraceEventData,\n  };\n  private paintImageEventByPixelRefId!: {\n    [x: string]: TraceEngine.Legacy.Event,\n  };\n  private lastPaintForLayer!: {\n    [x: string]: TraceEngine.Legacy.Event,\n  };\n  private currentScriptEvent!: TraceEngine.Legacy.Event|null;\n  private eventStack!: TraceEngine.Legacy.Event[];\n  private browserFrameTracking!: boolean;\n  private persistentIds!: boolean;\n  private legacyCurrentPage!: any;\n  private currentTaskLayoutAndRecalcEvents: TraceEngine.Legacy.Event[];\n  private tracingModelInternal: TraceEngine.Legacy.TracingModel|null;\n  private lastRecalculateStylesEvent: TraceEngine.Legacy.Event|null;\n  #isFreshRecording = false;\n\n  constructor() {\n    this.minimumRecordTimeInternal = 0;\n    this.reset();\n    this.resetProcessingState();\n\n    this.currentTaskLayoutAndRecalcEvents = [];\n    this.tracingModelInternal = null;\n    this.lastRecalculateStylesEvent = null;\n  }\n\n  /**\n   * Iterates events in a tree hierarchically, from top to bottom,\n   * calling back on every event's start and end in the order\n   * dictated by the corresponding timestamp.\n   *\n   * Events are assumed to be in ascendent order by timestamp.\n   *\n   * For example, given this tree, the following callbacks\n   * are expected to be made in the following order\n   * |---------------A---------------|\n   *  |------B------||-------D------|\n   *    |---C---|\n   *\n   * 1. Start A\n   * 3. Start B\n   * 4. Start C\n   * 5. End C\n   * 6. End B\n   * 7. Start D\n   * 8. End D\n   * 9. End A\n   *\n   * By default, async events are filtered. This behaviour can be\n   * overriden making use of the filterAsyncEvents parameter.\n   */\n  static forEachEvent(\n      events: TraceEngine.Legacy.CompatibleTraceEvent[],\n      onStartEvent: (arg0: TraceEngine.Legacy.CompatibleTraceEvent) => void,\n      onEndEvent: (arg0: TraceEngine.Legacy.CompatibleTraceEvent) => void,\n      onInstantEvent?:\n          ((arg0: TraceEngine.Legacy.CompatibleTraceEvent, arg1: TraceEngine.Legacy.CompatibleTraceEvent|null) => void),\n      startTime?: number, endTime?: number, filter?: ((arg0: TraceEngine.Legacy.CompatibleTraceEvent) => boolean),\n      ignoreAsyncEvents = true): void {\n    startTime = startTime || 0;\n    endTime = endTime || Infinity;\n    const stack: TraceEngine.Legacy.CompatibleTraceEvent[] = [];\n    const startEvent = TimelineModelImpl.topLevelEventEndingAfter(events, startTime);\n    for (let i = startEvent; i < events.length; ++i) {\n      const e = events[i];\n      const {endTime: eventEndTime, startTime: eventStartTime, duration: eventDuration} =\n          TraceEngine.Legacy.timesForEventInMilliseconds(e);\n      const eventPhase = TraceEngine.Legacy.phaseForEvent(e);\n      if ((eventEndTime || eventStartTime) < startTime) {\n        continue;\n      }\n      if (eventStartTime >= endTime) {\n        break;\n      }\n      const canIgnoreAsyncEvent = ignoreAsyncEvents && TraceEngine.Types.TraceEvents.isAsyncPhase(eventPhase);\n      if (canIgnoreAsyncEvent || TraceEngine.Types.TraceEvents.isFlowPhase(eventPhase)) {\n        continue;\n      }\n      let last = stack[stack.length - 1];\n      let lastEventEndTime = last && TraceEngine.Legacy.timesForEventInMilliseconds(last).endTime;\n      while (last && lastEventEndTime !== undefined && lastEventEndTime <= eventStartTime) {\n        stack.pop();\n        onEndEvent(last);\n        last = stack[stack.length - 1];\n        lastEventEndTime = last && TraceEngine.Legacy.timesForEventInMilliseconds(last).endTime;\n      }\n\n      if (filter && !filter(e)) {\n        continue;\n      }\n      if (eventDuration) {\n        onStartEvent(e);\n        stack.push(e);\n      } else {\n        onInstantEvent && onInstantEvent(e, stack[stack.length - 1] || null);\n      }\n    }\n    while (stack.length) {\n      const last = stack.pop();\n      if (last) {\n        onEndEvent(last);\n      }\n    }\n  }\n\n  private static topLevelEventEndingAfter(events: TraceEngine.Legacy.CompatibleTraceEvent[], time: number): number {\n    let index =\n        Platform.ArrayUtilities.upperBound(\n            events, time, (time, event) => time - TraceEngine.Legacy.timesForEventInMilliseconds(event).startTime) -\n        1;\n    while (index > 0 && !TraceEngine.Legacy.TracingModel.isTopLevelEvent(events[index])) {\n      index--;\n    }\n    return Math.max(index, 0);\n  }\n\n  /**\n   * Determines if an event is potentially a marker event. A marker event here\n   * is a single moment in time that we want to highlight on the timeline, such as\n   * the LCP point. This method does not filter out events: for example, it treats\n   * every LCP Candidate event as a potential marker event. The logic to pick the\n   * right candidate to use is implemeneted in the TimelineFlameChartDataProvider.\n   **/\n  isMarkerEvent(event: TraceEngine.Legacy.CompatibleTraceEvent): boolean {\n    switch (event.name) {\n      case RecordType.TimeStamp:\n        return true;\n      case RecordType.MarkFirstPaint:\n      case RecordType.MarkFCP:\n        return Boolean(this.mainFrame) && event.args.frame === this.mainFrame.frameId && Boolean(event.args.data);\n      case RecordType.MarkDOMContent:\n      case RecordType.MarkLoad:\n      case RecordType.MarkLCPCandidate:\n      case RecordType.MarkLCPInvalidate:\n        return Boolean(event.args['data']['isOutermostMainFrame'] ?? event.args['data']['isMainFrame']);\n      default:\n        return false;\n    }\n  }\n\n  isInteractiveTimeEvent(event: TraceEngine.Legacy.Event): boolean {\n    return event.name === RecordType.InteractiveTime;\n  }\n\n  isLayoutShiftEvent(event: TraceEngine.Legacy.Event): boolean {\n    return event.name === RecordType.LayoutShift;\n  }\n\n  static globalEventId(event: TraceEngine.Legacy.Event, field: string): string {\n    const data = event.args['data'] || event.args['beginData'];\n    const id = data && data[field];\n    if (!id) {\n      return '';\n    }\n    return `${event.thread.process().id()}.${id}`;\n  }\n\n  static eventFrameId(event: TraceEngine.Legacy.Event): Protocol.Page.FrameId|null {\n    const data = event.args['data'] || event.args['beginData'];\n    return data && data['frame'] || null;\n  }\n\n  isFreshRecording(): boolean {\n    return this.#isFreshRecording;\n  }\n\n  setEvents(tracingModel: TraceEngine.Legacy.TracingModel, isFreshRecording: boolean = false): void {\n    this.#isFreshRecording = isFreshRecording;\n    this.reset();\n    this.resetProcessingState();\n    this.tracingModelInternal = tracingModel;\n\n    this.minimumRecordTimeInternal = tracingModel.minimumRecordTime();\n\n    this.processSyncBrowserEvents(tracingModel);\n    if (this.browserFrameTracking) {\n      this.processThreadsForBrowserFrames(tracingModel);\n    } else {\n      // The next line is for loading legacy traces recorded before M67.\n      // TODO(alph): Drop the support at some point.\n      const metadataEvents = this.processMetadataEvents(tracingModel);\n      if (metadataEvents) {\n        this.processMetadataAndThreads(metadataEvents);\n      } else {\n        this.processGenericTrace(tracingModel);\n      }\n    }\n    this.inspectedTargetEventsInternal.sort(TraceEngine.Legacy.Event.compareStartTime);\n    this.resetProcessingState();\n  }\n\n  private processGenericTrace(tracingModel: TraceEngine.Legacy.TracingModel): void {\n    let browserMainThread = TraceEngine.Legacy.TracingModel.browserMainThread(tracingModel);\n    if (!browserMainThread && tracingModel.sortedProcesses().length) {\n      browserMainThread = tracingModel.sortedProcesses()[0].sortedThreads()[0];\n    }\n    for (const process of tracingModel.sortedProcesses()) {\n      for (const thread of process.sortedThreads()) {\n        this.processThreadEvents(thread);\n      }\n    }\n  }\n\n  private processMetadataAndThreads(metadataEvents: MetadataEvents): void {\n    let startTime = 0;\n    for (let i = 0, length = metadataEvents.page.length; i < length; i++) {\n      const metaEvent = metadataEvents.page[i];\n      const process = metaEvent.thread.process();\n      const endTime = i + 1 < length ? metadataEvents.page[i + 1].startTime : Infinity;\n      if (startTime === endTime) {\n        continue;\n      }\n      this.legacyCurrentPage = metaEvent.args['data'] && metaEvent.args['data']['page'];\n      for (const thread of process.sortedThreads()) {\n        if (thread.name() === TimelineModelImpl.WorkerThreadName ||\n            thread.name() === TimelineModelImpl.WorkerThreadNameLegacy) {\n          const workerMetaEvent = metadataEvents.workers.find(e => {\n            if (e.args['data']['workerThreadId'] !== thread.id()) {\n              return false;\n            }\n            // This is to support old traces.\n            if (e.args['data']['sessionId'] === this.sessionId) {\n              return true;\n            }\n            const frameId = TimelineModelImpl.eventFrameId(e);\n            return frameId ? Boolean(this.pageFrames.get(frameId)) : false;\n          });\n          if (!workerMetaEvent) {\n            continue;\n          }\n          const workerId = workerMetaEvent.args['data']['workerId'];\n          if (workerId) {\n            this.workerIdByThread.set(thread, workerId);\n          }\n        }\n        this.processThreadEvents(thread);\n      }\n      startTime = endTime;\n    }\n  }\n\n  private processThreadsForBrowserFrames(tracingModel: TraceEngine.Legacy.TracingModel): void {\n    const processDataByPid = new Map<number, {\n      from: number,\n      to: number,\n      main: boolean,\n      url: Platform.DevToolsPath.UrlString,\n    }[]>();\n    for (const frame of this.pageFrames.values()) {\n      for (let i = 0; i < frame.processes.length; i++) {\n        const pid = frame.processes[i].processId;\n        let data = processDataByPid.get(pid);\n        if (!data) {\n          data = [];\n          processDataByPid.set(pid, data);\n        }\n        const to = i === frame.processes.length - 1 ? (frame.deletedTime || Infinity) : frame.processes[i + 1].time;\n        data.push({\n          from: frame.processes[i].time,\n          to: to,\n          main: !frame.parent,\n          url: frame.processes[i].url,\n        });\n      }\n    }\n    const allMetadataEvents = tracingModel.devToolsMetadataEvents();\n    for (const process of tracingModel.sortedProcesses()) {\n      const processData = processDataByPid.get(process.id());\n      if (!processData) {\n        continue;\n      }\n      // Sort ascending by range starts, followed by range ends\n      processData.sort((a, b) => a.from - b.from || a.to - b.to);\n\n      for (const thread of process.sortedThreads()) {\n        if (thread.name() === TimelineModelImpl.RendererMainThreadName) {\n          this.processThreadEvents(thread);\n        } else if (\n            thread.name() === TimelineModelImpl.WorkerThreadName ||\n            thread.name() === TimelineModelImpl.WorkerThreadNameLegacy) {\n          const workerMetaEvent = allMetadataEvents.find(e => {\n            if (e.name !== TimelineModelImpl.DevToolsMetadataEvent.TracingSessionIdForWorker) {\n              return false;\n            }\n            if (e.thread.process() !== process) {\n              return false;\n            }\n            if (e.args['data']['workerThreadId'] !== thread.id()) {\n              return false;\n            }\n            const frameId = TimelineModelImpl.eventFrameId(e);\n            return frameId ? Boolean(this.pageFrames.get(frameId)) : false;\n          });\n          if (!workerMetaEvent) {\n            continue;\n          }\n          this.workerIdByThread.set(thread, workerMetaEvent.args['data']['workerId'] || '');\n          this.processThreadEvents(thread);\n        } else {\n          this.processThreadEvents(thread);\n        }\n      }\n    }\n  }\n\n  private processMetadataEvents(tracingModel: TraceEngine.Legacy.TracingModel): MetadataEvents|null {\n    const metadataEvents = tracingModel.devToolsMetadataEvents();\n\n    const pageDevToolsMetadataEvents = [];\n    const workersDevToolsMetadataEvents = [];\n    for (const event of metadataEvents) {\n      if (event.name === TimelineModelImpl.DevToolsMetadataEvent.TracingStartedInPage) {\n        pageDevToolsMetadataEvents.push(event);\n        if (event.args['data'] && event.args['data']['persistentIds']) {\n          this.persistentIds = true;\n        }\n        const frames = ((event.args['data'] && event.args['data']['frames']) || [] as PageFrame[]);\n        frames.forEach((payload: PageFrame) => this.addPageFrame(event, payload));\n        this.mainFrame = this.rootFrames()[0];\n      } else if (event.name === TimelineModelImpl.DevToolsMetadataEvent.TracingSessionIdForWorker) {\n        workersDevToolsMetadataEvents.push(event);\n      } else if (event.name === TimelineModelImpl.DevToolsMetadataEvent.TracingStartedInBrowser) {\n        console.assert(!this.mainFrameNodeId, 'Multiple sessions in trace');\n        this.mainFrameNodeId = event.args['frameTreeNodeId'];\n      }\n    }\n    if (!pageDevToolsMetadataEvents.length) {\n      return null;\n    }\n\n    const sessionId =\n        pageDevToolsMetadataEvents[0].args['sessionId'] || pageDevToolsMetadataEvents[0].args['data']['sessionId'];\n    this.sessionId = sessionId;\n\n    const mismatchingIds = new Set<any>();\n    function checkSessionId(event: TraceEngine.Legacy.Event): boolean {\n      let args = event.args;\n      // FIXME: put sessionId into args[\"data\"] for TracingStartedInPage event.\n      if (args['data']) {\n        args = args['data'];\n      }\n      const id = args['sessionId'];\n      if (id === sessionId) {\n        return true;\n      }\n      mismatchingIds.add(id);\n      return false;\n    }\n    const result = {\n      page: pageDevToolsMetadataEvents.filter(checkSessionId).sort(TraceEngine.Legacy.Event.compareStartTime),\n      workers: workersDevToolsMetadataEvents.sort(TraceEngine.Legacy.Event.compareStartTime),\n    };\n    if (mismatchingIds.size) {\n      Common.Console.Console.instance().error(\n          'Timeline recording was started in more than one page simultaneously. Session id mismatch: ' +\n          this.sessionId + ' and ' + [...mismatchingIds] + '.');\n    }\n    return result;\n  }\n\n  private processSyncBrowserEvents(tracingModel: TraceEngine.Legacy.TracingModel): void {\n    const browserMain = TraceEngine.Legacy.TracingModel.browserMainThread(tracingModel);\n    if (browserMain) {\n      browserMain.events().forEach(this.processBrowserEvent, this);\n    }\n  }\n\n  private resetProcessingState(): void {\n    this.lastScheduleStyleRecalculation = {};\n    this.paintImageEventByPixelRefId = {};\n    this.lastPaintForLayer = {};\n    this.currentScriptEvent = null;\n    this.eventStack = [];\n    this.browserFrameTracking = false;\n    this.persistentIds = false;\n    this.legacyCurrentPage = null;\n  }\n\n  private processThreadEvents(thread: TraceEngine.Legacy.Thread): void {\n    const events = thread.events();\n    this.eventStack = [];\n    const eventStack = this.eventStack;\n\n    for (let i = 0; i < events.length; i++) {\n      const event = events[i];\n\n      let last: TraceEngine.Legacy.Event = eventStack[eventStack.length - 1];\n      while (last && last.endTime !== undefined && last.endTime <= event.startTime) {\n        eventStack.pop();\n        last = eventStack[eventStack.length - 1];\n      }\n      if (!this.processEvent(event)) {\n        continue;\n      }\n      if (!TraceEngine.Types.TraceEvents.isAsyncPhase(event.phase) && event.duration) {\n        if (eventStack.length) {\n          const parent = eventStack[eventStack.length - 1];\n          if (parent) {\n            parent.selfTime -= event.duration;\n            if (parent.selfTime < 0) {\n              parent.selfTime = 0;\n            }\n          }\n        }\n        event.selfTime = event.duration;\n        eventStack.push(event);\n      }\n\n      this.inspectedTargetEventsInternal.push(event);\n    }\n  }\n\n  private processEvent(event: TraceEngine.Legacy.Event): boolean {\n    const eventStack = this.eventStack;\n\n    if (!eventStack.length) {\n      this.currentTaskLayoutAndRecalcEvents = [];\n    }\n\n    if (this.currentScriptEvent) {\n      if (this.currentScriptEvent.endTime !== undefined && event.startTime > this.currentScriptEvent.endTime) {\n        this.currentScriptEvent = null;\n      }\n    }\n\n    const eventData = event.args['data'] || event.args['beginData'] || {};\n    const timelineData = EventOnTimelineData.forEvent(event);\n    if (eventData['stackTrace']) {\n      timelineData.stackTrace = eventData['stackTrace'].map((callFrameOrProfileNode: Protocol.Runtime.CallFrame) => {\n        // `callFrameOrProfileNode` can also be a `SDK.ProfileTreeModel.ProfileNode` for JSSample; that class\n        // has accessors to mimic a `CallFrame`, but apparently we don't adjust stack traces in that case. Whether\n        // we should is unclear.\n        if (event.name !== RecordType.JSSample && event.name !== RecordType.JSSystemSample &&\n            event.name !== RecordType.JSIdleSample) {\n          // We need to copy the data so we can safely modify it below.\n          const frame = {...callFrameOrProfileNode};\n          // TraceEvents come with 1-based line & column numbers. The frontend code\n          // requires 0-based ones. Adjust the values.\n          --frame.lineNumber;\n          --frame.columnNumber;\n          return frame;\n        }\n        return callFrameOrProfileNode;\n      });\n    }\n    let pageFrameId = TimelineModelImpl.eventFrameId(event);\n    const last = eventStack[eventStack.length - 1];\n    if (!pageFrameId && last) {\n      pageFrameId = EventOnTimelineData.forEvent(last).frameId;\n    }\n    timelineData.frameId = pageFrameId || (this.mainFrame && this.mainFrame.frameId) || '';\n\n    switch (event.name) {\n      case RecordType.ResourceSendRequest:\n      case RecordType.WebSocketCreate: {\n        const lastEvent = eventStack[eventStack.length - 1];\n        if (!(lastEvent instanceof TraceEngine.Legacy.PayloadEvent)) {\n          break;\n        }\n        timelineData.url = eventData['url'];\n        break;\n      }\n\n      case RecordType.ScheduleStyleRecalculation: {\n        if (!(event instanceof TraceEngine.Legacy.PayloadEvent)) {\n          break;\n        }\n        this.lastScheduleStyleRecalculation[eventData['frame']] = event.rawPayload();\n        break;\n      }\n\n      case RecordType.UpdateLayoutTree:\n      case RecordType.RecalculateStyles: {\n        if (this.currentScriptEvent) {\n          this.currentTaskLayoutAndRecalcEvents.push(event);\n        }\n        break;\n      }\n\n      case RecordType.Layout: {\n        const frameId = event.args?.beginData?.frame;\n        if (!frameId) {\n          break;\n        }\n        // In case we have no closing Layout event, endData is not available.\n        if (event.args['endData']) {\n          if (event.args['endData']['layoutRoots']) {\n            for (let i = 0; i < event.args['endData']['layoutRoots'].length; ++i) {\n              timelineData.backendNodeIds.push(event.args['endData']['layoutRoots'][i]['nodeId']);\n            }\n          } else {\n            timelineData.backendNodeIds.push(event.args['endData']['rootNode']);\n          }\n        }\n        if (this.currentScriptEvent) {\n          this.currentTaskLayoutAndRecalcEvents.push(event);\n        }\n        break;\n      }\n\n      // @ts-ignore fallthrough intended.\n      case RecordType.FunctionCall: {\n        // Compatibility with old format.\n        if (typeof eventData['scriptName'] === 'string') {\n          eventData['url'] = eventData['scriptName'];\n        }\n        if (typeof eventData['scriptLine'] === 'number') {\n          eventData['lineNumber'] = eventData['scriptLine'];\n        }\n      }\n\n      case RecordType.EvaluateScript:\n      case RecordType.CompileScript:\n      // @ts-ignore fallthrough intended.\n      case RecordType.CacheScript: {\n        if (typeof eventData['lineNumber'] === 'number') {\n          --eventData['lineNumber'];\n        }\n        if (typeof eventData['columnNumber'] === 'number') {\n          --eventData['columnNumber'];\n        }\n      }\n\n      case RecordType.RunMicrotasks: {\n        // Microtasks technically are not necessarily scripts, but for purpose of\n        // forced sync style recalc or layout detection they are.\n        if (!this.currentScriptEvent) {\n          this.currentScriptEvent = event;\n        }\n        break;\n      }\n\n      case RecordType.SetLayerTreeId: {\n        // This is to support old traces.\n        if (this.sessionId && eventData['sessionId'] && this.sessionId === eventData['sessionId']) {\n          break;\n        }\n\n        // We currently only show layer tree for the main frame.\n        const frameId = TimelineModelImpl.eventFrameId(event);\n        const pageFrame = frameId ? this.pageFrames.get(frameId) : null;\n        if (!pageFrame || pageFrame.parent) {\n          return false;\n        }\n        break;\n      }\n\n      case RecordType.Paint: {\n        // With CompositeAfterPaint enabled, paint events are no longer\n        // associated with a Node, and nodeId will not be present.\n        if ('nodeId' in eventData) {\n          timelineData.backendNodeIds.push(eventData['nodeId']);\n        }\n        // Only keep layer paint events, skip paints for subframes that get painted to the same layer as parent.\n        if (!eventData['layerId']) {\n          break;\n        }\n        const layerId = eventData['layerId'];\n        this.lastPaintForLayer[layerId] = event;\n        break;\n      }\n\n      case RecordType.ScrollLayer: {\n        timelineData.backendNodeIds.push(eventData['nodeId']);\n        break;\n      }\n\n      case RecordType.PaintImage: {\n        timelineData.backendNodeIds.push(eventData['nodeId']);\n        timelineData.url = eventData['url'];\n        break;\n      }\n\n      case RecordType.DecodeImage:\n      case RecordType.ResizeImage: {\n        let paintImageEvent = this.findAncestorEvent(RecordType.PaintImage);\n        if (!paintImageEvent) {\n          const decodeLazyPixelRefEvent = this.findAncestorEvent(RecordType.DecodeLazyPixelRef);\n          paintImageEvent =\n              decodeLazyPixelRefEvent && this.paintImageEventByPixelRefId[decodeLazyPixelRefEvent.args['LazyPixelRef']];\n        }\n        if (!paintImageEvent) {\n          break;\n        }\n        const paintImageData = EventOnTimelineData.forEvent(paintImageEvent);\n        timelineData.backendNodeIds.push(paintImageData.backendNodeIds[0]);\n        timelineData.url = paintImageData.url;\n        break;\n      }\n\n      case RecordType.DrawLazyPixelRef: {\n        const paintImageEvent = this.findAncestorEvent(RecordType.PaintImage);\n        if (!paintImageEvent) {\n          break;\n        }\n        this.paintImageEventByPixelRefId[event.args['LazyPixelRef']] = paintImageEvent;\n        const paintImageData = EventOnTimelineData.forEvent(paintImageEvent);\n        timelineData.backendNodeIds.push(paintImageData.backendNodeIds[0]);\n        timelineData.url = paintImageData.url;\n        break;\n      }\n\n      case RecordType.FrameStartedLoading: {\n        if (timelineData.frameId !== event.args['frame']) {\n          return false;\n        }\n        break;\n      }\n\n      case RecordType.MarkLCPCandidate: {\n        timelineData.backendNodeIds.push(eventData['nodeId']);\n        break;\n      }\n\n      case RecordType.MarkDOMContent:\n      case RecordType.MarkLoad: {\n        const frameId = TimelineModelImpl.eventFrameId(event);\n        if (!frameId || !this.pageFrames.has(frameId)) {\n          return false;\n        }\n        break;\n      }\n\n      case RecordType.CommitLoad: {\n        if (this.browserFrameTracking) {\n          break;\n        }\n        const frameId = TimelineModelImpl.eventFrameId(event);\n        const isOutermostMainFrame = Boolean(eventData['isOutermostMainFrame'] ?? eventData['isMainFrame']);\n        const pageFrame = frameId ? this.pageFrames.get(frameId) : null;\n        if (pageFrame) {\n          pageFrame.update(event.startTime, eventData);\n        } else {\n          // We should only have one main frame which has persistent id,\n          // unless it's an old trace without 'persistentIds' flag.\n          if (!this.persistentIds) {\n            if (eventData['page'] && eventData['page'] !== this.legacyCurrentPage) {\n              return false;\n            }\n          } else if (isOutermostMainFrame) {\n            return false;\n          } else if (!this.addPageFrame(event, eventData)) {\n            return false;\n          }\n        }\n        if (isOutermostMainFrame && frameId) {\n          const frame = this.pageFrames.get(frameId);\n          if (frame) {\n            this.mainFrame = frame;\n          }\n        }\n        break;\n      }\n\n      case RecordType.SelectorStats: {\n        this.lastRecalculateStylesEvent?.addArgs(event.args);\n        break;\n      }\n    }\n    return true;\n  }\n\n  private processBrowserEvent(event: TraceEngine.Legacy.Event): void {\n    if (event.name === RecordType.ResourceWillSendRequest) {\n      const requestId = event.args?.data?.requestId;\n      if (typeof requestId === 'string') {\n        this.requestsFromBrowser.set(requestId, event);\n      }\n      return;\n    }\n\n    if (event.hasCategory(TraceEngine.Legacy.DevToolsMetadataEventCategory) && event.args['data']) {\n      const data = event.args['data'];\n      if (event.name === TimelineModelImpl.DevToolsMetadataEvent.TracingStartedInBrowser) {\n        if (!data['persistentIds']) {\n          return;\n        }\n        this.browserFrameTracking = true;\n        this.mainFrameNodeId = data['frameTreeNodeId'];\n        const frames: any[] = data['frames'] || [];\n        frames.forEach(payload => {\n          const parent = payload['parent'] && this.pageFrames.get(payload['parent']);\n          if (payload['parent'] && !parent) {\n            return;\n          }\n          let frame = this.pageFrames.get(payload['frame']);\n          if (!frame) {\n            frame = new PageFrame(payload);\n            this.pageFrames.set(frame.frameId, frame);\n            if (parent) {\n              parent.addChild(frame);\n            } else {\n              this.mainFrame = frame;\n            }\n          }\n          // TODO(dgozman): this should use event.startTime, but due to races between tracing start\n          // in different processes we cannot do this yet.\n          frame.update(this.minimumRecordTimeInternal, payload);\n        });\n        return;\n      }\n      if (event.name === TimelineModelImpl.DevToolsMetadataEvent.FrameCommittedInBrowser && this.browserFrameTracking) {\n        let frame = this.pageFrames.get(data['frame']);\n        if (!frame) {\n          const parent = data['parent'] && this.pageFrames.get(data['parent']);\n          frame = new PageFrame(data);\n          this.pageFrames.set(frame.frameId, frame);\n          if (parent) {\n            parent.addChild(frame);\n          }\n        }\n        frame.update(event.startTime, data);\n        return;\n      }\n      if (event.name === TimelineModelImpl.DevToolsMetadataEvent.ProcessReadyInBrowser && this.browserFrameTracking) {\n        const frame = this.pageFrames.get(data['frame']);\n        if (frame) {\n          frame.processReady(data['processPseudoId'], data['processId']);\n        }\n        return;\n      }\n      if (event.name === TimelineModelImpl.DevToolsMetadataEvent.FrameDeletedInBrowser && this.browserFrameTracking) {\n        const frame = this.pageFrames.get(data['frame']);\n        if (frame) {\n          frame.deletedTime = event.startTime;\n        }\n        return;\n      }\n    }\n  }\n\n  private findAncestorEvent(name: string): TraceEngine.Legacy.Event|null {\n    for (let i = this.eventStack.length - 1; i >= 0; --i) {\n      const event = this.eventStack[i];\n      if (event.name === name) {\n        return event;\n      }\n    }\n    return null;\n  }\n\n  private addPageFrame(event: TraceEngine.Legacy.Event, payload: any): boolean {\n    const parent = payload['parent'] && this.pageFrames.get(payload['parent']);\n    if (payload['parent'] && !parent) {\n      return false;\n    }\n    const pageFrame = new PageFrame(payload);\n    this.pageFrames.set(pageFrame.frameId, pageFrame);\n    pageFrame.update(event.startTime, payload);\n    if (parent) {\n      parent.addChild(pageFrame);\n    }\n    return true;\n  }\n\n  private reset(): void {\n    this.inspectedTargetEventsInternal = [];\n    this.sessionId = null;\n    this.mainFrameNodeId = null;\n    this.workerIdByThread = new WeakMap();\n    this.pageFrames = new Map();\n    this.requestsFromBrowser = new Map();\n\n    this.minimumRecordTimeInternal = 0;\n  }\n\n  tracingModel(): TraceEngine.Legacy.TracingModel|null {\n    return this.tracingModelInternal;\n  }\n\n  inspectedTargetEvents(): TraceEngine.Legacy.Event[] {\n    return this.inspectedTargetEventsInternal;\n  }\n\n  rootFrames(): PageFrame[] {\n    return Array.from(this.pageFrames.values()).filter(frame => !frame.parent);\n  }\n\n  pageURL(): Platform.DevToolsPath.UrlString {\n    return this.mainFrame && this.mainFrame.url || Platform.DevToolsPath.EmptyUrlString;\n  }\n\n  pageFrameById(frameId: Protocol.Page.FrameId): PageFrame|null {\n    return frameId ? this.pageFrames.get(frameId) || null : null;\n  }\n\n  static findRecalculateStyleEvents(\n      events: TraceEngine.Types.TraceEvents.TraceEventData[], startTime: number = 0,\n      endTime: number = Infinity): TraceEngine.Legacy.Event[] {\n    const stack: TraceEngine.Legacy.Event[] = [];\n    const startEvent = TimelineModelImpl.topLevelEventEndingAfter(events, startTime);\n    const startTimeInMicroSec =\n        TraceEngine.Helpers.Timing.millisecondsToMicroseconds(TraceEngine.Types.Timing.MilliSeconds(startTime));\n    const endTimeInMicroSec =\n        TraceEngine.Helpers.Timing.millisecondsToMicroseconds(TraceEngine.Types.Timing.MilliSeconds(endTime));\n    for (let i = startEvent; i < events.length; ++i) {\n      const e = events[i] as unknown as TraceEngine.Types.TraceEvents.TraceEventComplete;\n      if (e.name !== TraceEngine.Types.TraceEvents.KnownEventName.RecalculateStyles &&\n          e.name !== TraceEngine.Types.TraceEvents.KnownEventName.UpdateLayoutTree) {\n        continue;\n      }\n      if (!e.dur || e.ts + e.dur < startTimeInMicroSec) {\n        continue;\n      }\n      if (e.ts >= endTimeInMicroSec) {\n        break;\n      }\n      stack.push(e as unknown as TraceEngine.Legacy.Event);\n    }\n    return stack;\n  }\n}\n\nexport enum RecordType {\n  Task = 'RunTask',\n  Program = 'Program',\n  EventDispatch = 'EventDispatch',\n\n  GPUTask = 'GPUTask',\n\n  Animation = 'Animation',\n  RequestMainThreadFrame = 'RequestMainThreadFrame',\n  BeginFrame = 'BeginFrame',\n  NeedsBeginFrameChanged = 'NeedsBeginFrameChanged',\n  BeginMainThreadFrame = 'BeginMainThreadFrame',\n  ActivateLayerTree = 'ActivateLayerTree',\n  DrawFrame = 'DrawFrame',\n  DroppedFrame = 'DroppedFrame',\n  HitTest = 'HitTest',\n  ScheduleStyleRecalculation = 'ScheduleStyleRecalculation',\n  RecalculateStyles = 'RecalculateStyles',\n  UpdateLayoutTree = 'UpdateLayoutTree',\n  InvalidateLayout = 'InvalidateLayout',\n  Layerize = 'Layerize',\n  Layout = 'Layout',\n  LayoutShift = 'LayoutShift',\n  UpdateLayer = 'UpdateLayer',\n  UpdateLayerTree = 'UpdateLayerTree',\n  PaintSetup = 'PaintSetup',\n  Paint = 'Paint',\n  PaintImage = 'PaintImage',\n  PrePaint = 'PrePaint',\n  Rasterize = 'Rasterize',\n  RasterTask = 'RasterTask',\n  ScrollLayer = 'ScrollLayer',\n  Commit = 'Commit',\n  CompositeLayers = 'CompositeLayers',\n  ComputeIntersections = 'IntersectionObserverController::computeIntersections',\n  InteractiveTime = 'InteractiveTime',\n\n  ParseHTML = 'ParseHTML',\n  ParseAuthorStyleSheet = 'ParseAuthorStyleSheet',\n\n  TimerInstall = 'TimerInstall',\n  TimerRemove = 'TimerRemove',\n  TimerFire = 'TimerFire',\n\n  XHRReadyStateChange = 'XHRReadyStateChange',\n  XHRLoad = 'XHRLoad',\n  CompileScript = 'v8.compile',\n  CompileCode = 'V8.CompileCode',\n  OptimizeCode = 'V8.OptimizeCode',\n  EvaluateScript = 'EvaluateScript',\n  CacheScript = 'v8.produceCache',\n  CompileModule = 'v8.compileModule',\n  EvaluateModule = 'v8.evaluateModule',\n  CacheModule = 'v8.produceModuleCache',\n  WasmStreamFromResponseCallback = 'v8.wasm.streamFromResponseCallback',\n  WasmCompiledModule = 'v8.wasm.compiledModule',\n  WasmCachedModule = 'v8.wasm.cachedModule',\n  WasmModuleCacheHit = 'v8.wasm.moduleCacheHit',\n  WasmModuleCacheInvalid = 'v8.wasm.moduleCacheInvalid',\n\n  FrameStartedLoading = 'FrameStartedLoading',\n  CommitLoad = 'CommitLoad',\n  MarkLoad = 'MarkLoad',\n  MarkDOMContent = 'MarkDOMContent',\n  MarkFirstPaint = 'firstPaint',\n  MarkFCP = 'firstContentfulPaint',\n  MarkLCPCandidate = 'largestContentfulPaint::Candidate',\n  MarkLCPInvalidate = 'largestContentfulPaint::Invalidate',\n  NavigationStart = 'navigationStart',\n\n  TimeStamp = 'TimeStamp',\n  ConsoleTime = 'ConsoleTime',\n  UserTiming = 'UserTiming',\n  EventTiming = 'EventTiming',\n\n  ResourceWillSendRequest = 'ResourceWillSendRequest',\n  ResourceSendRequest = 'ResourceSendRequest',\n  ResourceReceiveResponse = 'ResourceReceiveResponse',\n  ResourceReceivedData = 'ResourceReceivedData',\n  ResourceFinish = 'ResourceFinish',\n  ResourceMarkAsCached = 'ResourceMarkAsCached',\n\n  RunMicrotasks = 'RunMicrotasks',\n  FunctionCall = 'FunctionCall',\n  GCEvent = 'GCEvent',\n  MajorGC = 'MajorGC',\n  MinorGC = 'MinorGC',\n\n  // The following types are used for CPUProfile.\n  // JSRoot is used for the root node.\n  // JSIdleFrame and JSIdleSample are used for idle nodes.\n  // JSSystemFrame and JSSystemSample are used for other system nodes.\n  // JSFrame and JSSample are used for other nodes, and will be categorized as |scripting|.\n  JSFrame = 'JSFrame',\n  JSSample = 'JSSample',\n  JSIdleFrame = 'JSIdleFrame',\n  JSIdleSample = 'JSIdleSample',\n  JSSystemFrame = 'JSSystemFrame',\n  JSSystemSample = 'JSSystemSample',\n  JSRoot = 'JSRoot',\n\n  // V8Sample events are coming from tracing and contain raw stacks with function addresses.\n  // After being processed with help of JitCodeAdded and JitCodeMoved events they\n  // get translated into function infos and stored as stacks in JSSample events.\n  V8Sample = 'V8Sample',\n  JitCodeAdded = 'JitCodeAdded',\n  JitCodeMoved = 'JitCodeMoved',\n  StreamingCompileScript = 'v8.parseOnBackground',\n  StreamingCompileScriptWaiting = 'v8.parseOnBackgroundWaiting',\n  StreamingCompileScriptParsing = 'v8.parseOnBackgroundParsing',\n  BackgroundDeserialize = 'v8.deserializeOnBackground',\n  FinalizeDeserialization = 'V8.FinalizeDeserialization',\n  V8Execute = 'V8.Execute',\n\n  UpdateCounters = 'UpdateCounters',\n\n  RequestAnimationFrame = 'RequestAnimationFrame',\n  CancelAnimationFrame = 'CancelAnimationFrame',\n  FireAnimationFrame = 'FireAnimationFrame',\n\n  RequestIdleCallback = 'RequestIdleCallback',\n  CancelIdleCallback = 'CancelIdleCallback',\n  FireIdleCallback = 'FireIdleCallback',\n\n  WebSocketCreate = 'WebSocketCreate',\n  WebSocketSendHandshakeRequest = 'WebSocketSendHandshakeRequest',\n  WebSocketReceiveHandshakeResponse = 'WebSocketReceiveHandshakeResponse',\n  WebSocketDestroy = 'WebSocketDestroy',\n\n  EmbedderCallback = 'EmbedderCallback',\n\n  SetLayerTreeId = 'SetLayerTreeId',\n  TracingStartedInPage = 'TracingStartedInPage',\n  TracingSessionIdForWorker = 'TracingSessionIdForWorker',\n  StartProfiling = 'CpuProfiler::StartProfiling',\n\n  DecodeImage = 'Decode Image',\n  ResizeImage = 'Resize Image',\n  DrawLazyPixelRef = 'Draw LazyPixelRef',\n  DecodeLazyPixelRef = 'Decode LazyPixelRef',\n\n  LazyPixelRef = 'LazyPixelRef',\n  LayerTreeHostImplSnapshot = 'cc::LayerTreeHostImpl',\n  PictureSnapshot = 'cc::Picture',\n  DisplayItemListSnapshot = 'cc::DisplayItemList',\n  InputLatencyMouseMove = 'InputLatency::MouseMove',\n  InputLatencyMouseWheel = 'InputLatency::MouseWheel',\n  ImplSideFling = 'InputHandlerProxy::HandleGestureFling::started',\n  GCCollectGarbage = 'BlinkGC.AtomicPhase',\n\n  CryptoDoEncrypt = 'DoEncrypt',\n  CryptoDoEncryptReply = 'DoEncryptReply',\n  CryptoDoDecrypt = 'DoDecrypt',\n  CryptoDoDecryptReply = 'DoDecryptReply',\n  CryptoDoDigest = 'DoDigest',\n  CryptoDoDigestReply = 'DoDigestReply',\n  CryptoDoSign = 'DoSign',\n  CryptoDoSignReply = 'DoSignReply',\n  CryptoDoVerify = 'DoVerify',\n  CryptoDoVerifyReply = 'DoVerifyReply',\n\n  // CpuProfile is a virtual event created on frontend to support\n  // serialization of CPU Profiles within tracing timeline data.\n  CpuProfile = 'CpuProfile',\n  Profile = 'Profile',\n\n  AsyncTask = 'AsyncTask',\n\n  SelectorStats = 'SelectorStats',\n}\n\nexport namespace TimelineModelImpl {\n  export const Category = {\n    Console: 'blink.console',\n    UserTiming: 'blink.user_timing',\n    Loading: 'loading',\n  };\n\n  export const WorkerThreadName = 'DedicatedWorker thread';\n  export const WorkerThreadNameLegacy = 'DedicatedWorker Thread';\n  export const RendererMainThreadName = 'CrRendererMain';\n  export const BrowserMainThreadName = 'CrBrowserMain';\n  // The names of threads before M111 were exactly this, but afterwards have\n  // it a suffix after the exact role.\n  export const UtilityMainThreadNameSuffix = 'CrUtilityMain';\n\n  export const DevToolsMetadataEvent = {\n    TracingStartedInBrowser: 'TracingStartedInBrowser',\n    TracingStartedInPage: 'TracingStartedInPage',\n    TracingSessionIdForWorker: 'TracingSessionIdForWorker',\n    FrameCommittedInBrowser: 'FrameCommittedInBrowser',\n    ProcessReadyInBrowser: 'ProcessReadyInBrowser',\n    FrameDeletedInBrowser: 'FrameDeletedInBrowser',\n  };\n\n  export const Thresholds = {\n    LongTask: 50,\n    Handler: 150,\n    RecurringHandler: 50,\n    ForcedLayout: 30,\n    IdleCallbackAddon: 5,\n  };\n}\n\nexport class PageFrame {\n  frameId: any;\n  url: any;\n  name: any;\n  children: PageFrame[];\n  parent: PageFrame|null;\n  processes: {\n    time: number,\n    processId: number,\n    processPseudoId: string|null,\n    url: Platform.DevToolsPath.UrlString,\n  }[];\n  deletedTime: number|null;\n  ownerNode: SDK.DOMModel.DeferredDOMNode|null;\n  constructor(payload: any) {\n    this.frameId = payload['frame'];\n    this.url = payload['url'] || Platform.DevToolsPath.EmptyUrlString;\n    this.name = payload['name'];\n    this.children = [];\n    this.parent = null;\n    this.processes = [];\n    this.deletedTime = null;\n    // TODO(dgozman): figure this out.\n    // this.ownerNode = target && payload['nodeId'] ? new SDK.DOMModel.DeferredDOMNode(target, payload['nodeId']) : null;\n    this.ownerNode = null;\n  }\n\n  update(time: number, payload: any): void {\n    this.url = payload['url'] || '';\n    this.name = payload['name'];\n    if (payload['processId']) {\n      this.processes.push(\n          {time: time, processId: payload['processId'], processPseudoId: '', url: payload['url'] || ''});\n    } else {\n      this.processes.push(\n          {time: time, processId: -1, processPseudoId: payload['processPseudoId'], url: payload['url'] || ''});\n    }\n  }\n\n  processReady(processPseudoId: string, processId: number): void {\n    for (const process of this.processes) {\n      if (process.processPseudoId === processPseudoId) {\n        process.processPseudoId = '';\n        process.processId = processId;\n      }\n    }\n  }\n\n  addChild(child: PageFrame): void {\n    this.children.push(child);\n    child.parent = this;\n  }\n}\n\nexport class EventOnTimelineData {\n  url: Platform.DevToolsPath.UrlString|null;\n  backendNodeIds: Protocol.DOM.BackendNodeId[];\n  stackTrace: Protocol.Runtime.CallFrame[]|null;\n  frameId: Protocol.Page.FrameId|null;\n\n  constructor() {\n    this.url = null;\n    this.backendNodeIds = [];\n    this.stackTrace = null;\n    this.frameId = null;\n  }\n\n  topFrame(): Protocol.Runtime.CallFrame|null {\n    return this.stackTrace && this.stackTrace[0] || null;\n  }\n\n  static forEvent(event: TraceEngine.Legacy.CompatibleTraceEvent): EventOnTimelineData {\n    if (event instanceof TraceEngine.Legacy.PayloadEvent) {\n      return EventOnTimelineData.forTraceEventData(event.rawPayload());\n    }\n    if (!(event instanceof TraceEngine.Legacy.Event)) {\n      return EventOnTimelineData.forTraceEventData(event);\n    }\n    return getOrCreateEventData(event);\n  }\n\n  static forTraceEventData(event: TraceEngine.Types.TraceEvents.TraceEventData): EventOnTimelineData {\n    return getOrCreateEventData(event);\n  }\n  static reset(): void {\n    eventToData = new Map<\n        TraceEngine.Legacy.ConstructedEvent|TraceEngine.Types.TraceEvents.TraceEventData, EventOnTimelineData>();\n  }\n}\n\nfunction getOrCreateEventData(event: TraceEngine.Legacy.ConstructedEvent|\n                              TraceEngine.Types.TraceEvents.TraceEventData): EventOnTimelineData {\n  let data = eventToData.get(event);\n  if (!data) {\n    data = new EventOnTimelineData();\n    eventToData.set(event, data);\n  }\n  return data;\n}\n\nlet eventToData =\n    new Map<TraceEngine.Legacy.ConstructedEvent|TraceEngine.Types.TraceEvents.TraceEventData, EventOnTimelineData>();\n\nexport interface InvalidationCause {\n  reason: string;\n  stackTrace: Protocol.Runtime.CallFrame[]|null;\n}\nexport interface MetadataEvents {\n  page: TraceEngine.Legacy.Event[];\n  workers: TraceEngine.Legacy.Event[];\n}\n"]}