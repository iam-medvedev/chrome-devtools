{"version":3,"file":"TimelineJSProfile.js","sourceRoot":"","sources":["../../../../../../front_end/models/timeline_model/TimelineJSProfile.ts"],"names":[],"mappings":"AAAA,4DAA4D;AAC5D,yEAAyE;AACzE,6BAA6B;AAE7B,uDAAuD;AAEvD,OAAO,KAAK,IAAI,MAAM,yBAAyB,CAAC;AAEhD,OAAO,KAAK,KAAK,MAAM,mBAAmB,CAAC;AAE3C,MAAM,SAAS,GAAG;IAChB;;;OAGG;IACH,OAAO,EAAE,cAAc;CACxB,CAAC;AACF,MAAM,IAAI,GAAG,IAAI,CAAC,IAAI,CAAC,iBAAiB,CAAC,4CAA4C,EAAE,SAAS,CAAC,CAAC;AAClG,MAAM,UAAU,GAAG,IAAI,CAAC,IAAI,CAAC,kBAAkB,CAAC,IAAI,CAAC,SAAS,EAAE,IAAI,CAAC,CAAC;AACtE,MAAM,OAAO,0BAA0B;IACrC,MAAM,CAAC,oBAAoB,CAAC,KAAiC;QAC3D,OAAO,KAAK,CAAC,GAAG,KAAK,kBAAkB,CAAC;IAC1C,CAAC;IAED,MAAM,CAAC,WAAW,CAAC,UAAkB;QACnC,IAAI,UAAU,CAAC,UAAU,CAAC,OAAO,CAAC,EAAE,CAAC;YACnC,mEAAqD;QACvD,CAAC;QACD,IAAI,UAAU,CAAC,UAAU,CAAC,SAAS,CAAC,IAAI,UAAU,CAAC,UAAU,CAAC,WAAW,CAAC,EAAE,CAAC;YAC3E,uEAAuD;QACzD,CAAC;QACD,OAAO,IAAI,CAAC;IACd,CAAC;IAED,MAAM,CAAC,6BAA6B,CAAC,OAAkC,EAAE,GAAgC;QAEvG,MAAM,MAAM,GAA+B,EAAE,CAAC;QAE9C,MAAM,UAAU,GAAG,UAAU,CAAC,SAAS,CAAC,OAAO,EAAE,EAAC,GAAG,EAAE,GAAG,EAAC,CAAC,CAAC;QAC7D,WAAW,CAAC,sBAAsB,EAAE,EAAC,IAAI,EAAE,EAAC,SAAS,EAAE,GAAG,EAAC,EAAC,EAAE,CAAC,EAAE,CAAC,8CAAoC,CAAC;QACvG,WAAW,0DAC8B,EAAC,IAAI,EAAE,UAAU,EAAC,EAAE,CAAC,EAAE,CAAC,+CAAqC,YAAY,CAAC,CAAC;QACpH,IAAI,CAAC,OAAO,EAAE,CAAC;YACb,OAAO,MAAM,CAAC;QAChB,CAAC;QAED,+GAA+G;QAC/G,yCAAyC;QACzC,iMAAiM;QACjM,kFAAkF;QAClF,WAAW,CACP,QAAQ,EAAE,EAAE,EAAE,OAAO,CAAC,SAAS,EAAE,OAAO,CAAC,OAAO,GAAG,OAAO,CAAC,SAAS,+CACpE,UAAU,CAAC,CAAC;QAEhB,oEAAoE;QACpE,WAAW,CAAC,YAAY,EAAE,EAAC,IAAI,EAAE,EAAC,UAAU,EAAE,OAAO,EAAC,EAAC,EAAE,OAAO,CAAC,OAAO,EAAE,CAAC,8CAAoC,CAAC;QAChH,OAAO,MAAM,CAAC;QAEd,SAAS,WAAW,CAChB,IAAY,EAAE,IAAS,EAAE,EAAU,EAAE,GAAY,EAAE,EAA6B,EAChF,GAAY;YACd,MAAM,KAAK,GAA6B;gBACtC,GAAG,EAAE,GAAG,IAAI,uCAAuC;gBACnD,IAAI;gBACJ,EAAE,EAAE,EAAE,+CAAqC;gBAC3C,GAAG,EAAE,KAAK,CAAC,KAAK,CAAC,MAAM,CAAC,SAAS,CAAC,CAAC,CAAC;gBACpC,GAAG;gBACH,EAAE,EAAE,KAAK,CAAC,KAAK,CAAC,MAAM,CAAC,YAAY,CAAC,EAAE,CAAC;gBACvC,IAAI;aACL,CAAC;YAEF,IAAI,GAAG,EAAE,CAAC;gBACR,KAAK,CAAC,GAAG,GAAG,KAAK,CAAC,KAAK,CAAC,MAAM,CAAC,YAAY,CAAC,GAAG,CAAC,CAAC;YACnD,CAAC;YACD,MAAM,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;YACnB,OAAO,KAAK,CAAC;QACf,CAAC;IACH,CAAC;CACF","sourcesContent":["// Copyright 2014 The Chromium Authors. All rights reserved.\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\n/* eslint-disable @typescript-eslint/no-explicit-any */\n\nimport * as i18n from '../../core/i18n/i18n.js';\nimport type * as Protocol from '../../generated/protocol.js';\nimport * as Trace from '../trace/trace.js';\n\nconst UIStrings = {\n  /**\n   *@description Text for the name of a thread of the page\n   *@example {1} PH1\n   */\n  threadS: 'Thread {PH1}',\n};\nconst str_ = i18n.i18n.registerUIStrings('models/timeline_model/TimelineJSProfile.ts', UIStrings);\nconst i18nString = i18n.i18n.getLocalizedString.bind(undefined, str_);\nexport class TimelineJSProfileProcessor {\n  static isNativeRuntimeFrame(frame: Protocol.Runtime.CallFrame): boolean {\n    return frame.url === 'native V8Runtime';\n  }\n\n  static nativeGroup(nativeName: string): string|null {\n    if (nativeName.startsWith('Parse')) {\n      return TimelineJSProfileProcessor.NativeGroups.PARSE;\n    }\n    if (nativeName.startsWith('Compile') || nativeName.startsWith('Recompile')) {\n      return TimelineJSProfileProcessor.NativeGroups.COMPILE;\n    }\n    return null;\n  }\n\n  static createFakeTraceFromCpuProfile(profile: Protocol.Profiler.Profile, tid: Trace.Types.Events.ThreadID):\n      Trace.Types.Events.Event[] {\n    const events: Trace.Types.Events.Event[] = [];\n\n    const threadName = i18nString(UIStrings.threadS, {PH1: tid});\n    appendEvent('TracingStartedInPage', {data: {sessionId: '1'}}, 0, 0, Trace.Types.Events.Phase.METADATA);\n    appendEvent(\n        Trace.Types.Events.Name.THREAD_NAME, {name: threadName}, 0, 0, Trace.Types.Events.Phase.METADATA, '__metadata');\n    if (!profile) {\n      return events;\n    }\n\n    // Append a root to show the start time of the profile (which is earlier than first sample), so the Performance\n    // panel won't truncate this time period.\n    // 'JSRoot' doesn't exist in the new engine and is not the name of an actual trace event, but changing it might break other trace processing tools that rely on this, so we stick with this name.\n    // TODO(crbug.com/341234884): consider removing this or clarify why it's required.\n    appendEvent(\n        'JSRoot', {}, profile.startTime, profile.endTime - profile.startTime, Trace.Types.Events.Phase.COMPLETE,\n        'toplevel');\n\n    // TODO: create a `Profile` event instead, as `cpuProfile` is legacy\n    appendEvent('CpuProfile', {data: {cpuProfile: profile}}, profile.endTime, 0, Trace.Types.Events.Phase.COMPLETE);\n    return events;\n\n    function appendEvent(\n        name: string, args: any, ts: number, dur?: number, ph?: Trace.Types.Events.Phase,\n        cat?: string): Trace.Types.Events.Event {\n      const event: Trace.Types.Events.Event = {\n        cat: cat || 'disabled-by-default-devtools.timeline',\n        name,\n        ph: ph || Trace.Types.Events.Phase.COMPLETE,\n        pid: Trace.Types.Events.ProcessID(1),\n        tid,\n        ts: Trace.Types.Timing.MicroSeconds(ts),\n        args,\n      };\n\n      if (dur) {\n        event.dur = Trace.Types.Timing.MicroSeconds(dur);\n      }\n      events.push(event);\n      return event;\n    }\n  }\n}\n\nexport namespace TimelineJSProfileProcessor {\n  export const enum NativeGroups {\n    COMPILE = 'Compile',\n    PARSE = 'Parse',\n  }\n}\n"]}