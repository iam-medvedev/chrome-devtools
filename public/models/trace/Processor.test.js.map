{"version":3,"file":"Processor.test.js","sourceRoot":"","sources":["../../../../../../front_end/models/trace/Processor.test.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright 2023 The Chromium Authors. All rights reserved.\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport {describeWithEnvironment} from '../../testing/EnvironmentHelpers.js';\nimport {TraceLoader} from '../../testing/TraceLoader.js';\nimport * as Trace from '../trace/trace.js';\n\ndescribeWithEnvironment('TraceProcessor', function() {\n  it('can use a trace processor', async function() {\n    const processor = Trace.Processor.TraceProcessor.createWithAllHandlers();\n    const file = await TraceLoader.rawEvents(this, 'basic.json.gz');\n\n    // Check parsing after instantiation.\n    assert.isNull(processor.parsedTrace);\n    await processor.parse(file, {isFreshRecording: true, isCPUProfile: false});\n    assert.isNotNull(processor.parsedTrace);\n\n    // Check parsing without a reset.\n    let thrown;\n    try {\n      await processor.parse(file, {isFreshRecording: true, isCPUProfile: false});\n    } catch (e) {\n      thrown = e as Error;\n    }\n    assert.strictEqual(\n        thrown?.message, 'Trace processor can\\'t start parsing when not idle. Current state: FINISHED_PARSING');\n\n    // Check parsing after reset.\n    processor.reset();\n    assert.isNull(processor.parsedTrace);\n    assert.isNull(processor.insights);\n    await processor.parse(file, {isFreshRecording: true, isCPUProfile: false});\n    assert.isNotNull(processor.parsedTrace);\n    assert.isNotNull(processor.insights);\n    // Cleanup.\n    processor.reset();\n\n    // Check simultaneous parsing without waiting.\n    let promise;\n    try {\n      promise = processor.parse(file, {isFreshRecording: true, isCPUProfile: false});\n      await processor.parse(file, {isFreshRecording: true, isCPUProfile: false});\n\n    } catch (e) {\n      thrown = e as Error;\n    } finally {\n      // Cleanup.\n      await promise;\n      processor.reset();\n    }\n    assert.strictEqual(thrown?.message, 'Trace processor can\\'t start parsing when not idle. Current state: PARSING');\n\n    // Check if data is null immediately after resetting.\n    assert.isNull(processor.parsedTrace);\n    assert.isNull(processor.insights);\n    await processor.parse(file, {isFreshRecording: true, isCPUProfile: false});\n    assert.isNotNull(processor.parsedTrace);\n    assert.isNotNull(processor.insights);\n    processor.reset();\n    assert.isNull(processor.parsedTrace);\n    assert.isNull(processor.insights);\n\n    // Check resetting while parsing.\n    try {\n      promise = processor.parse(file, {isFreshRecording: true, isCPUProfile: false});\n      processor.reset();\n    } catch (e) {\n      thrown = e as Error;\n    } finally {\n      // Cleanup.\n      await promise;\n      processor.reset();\n    }\n    assert.strictEqual(thrown?.message, 'Trace processor can\\'t reset while parsing.');\n\n    // Check parsing after resetting while parsing.\n    assert.isNull(processor.parsedTrace);\n    assert.isNull(processor.insights);\n    await processor.parse(file, {isFreshRecording: true, isCPUProfile: false});\n    assert.isNotNull(processor.parsedTrace);\n    assert.isNotNull(processor.insights);\n  });\n\n  it('can be given a subset of handlers to run and will run just those along with the meta handler', async function() {\n    const processor = new Trace.Processor.TraceProcessor({\n      Animations: Trace.Handlers.ModelHandlers.Animations,\n    });\n    const events = await TraceLoader.rawEvents(this, 'animation.json.gz');\n    await processor.parse(events, {isFreshRecording: true, isCPUProfile: false});\n    assert.isNotNull(processor.parsedTrace);\n    assert.deepEqual(Object.keys(processor.parsedTrace || {}), ['Meta', 'Animations']);\n  });\n\n  it('does not error if the user does not enable the Meta handler when it is a dependency', async function() {\n    assert.doesNotThrow(() => {\n      new Trace.Processor.TraceProcessor({\n        // Screenshots handler depends on Meta handler, so this is invalid.\n        // However, the Processor automatically ensures the Meta handler is\n        // enabled, so this should not cause an error.\n        Screenshots: Trace.Handlers.ModelHandlers.Screenshots,\n      });\n    });\n  });\n\n  it('errors if the user does not provide the right handler dependencies', async function() {\n    assert.throws(() => {\n      new Trace.Processor.TraceProcessor({\n        Renderer: Trace.Handlers.ModelHandlers.Renderer,\n        // Invalid: the renderer depends on the samples handler, so the user should pass that in too.\n      });\n    }, /Required handler Samples not provided/);\n  });\n\n  it('emits periodic trace updates', async function() {\n    const processor = new Trace.Processor.TraceProcessor(\n        {\n          Renderer: Trace.Handlers.ModelHandlers.Renderer,\n          Samples: Trace.Handlers.ModelHandlers.Samples,\n          AuctionWorklets: Trace.Handlers.ModelHandlers.AuctionWorklets,\n          NetworkRequests: Trace.Handlers.ModelHandlers.NetworkRequests,\n        },\n        Trace.Types.Configuration.defaults());\n\n    let updateEventCount = 0;\n\n    processor.addEventListener(Trace.Processor.TraceParseProgressEvent.eventName, () => {\n      updateEventCount++;\n    });\n\n    const rawEvents = await TraceLoader.rawEvents(this, 'web-dev-outermost-frames.json.gz');\n    // This trace has 106,110 events. At default of 50k chunks we should see 2 updates.\n    // Additional progress updates are emitted for handers, etc.\n    await processor.parse(rawEvents, {isFreshRecording: true, isCPUProfile: false}).then(() => {\n      assert.isAtLeast(updateEventCount, 2);\n    });\n  });\n\n  describe('handler sorting', () => {\n    const baseHandler = {\n      data() {},\n      handleEvent() {},\n      async finalize() {},\n      reset() {},\n    };\n\n    function fillHandlers(handlersDeps: {[key: string]: {deps ? () : Trace.Handlers.Types.HandlerName[]}}):\n        {[key: string]: Trace.Handlers.Types.Handler} {\n      const handlers: {[key: string]: Trace.Handlers.Types.Handler} = {};\n      for (const handler in handlersDeps) {\n        handlers[handler] = {...baseHandler, ...handlersDeps[handler]};\n      }\n      return handlers;\n    }\n\n    it('sorts handlers satisfying their dependencies 1', function() {\n      const handlersDeps: {[key: string]: {deps ? () : Trace.Handlers.Types.HandlerName[]}} = {\n        Meta: {},\n        GPU: {\n          deps() {\n            return ['Meta'];\n          },\n        },\n        LayoutShifts: {\n          deps() {\n            return ['GPU'];\n          },\n        },\n        NetworkRequests: {\n          deps() {\n            return ['LayoutShifts'];\n          },\n        },\n        PageLoadMetrics: {\n          deps() {\n            return ['Renderer', 'GPU'];\n          },\n        },\n        Renderer: {\n          deps() {\n            return ['Screenshots'];\n          },\n        },\n        Screenshots: {\n          deps() {\n            return ['NetworkRequests', 'LayoutShifts'];\n          },\n        },\n      };\n      const handlers = fillHandlers(handlersDeps);\n\n      const expectedOrder =\n          ['Meta', 'GPU', 'LayoutShifts', 'NetworkRequests', 'Screenshots', 'Renderer', 'PageLoadMetrics'];\n      assert.deepEqual([...Trace.Processor.sortHandlers(handlers).keys()], expectedOrder);\n    });\n    it('sorts handlers satisfying their dependencies 2', function() {\n      const handlersDeps: {[key: string]: {deps ? () : Trace.Handlers.Types.HandlerName[]}} = {\n        GPU: {\n          deps() {\n            return ['LayoutShifts', 'NetworkRequests'];\n          },\n        },\n        LayoutShifts: {\n          deps() {\n            return ['NetworkRequests'];\n          },\n        },\n        NetworkRequests: {},\n      };\n      const handlers = fillHandlers(handlersDeps);\n\n      const expectedOrder = ['NetworkRequests', 'LayoutShifts', 'GPU'];\n      assert.deepEqual([...Trace.Processor.sortHandlers(handlers).keys()], expectedOrder);\n    });\n    it('throws an error when a dependency cycle is present among handlers', function() {\n      const handlersDeps: {[key: string]: {deps ? () : Trace.Handlers.Types.HandlerName[]}} = {\n        Meta: {},\n        GPU: {\n          deps() {\n            return ['Meta'];\n          },\n        },\n        LayoutShifts: {\n          deps() {\n            return ['GPU', 'Renderer'];\n          },\n        },\n        NetworkRequests: {\n          deps() {\n            return ['LayoutShifts'];\n          },\n        },\n        Renderer: {\n          deps() {\n            return ['NetworkRequests'];\n          },\n        },\n      };\n      const handlers = fillHandlers(handlersDeps);\n      const cyclePath = 'LayoutShifts->Renderer->NetworkRequests->LayoutShifts';\n      assert.throws(\n          () => Trace.Processor.sortHandlers(handlers), `Found dependency cycle in trace event handlers: ${cyclePath}`);\n    });\n  });\n\n  describe('insights', () => {\n    it('returns a single group of insights even if no navigations', async function() {\n      const processor = Trace.Processor.TraceProcessor.createWithAllHandlers();\n      const file = await TraceLoader.rawEvents(this, 'basic.json.gz');\n\n      await processor.parse(file, {isFreshRecording: true, isCPUProfile: false});\n      if (!processor.insights) {\n        throw new Error('No insights');\n      }\n\n      assert.strictEqual(processor.insights.size, 1);\n      assert.deepEqual([...processor.insights.keys()], [Trace.Types.Events.NO_NAVIGATION]);\n    });\n\n    it('captures errors thrown by insights', async function() {\n      sinon.stub(Trace.Processor.TraceProcessor, 'getInsightRunners').callsFake(() => {\n        return {\n          ...Trace.Insights.Models,\n          RenderBlocking: {\n            // eslint-disable-next-line @typescript-eslint/no-explicit-any\n            UIStrings: {} as any,\n            // eslint-disable-next-line @typescript-eslint/no-explicit-any\n            i18nString: (() => {}) as any,\n            isRenderBlocking: (x: unknown): x is Trace.Insights.Models.RenderBlocking.RenderBlockingInsightModel =>\n                false,\n            generateInsight: () => {\n              throw new Error('forced error');\n            },\n          },\n        };\n      });\n\n      const processor = Trace.Processor.TraceProcessor.createWithAllHandlers();\n      const file = await TraceLoader.rawEvents(this, 'load-simple.json.gz');\n\n      await processor.parse(file, {isFreshRecording: true, isCPUProfile: false});\n      if (!processor.insights) {\n        throw new Error('No insights');\n      }\n\n      const insights = Array.from(processor.insights.values());\n      assert.lengthOf(insights, 2);\n      assert.instanceOf(insights[1].model.RenderBlocking, Error, 'RenderBlocking did not throw an error');\n      assert.strictEqual(insights[1].model.RenderBlocking.message, 'forced error');\n    });\n\n    it('returns insights for a navigation', async function() {\n      const processor = Trace.Processor.TraceProcessor.createWithAllHandlers();\n      const file = await TraceLoader.rawEvents(this, 'load-simple.json.gz');\n\n      await processor.parse(file, {isFreshRecording: true, isCPUProfile: false});\n      if (!processor.insights) {\n        throw new Error('No insights');\n      }\n\n      assert.deepEqual([...processor.insights.keys()], [\n        Trace.Types.Events.NO_NAVIGATION,\n        '0BCFC23BC7D7BEDC9F93E912DCCEC1DA',\n      ]);\n\n      const insights = Array.from(processor.insights.values());\n      if (insights[0].model.RenderBlocking instanceof Error) {\n        throw new Error('RenderBlocking threw an error');\n      }\n      if (insights[1].model.RenderBlocking instanceof Error) {\n        throw new Error('RenderBlocking threw an error');\n      }\n\n      assert.lengthOf(insights[0].model.RenderBlocking.renderBlockingRequests, 0);\n      assert.lengthOf(insights[1].model.RenderBlocking.renderBlockingRequests, 2);\n    });\n\n    it('returns insights for multiple navigations', async function() {\n      const processor = Trace.Processor.TraceProcessor.createWithAllHandlers();\n      const file = await TraceLoader.rawEvents(this, 'multiple-navigations.json.gz');\n\n      await processor.parse(file, {isFreshRecording: true, isCPUProfile: false});\n      if (!processor.insights) {\n        throw new Error('No insights');\n      }\n\n      assert.deepEqual([...processor.insights.keys()], [\n        Trace.Types.Events.NO_NAVIGATION,\n        '83ACBFD389F1F66EF79CEDB4076EB44A',\n        '70BCD304FD2C098BA2513488AB0FF3F2',\n        '71CF0F2B9FE50F2CB31B261D129D06E8',\n      ]);\n\n      const insights = Array.from(processor.insights.values());\n      if (insights[0].model.RenderBlocking instanceof Error) {\n        throw new Error('RenderBlocking threw an error');\n      }\n      if (insights[1].model.RenderBlocking instanceof Error) {\n        throw new Error('RenderBlocking threw an error');\n      }\n      if (insights[2].model.RenderBlocking instanceof Error) {\n        throw new Error('RenderBlocking threw an error');\n      }\n      if (insights[3].model.RenderBlocking instanceof Error) {\n        throw new Error('RenderBlocking threw an error');\n      }\n\n      assert.lengthOf(insights[0].model.RenderBlocking.renderBlockingRequests, 0);\n      assert.lengthOf(insights[1].model.RenderBlocking.renderBlockingRequests, 0);\n      assert.lengthOf(insights[2].model.RenderBlocking.renderBlockingRequests, 0);\n      assert.lengthOf(insights[3].model.RenderBlocking.renderBlockingRequests, 1);\n    });\n\n    it('sorts insights by estimated savings and field data', async function() {\n      const getInsightOrder = async (includeMetadata: boolean) => {\n        const processor = Trace.Processor.TraceProcessor.createWithAllHandlers();\n        const file = await TraceLoader.rawEvents(this, 'image-delivery.json.gz');\n\n        let metadata;\n        if (includeMetadata) {\n          metadata = await TraceLoader.metadata(this, 'image-delivery.json.gz');\n        }\n\n        await processor.parse(file, {isFreshRecording: true, isCPUProfile: false, metadata});\n        if (!processor.insights) {\n          throw new Error('No insights');\n        }\n\n        const insightSet = Array.from(processor.insights.values()).at(-1);\n        if (!insightSet) {\n          throw new Error('No insight set');\n        }\n\n        // It's been sorted already ... but let's add some fake estimated savings and re-sort to\n        // better test the sorting.\n        insightSet.model.CLSCulprits.metricSavings = {CLS: 0.07};\n        processor.sortInsightSet(processor.insights, insightSet, metadata ?? null);\n\n        return Object.keys(insightSet.model);\n      };\n\n      const orderWithoutMetadata = await getInsightOrder(false);\n      assert.deepEqual(orderWithoutMetadata, [\n        'CLSCulprits',\n        'Viewport',\n        'InteractionToNextPaint',\n        'LCPPhases',\n        'LCPDiscovery',\n        'RenderBlocking',\n        'NetworkDependencyTree',\n        'ImageDelivery',\n        'DocumentLatency',\n        'FontDisplay',\n        'DOMSize',\n        'ThirdParties',\n        'DuplicatedJavaScript',\n        'SlowCSSSelector',\n        'ForcedReflow',\n        'Cache',\n        'ModernHTTP',\n        'LegacyJavaScript',\n      ]);\n\n      const orderWithMetadata = await getInsightOrder(true);\n      // Viewport is first, before CLSCulprits, since the field data produces a higher weight for INP than for CLS.\n      assert.deepEqual(orderWithMetadata, [\n        'Viewport',\n        'CLSCulprits',\n        'InteractionToNextPaint',\n        'LCPPhases',\n        'LCPDiscovery',\n        'RenderBlocking',\n        'NetworkDependencyTree',\n        'ImageDelivery',\n        'DocumentLatency',\n        'FontDisplay',\n        'DOMSize',\n        'ThirdParties',\n        'DuplicatedJavaScript',\n        'SlowCSSSelector',\n        'ForcedReflow',\n        'Cache',\n        'ModernHTTP',\n        'LegacyJavaScript',\n      ]);\n    });\n  });\n});\n"]}