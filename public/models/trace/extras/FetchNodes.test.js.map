{"version":3,"file":"FetchNodes.test.js","sourceRoot":"","sources":["../../../../../../../front_end/models/trace/extras/FetchNodes.test.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright 2023 The Chromium Authors. All rights reserved.\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport * as SDK from '../../../core/sdk/sdk.js';\nimport type * as Protocol from '../../../generated/protocol.js';\nimport {createTarget} from '../../../testing/EnvironmentHelpers.js';\nimport {\n  clearAllMockConnectionResponseHandlers,\n  clearMockConnectionResponseHandler,\n  describeWithMockConnection,\n  setMockConnectionResponseHandler,\n} from '../../../testing/MockConnection.js';\nimport {TraceLoader} from '../../../testing/TraceLoader.js';\nimport * as Trace from '../trace.js';\n\nfunction nodeId<T extends Protocol.DOM.BackendNodeId|Protocol.DOM.NodeId>(x: number): T {\n  return x as T;\n}\n\ndescribeWithMockConnection('FetchNodes', function() {\n  beforeEach(async () => {\n    clearAllMockConnectionResponseHandlers();\n    Trace.Extras.FetchNodes.clearCacheForTesting();\n  });\n\n  describe('DOMNodeLookup', function() {\n    it('returns the DOM Node for the given node ID', async function() {\n      // Create a mock target, dom model, document and node.\n      const target = createTarget();\n      const domModel = target.model(SDK.DOMModel.DOMModel);\n      assert.exists(domModel);\n      const documentNode = {nodeId: nodeId(1)};\n      const domNode = new SDK.DOMModel.DOMNode(domModel);\n      domNode.id = nodeId(2);\n\n      // Set related CDP methods responses to return our mock document and node.\n      setMockConnectionResponseHandler('DOM.pushNodesByBackendIdsToFrontend', () => ({nodeIds: [domNode.id]}));\n      setMockConnectionResponseHandler('DOM.getDocument', () => ({root: documentNode}));\n\n      // Register the mock document and node in DOMModel, these use the mock responses set above.\n      await domModel.requestDocument();\n      domModel.registerNode(domNode);\n\n      const {parsedTrace} = await TraceLoader.traceEngine(this, 'cls-single-frame.json.gz');\n      const result = await Trace.Extras.FetchNodes.domNodeForBackendNodeID(parsedTrace, nodeId(2));\n      assert.strictEqual(result, domNode);\n\n      // Clear the mock and re-set it to return nothing to test the bad path.\n      clearMockConnectionResponseHandler('DOM.pushNodesByBackendIdsToFrontend');\n      setMockConnectionResponseHandler('DOM.pushNodesByBackendIdsToFrontend', () => ({nodeIds: []}));\n      const doesNotExistResult = await Trace.Extras.FetchNodes.domNodeForBackendNodeID(parsedTrace, nodeId(99));\n      assert.isNull(doesNotExistResult);\n    });\n\n    it('caches the call and does not look up a node more than once per model data', async () => {\n      // Create a mock target, dom model, document and node.\n      const target = createTarget();\n      const domModel = target.model(SDK.DOMModel.DOMModel);\n      assert.exists(domModel);\n      const documentNode = {nodeId: nodeId(1)};\n      const domNode = new SDK.DOMModel.DOMNode(domModel);\n      domNode.id = nodeId(2);\n      const pushNodesSpy = sinon.spy(domModel, 'pushNodesByBackendIdsToFrontend');\n\n      // Set related CDP methods responses to return our mock document and node.\n      setMockConnectionResponseHandler('DOM.pushNodesByBackendIdsToFrontend', () => ({nodeIds: [domNode.id]}));\n      setMockConnectionResponseHandler('DOM.getDocument', () => ({root: documentNode}));\n      await domModel.requestDocument();\n      domModel.registerNode(domNode);\n\n      // The model data is only used as a cache key, so we don't need it to be real to test this.\n      const modelData1 = {} as unknown as Trace.Handlers.Types.ParsedTrace;\n      const modelData2 = {} as unknown as Trace.Handlers.Types.ParsedTrace;\n      const result = await Trace.Extras.FetchNodes.domNodeForBackendNodeID(modelData1, nodeId(2));\n      assert.isNotNull(result);\n      // Look it up again to test the cache.\n      await Trace.Extras.FetchNodes.domNodeForBackendNodeID(modelData1, nodeId(2));\n      await Trace.Extras.FetchNodes.domNodeForBackendNodeID(modelData2, nodeId(2));\n      // The call with the new model data did not hit the cache.\n      assert.strictEqual(pushNodesSpy.callCount, 2);\n    });\n\n    it('can look up multiple nodes at once', async () => {\n      // Create a mock target, dom model, document and node.\n      const target = createTarget();\n      const domModel = target.model(SDK.DOMModel.DOMModel);\n      assert.exists(domModel);\n      const documentNode = {nodeId: nodeId(1)};\n      const domNodeId2 = new SDK.DOMModel.DOMNode(domModel);\n      domNodeId2.id = nodeId(2);\n      const domNodeId3 = new SDK.DOMModel.DOMNode(domModel);\n      domNodeId3.id = nodeId(3);\n\n      // Set related CDP methods responses to return our mock document and node.\n      setMockConnectionResponseHandler(\n          'DOM.pushNodesByBackendIdsToFrontend', () => ({nodeIds: [domNodeId2.id, domNodeId3.id]}));\n      setMockConnectionResponseHandler('DOM.getDocument', () => ({root: documentNode}));\n      await domModel.requestDocument();\n      domModel.registerNode(domNodeId2);\n      domModel.registerNode(domNodeId3);\n\n      // The model data is only used as a cache key, so we don't need it to be real to test this.\n      const modelData = {} as unknown as Trace.Handlers.Types.ParsedTrace;\n      const result = await Trace.Extras.FetchNodes.domNodesForMultipleBackendNodeIds(modelData, [nodeId(2), nodeId(3)]);\n      assert.isNotNull(result);\n      const entries = Array.from(result.entries());\n      assert.deepEqual(entries, [\n        [nodeId<Protocol.DOM.BackendNodeId>(2), domNodeId2],\n        [nodeId<Protocol.DOM.BackendNodeId>(3), domNodeId3],\n      ]);\n    });\n  });\n\n  describe('nodeIdsForEvent', () => {\n    it('identifies node ids for a Layout event', async function() {\n      const {parsedTrace} = await TraceLoader.traceEngine(this, 'web-dev-with-commit.json.gz');\n      const layoutEvent = parsedTrace.Renderer.allTraceEntries.find(Trace.Types.Events.isLayout);\n      assert.isOk(layoutEvent);\n      const nodeIds = Trace.Extras.FetchNodes.nodeIdsForEvent(parsedTrace, layoutEvent);\n      assert.deepEqual(Array.from(nodeIds), [2]);\n    });\n\n    it('identifies node ids for a LayoutShift event', async function() {\n      const {parsedTrace} = await TraceLoader.traceEngine(this, 'web-dev-initial-url.json.gz');\n      const layoutShiftEvent = parsedTrace.LayoutShifts.clusters[0].events.at(0);\n      assert.isOk(layoutShiftEvent);\n      const nodeIds = Trace.Extras.FetchNodes.nodeIdsForEvent(parsedTrace, layoutShiftEvent);\n      assert.deepEqual(Array.from(nodeIds), [\n        193,\n        195,\n        178,\n        189,\n        188,\n      ]);\n    });\n\n    it('identifies node ids for a Paint event', async function() {\n      const {parsedTrace} = await TraceLoader.traceEngine(this, 'web-dev-initial-url.json.gz');\n      const paintEvent = parsedTrace.Renderer.allTraceEntries.find(Trace.Types.Events.isPaint);\n      assert.isOk(paintEvent);\n      const nodeIds = Trace.Extras.FetchNodes.nodeIdsForEvent(parsedTrace, paintEvent);\n      assert.deepEqual(Array.from(nodeIds), [75]);\n    });\n\n    it('identifies node ids for a PaintImage event', async function() {\n      const {parsedTrace} = await TraceLoader.traceEngine(this, 'web-dev-initial-url.json.gz');\n      const paintImageEvent = parsedTrace.Renderer.allTraceEntries.find(Trace.Types.Events.isPaintImage);\n      assert.isOk(paintImageEvent);\n      const nodeIds = Trace.Extras.FetchNodes.nodeIdsForEvent(parsedTrace, paintImageEvent);\n      assert.deepEqual(Array.from(nodeIds), [107]);\n    });\n\n    it('identifies node ids for a ScrollLayer event', async function() {\n      // This trace chosen as it happens to have ScrollLayer events, unlike the\n      // web-dev traces used in tests above.\n      const {parsedTrace} = await TraceLoader.traceEngine(this, 'extension-tracks-and-marks.json.gz');\n      const scrollLayerEvent = parsedTrace.Renderer.allTraceEntries.find(Trace.Types.Events.isScrollLayer);\n      assert.isOk(scrollLayerEvent);\n      const nodeIds = Trace.Extras.FetchNodes.nodeIdsForEvent(parsedTrace, scrollLayerEvent);\n      assert.deepEqual(Array.from(nodeIds), [4]);\n    });\n\n    it('identifies node ids for a DecodeImage event', async function() {\n      const {parsedTrace} = await TraceLoader.traceEngine(this, 'web-dev.json.gz');\n      const decodeImageEvent = parsedTrace.Renderer.allTraceEntries.find(Trace.Types.Events.isDecodeImage);\n      assert.isOk(decodeImageEvent);\n      const nodeIds = Trace.Extras.FetchNodes.nodeIdsForEvent(parsedTrace, decodeImageEvent);\n      assert.deepEqual(Array.from(nodeIds), [240]);\n    });\n\n    it('identifies node ids for a DrawLazyPixelRef event', async function() {\n      const {parsedTrace} = await TraceLoader.traceEngine(this, 'web-dev.json.gz');\n      const drawLazyPixelRefEvent = parsedTrace.Renderer.allTraceEntries.find(Trace.Types.Events.isDrawLazyPixelRef);\n      assert.isOk(drawLazyPixelRefEvent);\n      const nodeIds = Trace.Extras.FetchNodes.nodeIdsForEvent(parsedTrace, drawLazyPixelRefEvent);\n      assert.deepEqual(Array.from(nodeIds), [212]);\n    });\n\n    it('identifies node ids for a MarkLCP event', async function() {\n      const {parsedTrace} = await TraceLoader.traceEngine(this, 'web-dev.json.gz');\n      const lcpCandidateEvent =\n          parsedTrace.PageLoadMetrics.allMarkerEvents.find(Trace.Types.Events.isLargestContentfulPaintCandidate);\n      assert.isOk(lcpCandidateEvent);\n      const nodeIds = Trace.Extras.FetchNodes.nodeIdsForEvent(parsedTrace, lcpCandidateEvent);\n      assert.deepEqual(Array.from(nodeIds), [209]);\n    });\n  });\n\n  describe('LayoutShifts', () => {\n    it('returns a list of sources for the given event', async () => {\n      // Create a mock target, dom model, document and node.\n      const target = createTarget();\n      const domModel = target.model(SDK.DOMModel.DOMModel);\n      assert.exists(domModel);\n      const documentNode = {nodeId: 1 as Protocol.DOM.NodeId};\n      const domNode = new SDK.DOMModel.DOMNode(domModel);\n      domNode.id = 2 as Protocol.DOM.NodeId;\n\n      // Set related CDP methods responses to return our mock document and node.\n      setMockConnectionResponseHandler('DOM.pushNodesByBackendIdsToFrontend', () => ({nodeIds: [domNode.id]}));\n      setMockConnectionResponseHandler('DOM.getDocument', () => ({root: documentNode}));\n\n      // Register the mock document and node in DOMModel, these use the mock responses set above.\n      await domModel.requestDocument();\n      domModel.registerNode(domNode);\n\n      const modelData = {} as unknown as Trace.Handlers.Types.ParsedTrace;\n      const event = {\n        args: {\n          data: {\n            impacted_nodes: [{\n              node_id: 1 as Protocol.DOM.BackendNodeId,\n              old_rect: [0, 0, 10, 10],\n              new_rect: [0, 0, 20, 20],\n            }],\n          },\n        },\n      } as unknown as Trace.Types.Events.LayoutShift;\n      const sources = await Trace.Extras.FetchNodes.sourcesForLayoutShift(modelData, event);\n      assert.lengthOf(sources, 1);\n      assert.deepEqual(sources.at(0), {\n        node: domNode,\n        previousRect: new DOMRect(0, 0, 10, 10),\n        currentRect: new DOMRect(0, 0, 20, 20),\n      });\n    });\n\n    it('returns normalized nodes if we can calculate the window.devicePixelRatio', async () => {\n      createTarget();\n      setMockConnectionResponseHandler('Runtime.evaluate', () => ({result: {value: 4, type: 'number'}}));\n      const impactedNodes: Trace.Types.Events.TraceImpactedNode[] = [\n        {\n          new_rect: [0, 0, 40, 80],\n          node_id: 1 as Protocol.DOM.BackendNodeId,\n          old_rect: [20, 20, 40, 80],\n        },\n        {\n          new_rect: [10, 10, 10, 10],\n          node_id: 1 as Protocol.DOM.BackendNodeId,\n          old_rect: [0, 0, 10, 10],\n        },\n      ];\n      const mockShift = {args: {data: {impacted_nodes: impactedNodes}}} as Trace.Types.Events.LayoutShift;\n      const modelData = {} as unknown as Trace.Handlers.Types.ParsedTrace;\n      const normalized = await Trace.Extras.FetchNodes.normalizedImpactedNodesForLayoutShift(modelData, mockShift);\n      assert.deepEqual(normalized, [\n        {\n          new_rect: [0, 0, 10, 20],\n          node_id: 1 as Protocol.DOM.BackendNodeId,\n          old_rect: [5, 5, 10, 20],\n        },\n        {\n          new_rect: [2.5, 2.5, 2.5, 2.5],\n          node_id: 1 as Protocol.DOM.BackendNodeId,\n          old_rect: [0, 0, 2.5, 2.5],\n        },\n      ]);\n    });\n  });\n});\n"]}