{"version":3,"file":"ScriptsHandler.test.js","sourceRoot":"","sources":["../../../../../../../front_end/models/trace/handlers/ScriptsHandler.test.ts"],"names":[],"mappings":"AAAA,4DAA4D;AAC5D,yEAAyE;AACzE,6BAA6B;AAI7B,OAAO,EAAC,WAAW,EAAC,MAAM,iCAAiC,CAAC;AAC5D,OAAO,KAAK,KAAK,MAAM,aAAa,CAAC;AAErC,QAAQ,CAAC,gBAAgB,EAAE,GAAG,EAAE;IAC9B,UAAU,CAAC,KAAK;QACd,KAAK,CAAC,QAAQ,CAAC,aAAa,CAAC,IAAI,CAAC,KAAK,EAAE,CAAC;QAC1C,KAAK,CAAC,QAAQ,CAAC,aAAa,CAAC,OAAO,CAAC,KAAK,EAAE,CAAC;QAC7C,MAAM,MAAM,GAAG,MAAM,WAAW,CAAC,SAAS,CAAC,IAAI,EAAE,yBAAyB,CAAC,CAAC;QAC5E,KAAK,MAAM,KAAK,IAAI,MAAM,EAAE,CAAC;YAC3B,KAAK,CAAC,QAAQ,CAAC,aAAa,CAAC,IAAI,CAAC,WAAW,CAAC,KAAK,CAAC,CAAC;YACrD,KAAK,CAAC,QAAQ,CAAC,aAAa,CAAC,OAAO,CAAC,WAAW,CAAC,KAAK,CAAC,CAAC;QAC1D,CAAC;QACD,MAAM,KAAK,CAAC,QAAQ,CAAC,aAAa,CAAC,IAAI,CAAC,QAAQ,EAAE,CAAC;QACnD,MAAM,KAAK,CAAC,QAAQ,CAAC,aAAa,CAAC,OAAO,CAAC,QAAQ,CAAC;YAClD,KAAK,CAAC,gBAAgB,CAAC,MAAwD;gBAEzE,4CAA4C;gBAC5C,OAAO,EAAC,IAAI,EAAE,MAAM,CAAC,YAAY,EAAuC,CAAC;YAC3E,CAAC;SACN,CAAC,CAAC;IACL,CAAC,CAAC,CAAC;IAEH,SAAS,CAAC,GAAG,EAAE;QACb,KAAK,CAAC,QAAQ,CAAC,aAAa,CAAC,OAAO,CAAC,KAAK,EAAE,CAAC;IAC/C,CAAC,CAAC,CAAC;IAEH,EAAE,CAAC,2BAA2B,EAAE,KAAK;QACnC,MAAM,IAAI,GAAG,KAAK,CAAC,QAAQ,CAAC,aAAa,CAAC,OAAO,CAAC,IAAI,EAAE,CAAC;QACzD,MAAM,CAAC,SAAS,CAAC,CAAC,GAAG,IAAI,CAAC,OAAO,CAAC,MAAM,EAAE,CAAC,EAAE;YAC3C;gBACE,QAAQ,EAAE,GAAG;gBACb,KAAK,EAAE,kCAAkC;gBACzC,EAAE,EAAE,WAAW;gBACf,GAAG,EAAE,kCAAkC;gBACvC,OAAO,EAAE,QAAQ;gBACjB,YAAY,EAAE,uCAAuC;gBACrD,SAAS,EAAE,EAAC,IAAI,EAAE,uCAAuC,EAAC;aAC3D;YACD;gBACE,QAAQ,EAAE,GAAG;gBACb,KAAK,EAAE,kCAAkC;gBACzC,EAAE,EAAE,WAAW;gBACf,GAAG,EAAE,kCAAkC;gBACvC,OAAO,EAAE,eAAe;aACzB;SACF,CAAC,CAAC;IACL,CAAC,CAAC,CAAC;AACL,CAAC,CAAC,CAAC","sourcesContent":["// Copyright 2025 The Chromium Authors. All rights reserved.\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\n// eslint-disable-next-line rulesdir/no-imports-in-directory\nimport type * as SDK from '../../../core/sdk/sdk.js';\nimport {TraceLoader} from '../../../testing/TraceLoader.js';\nimport * as Trace from '../trace.js';\n\ndescribe('ScriptsHandler', () => {\n  beforeEach(async function() {\n    Trace.Handlers.ModelHandlers.Meta.reset();\n    Trace.Handlers.ModelHandlers.Scripts.reset();\n    const events = await TraceLoader.rawEvents(this, 'enhanced-traces.json.gz');\n    for (const event of events) {\n      Trace.Handlers.ModelHandlers.Meta.handleEvent(event);\n      Trace.Handlers.ModelHandlers.Scripts.handleEvent(event);\n    }\n    await Trace.Handlers.ModelHandlers.Meta.finalize();\n    await Trace.Handlers.ModelHandlers.Scripts.finalize({\n      async resolveSourceMap(params: Trace.Types.Configuration.ResolveSourceMapParams):\n          Promise<SDK.SourceMap.SourceMap> {\n            // Don't need to actually make a source map.\n            return {test: params.sourceMapUrl} as unknown as SDK.SourceMap.SourceMap;\n          }\n    });\n  });\n\n  afterEach(() => {\n    Trace.Handlers.ModelHandlers.Scripts.reset();\n  });\n\n  it('collects scripts contents', async function() {\n    const data = Trace.Handlers.ModelHandlers.Scripts.data();\n    assert.deepEqual([...data.scripts.values()], [\n      {\n        scriptId: '1',\n        frame: '3E1717BE677B75D0536E292E00D6A34A',\n        ts: 50442438976,\n        url: 'http://localhost:8080/index.html',\n        content: ' text ',\n        sourceMapUrl: 'http://localhost:8080/source.map.json',\n        sourceMap: {test: 'http://localhost:8080/source.map.json'}\n      },\n      {\n        scriptId: '2',\n        frame: '21D58E83A5C17916277166140F6A464B',\n        ts: 50442438976,\n        url: 'http://localhost:8080/index.html',\n        content: 'source text 2'\n      },\n    ]);\n  });\n});\n"]}