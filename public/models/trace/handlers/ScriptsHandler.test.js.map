{"version":3,"file":"ScriptsHandler.test.js","sourceRoot":"","sources":["../../../../../../../front_end/models/trace/handlers/ScriptsHandler.test.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright 2025 The Chromium Authors\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport type * as SDK from '../../../core/sdk/sdk.js';\nimport {TraceLoader} from '../../../testing/TraceLoader.js';\nimport * as Trace from '../trace.js';\n\ndescribe('ScriptsHandler', () => {\n  beforeEach(async function() {\n    Trace.Handlers.ModelHandlers.Meta.reset();\n    Trace.Handlers.ModelHandlers.NetworkRequests.reset();\n    Trace.Handlers.ModelHandlers.Scripts.reset();\n    const events = await TraceLoader.rawEvents(this, 'enhanced-traces.json');\n    for (const event of events) {\n      Trace.Handlers.ModelHandlers.Meta.handleEvent(event);\n      Trace.Handlers.ModelHandlers.NetworkRequests.handleEvent(event);\n      Trace.Handlers.ModelHandlers.Scripts.handleEvent(event);\n    }\n    await Trace.Handlers.ModelHandlers.Meta.finalize();\n    await Trace.Handlers.ModelHandlers.NetworkRequests.finalize();\n    await Trace.Handlers.ModelHandlers.Scripts.finalize({\n      allTraceEvents: events,\n      async resolveSourceMap(params: Trace.Types.Configuration.ResolveSourceMapParams):\n          Promise<SDK.SourceMap.SourceMap> {\n            // Don't need to actually make a source map.\n            return {test: params.sourceMapUrl} as unknown as SDK.SourceMap.SourceMap;\n          }\n    });\n  });\n\n  afterEach(() => {\n    Trace.Handlers.ModelHandlers.Scripts.reset();\n  });\n\n  it('collects scripts contents', async function() {\n    const data = Trace.Handlers.ModelHandlers.Scripts.data();\n    assert.deepEqual([...data.scripts], [\n      {\n        frame: '',\n        inline: true,\n        isolate: '12345',\n        request: undefined,\n        scriptId: '3',\n        sourceMapUrl: 'http://localhost:8080/source.map.json',\n        ts: 50442438976,\n        url: 'http://localhost:8080/index.html',\n      },\n      {\n        frame: '',\n        inline: true,\n        isolate: '12345',\n        request: undefined,\n        scriptId: '4',\n        sourceMapUrl: 'http://localhost:8080/source.map.json',\n        ts: 50442438976,\n        url: 'http://localhost:8080/index.html',\n      },\n      {\n        frame: '',\n        inline: true,\n        isolate: '1357',\n        request: undefined,\n        scriptId: '1',\n        sourceMapUrl: 'http://localhost:8080/source.map.json',\n        ts: 50442438976,\n        url: 'http://localhost:8080/index.html',\n      },\n      {\n        isolate: '12345',\n        scriptId: '1',\n        frame: '21D58E83A5C17916277166140F6A464B',\n        request: undefined,\n        ts: 50442438976,\n        inline: true,\n        url: 'http://localhost:8080/index.html',\n        content: 'source text 1',\n        sourceMapUrl: 'http://localhost:8080/source.map.json',\n        sourceMap: {test: 'http://localhost:8080/source.map.json'}\n      },\n      {\n        isolate: '12345',\n        scriptId: '2',\n        frame: '21D58E83A5C17916277166140F6A464B',\n        request: undefined,\n        ts: 50442438976,\n        inline: true,\n        url: 'http://localhost:8080/index.html',\n        content: 'source text 2'\n      },\n      {\n        isolate: '6789',\n        scriptId: '1',\n        frame: '3E1717BE677B75D0536E292E00D6A34A',\n        content: ' text ',\n        request: undefined,\n        ts: 50442438976,\n        inline: true,\n        url: 'http://localhost:8080/index.html',\n      },\n    ]);\n  });\n});\n"]}