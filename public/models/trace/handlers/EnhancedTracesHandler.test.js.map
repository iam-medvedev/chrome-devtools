{"version":3,"file":"EnhancedTracesHandler.test.js","sourceRoot":"","sources":["../../../../../../../front_end/models/trace/handlers/EnhancedTracesHandler.test.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright 2024 The Chromium Authors. All rights reserved.\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport {TraceLoader} from '../../../testing/TraceLoader.js';\nimport * as TraceEngine from '../trace.js';\n\ndescribe('EnhancedTracesHandler', () => {\n  beforeEach(async function() {\n    TraceEngine.Handlers.ModelHandlers.EnhancedTraces.reset();\n    const events = await TraceLoader.rawEvents(this, 'enhanced-traces.json.gz');\n    TraceEngine.Handlers.ModelHandlers.EnhancedTraces.initialize();\n    for (const event of events) {\n      TraceEngine.Handlers.ModelHandlers.EnhancedTraces.handleEvent(event);\n    }\n    await TraceEngine.Handlers.ModelHandlers.EnhancedTraces.finalize();\n  });\n  afterEach(() => {\n    TraceEngine.Handlers.ModelHandlers.EnhancedTraces.reset();\n  });\n\n  it('captures targets from target rundown events', async function() {\n    const data = TraceEngine.Handlers.ModelHandlers.EnhancedTraces.data();\n    assert.deepEqual(data.targets, [\n      {\n        targetId: '21D58E83A5C17916277166140F6A464B',\n        type: 'page',\n        isolate: '12345',\n        pid: 8050,\n        url: 'http://localhost:8080/index.html',\n      },\n      {\n        targetId: '3E1717BE677B75D0536E292E00D6A34A',\n        type: 'page',\n        isolate: '6789',\n        pid: 8051,\n        url: 'http://localhost:8080/index.html',\n      },\n    ]);\n  });\n\n  it('captures execution context info', async function() {\n    const data = TraceEngine.Handlers.ModelHandlers.EnhancedTraces.data();\n    assert.deepEqual(data.executionContexts, [\n      {\n        id: 1,\n        origin: 'http://localhost:8080',\n        v8Context: 'example context 1',\n        auxData: {\n          frameId: '21D58E83A5C17916277166140F6A464B',\n          isDefault: true,\n          type: 'type',\n        },\n        isolate: '12345',\n      },\n      {\n        id: 2,\n        origin: 'http://localhost:8080',\n        v8Context: 'example context 2',\n        auxData: {\n          frameId: '21D58E83A5C17916277166140F6A464B',\n          isDefault: true,\n          type: 'type',\n        },\n        isolate: '12345',\n      },\n      {\n        id: 1,\n        origin: 'http://localhost:8080',\n        v8Context: 'example context 3',\n        auxData: {\n          frameId: '3E1717BE677B75D0536E292E00D6A34A',\n          isDefault: true,\n          type: 'type',\n        },\n        isolate: '6789',\n      },\n    ]);\n  });\n\n  it('captures script info and source text', async function() {\n    const data = TraceEngine.Handlers.ModelHandlers.EnhancedTraces.data();\n    assert.deepEqual(data.scripts, [\n      {\n        scriptId: 1,\n        isolate: '12345',\n        executionContextId: 1,\n        startLine: 0,\n        startColumn: 0,\n        endLine: 1,\n        endColumn: 10,\n        hash: '',\n        isModule: false,\n        url: 'http://localhost:8080/index.html',\n        hasSourceUrl: false,\n        sourceMapUrl: 'http://localhost:8080/source',\n        length: 13,\n        sourceText: 'source text 1',\n        auxData: {\n          frameId: '21D58E83A5C17916277166140F6A464B',\n          isDefault: true,\n          type: 'type',\n        },\n      },\n      {\n        scriptId: 2,\n        isolate: '12345',\n        executionContextId: 2,\n        startLine: 0,\n        startColumn: 0,\n        endLine: 1,\n        endColumn: 10,\n        hash: '',\n        isModule: false,\n        url: 'http://localhost:8080/index.html',\n        hasSourceUrl: false,\n        sourceMapUrl: undefined,\n        length: 13,\n        sourceText: 'source text 2',\n        auxData: {\n          frameId: '21D58E83A5C17916277166140F6A464B',\n          isDefault: true,\n          type: 'type',\n        },\n      },\n      {\n        scriptId: 1,\n        isolate: '6789',\n        executionContextId: 1,\n        startLine: 0,\n        startColumn: 0,\n        endLine: 1,\n        endColumn: 10,\n        hash: '',\n        isModule: false,\n        url: 'http://localhost:8080/index.html',\n        hasSourceUrl: false,\n        sourceMapUrl: undefined,\n        length: 13,\n        sourceText: 'source text 3',\n        auxData: {\n          frameId: '3E1717BE677B75D0536E292E00D6A34A',\n          isDefault: true,\n          type: 'type',\n        },\n      },\n    ]);\n  });\n});\n"]}