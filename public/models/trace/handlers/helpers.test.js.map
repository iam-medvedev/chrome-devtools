{"version":3,"file":"helpers.test.js","sourceRoot":"","sources":["../../../../../../../front_end/models/trace/handlers/helpers.test.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright 2024 The Chromium Authors\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport {describeWithEnvironment} from '../../../testing/EnvironmentHelpers.js';\nimport {allThreadEntriesInTrace} from '../../../testing/TraceHelpers.js';\nimport {TraceLoader} from '../../../testing/TraceLoader.js';\nimport * as Trace from '../trace.js';\n\ndescribeWithEnvironment('getNonResolvedURL', () => {\n  it('returns the URL in event.args.data if it has one', async function() {\n    const parsedTrace = await TraceLoader.traceEngine(this, 'web-dev-with-commit.json.gz');\n    const commitLoadEvent = allThreadEntriesInTrace(parsedTrace).find(Trace.Types.Events.isCommitLoad);\n    assert.isOk(commitLoadEvent);\n    const url = Trace.Handlers.Helpers.getNonResolvedURL(commitLoadEvent, parsedTrace.data);\n    assert.isNotNull(url);\n    assert.strictEqual(url, commitLoadEvent.args.data?.url);\n  });\n\n  it('returns the URL for a ProfileCall from the callframe', async function() {\n    const parsedTrace = await TraceLoader.traceEngine(this, 'web-dev-with-commit.json.gz');\n    const profileCall = allThreadEntriesInTrace(parsedTrace).find(Trace.Types.Events.isProfileCall);\n    assert.isOk(profileCall);\n    const url = Trace.Handlers.Helpers.getNonResolvedURL(profileCall, parsedTrace.data);\n    assert.isNotNull(url);\n    assert.strictEqual(url, profileCall.callFrame.url);\n  });\n\n  it('parses out the URL For a ParseAuthorStyleSheet', async function() {\n    const parsedTrace = await TraceLoader.traceEngine(this, 'web-dev-with-commit.json.gz');\n    const parseStyle = allThreadEntriesInTrace(parsedTrace).find(Trace.Types.Events.isParseAuthorStyleSheetEvent);\n    assert.isOk(parseStyle);\n    const url = Trace.Handlers.Helpers.getNonResolvedURL(parseStyle, parsedTrace.data);\n    assert.strictEqual(url, parseStyle.args?.data.url);\n  });\n\n  it('uses the request URL for a network request', async function() {\n    const parsedTrace = await TraceLoader.traceEngine(this, 'web-dev-with-commit.json.gz');\n    const request = parsedTrace.data.NetworkRequests.byTime[0];\n    assert.isOk(request);\n    const url = Trace.Handlers.Helpers.getNonResolvedURL(request, parsedTrace.data);\n    assert.isNotNull(url);\n    assert.strictEqual(url, request.args.data.url);\n  });\n\n  it('for a generic event with a stackTrace property, it uses the URL of the top frame', async function() {\n    const parsedTrace = await TraceLoader.traceEngine(this, 'web-dev-with-commit.json.gz');\n    const eventDispatch = allThreadEntriesInTrace(parsedTrace).find(entry => {\n      return Trace.Types.Events.isDispatch(entry) && entry.args.data.stackTrace;\n    });\n    assert.isOk(eventDispatch);\n    const url = Trace.Handlers.Helpers.getNonResolvedURL(eventDispatch, parsedTrace.data);\n    assert.isNotNull(url);\n    assert.strictEqual(url, eventDispatch.args?.data?.stackTrace?.[0].url);\n  });\n\n  it('finds the URL for a ParseHTML event', async function() {\n    const parsedTrace = await TraceLoader.traceEngine(this, 'web-dev-with-commit.json.gz');\n    const parseHTMLEvent = allThreadEntriesInTrace(parsedTrace).find(Trace.Types.Events.isParseHTML);\n    assert.isOk(parseHTMLEvent);\n    const url = Trace.Handlers.Helpers.getNonResolvedURL(parseHTMLEvent, parsedTrace.data);\n    assert.isNotNull(url);\n    assert.strictEqual(url, parseHTMLEvent.args.beginData.url);\n  });\n\n  it('uses the PaintImage URL for a DecodeImage event', async function() {\n    const parsedTrace = await TraceLoader.traceEngine(this, 'web-dev.json.gz');\n    const decodeImage = allThreadEntriesInTrace(parsedTrace).find(Trace.Types.Events.isDecodeImage);\n    assert.isOk(decodeImage);\n    const url = Trace.Handlers.Helpers.getNonResolvedURL(decodeImage, parsedTrace.data);\n    assert.isNotNull(url);\n    assert.strictEqual(\n        url, 'https://web-dev.imgix.net/image/admin/WkMOiDtaDgiAA2YkRZ5H.jpg?fit=crop&h=64&w=64&dpr=1&q=75');\n  });\n});\ndescribeWithEnvironment('makeUpEntity', () => {\n  it('correctly makes up entities', async function() {\n    const expectedEntities = new Map<string, string>([\n      ['http://localhost:8080/', 'localhost'],\n      ['https://fonts.googleapis.com/css2?family=Orelega+One&display=swap', 'googleapis.com'],\n      ['https://emp.bbci.co.uk/emp/bump-4/bump-4.js', 'bbci.co.uk'],\n      ['http://localhost:8080/blocking.js', 'localhost'],\n      ['https://fonts.gstatic.com/s/orelegaone/v1/3qTpojOggD2XtAdFb-QXZFt93kY.woff2', 'gstatic.com'],\n      ['chrome-extension://chromeextension/something/exciting.js', 'chromeextension'],\n    ]);\n\n    for (const [url, expectedEntity] of expectedEntities.entries()) {\n      const gotEntity =\n          Trace.Handlers.Helpers.makeUpEntity(new Map<string, Trace.Extras.ThirdParties.Entity>(), url)?.name ?? '';\n      assert.deepEqual(gotEntity, expectedEntity);\n    }\n  });\n  it('correctly makes up chrome extension entity', async function() {\n    const url = 'chrome-extension://chromeextension/something/exciting.js';\n    const gotEntity = Trace.Handlers.Helpers.makeUpEntity(new Map<string, Trace.Extras.ThirdParties.Entity>(), url);\n    assert.exists(gotEntity);\n\n    assert.deepEqual(gotEntity.name, 'chromeextension');\n    assert.deepEqual(gotEntity.category, 'Chrome Extension');\n    assert.deepEqual(gotEntity.homepage, 'https://chromewebstore.google.com/detail/chromeextension');\n  });\n});\n"]}