{"version":3,"file":"AnimationFramesHandler.test.js","sourceRoot":"","sources":["../../../../../../../front_end/models/trace/handlers/AnimationFramesHandler.test.ts"],"names":[],"mappings":"AAAA,4DAA4D;AAC5D,yEAAyE;AACzE,6BAA6B;AAC7B,OAAO,EAAC,WAAW,EAAC,MAAM,iCAAiC,CAAC;AAC5D,OAAO,KAAK,KAAK,MAAM,aAAa,CAAC;AAErC,KAAK,UAAU,WAAW,CAAC,MAA2C;IACpE,KAAK,CAAC,QAAQ,CAAC,aAAa,CAAC,eAAe,CAAC,KAAK,EAAE,CAAC;IACrD,KAAK,CAAC,QAAQ,CAAC,aAAa,CAAC,eAAe,CAAC,gBAAgB,CAAC;QAC5D,GAAG,KAAK,CAAC,KAAK,CAAC,aAAa,CAAC,QAAQ,EAAE;QACvC,4BAA4B,EAAE,IAAI;KACnC,CAAC,CAAC;IAEH,KAAK,MAAM,KAAK,IAAI,MAAM,EAAE,CAAC;QAC3B,KAAK,CAAC,QAAQ,CAAC,aAAa,CAAC,eAAe,CAAC,WAAW,CAAC,KAAK,CAAC,CAAC;IAClE,CAAC;IACD,MAAM,KAAK,CAAC,QAAQ,CAAC,aAAa,CAAC,eAAe,CAAC,QAAQ,EAAE,CAAC;AAChE,CAAC;AAED,QAAQ,CAAC,wBAAwB,EAAE,GAAG,EAAE;IACtC,EAAE,CAAC,8CAA8C,EAAE,KAAK;QACtD,MAAM,MAAM,GAAG,MAAM,WAAW,CAAC,SAAS,CAAC,IAAI,EAAE,kCAAkC,CAAC,CAAC;QACrF,MAAM,WAAW,CAAC,MAAM,CAAC,CAAC;QAC1B,MAAM,IAAI,GAAG,KAAK,CAAC,QAAQ,CAAC,aAAa,CAAC,eAAe,CAAC,IAAI,EAAE,CAAC;QACjE,MAAM,CAAC,QAAQ,CAAC,IAAI,CAAC,eAAe,EAAE,EAAE,CAAC,CAAC;QAC1C,MAAM,UAAU,GAAG,IAAI,CAAC,eAAe,CAAC,CAAC,CAAC,CAAC;QAC3C,MAAM,CAAC,WAAW,CAAC,UAAU,CAAC,IAAI,CAAC,IAAI,CAAC,UAAU,CAAC,IAAI,EAAE,2BAA2B,CAAC,WAAW,EAAE,EAAE,CAAC,CAAC;QACtG,MAAM,CAAC,WAAW,CAAC,UAAU,CAAC,GAAG,EAAE,KAAK,CAAC,KAAK,CAAC,MAAM,CAAC,KAAK,CAAC,KAAK,CAAC,CAAC,CAAC;IACtE,CAAC,CAAC,CAAC;IAEH,EAAE,CAAC,oDAAoD,EAAE,KAAK;QAC5D,MAAM,MAAM,GAAG,MAAM,WAAW,CAAC,SAAS,CAAC,IAAI,EAAE,kCAAkC,CAAC,CAAC;QACrF,MAAM,WAAW,CAAC,MAAM,CAAC,CAAC;QAC1B,MAAM,IAAI,GAAG,KAAK,CAAC,QAAQ,CAAC,aAAa,CAAC,eAAe,CAAC,IAAI,EAAE,CAAC;QACjE,MAAM,UAAU,GAAG,IAAI,CAAC,eAAe,CAAC,CAAC,CAAC,CAAC;QAC3C,MAAM,iBAAiB,GAAG,IAAI,CAAC,oBAAoB,CAAC,GAAG,CAAC,UAAU,CAAC,CAAC;QACpE,MAAM,CAAC,SAAS,CAAC,iBAAiB,CAAC,CAAC;QACpC,MAAM,CAAC,WAAW,CAAC,iBAAiB,CAAC,IAAI,EAAE,EAAE,EAAE,UAAU,CAAC,IAAI,CAAC,IAAI,CAAC,UAAU,CAAC,IAAI,EAAE,EAAE,CAAC,CAAC;IAC3F,CAAC,CAAC,CAAC;AACL,CAAC,CAAC,CAAC","sourcesContent":["// Copyright 2024 The Chromium Authors. All rights reserved.\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\nimport {TraceLoader} from '../../../testing/TraceLoader.js';\nimport * as Trace from '../trace.js';\n\nasync function parseEvents(events: readonly Trace.Types.Events.Event[]) {\n  Trace.Handlers.ModelHandlers.AnimationFrames.reset();\n  Trace.Handlers.ModelHandlers.AnimationFrames.handleUserConfig({\n    ...Trace.Types.Configuration.defaults(),\n    enableAnimationsFrameHandler: true,\n  });\n\n  for (const event of events) {\n    Trace.Handlers.ModelHandlers.AnimationFrames.handleEvent(event);\n  }\n  await Trace.Handlers.ModelHandlers.AnimationFrames.finalize();\n}\n\ndescribe('AnimationFramesHandler', () => {\n  it('can group all related animation frame events', async function() {\n    const events = await TraceLoader.rawEvents(this, 'web-dev-animation-frames.json.gz');\n    await parseEvents(events);\n    const data = Trace.Handlers.ModelHandlers.AnimationFrames.data();\n    assert.lengthOf(data.animationFrames, 32);\n    const firstFrame = data.animationFrames[0];\n    assert.strictEqual(firstFrame.args.data.beginEvent.args?.animation_frame_timing_info.duration_ms, 76);\n    assert.strictEqual(firstFrame.dur, Trace.Types.Timing.Micro(76038));\n  });\n\n  it('links an animation frame to its presentation event', async function() {\n    const events = await TraceLoader.rawEvents(this, 'web-dev-animation-frames.json.gz');\n    await parseEvents(events);\n    const data = Trace.Handlers.ModelHandlers.AnimationFrames.data();\n    const firstFrame = data.animationFrames[0];\n    const presentationEvent = data.presentationForFrame.get(firstFrame);\n    assert.isDefined(presentationEvent);\n    assert.strictEqual(presentationEvent.args?.id, firstFrame.args.data.beginEvent.args?.id);\n  });\n});\n"]}