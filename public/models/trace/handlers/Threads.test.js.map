{"version":3,"file":"Threads.test.js","sourceRoot":"","sources":["../../../../../../../front_end/models/trace/handlers/Threads.test.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright 2023 The Chromium Authors. All rights reserved.\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport {describeWithEnvironment} from '../../../testing/EnvironmentHelpers.js';\nimport {TraceLoader} from '../../../testing/TraceLoader.js';\nimport * as Trace from '../trace.js';\n\ndescribeWithEnvironment('Handler Threads helper', function() {\n  it('returns all the threads for a trace that used tracing', async function() {\n    const {parsedTrace} = await TraceLoader.traceEngine(this, 'web-dev.json.gz');\n\n    const allThreads = Array.from(parsedTrace.Renderer.processes.values()).flatMap(process => {\n      return Array.from(process.threads.values());\n    });\n\n    const expectedThreadNamesAndTypes = [\n      {name: 'CrRendererMain', type: Trace.Handlers.Threads.ThreadType.MAIN_THREAD},\n      {name: 'Chrome_ChildIOThread', type: Trace.Handlers.Threads.ThreadType.OTHER},\n      {name: 'Compositor', type: Trace.Handlers.Threads.ThreadType.OTHER},\n      {name: 'ThreadPoolServiceThread', type: Trace.Handlers.Threads.ThreadType.THREAD_POOL},\n      {name: 'Media', type: Trace.Handlers.Threads.ThreadType.OTHER},\n      {name: 'ThreadPoolForegroundWorker', type: Trace.Handlers.Threads.ThreadType.THREAD_POOL},\n      {name: 'CompositorTileWorker4', type: Trace.Handlers.Threads.ThreadType.RASTERIZER},\n      {name: 'CompositorTileWorker2', type: Trace.Handlers.Threads.ThreadType.RASTERIZER},\n      {name: 'CompositorTileWorker1', type: Trace.Handlers.Threads.ThreadType.RASTERIZER},\n      {name: 'CompositorTileWorkerBackground', type: Trace.Handlers.Threads.ThreadType.RASTERIZER},\n      {name: 'ThreadPoolForegroundWorker', type: Trace.Handlers.Threads.ThreadType.THREAD_POOL},\n      {name: 'CompositorTileWorker3', type: Trace.Handlers.Threads.ThreadType.RASTERIZER},\n    ];\n\n    const threads = Trace.Handlers.Threads.threadsInTrace(parsedTrace);\n    assert.strictEqual(threads.length, allThreads.length);\n    assert.deepEqual(threads.map(thread => ({name: thread.name, type: thread.type})), expectedThreadNamesAndTypes);\n  });\n\n  it('returns all the threads for a trace that used CPU profiling', async function() {\n    // Bit of extra setup required: we need to mimic what the panel does where\n    // it takes the CDP Profile and wraps it in fake trace events, before then\n    // passing that through to the new engine.\n    const profile = await TraceLoader.rawCPUProfile(this, 'node-fibonacci-website.cpuprofile.gz');\n    const contents = Trace.Helpers.SamplesIntegrator.SamplesIntegrator.createFakeTraceFromCpuProfile(\n        profile,\n        Trace.Types.Events.ThreadID(1),\n    );\n\n    const {parsedTrace} = await TraceLoader.executeTraceEngineOnFileContents(contents);\n\n    // Check that we did indeed parse this properly as a CPU Profile.\n    assert.strictEqual(parsedTrace.Renderer.processes.size, 0);\n    assert.strictEqual(parsedTrace.Samples.profilesInProcess.size, 1);\n\n    const threads = Trace.Handlers.Threads.threadsInTrace(parsedTrace);\n    assert.lengthOf(threads, 1);\n\n    assert.strictEqual(threads.at(0)?.type, Trace.Handlers.Threads.ThreadType.CPU_PROFILE);\n    assert.strictEqual(threads.at(0)?.entries.length, 875);\n  });\n});\n"]}