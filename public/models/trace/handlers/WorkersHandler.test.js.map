{"version":3,"file":"WorkersHandler.test.js","sourceRoot":"","sources":["../../../../../../../front_end/models/trace/handlers/WorkersHandler.test.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright 2023 The Chromium Authors\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport {TraceLoader} from '../../../testing/TraceLoader.js';\nimport * as Trace from '../trace.js';\n\ndescribe('WorkersHandler', () => {\n  beforeEach(async function() {\n    Trace.Handlers.ModelHandlers.Workers.reset();\n    const events = await TraceLoader.rawEvents(this, 'two-workers.json.gz');\n    for (const event of events) {\n      Trace.Handlers.ModelHandlers.Workers.handleEvent(event);\n    }\n    await Trace.Handlers.ModelHandlers.Workers.finalize();\n  });\n  afterEach(() => {\n    Trace.Handlers.ModelHandlers.Workers.reset();\n  });\n\n  it('collects the worker session ID metadata events', async function() {\n    const data = Trace.Handlers.ModelHandlers.Workers.data();\n    assert.deepEqual(data.workerSessionIdEvents, [\n      {\n        name: 'TracingSessionIdForWorker',\n        cat: 'disabled-by-default-devtools.timeline',\n        ph: Trace.Types.Events.Phase.INSTANT,\n        tid: Trace.Types.Events.ThreadID(37651),\n        pid: Trace.Types.Events.ProcessID(71044),\n        s: Trace.Types.Events.Scope.THREAD,\n        ts: Trace.Types.Timing.Micro(107351291649),\n        tts: Trace.Types.Timing.Micro(934),\n        args: {\n          data: {\n            frame: '372333E30ECABDA706136ED37FD9FA2B',\n            url: 'https://chromedevtools.github.io/performance-stories/two-workers/fib-worker.js',\n            workerId: Trace.Types.Events.WorkerId('990A76F8BED5B771144F505FF9313D06'),\n            workerThreadId: Trace.Types.Events.ThreadID(37651),\n          },\n        },\n      },\n      {\n        name: 'TracingSessionIdForWorker',\n        cat: 'disabled-by-default-devtools.timeline',\n        ph: Trace.Types.Events.Phase.INSTANT,\n        tid: Trace.Types.Events.ThreadID(35351),\n        pid: Trace.Types.Events.ProcessID(71044),\n        s: Trace.Types.Events.Scope.THREAD,\n        ts: Trace.Types.Timing.Micro(107351292507),\n        tts: Trace.Types.Timing.Micro(817),\n        args: {\n          data: {\n            frame: '372333E30ECABDA706136ED37FD9FA2B',\n            url: 'https://chromedevtools.github.io/performance-stories/two-workers/fib-worker.js',\n            workerId: Trace.Types.Events.WorkerId('E59E70C44C7664657CE822BB7DC54085'),\n            workerThreadId: Trace.Types.Events.ThreadID(35351),\n          },\n        },\n      },\n    ]);\n  });\n\n  it('collects thread id for workers', async function() {\n    const data = Trace.Handlers.ModelHandlers.Workers.data();\n    const [[thread1, worker1], [thread2, worker2]] = data.workerIdByThread.entries();\n    assert.strictEqual(thread1, 37651);\n    assert.strictEqual(worker1, '990A76F8BED5B771144F505FF9313D06');\n    assert.strictEqual(thread2, 35351);\n    assert.strictEqual(worker2, 'E59E70C44C7664657CE822BB7DC54085');\n  });\n\n  it('collects the url of workers', async function() {\n    const data = Trace.Handlers.ModelHandlers.Workers.data();\n    const [[thread1, worker1], [thread2, worker2]] = data.workerURLById.entries();\n    assert.strictEqual(thread1, '990A76F8BED5B771144F505FF9313D06');\n    assert.strictEqual(worker1, 'https://chromedevtools.github.io/performance-stories/two-workers/fib-worker.js');\n    assert.strictEqual(thread2, 'E59E70C44C7664657CE822BB7DC54085');\n    assert.strictEqual(worker2, 'https://chromedevtools.github.io/performance-stories/two-workers/fib-worker.js');\n  });\n});\n"]}