{"version":3,"file":"MetricTestUtils.js","sourceRoot":"","sources":["../../../../../../../../front_end/models/trace/lantern/testing/MetricTestUtils.ts"],"names":[],"mappings":"AAAA,sCAAsC;AACtC,yEAAyE;AACzE,6BAA6B;AAE7B,4FAA4F;AAC5F,mEAAmE;AACnE,uDAAuD;AACvD,OAAO,KAAK,WAAW,MAAM,oCAAoC,CAAC;AAClE,OAAO,KAAK,KAAK,MAAM,gBAAgB,CAAC;AACxC,OAAO,KAAK,OAAO,MAAM,eAAe,CAAC;AAEzC,SAAS,cAAc,CAAC,WAAgD;IACtE,OAAO;QACL,WAAW,EAAE,WAAoD;KAClE,CAAC;AACJ,CAAC;AAED,KAAK,UAAU,iBAAiB,CAAC,OAAkC,EAAE,KAA0B;IAC7F,WAAW,CAAC,WAAW,CAAC,cAAc,CAAC,OAAO,CAAC,CAAC;IAEhD,MAAM,SAAS,GAAG,KAAK,CAAC,SAAS,CAAC,cAAc,CAAC,qBAAqB,EAAE,CAAC;IACzE,MAAM,SAAS,CAAC,KAAK,CAAC,KAAK,CAAC,WAAyC,EAAE,EAAC,YAAY,EAAE,KAAK,EAAE,gBAAgB,EAAE,IAAI,EAAC,CAAC,CAAC;IACtH,IAAI,CAAC,SAAS,CAAC,IAAI,EAAE,CAAC;QACpB,MAAM,IAAI,KAAK,CAAC,SAAS,CAAC,CAAC;IAC7B,CAAC;IACD,OAAO,SAAS,CAAC,IAAI,CAAC;AACxB,CAAC;AAED,KAAK,UAAU,6BAA6B,CAAC,OAAkC,EAAE,EAAC,KAAK,EAAE,QAAQ,EAAE,GAAG,EAIrG;IACC,QAAQ,GAAG,QAAQ,IAAI,EAAuC,CAAC;IAC/D,IAAI,CAAC,QAAQ,CAAC,gBAAgB,EAAE,CAAC;QAC/B,QAAQ,CAAC,gBAAgB,GAAG,UAAU,CAAC;IACzC,CAAC;IACD,MAAM,IAAI,GAAG,MAAM,iBAAiB,CAAC,OAAO,EAAE,KAAK,CAAC,CAAC;IACrD,MAAM,QAAQ,GAAG,KAAK,CAAC,sBAAsB,CAAC,qBAAqB,CAAC,KAAK,EAAE,IAAI,CAAC,CAAC;IACjF,MAAM,eAAe,GAAG,OAAO,CAAC,IAAI,CAAC,eAAe,CAAC,OAAO,CAAC,QAAQ,CAAC,CAAC;IACvE,IAAI,CAAC,eAAe,EAAE,CAAC;QACrB,MAAM,IAAI,KAAK,CAAC,oBAAoB,CAAC,CAAC;IACxC,CAAC;IAED,MAAM,OAAO,GAAG,IAAI,CAAC,IAAI,CAAC,WAAW,CAAC;IACtC,MAAM,YAAY,GAAG,IAAI,CAAC,IAAI,CAAC,oBAAoB,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,IAAI,EAAE,YAAY,CAAC;IAC/E,IAAI,CAAC,YAAY,EAAE,CAAC;QAClB,MAAM,IAAI,KAAK,CAAC,wBAAwB,CAAC,CAAC;IAC5C,CAAC;IAED,OAAO;QACL,SAAS,EAAE,OAAO,CAAC,UAAU,CAAC,SAAS,CAAC,eAAe,CAAC,EAAC,GAAG,QAAQ,EAAE,eAAe,EAAC,CAAC;QACvF,KAAK,EAAE,KAAK,CAAC,sBAAsB,CAAC,WAAW,CAAC,QAAQ,EAAE,KAAK,EAAE,IAAI,EAAE,GAAG,CAAC;QAC3E,mBAAmB,EAAE,KAAK,CAAC,sBAAsB,CAAC,yBAAyB,CAAC,IAAI,EAAE,OAAO,EAAE,YAAY,CAAC;KACzG,CAAC;AACJ,CAAC;AAED,OAAO,EACL,6BAA6B,EAC7B,iBAAiB,IAAI,QAAQ,EAC7B,cAAc,GACf,CAAC","sourcesContent":["// Copyright 2024 The Chromium Authors\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\n// Unsure why this lint is failing, given `lantern/metrics/SpeedIndex.test.ts` does the same\n// and is fine. Maybe `*.test.*` files are excluded from this rule?\n// eslint-disable-next-line @devtools/es-modules-import\nimport * as TraceLoader from '../../../../testing/TraceLoader.js';\nimport * as Trace from '../../trace.js';\nimport * as Lantern from '../lantern.js';\n\nfunction toLanternTrace(traceEvents: readonly Trace.Types.Events.Event[]): Lantern.Types.Trace {\n  return {\n    traceEvents: traceEvents as unknown as Lantern.Types.TraceEvent[],\n  };\n}\n\nasync function runTraceProcessor(context: Mocha.Suite|Mocha.Context, trace: Lantern.Types.Trace) {\n  TraceLoader.TraceLoader.setTestTimeout(context);\n\n  const processor = Trace.Processor.TraceProcessor.createWithAllHandlers();\n  await processor.parse(trace.traceEvents as Trace.Types.Events.Event[], {isCPUProfile: false, isFreshRecording: true});\n  if (!processor.data) {\n    throw new Error('No data');\n  }\n  return processor.data;\n}\n\nasync function getComputationDataFromFixture(context: Mocha.Suite|Mocha.Context, {trace, settings, url}: {\n  trace: Lantern.Types.Trace,\n  settings?: Lantern.Types.Simulation.Settings,\n  url?: Lantern.Types.Simulation.URL,\n}) {\n  settings = settings ?? {} as Lantern.Types.Simulation.Settings;\n  if (!settings.throttlingMethod) {\n    settings.throttlingMethod = 'simulate';\n  }\n  const data = await runTraceProcessor(context, trace);\n  const requests = Trace.LanternComputationData.createNetworkRequests(trace, data);\n  const networkAnalysis = Lantern.Core.NetworkAnalyzer.analyze(requests);\n  if (!networkAnalysis) {\n    throw new Error('no networkAnalysis');\n  }\n\n  const frameId = data.Meta.mainFrameId;\n  const navigationId = data.Meta.mainFrameNavigations[0].args.data?.navigationId;\n  if (!navigationId) {\n    throw new Error('no navigation id found');\n  }\n\n  return {\n    simulator: Lantern.Simulation.Simulator.createSimulator({...settings, networkAnalysis}),\n    graph: Trace.LanternComputationData.createGraph(requests, trace, data, url),\n    processedNavigation: Trace.LanternComputationData.createProcessedNavigation(data, frameId, navigationId),\n  };\n}\n\nexport {\n  getComputationDataFromFixture,\n  runTraceProcessor as runTrace,\n  toLanternTrace,\n};\n"]}