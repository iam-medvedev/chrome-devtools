{"version":3,"file":"EditFileSystemView.test.js","sourceRoot":"","sources":["../../../../../../front_end/models/persistence/EditFileSystemView.test.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright 2025 The Chromium Authors. All rights reserved.\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport * as Platform from '../../core/platform/platform.js';\nimport {assertScreenshot, renderElementIntoDOM} from '../../testing/DOMHelpers.js';\nimport {describeWithEnvironment} from '../../testing/EnvironmentHelpers.js';\nimport {createViewFunctionStub} from '../../testing/ViewFunctionHelpers.js';\n\nimport * as Persistence from './persistence.js';\n\nconst {EditFileSystemView, ExcludedFolderStatus, DEFAULT_VIEW} = Persistence.EditFileSystemView;\nconst {urlString} = Platform.DevToolsPath;\n\ndescribeWithEnvironment('EditFileSystemView view', () => {\n  it('renders excluded sub-directories', async () => {\n    const target = document.createElement('div');\n    renderElementIntoDOM(target);\n\n    DEFAULT_VIEW(\n        {\n          fileSystemPath: urlString`file:///home/user/project`,\n          excludedFolderPaths: [\n            {path: '/foo/' as Platform.DevToolsPath.EncodedPathString, status: ExcludedFolderStatus.VALID},\n            {path: '/bar/' as Platform.DevToolsPath.EncodedPathString, status: ExcludedFolderStatus.VALID},\n          ],\n          onCreate: () => {},\n          onEdit: () => {},\n          onDelete: () => {},\n        },\n        {}, target);\n\n    await assertScreenshot('persistence/edit_file_system_basic.png');\n  });\n\n  it('renders errors for invalid sub-directories', async () => {\n    const target = document.createElement('div');\n    renderElementIntoDOM(target);\n\n    DEFAULT_VIEW(\n        {\n          fileSystemPath: urlString`file:///home/user/project`,\n          excludedFolderPaths: [\n            {path: '/foo/' as Platform.DevToolsPath.EncodedPathString, status: ExcludedFolderStatus.VALID},\n            {path: '' as Platform.DevToolsPath.EncodedPathString, status: ExcludedFolderStatus.ERROR_NOT_A_PATH},\n            {path: '/bar/' as Platform.DevToolsPath.EncodedPathString, status: ExcludedFolderStatus.VALID},\n            {path: '/foo/' as Platform.DevToolsPath.EncodedPathString, status: ExcludedFolderStatus.ERROR_NOT_UNIQUE},\n          ],\n          onCreate: () => {},\n          onEdit: () => {},\n          onDelete: () => {},\n        },\n        {}, target);\n\n    await assertScreenshot('persistence/edit_file_system_error.png');\n  });\n});\n\ndescribeWithEnvironment('EditFileSystemView widget', () => {\n  async function setup(initialExcludedFolders: Set<string>) {\n    const view = createViewFunctionStub(EditFileSystemView);\n    const widget = new EditFileSystemView(urlString`file:///home/user`, view);\n    const fileSystem = sinon.createStubInstance(Persistence.IsolatedFileSystem.IsolatedFileSystem);\n    sinon.stub(Persistence.IsolatedFileSystemManager.IsolatedFileSystemManager.instance(), 'fileSystem')\n        .returns(fileSystem);\n    fileSystem.excludedFolders.returns(initialExcludedFolders as Set<Platform.DevToolsPath.EncodedPathString>);\n\n    const container = document.createElement('div');\n    renderElementIntoDOM(container);\n    widget.markAsRoot();\n    widget.show(container);\n    await view.nextInput;\n\n    return {view, fileSystem};\n  }\n\n  it('shows the initial excluded sub-directories', async () => {\n    const {view} = await setup(new Set(['foo/', 'bar/']));\n\n    assert.strictEqual(view.input.fileSystemPath, urlString`file:///home/user`);\n    assert.deepEqual(view.input.excludedFolderPaths, [\n      {path: 'foo/' as Platform.DevToolsPath.EncodedPathString, status: ExcludedFolderStatus.VALID},\n      {path: 'bar/' as Platform.DevToolsPath.EncodedPathString, status: ExcludedFolderStatus.VALID},\n    ]);\n  });\n\n  it('adds new valid sub-directories to the file system', async () => {\n    const {view, fileSystem} = await setup(new Set());\n\n    view.input.onCreate(new CustomEvent('create', {detail: {url: 'foo'}}));\n\n    sinon.assert.calledOnceWithExactly(fileSystem.addExcludedFolder, 'foo/' as Platform.DevToolsPath.EncodedPathString);\n  });\n\n  it('shows empty sub-directory strings with an error and does not exclude it', async () => {\n    const {view, fileSystem} = await setup(new Set());\n\n    view.input.onCreate(new CustomEvent('create', {detail: {url: ''}}));\n\n    await view.nextInput;\n    assert.deepEqual(view.input.excludedFolderPaths, [\n      {path: '' as Platform.DevToolsPath.EncodedPathString, status: ExcludedFolderStatus.ERROR_NOT_A_PATH},\n    ]);\n    sinon.assert.notCalled(fileSystem.addExcludedFolder);\n  });\n\n  it('shows duplicate sub-directory strings with an error and does not re-exclude it', async () => {\n    const {view, fileSystem} = await setup(new Set(['foo/']));\n\n    view.input.onCreate(new CustomEvent('create', {detail: {url: 'foo'}}));\n\n    await view.nextInput;\n    assert.deepEqual(view.input.excludedFolderPaths, [\n      {path: 'foo/' as Platform.DevToolsPath.EncodedPathString, status: ExcludedFolderStatus.VALID},\n      {path: 'foo/' as Platform.DevToolsPath.EncodedPathString, status: ExcludedFolderStatus.ERROR_NOT_UNIQUE},\n    ]);\n    sinon.assert.notCalled(fileSystem.addExcludedFolder);\n  });\n\n  it('renders the new status when editing a sub-directory', async () => {\n    const {view} = await setup(new Set(['foo/']));\n    const node = document.createElement('tr');\n    node.setAttribute('data-index', '0');\n\n    view.input.onEdit(\n        new CustomEvent('edit', {detail: {node, columnId: 'url', valueBeforeEditing: 'foo/', newText: ''}}));\n\n    await view.nextInput;\n    assert.deepEqual(view.input.excludedFolderPaths, [\n      {path: '' as Platform.DevToolsPath.EncodedPathString, status: ExcludedFolderStatus.ERROR_NOT_A_PATH},\n    ]);\n  });\n\n  it('removes the old exclude when editing a valid sub-directory', async () => {\n    const {view, fileSystem} = await setup(new Set(['foo/']));\n    const node = document.createElement('tr');\n    node.setAttribute('data-index', '0');\n\n    view.input.onEdit(\n        new CustomEvent('edit', {detail: {node, columnId: 'url', valueBeforeEditing: 'foo/', newText: 'bar/'}}));\n\n    await view.nextInput;\n    sinon.assert.calledOnceWithExactly(\n        fileSystem.removeExcludedFolder, 'foo/' as Platform.DevToolsPath.EncodedPathString);\n  });\n\n  it('adds the new exclude when editing a sub-directory to a valid exclude', async () => {\n    const {view, fileSystem} = await setup(new Set(['foo/']));\n    const node = document.createElement('tr');\n    node.setAttribute('data-index', '0');\n\n    view.input.onEdit(\n        new CustomEvent('edit', {detail: {node, columnId: 'url', valueBeforeEditing: 'foo/', newText: 'bar/'}}));\n\n    await view.nextInput;\n    sinon.assert.calledOnceWithExactly(fileSystem.addExcludedFolder, 'bar/' as Platform.DevToolsPath.EncodedPathString);\n  });\n\n  it('removes the sub-directory from the list when deleting it', async () => {\n    const {view} = await setup(new Set(['foo/']));\n    const node = document.createElement('tr');\n    node.setAttribute('data-index', '0');\n\n    view.input.onDelete(new CustomEvent('delete', {detail: node}));\n\n    await view.nextInput;\n    assert.isEmpty(view.input.excludedFolderPaths);\n  });\n\n  it('removes the exclude when deleting a valid sub-directory', async () => {\n    const {view, fileSystem} = await setup(new Set(['foo/']));\n    const node = document.createElement('tr');\n    node.setAttribute('data-index', '0');\n\n    view.input.onDelete(new CustomEvent('delete', {detail: node}));\n\n    await view.nextInput;\n    sinon.assert.calledOnceWithExactly(\n        fileSystem.removeExcludedFolder, 'foo/' as Platform.DevToolsPath.EncodedPathString);\n  });\n});\n"]}