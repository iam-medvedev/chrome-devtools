{"version":3,"file":"WorkspaceSettingsTab.js","sourceRoot":"","sources":["../../../../../../front_end/models/persistence/WorkspaceSettingsTab.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright 2017 The Chromium Authors. All rights reserved.\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport '../../ui/components/cards/cards.js';\n\nimport * as i18n from '../../core/i18n/i18n.js';\nimport type * as Platform from '../../core/platform/platform.js';\nimport * as IconButton from '../../ui/components/icon_button/icon_button.js';\nimport * as UI from '../../ui/legacy/legacy.js';\nimport * as VisualLogging from '../../ui/visual_logging/visual_logging.js';\n\nimport {EditFileSystemView} from './EditFileSystemView.js';\nimport type {FileSystem} from './FileSystemWorkspaceBinding.js';\nimport {IsolatedFileSystem} from './IsolatedFileSystem.js';\nimport {Events, IsolatedFileSystemManager} from './IsolatedFileSystemManager.js';\nimport {NetworkPersistenceManager} from './NetworkPersistenceManager.js';\nimport type {PlatformFileSystem} from './PlatformFileSystem.js';\nimport workspaceSettingsTabStyles from './workspaceSettingsTab.css.js';\n\nconst UIStrings = {\n  /**\n   *@description Text of a DOM element in Workspace Settings Tab of the Workspace settings in Settings\n   */\n  workspace: 'Workspace',\n  /**\n   *@description Text of a DOM element in Workspace Settings Tab of the Workspace settings in Settings\n   */\n  mappingsAreInferredAutomatically: 'Mappings are inferred automatically.',\n  /**\n   *@description Text of the add button in Workspace Settings Tab of the Workspace settings in Settings\n   */\n  addFolder: 'Add folder',\n  /**\n   *@description Label element text content in Workspace Settings Tab of the Workspace settings in Settings\n   */\n  folderExcludePattern: 'Exclude from workspace',\n  /**\n   *@description Label for an item to remove something\n   */\n  remove: 'Remove',\n} as const;\nconst str_ = i18n.i18n.registerUIStrings('models/persistence/WorkspaceSettingsTab.ts', UIStrings);\nconst i18nString = i18n.i18n.getLocalizedString.bind(undefined, str_);\n\nexport class WorkspaceSettingsTab extends UI.Widget.VBox {\n  containerElement: HTMLElement;\n  #addButtonContainer: HTMLElement;\n  private readonly elementByPath: Map<Platform.DevToolsPath.UrlString, Element>;\n  private readonly mappingViewByPath: Map<Platform.DevToolsPath.UrlString, EditFileSystemView>;\n\n  constructor() {\n    super();\n    this.registerRequiredCSS(workspaceSettingsTabStyles);\n\n    this.element.setAttribute('jslog', `${VisualLogging.pane('workspace')}`);\n\n    this.containerElement =\n        this.contentElement.createChild('div', 'settings-card-container-wrapper').createChild('div');\n    this.containerElement.classList.add('settings-card-container');\n\n    IsolatedFileSystemManager.instance().addEventListener(\n        Events.FileSystemAdded, event => this.fileSystemAdded(event.data), this);\n    IsolatedFileSystemManager.instance().addEventListener(\n        Events.FileSystemRemoved, event => this.fileSystemRemoved(event.data), this);\n\n    const folderExcludePatternInput = this.createFolderExcludePatternInput();\n    folderExcludePatternInput.classList.add('folder-exclude-pattern');\n    const mappingsAreInferredInfo = document.createElement('div');\n    mappingsAreInferredInfo.classList.add('mappings-info');\n    UI.UIUtils.createTextChild(mappingsAreInferredInfo, i18nString(UIStrings.mappingsAreInferredAutomatically));\n\n    const card = this.containerElement.createChild('devtools-card');\n    card.heading = i18nString(UIStrings.workspace);\n    card.append(folderExcludePatternInput, mappingsAreInferredInfo);\n\n    this.elementByPath = new Map();\n    this.mappingViewByPath = new Map();\n\n    const fileSystems = IsolatedFileSystemManager.instance().fileSystems();\n    for (let i = 0; i < fileSystems.length; ++i) {\n      this.addItem(fileSystems[i]);\n    }\n\n    this.#addButtonContainer = this.containerElement.createChild('div', 'add-button-container');\n    const addButton = UI.UIUtils.createTextButton(\n        i18nString(UIStrings.addFolder), this.addFileSystemClicked.bind(this),\n        {jslogContext: 'sources.add-folder-to-workspace'});\n    addButton.classList.add('add-folder');\n    this.#addButtonContainer.appendChild(addButton);\n  }\n\n  private createFolderExcludePatternInput(): HTMLElement {\n    const excludePatternElement = document.createElement('div');\n    excludePatternElement.classList.add('folder-exclude-pattern');\n    const labelElement = excludePatternElement.createChild('label');\n    labelElement.textContent = i18nString(UIStrings.folderExcludePattern);\n    const folderExcludeSetting = IsolatedFileSystemManager.instance().workspaceFolderExcludePatternSetting();\n    const inputElement = UI.UIUtils.createInput('', 'text', folderExcludeSetting.name);\n    UI.ARIAUtils.bindLabelToControl(labelElement, inputElement);\n    excludePatternElement.appendChild(inputElement);\n    const setValue =\n        UI.UIUtils.bindInput(inputElement, folderExcludeSetting.set.bind(folderExcludeSetting), regexValidator, false);\n    folderExcludeSetting.addChangeListener(() => setValue.call(null, folderExcludeSetting.get()));\n    setValue(folderExcludeSetting.get());\n    return excludePatternElement;\n\n    function regexValidator(value: string): {valid: boolean, errorMessage: (string|undefined)} {\n      let regex;\n      try {\n        regex = new RegExp(value);\n      } catch {\n      }\n      const valid = Boolean(regex);\n      return {valid, errorMessage: undefined};\n    }\n  }\n\n  private addItem(fileSystem: PlatformFileSystem): void {\n    // Support managing only instances of IsolatedFileSystem.\n    if (!(fileSystem instanceof IsolatedFileSystem)) {\n      return;\n    }\n    const networkPersistenceProject = NetworkPersistenceManager.instance().project();\n    if (networkPersistenceProject &&\n        IsolatedFileSystemManager.instance().fileSystem((networkPersistenceProject as FileSystem).fileSystemPath()) ===\n            fileSystem) {\n      return;\n    }\n    const filename = this.getFilename(fileSystem);\n    const removeButton = UI.UIUtils.createTextButton(\n        i18nString(UIStrings.remove), this.removeFileSystemClicked.bind(this, fileSystem),\n        {jslogContext: 'settings.remove-file-system'});\n    removeButton.slot = 'heading-suffix';\n    const folderIcon = IconButton.Icon.create('folder');\n    folderIcon.slot = 'heading-prefix';\n\n    const mappingViewContainer = document.createElement('div');\n    mappingViewContainer.classList.add('mapping-view-container');\n    const fileSystemExcludeCard = document.createElement('devtools-card');\n    fileSystemExcludeCard.heading = filename;\n    fileSystemExcludeCard.append(folderIcon, removeButton, mappingViewContainer);\n    this.containerElement.insertBefore(fileSystemExcludeCard, this.#addButtonContainer);\n    const mappingView = new EditFileSystemView(fileSystem.path());\n    this.mappingViewByPath.set(fileSystem.path(), mappingView);\n    mappingView.element.classList.add('file-system-mapping-view');\n\n    mappingView.show(mappingViewContainer);\n\n    this.elementByPath.set(fileSystem.path(), fileSystemExcludeCard);\n  }\n\n  private getFilename(fileSystem: PlatformFileSystem): string {\n    const fileSystemPath = fileSystem.path();\n    const lastIndexOfSlash = fileSystemPath.lastIndexOf('/');\n    const lastPathComponent = fileSystemPath.substr(lastIndexOfSlash + 1);\n    return decodeURIComponent(lastPathComponent);\n  }\n\n  private removeFileSystemClicked(fileSystem: PlatformFileSystem): void {\n    IsolatedFileSystemManager.instance().removeFileSystem(fileSystem);\n  }\n\n  private addFileSystemClicked(): void {\n    void IsolatedFileSystemManager.instance().addFileSystem();\n  }\n\n  private fileSystemAdded(fileSystem: PlatformFileSystem): void {\n    this.addItem(fileSystem);\n  }\n\n  private fileSystemRemoved(fileSystem: PlatformFileSystem): void {\n    const mappingView = this.mappingViewByPath.get(fileSystem.path());\n    if (mappingView) {\n      mappingView.dispose();\n      this.mappingViewByPath.delete(fileSystem.path());\n    }\n\n    const element = this.elementByPath.get(fileSystem.path());\n    if (element) {\n      this.elementByPath.delete(fileSystem.path());\n      element.remove();\n    }\n  }\n}\n"]}