{"version":3,"file":"ScriptFormatter.test.js","sourceRoot":"","sources":["../../../../../../front_end/models/formatter/ScriptFormatter.test.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright 2020 The Chromium Authors\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport * as Common from '../../core/common/common.js';\nimport * as Formatter from '../formatter/formatter.js';\n\ndescribe('ScriptFormatter', () => {\n  const indentString = '  ';\n\n  after(() => {\n    Formatter.FormatterWorkerPool.formatterWorkerPool().dispose();\n  });\n\n  describe('JSON formatting', () => {\n    it('can format a JSON document via format()', async () => {\n      // Bug fix test: JSON files should be formatted when using the format() function.\n      // Previously, format() only formatted documents/scripts/stylesheets, skipping JSON.\n      const originalContent = '{\"a\":{\"b\":{\"c\":1}}}';\n      const {formattedContent} = await Formatter.ScriptFormatter.format(\n          Common.ResourceType.ResourceType.fromMimeType('application/json'), 'application/json', originalContent,\n          indentString);\n      const expectedContent = `{\n  \"a\": {\n    \"b\": {\n      \"c\": 1\n    }\n  }\n}`;\n      assert.strictEqual(formattedContent, expectedContent);\n    });\n\n    it('can format a JSON document via formatScriptContent()', async () => {\n      const originalContent = '{\"a\":{\"b\":{\"c\":1}}}';\n      const {formattedContent} =\n          await Formatter.ScriptFormatter.formatScriptContent('application/json', originalContent, indentString);\n      const expectedContent = `{\n  \"a\": {\n    \"b\": {\n      \"c\": 1\n    }\n  }\n}`;\n      assert.strictEqual(formattedContent, expectedContent);\n    });\n\n    it('can toggle JSON formatting (format then restore original)', async () => {\n      // Test that demonstrates the reversibility requirement from issue 378870233\n      const originalContent = '{\"keys\":[{\"k1\":\"v1\"},{\"k2\":\"v2\"}]}';\n      const {formattedContent, formattedMapping} = await Formatter.ScriptFormatter.format(\n          Common.ResourceType.ResourceType.fromMimeType('application/json'), 'application/json', originalContent,\n          indentString);\n\n      // Should be formatted\n      assert.notStrictEqual(formattedContent, originalContent);\n      assert.include(formattedContent, '\\n');\n\n      // Mapping should work correctly\n      assert.deepEqual(formattedMapping.originalToFormatted(0, 0), [0, 0]);\n    });\n  });\n\n  it('can format a HTML document', async () => {\n    const {formattedContent} = await Formatter.ScriptFormatter.format(\n        Common.ResourceType.ResourceType.fromMimeType('text/html'), 'text/html',\n        '<html><head></head><body></body></html>', indentString);\n    assert.strictEqual(formattedContent, `<html>\n  <head></head>\n  <body></body>\n</html>\n`);\n  });\n\n  it('can map original locations to formatted locations for HTML documents', async () => {\n    const {formattedMapping} = await Formatter.ScriptFormatter.format(\n        Common.ResourceType.ResourceType.fromMimeType('text/html'), 'text/html',\n        '<html><head></head><body></body></html>', indentString);\n    // The start of <head>\n    assert.deepEqual(formattedMapping.originalToFormatted(0, 6), [1, 2]);\n  });\n\n  it('can map original lines to formatted locations for HTML documents', async () => {\n    const {formattedMapping} = await Formatter.ScriptFormatter.format(\n        Common.ResourceType.ResourceType.fromMimeType('text/html'), 'text/html', `<html><head>\n</head><body></body></html>`,\n        indentString);\n    // The start of </head>\n    assert.deepEqual(formattedMapping.originalToFormatted(1), [1, 8]);\n  });\n\n  it('can map formatted locations to original locations for HTML documents', async () => {\n    const {formattedMapping} = await Formatter.ScriptFormatter.format(\n        Common.ResourceType.ResourceType.fromMimeType('text/html'), 'text/html',\n        '<html><head></head><body></body></html>', indentString);\n    // The start of <head>\n    assert.deepEqual(formattedMapping.formattedToOriginal(1, 2), [0, 6]);\n  });\n\n  it('can map formatted lines to original locations for HTML documents', async () => {\n    const {formattedMapping} = await Formatter.ScriptFormatter.format(\n        Common.ResourceType.ResourceType.fromMimeType('text/html'), 'text/html',\n        '<html><head></head><body></body></html>', indentString);\n    // The start of <head>\n    assert.deepEqual(formattedMapping.formattedToOriginal(1), [0, 6]);\n  });\n\n  describe('for documents that cant be formatted', () => {\n    // Technically we can format SVG files, but for this test we pretend its\n    // mimetype is an image, which we consider unformattable.\n    const originalContent = `<svg>\n  <rect x=\"10\" y=\"-10\" /></svg>`;\n    const mimeType = 'image/svg';\n    const resourceType = Common.ResourceType.ResourceType.fromMimeType(mimeType);\n\n    it('returns the original content', async () => {\n      const {formattedContent} =\n          await Formatter.ScriptFormatter.format(resourceType, mimeType, originalContent, indentString);\n      assert.deepEqual(formattedContent, originalContent);\n    });\n\n    it('maps to the same locations from formatted locations', async () => {\n      const {formattedMapping} =\n          await Formatter.ScriptFormatter.format(resourceType, mimeType, originalContent, indentString);\n      assert.deepEqual(formattedMapping.formattedToOriginal(1, 2), [1, 2]);\n    });\n\n    it('defaults column number to zero from formatted locations', async () => {\n      const {formattedMapping} =\n          await Formatter.ScriptFormatter.format(resourceType, mimeType, originalContent, indentString);\n      assert.deepEqual(formattedMapping.formattedToOriginal(1), [1, 0]);\n    });\n\n    it('maps to the same locations from original locations', async () => {\n      const {formattedMapping} =\n          await Formatter.ScriptFormatter.format(resourceType, mimeType, originalContent, indentString);\n      assert.deepEqual(formattedMapping.originalToFormatted(1, 4), [1, 4]);\n    });\n\n    it('defaults column number to zero from original locations', async () => {\n      const {formattedMapping} =\n          await Formatter.ScriptFormatter.format(resourceType, mimeType, originalContent, indentString);\n      assert.deepEqual(formattedMapping.originalToFormatted(1), [1, 0]);\n    });\n  });\n});\n"]}