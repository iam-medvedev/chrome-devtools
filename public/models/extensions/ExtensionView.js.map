{"version":3,"file":"ExtensionView.js","sourceRoot":"","sources":["../../../../../../front_end/models/extensions/ExtensionView.ts"],"names":[],"mappings":"AAAA;;;;;;;;;;;;;;;;;;;;;;;;;;;;GA4BG;AAEH,kDAAkD;AAClD,4DAA4D;AAC5D,OAAO,KAAK,EAAE,MAAM,2BAA2B,CAAC;AAChD,kDAAkD;AAClD,4DAA4D;AAC5D,OAAO,KAAK,GAAG,MAAM,qBAAqB,CAAC;AAI3C,MAAM,EAAC,MAAM,EAAE,IAAI,EAAE,UAAU,EAAE,EAAC,GAAG,EAAC,EAAC,GAAG,GAAG,CAAC;AAY9C,MAAM,YAAY,GAAG,CAAC,KAAgB,EAAE,MAAkB,EAAE,MAAmB,EAAQ,EAAE;IACvF,mBAAmB;IACnB,MAAM,CAAC,IAAI,CAAA;MACP,GAAG,CAAC,OAAO,CAAC,EAAE,GAAE,MAAM,CAAC,MAAM,GAAG,OAA4B,CAAC,CAAC,CAAC,CAAC;UAC5D,KAAK,CAAC,GAAG;YACP,KAAK,CAAC,SAAS;YACf,KAAK,CAAC,MAAM,YAAY,EAAE,MAAM,CAAC,CAAC;IAC5C,kBAAkB;AACpB,CAAC,CAAC;AAEF,MAAM,OAAO,aAAc,SAAQ,EAAE,CAAC,MAAM,CAAC,MAAM;IACjD,OAAO,CAAkB;IACzB,GAAG,CAAS;IACZ,IAAI,CAAS;IACb,UAAU,CAAS;IAEnB,OAAO,CAAqB;IAC5B,WAAW,CAAU;IAErB,KAAK,CAAsB;IAC3B,YAAY,MAAuB,EAAE,EAAU,EAAE,GAAW,EAAE,SAAiB,EAAE,IAAI,GAAG,YAAY;QAClG,KAAK,EAAE,CAAC;QACR,IAAI,CAAC,KAAK,GAAG,IAAI,CAAC;QAClB,IAAI,CAAC,OAAO,GAAG,MAAM,CAAC;QACtB,IAAI,CAAC,IAAI,GAAG,GAAG,CAAC;QAChB,IAAI,CAAC,UAAU,GAAG,SAAS,CAAC;QAC5B,IAAI,CAAC,GAAG,GAAG,EAAE,CAAC;QACd,IAAI,CAAC,eAAe,EAAE,CAAC,CAAE,WAAW;QACpC,KAAK,IAAI,CAAC,aAAa,EAAE,CAAC;IAC5B,CAAC;IAEQ,aAAa;QACpB,MAAM,MAAM,GAAe,EAAE,CAAC;QAC9B,IAAI,CAAC,KAAK,CACN;YACE,GAAG,EAAE,IAAI,CAAC,IAAI;YACd,SAAS,EAAE,IAAI,CAAC,UAAU;YAC1B,MAAM,EAAE,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC;SAC/B,EACD,MAAM,EAAE,IAAI,CAAC,OAAO,CAAC,CAAC;QAC1B,IAAI,MAAM,CAAC,MAAM,EAAE,CAAC;YAClB,IAAI,CAAC,OAAO,GAAG,MAAM,CAAC,MAAM,CAAC;QAC/B,CAAC;IACH,CAAC;IAEQ,QAAQ;QACf,KAAK,CAAC,QAAQ,EAAE,CAAC;QACjB,IAAI,OAAO,IAAI,CAAC,WAAW,KAAK,QAAQ,EAAE,CAAC;YACzC,IAAI,CAAC,OAAO,CAAC,eAAe,CAAC,IAAI,CAAC,GAAG,EAAE,IAAI,CAAC,WAAW,CAAC,CAAC;QAC3D,CAAC;IACH,CAAC;IAEQ,QAAQ;QACf,IAAI,OAAO,IAAI,CAAC,WAAW,KAAK,QAAQ,EAAE,CAAC;YACzC,IAAI,CAAC,OAAO,CAAC,gBAAgB,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;QAC1C,CAAC;IACH,CAAC;IAEO,MAAM;QACZ,IAAI,CAAC,IAAI,CAAC,OAAO,EAAE,CAAC;YAClB,OAAO;QACT,CAAC;QACD,MAAM,MAAM,GAAG,MAAM,CAAC,MAAM,CAAC;QAC7B,IAAI,CAAC,WAAW,GAAG,KAAK,CAAC,SAAS,CAAC,OAAO,CAAC,IAAI,CAAC,MAAM,EAAE,IAAI,CAAC,OAAO,CAAC,aAAa,CAAC,CAAC;QACpF,IAAI,IAAI,CAAC,SAAS,EAAE,EAAE,CAAC;YACrB,IAAI,CAAC,OAAO,CAAC,eAAe,CAAC,IAAI,CAAC,GAAG,EAAE,IAAI,CAAC,WAAW,CAAC,CAAC;QAC3D,CAAC;IACH,CAAC;CACF;AAED,MAAM,OAAO,qBAAsB,SAAQ,EAAE,CAAC,MAAM,CAAC,IAAI;IACtC,MAAM,CAAkB;IACxB,EAAE,CAAS;IAC5B,YAAY,MAAuB,EAAE,EAAU;QAC7C,KAAK,EAAE,CAAC;QAER,IAAI,CAAC,MAAM,GAAG,MAAM,CAAC;QACrB,IAAI,CAAC,EAAE,GAAG,EAAE,CAAC;IACf,CAAC;IAEQ,QAAQ;QACf,IAAI,CAAC,MAAM,CAAC,eAAe,CAAC,IAAI,CAAC,EAAE,CAAC,CAAC;IACvC,CAAC;IAEQ,QAAQ;QACf,IAAI,CAAC,MAAM,CAAC,gBAAgB,CAAC,IAAI,CAAC,EAAE,CAAC,CAAC;IACxC,CAAC;CACF","sourcesContent":["/*\n * Copyright (C) 2012 Google Inc. All rights reserved.\n *\n * Redistribution and use in source and binary forms, with or without\n * modification, are permitted provided that the following conditions are\n * met:\n *\n *     * Redistributions of source code must retain the above copyright\n * notice, this list of conditions and the following disclaimer.\n *     * Redistributions in binary form must reproduce the above\n * copyright notice, this list of conditions and the following disclaimer\n * in the documentation and/or other materials provided with the\n * distribution.\n *     * Neither the name of Google Inc. nor the names of its\n * contributors may be used to endorse or promote products derived from\n * this software without specific prior written permission.\n *\n * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS\n * \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT\n * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR\n * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT\n * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,\n * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT\n * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,\n * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY\n * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\n * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE\n * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n */\n\n// TODO(crbug.com/442509324): remove UI dependency\n// eslint-disable-next-line rulesdir/no-imports-in-directory\nimport * as UI from '../../ui/legacy/legacy.js';\n// TODO(crbug.com/442509324): remove UI dependency\n// eslint-disable-next-line rulesdir/no-imports-in-directory\nimport * as Lit from '../../ui/lit/lit.js';\n\nimport type {ExtensionServer} from './ExtensionServer.js';\n\nconst {render, html, Directives: {ref}} = Lit;\n\ninterface ViewInput {\n  src: string;\n  className: string;\n  onLoad: () => void;\n}\n\ninterface ViewOutput {\n  iframe?: HTMLIFrameElement;\n}\n\nconst DEFAULT_VIEW = (input: ViewInput, output: ViewOutput, target: HTMLElement): void => {\n  // clang-format off\n  render(html`<iframe\n    ${ref(element => {output.iframe = element as HTMLIFrameElement; })}\n    src=${input.src}\n    class=${input.className}\n    @load=${input.onLoad}></iframe>`, target);\n  // clang-format on\n};\n\nexport class ExtensionView extends UI.Widget.Widget {\n  #server: ExtensionServer;\n  #id: string;\n  #src: string;\n  #className: string;\n\n  #iframe?: HTMLIFrameElement;\n  #frameIndex?: number;\n\n  #view: typeof DEFAULT_VIEW;\n  constructor(server: ExtensionServer, id: string, src: string, className: string, view = DEFAULT_VIEW) {\n    super();\n    this.#view = view;\n    this.#server = server;\n    this.#src = src;\n    this.#className = className;\n    this.#id = id;\n    this.setHideOnDetach();  // Override\n    void this.performUpdate();\n  }\n\n  override performUpdate(): Promise<void>|void {\n    const output: ViewOutput = {};\n    this.#view(\n        {\n          src: this.#src,\n          className: this.#className,\n          onLoad: this.onLoad.bind(this),\n        },\n        output, this.element);\n    if (output.iframe) {\n      this.#iframe = output.iframe;\n    }\n  }\n\n  override wasShown(): void {\n    super.wasShown();\n    if (typeof this.#frameIndex === 'number') {\n      this.#server.notifyViewShown(this.#id, this.#frameIndex);\n    }\n  }\n\n  override willHide(): void {\n    if (typeof this.#frameIndex === 'number') {\n      this.#server.notifyViewHidden(this.#id);\n    }\n  }\n\n  private onLoad(): void {\n    if (!this.#iframe) {\n      return;\n    }\n    const frames = window.frames;\n    this.#frameIndex = Array.prototype.indexOf.call(frames, this.#iframe.contentWindow);\n    if (this.isShowing()) {\n      this.#server.notifyViewShown(this.#id, this.#frameIndex);\n    }\n  }\n}\n\nexport class ExtensionNotifierView extends UI.Widget.VBox {\n  private readonly server: ExtensionServer;\n  private readonly id: string;\n  constructor(server: ExtensionServer, id: string) {\n    super();\n\n    this.server = server;\n    this.id = id;\n  }\n\n  override wasShown(): void {\n    this.server.notifyViewShown(this.id);\n  }\n\n  override willHide(): void {\n    this.server.notifyViewHidden(this.id);\n  }\n}\n"]}