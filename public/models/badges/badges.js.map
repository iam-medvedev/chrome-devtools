{
  "version": 3,
  "sources": ["../../../../../../front_end/models/badges/Badge.ts", "../../../../../../front_end/models/badges/SpeedsterBadge.ts", "../../../../../../front_end/models/badges/StarterBadge.ts", "../../../../../../front_end/models/badges/UserBadges.ts", "../../../../../../front_end/models/badges/AiExplorerBadge.ts", "../../../../../../front_end/models/badges/CodeWhispererBadge.ts", "../../../../../../front_end/models/badges/DOMDetectiveBadge.ts"],
  "sourcesContent": ["// Copyright 2025 The Chromium Authors\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport * as Common from '../../core/common/common.js';\n\nexport enum BadgeAction {\n  GDP_SIGN_UP_COMPLETE = 'gdp-sign-up-complete',\n  RECEIVE_BADGES_SETTING_ENABLED = 'receive-badges-setting-enabled',\n  CSS_RULE_MODIFIED = 'css-rule-modified',\n  DOM_ELEMENT_OR_ATTRIBUTE_EDITED = 'dom-element-or-attribute-edited',\n  MODERN_DOM_BADGE_CLICKED = 'modern-dom-badge-clicked',\n  // TODO(ergunsh): Instrument performance insight clicks.\n  PERFORMANCE_INSIGHT_CLICKED = 'performance-insight-clicked',\n}\n\nexport type BadgeActionEvents = Record<BadgeAction, void>;\n\nexport interface BadgeContext {\n  onTriggerBadge: (badge: Badge) => void;\n  badgeActionEventTarget: Common.ObjectWrapper.ObjectWrapper<BadgeActionEvents>;\n}\n\nexport abstract class Badge {\n  #onTriggerBadge: (badge: Badge) => void;\n  #badgeActionEventTarget: Common.ObjectWrapper.ObjectWrapper<BadgeActionEvents>;\n  #eventListeners: Common.EventTarget.EventDescriptor[] = [];\n  #triggeredBefore = false;\n\n  abstract readonly name: string;\n  abstract readonly title: string;\n  abstract readonly imageUri: string;\n  abstract readonly interestedActions: readonly BadgeAction[];\n  readonly isStarterBadge: boolean = false;\n\n  constructor(context: BadgeContext) {\n    this.#onTriggerBadge = context.onTriggerBadge;\n    this.#badgeActionEventTarget = context.badgeActionEventTarget;\n  }\n\n  abstract handleAction(action: BadgeAction): void;\n  protected trigger(): void {\n    if (this.#triggeredBefore) {\n      return;\n    }\n\n    this.#triggeredBefore = true;\n    this.deactivate();\n    this.#onTriggerBadge(this);\n  }\n\n  activate(): void {\n    // The event listeners are already registered, we don't re-register them.\n    if (this.#eventListeners.length > 0) {\n      return;\n    }\n\n    this.#eventListeners =\n        this.interestedActions.map(actionType => this.#badgeActionEventTarget.addEventListener(actionType, () => {\n          this.handleAction(actionType);\n        }, this));\n  }\n\n  deactivate(): void {\n    if (!this.#eventListeners.length) {\n      return;\n    }\n\n    Common.EventTarget.removeEventListeners(this.#eventListeners);\n    this.#eventListeners = [];\n    this.#triggeredBefore = false;\n  }\n}\n", "// Copyright 2025 The Chromium Authors\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport {Badge, BadgeAction} from './Badge.js';\n\nconst SPEEDSTER_BADGE_URI = new URL('../../Images/speedster-badge.svg', import.meta.url).toString();\nexport class SpeedsterBadge extends Badge {\n  override readonly name =\n      'profiles/me/awards/developers.google.com%2Fprofile%2Fbadges%2Factivity%2Fchrome-devtools%2Fspeedster';\n  override readonly title = 'Speedster';\n  override readonly interestedActions = [\n    BadgeAction.PERFORMANCE_INSIGHT_CLICKED,\n  ] as const;\n  override readonly imageUri = SPEEDSTER_BADGE_URI;\n\n  handleAction(_action: BadgeAction): void {\n    this.trigger();\n  }\n}\n", "// Copyright 2025 The Chromium Authors\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport {Badge, BadgeAction} from './Badge.js';\n\nconst STARTER_BADGE_IMAGE_URI = new URL('../../Images/devtools-user-badge.svg', import.meta.url).toString();\nexport class StarterBadge extends Badge {\n  override readonly isStarterBadge = true;\n  override readonly name =\n      'profiles/me/awards/developers.google.com%2Fprofile%2Fbadges%2Factivity%2Fchrome-devtools%2Fchrome-devtools-user';\n  override readonly title = 'Chrome DevTools User';\n  override readonly imageUri = STARTER_BADGE_IMAGE_URI;\n\n  // TODO(ergunsh): Add remaining non-trivial event definitions\n  override readonly interestedActions = [\n    BadgeAction.GDP_SIGN_UP_COMPLETE,\n    BadgeAction.RECEIVE_BADGES_SETTING_ENABLED,\n    BadgeAction.CSS_RULE_MODIFIED,\n    BadgeAction.DOM_ELEMENT_OR_ATTRIBUTE_EDITED,\n  ] as const;\n\n  handleAction(_action: BadgeAction): void {\n    this.trigger();\n  }\n}\n", "// Copyright 2025 The Chromium Authors\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport * as Common from '../../core/common/common.js';\nimport * as Host from '../../core/host/host.js';\n\nimport {AiExplorerBadge} from './AiExplorerBadge.js';\nimport type {Badge, BadgeAction, BadgeActionEvents, BadgeContext} from './Badge.js';\nimport {CodeWhispererBadge} from './CodeWhispererBadge.js';\nimport {DOMDetectiveBadge} from './DOMDetectiveBadge.js';\nimport {SpeedsterBadge} from './SpeedsterBadge.js';\nimport {StarterBadge} from './StarterBadge.js';\n\ntype BadgeClass = new (badgeContext: BadgeContext) => Badge;\n\nexport const enum Events {\n  BADGE_TRIGGERED = 'BadgeTriggered',\n}\n\nexport interface EventTypes {\n  [Events.BADGE_TRIGGERED]: Badge;\n}\n\nlet userBadgesInstance: UserBadges|undefined = undefined;\nexport class UserBadges extends Common.ObjectWrapper.ObjectWrapper<EventTypes> {\n  readonly #badgeActionEventTarget = new Common.ObjectWrapper.ObjectWrapper<BadgeActionEvents>();\n\n  #receiveBadgesSetting: Common.Settings.Setting<Boolean>;\n  #allBadges: Badge[];\n\n  static readonly BADGE_REGISTRY: BadgeClass[] = [\n    StarterBadge,\n    SpeedsterBadge,\n    DOMDetectiveBadge,\n    CodeWhispererBadge,\n    AiExplorerBadge,\n  ];\n\n  private constructor() {\n    super();\n\n    this.#receiveBadgesSetting = Common.Settings.Settings.instance().moduleSetting('receive-gdp-badges');\n    this.#receiveBadgesSetting.addChangeListener(this.#reconcileBadges, this);\n\n    this.#allBadges = UserBadges.BADGE_REGISTRY.map(badgeCtor => new badgeCtor({\n                                                      onTriggerBadge: this.#onTriggerBadge.bind(this),\n                                                      badgeActionEventTarget: this.#badgeActionEventTarget,\n                                                    }));\n  }\n\n  static instance({forceNew}: {forceNew: boolean} = {forceNew: false}): UserBadges {\n    if (!userBadgesInstance || forceNew) {\n      userBadgesInstance = new UserBadges();\n    }\n    return userBadgesInstance;\n  }\n\n  async initialize(): Promise<void> {\n    return await this.#reconcileBadges();\n  }\n\n  recordAction(action: BadgeAction): void {\n    // `Common.ObjectWrapper.ObjectWrapper` does not allow passing unions to\n    // the `dispatchEventToListeners` and `action` in this case is a union.\n    // We want to support listening to specific actions here, that's why we suppress\n    // the TypeScript errors. This is safe to do so since every `BadgeAction`\n    // is a valid event type and all events are typed as void.\n    // @ts-expect-error\n    this.#badgeActionEventTarget.dispatchEventToListeners(action);\n  }\n\n  async #onTriggerBadge(badge: Badge): Promise<void> {\n    let shouldAwardBadge = false;\n    // By default, we award non-starter badges directly when they are triggered.\n    if (!badge.isStarterBadge) {\n      shouldAwardBadge = true;\n    } else {\n      const gdpProfile = await Host.GdpClient.GdpClient.instance().getProfile();\n      const receiveBadgesSettingEnabled = Boolean(this.#receiveBadgesSetting.get());\n      // If there is a GDP profile and the user has enabled receiving badges, we award the starter badge as well.\n      if (gdpProfile && receiveBadgesSettingEnabled) {\n        shouldAwardBadge = true;\n      }\n    }\n\n    // Awarding was needed and not successful, we don't show the notification\n    if (shouldAwardBadge) {\n      const result = await Host.GdpClient.GdpClient.instance().createAward({name: badge.name});\n      if (!result) {\n        return;\n      }\n    }\n\n    this.dispatchEventToListeners(Events.BADGE_TRIGGERED, badge);\n  }\n\n  #deactivateAllBadges(): void {\n    this.#allBadges.forEach(badge => {\n      badge.deactivate();\n    });\n  }\n\n  // TODO(ergunsh): Implement starter badge dismissal, snooze count & timestamp checks.\n  async #reconcileBadges(): Promise<void> {\n    const syncInfo = await new Promise<Host.InspectorFrontendHostAPI.SyncInformation>(\n        resolve => Host.InspectorFrontendHost.InspectorFrontendHostInstance.getSyncInformation(resolve));\n    // If the user is not signed in, do not activate any badges.\n    if (!syncInfo.accountEmail) {\n      this.#deactivateAllBadges();\n      return;\n    }\n\n    const [gdpProfile, isEligibleToCreateProfile] = await Promise.all([\n      Host.GdpClient.GdpClient.instance().getProfile(),\n      Host.GdpClient.GdpClient.instance().isEligibleToCreateProfile(),\n    ]);\n\n    // User does not have a GDP profile & not eligible to create one.\n    // So, we don't activate any badges for them.\n    if (!gdpProfile && !isEligibleToCreateProfile) {\n      this.#deactivateAllBadges();\n      return;\n    }\n\n    let awardedBadgeNames: Set<string>|null = null;\n    if (gdpProfile) {\n      awardedBadgeNames = await Host.GdpClient.GdpClient.instance().getAwardedBadgeNames(\n          {names: this.#allBadges.map(badge => badge.name)});\n      // This is a conservative approach. We bail out if `awardedBadgeNames` is null\n      // when there is a profile to prevent a negative user experience.\n      //\n      // A failure here (e.g., from a typo in a badge name) could cause us to\n      // re-trigger the \"Receive badges\" nudge for a user who has already earned the\n      // starter badge and opted out of receiving badges.\n      //\n      // The trade-off is, we silently failing to enable badge mechanism rather than annoying the user.\n      if (!awardedBadgeNames) {\n        this.#deactivateAllBadges();\n        return;\n      }\n    }\n\n    const receiveBadgesSettingEnabled = Boolean(this.#receiveBadgesSetting.get());\n    for (const badge of this.#allBadges) {\n      if (awardedBadgeNames?.has(badge.name)) {\n        badge.deactivate();\n        continue;\n      }\n\n      const shouldActivateStarterBadge = badge.isStarterBadge && isEligibleToCreateProfile;\n      const shouldActivateActivityBasedBadge =\n          !badge.isStarterBadge && Boolean(gdpProfile) && receiveBadgesSettingEnabled;\n      if (shouldActivateStarterBadge || shouldActivateActivityBasedBadge) {\n        badge.activate();\n      } else {\n        badge.deactivate();\n      }\n    }\n\n    this.reconcileBadgesFinishedForTest();\n  }\n\n  reconcileBadgesFinishedForTest(): void {\n  }\n\n  isReceiveBadgesSettingEnabled(): boolean {\n    return Boolean(this.#receiveBadgesSetting.get());\n  }\n}\n", "// Copyright 2025 The Chromium Authors\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport {Badge, type BadgeAction} from './Badge.js';\n\nconst AI_EXPLORER_BADGE_URI = new URL('../../Images/ai-explorer-badge.svg', import.meta.url).toString();\nexport class AiExplorerBadge extends Badge {\n  override readonly name =\n      'profiles/me/awards/developers.google.com%2Fprofile%2Fbadges%2Factivity%2Fchrome-devtools%2Fai-explorer';\n  override readonly title = 'AI Explorer';\n  override readonly imageUri = AI_EXPLORER_BADGE_URI;\n\n  override readonly interestedActions = [\n    // TODO(ergunsh): Instrument related actions.\n  ] as const;\n\n  handleAction(_action: BadgeAction): void {\n    this.trigger();\n  }\n}\n", "// Copyright 2025 The Chromium Authors\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport {Badge, type BadgeAction} from './Badge.js';\n\nconst CODE_WHISPERER_BADGE_IMAGE_URI = new URL('../../Images/code-whisperer-badge.svg', import.meta.url).toString();\nexport class CodeWhispererBadge extends Badge {\n  override readonly name =\n      'profiles/me/awards/developers.google.com%2Fprofile%2Fbadges%2Factivity%2Fchrome-devtools%2Fcode-whisperer';\n  override readonly title = 'Code Whisperer';\n  override readonly imageUri = CODE_WHISPERER_BADGE_IMAGE_URI;\n\n  override readonly interestedActions = [\n    // TODO(ergunsh): Instrument related actions.\n  ] as const;\n\n  handleAction(_action: BadgeAction): void {\n    this.trigger();\n  }\n}\n", "// Copyright 2025 The Chromium Authors\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport {Badge, BadgeAction} from './Badge.js';\n\nconst DOM_DETECTIVE_BADGE_IMAGE_URI = new URL('../../Images/dom-detective-badge.svg', import.meta.url).toString();\nexport class DOMDetectiveBadge extends Badge {\n  override readonly name =\n      'profiles/me/awards/developers.google.com%2Fprofile%2Fbadges%2Factivity%2Fchrome-devtools%2Fdom-detective';\n  override readonly title = 'DOM Detective';\n  override readonly imageUri = DOM_DETECTIVE_BADGE_IMAGE_URI;\n\n  override readonly interestedActions = [\n    BadgeAction.MODERN_DOM_BADGE_CLICKED,\n  ] as const;\n\n  handleAction(_action: BadgeAction): void {\n    this.trigger();\n  }\n}\n"],
  "mappings": "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",
  "names": ["BadgeAction", "Common"]
}
