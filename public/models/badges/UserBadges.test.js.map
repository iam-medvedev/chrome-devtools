{"version":3,"file":"UserBadges.test.js","sourceRoot":"","sources":["../../../../../../front_end/models/badges/UserBadges.test.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright 2025 The Chromium Authors\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport * as Common from '../../core/common/common.js';\nimport * as Host from '../../core/host/host.js';\nimport {describeWithEnvironment} from '../../testing/EnvironmentHelpers.js';\nimport {expectCall} from '../../testing/ExpectStubCall.js';\n\nimport * as Badges from './badges.js';\nclass MockActivityBadge extends Badges.Badge {\n  override name = 'badges/test-badge';\n  override title = 'test-badge-title';\n  override interestedActions: readonly Badges.BadgeAction[] = [\n    Badges.BadgeAction.PERFORMANCE_INSIGHT_CLICKED,\n  ] as const;\n\n  override handleAction(): void {\n    this.trigger();\n  }\n}\n\nclass MockStarterBadge extends Badges.Badge {\n  override name = 'badges/starter-test-badge';\n  override title = 'starter-test-badge';\n  override isStarterBadge = true;\n  override interestedActions: readonly Badges.BadgeAction[] = [\n    Badges.BadgeAction.CSS_RULE_MODIFIED,\n  ] as const;\n\n  override handleAction(): void {\n    this.trigger();\n  }\n}\n\nconst MOCK_BADGE_REGISTRY = [\n  MockActivityBadge,\n  MockStarterBadge,\n];\n\nfunction mockGetSyncInformation(information: Host.InspectorFrontendHostAPI.SyncInformation): void {\n  sinon.stub(Host.InspectorFrontendHost.InspectorFrontendHostInstance, 'getSyncInformation').callsFake(cb => {\n    cb(information);\n  });\n}\n\nfunction mockGdpClientGetProfile(profile: Host.GdpClient.Profile|null): void {\n  sinon.stub(Host.GdpClient.GdpClient.instance(), 'getProfile').resolves(profile);\n}\n\nfunction mockIsEligibleToCreateProfile(eligible: boolean): void {\n  sinon.stub(Host.GdpClient.GdpClient.instance(), 'isEligibleToCreateProfile').resolves(eligible);\n}\n\nfunction setReceiveBadgesSetting(value: boolean) {\n  Common.Settings.Settings.instance().moduleSetting('receive-gdp-badges').set(value);\n}\n\nfunction setUpEnvironmentForActivatedBadges(): void {\n  setReceiveBadgesSetting(true);\n  mockGetSyncInformation({accountEmail: 'test@test.com', isSyncActive: false});\n  mockGdpClientGetProfile({name: 'names/profile-id'});\n  mockIsEligibleToCreateProfile(true);\n}\n\nfunction assertActiveBadges({\n  shouldStarterBadgeBeActive,\n  shouldActivityBadgeBeActive,\n}: {\n  shouldStarterBadgeBeActive: boolean,\n  shouldActivityBadgeBeActive: boolean,\n}): void {\n  // Record actions that'll trigger both badges.\n  const handleActivityBadgeActionStub = sinon.stub(MockActivityBadge.prototype, 'handleAction');\n  const handleStarterBadgeActionStub = sinon.stub(MockStarterBadge.prototype, 'handleAction');\n\n  Badges.UserBadges.instance().recordAction(Badges.BadgeAction.PERFORMANCE_INSIGHT_CLICKED);\n  Badges.UserBadges.instance().recordAction(Badges.BadgeAction.CSS_RULE_MODIFIED);\n\n  if (shouldStarterBadgeBeActive) {\n    sinon.assert.calledOnce(handleStarterBadgeActionStub);\n  } else {\n    sinon.assert.notCalled(handleStarterBadgeActionStub);\n  }\n\n  if (shouldActivityBadgeBeActive) {\n    sinon.assert.calledOnce(handleActivityBadgeActionStub);\n  } else {\n    sinon.assert.notCalled(handleActivityBadgeActionStub);\n  }\n\n  handleStarterBadgeActionStub.restore();\n  handleActivityBadgeActionStub.restore();\n}\n\ndescribeWithEnvironment('UserBadges', () => {\n  beforeEach(() => {\n    Object.assign(Badges.UserBadges.BADGE_REGISTRY, MOCK_BADGE_REGISTRY);\n    Badges.UserBadges.instance({forceNew: true});\n  });\n\n  it('should dispatch a badge triggered event when a badge is triggered for the first time', async () => {\n    setUpEnvironmentForActivatedBadges();\n    const badgeTriggeredEventHandlerStub = sinon.stub();\n    await Badges.UserBadges.instance().initialize();\n    Badges.UserBadges.instance().addEventListener(Badges.Events.BADGE_TRIGGERED, badgeTriggeredEventHandlerStub);\n\n    Badges.UserBadges.instance().recordAction(Badges.BadgeAction.PERFORMANCE_INSIGHT_CLICKED);\n\n    sinon.assert.calledOnce(badgeTriggeredEventHandlerStub);\n  });\n\n  it('should only dispatch a badge triggered event once when the same action is recorded multiple times', async () => {\n    setUpEnvironmentForActivatedBadges();\n    const badgeTriggeredEventHandlerStub = sinon.stub();\n    await Badges.UserBadges.instance().initialize();\n    Badges.UserBadges.instance().addEventListener(Badges.Events.BADGE_TRIGGERED, badgeTriggeredEventHandlerStub);\n\n    Badges.UserBadges.instance().recordAction(Badges.BadgeAction.PERFORMANCE_INSIGHT_CLICKED);\n    Badges.UserBadges.instance().recordAction(Badges.BadgeAction.PERFORMANCE_INSIGHT_CLICKED);\n\n    sinon.assert.calledOnce(badgeTriggeredEventHandlerStub);\n  });\n\n  describe('recordAction', () => {\n    it('should result in a call to `handleAction` for the badges that are interested in that action', async () => {\n      setUpEnvironmentForActivatedBadges();\n      await Badges.UserBadges.instance().initialize();\n      const handleActionStub = sinon.stub(MockActivityBadge.prototype, 'handleAction');\n\n      Badges.UserBadges.instance().recordAction(Badges.BadgeAction.PERFORMANCE_INSIGHT_CLICKED);\n\n      sinon.assert.calledOnce(handleActionStub);\n    });\n  });\n\n  describe('initialize and reconcile badges', () => {\n    describe('no active badges', () => {\n      it('should not activate any badges if the user is not signed in', async () => {\n        mockGetSyncInformation({isSyncActive: false});\n\n        await Badges.UserBadges.instance().initialize();\n\n        assertActiveBadges({\n          shouldActivityBadgeBeActive: false,\n          shouldStarterBadgeBeActive: false,\n        });\n      });\n\n      it('should not activate any badges if the user is signed in but is neither eligible to create a GDP profile nor has an existing one',\n         async () => {\n           mockGetSyncInformation({accountEmail: 'test@test.com', isSyncActive: false});\n           mockIsEligibleToCreateProfile(false);\n           mockGdpClientGetProfile(null);\n\n           await Badges.UserBadges.instance().initialize();\n\n           assertActiveBadges({\n             shouldActivityBadgeBeActive: false,\n             shouldStarterBadgeBeActive: false,\n           });\n         });\n    });\n\n    describe('only starter badge', () => {\n      it('should activate only the starter badge if the user does not have a GDP profile and is eligible for one',\n         async () => {\n           mockIsEligibleToCreateProfile(true);\n           mockGetSyncInformation({accountEmail: 'test@test.com', isSyncActive: false});\n\n           await Badges.UserBadges.instance().initialize();\n\n           assertActiveBadges({\n             shouldActivityBadgeBeActive: false,\n             shouldStarterBadgeBeActive: true,\n           });\n         });\n\n      it('should activate only the starter badge if the user has a GDP profile and the receive badges setting is off',\n         async () => {\n           setReceiveBadgesSetting(false);\n           mockIsEligibleToCreateProfile(true);\n           mockGdpClientGetProfile({name: 'profiles/test'});\n           mockGetSyncInformation({accountEmail: 'test@test.com', isSyncActive: false});\n\n           await Badges.UserBadges.instance().initialize();\n\n           assertActiveBadges({\n             shouldActivityBadgeBeActive: false,\n             shouldStarterBadgeBeActive: true,\n           });\n         });\n    });\n\n    describe('all badges', () => {\n      it('should activate starter and activity badges if the user has a GDP profile and the receive badges setting is on',\n         async () => {\n           setReceiveBadgesSetting(true);\n           mockIsEligibleToCreateProfile(true);\n           mockGdpClientGetProfile({name: 'profiles/test'});\n           mockGetSyncInformation({accountEmail: 'test@test.com', isSyncActive: false});\n\n           await Badges.UserBadges.instance().initialize();\n\n           assertActiveBadges({\n             shouldActivityBadgeBeActive: true,\n             shouldStarterBadgeBeActive: true,\n           });\n         });\n    });\n\n    it('should deactivate activity based badges when receive badges setting turns to false', async () => {\n      setReceiveBadgesSetting(true);\n      mockIsEligibleToCreateProfile(true);\n      mockGdpClientGetProfile({name: 'profiles/test'});\n      mockGetSyncInformation({accountEmail: 'test@test.com', isSyncActive: false});\n\n      await Badges.UserBadges.instance().initialize();\n      assertActiveBadges({\n        shouldActivityBadgeBeActive: true,\n        shouldStarterBadgeBeActive: true,\n      });\n\n      const waitForReconcileBadgesToFinish =\n          expectCall(sinon.stub(Badges.UserBadges.instance(), 'reconcileBadgesFinishedForTest'));\n      setReceiveBadgesSetting(false);\n      await waitForReconcileBadgesToFinish;\n      assertActiveBadges({\n        shouldActivityBadgeBeActive: false,\n        shouldStarterBadgeBeActive: true,\n      });\n    });\n  });\n});\n"]}