{"version":3,"file":"BuiltInAi.test.js","sourceRoot":"","sources":["../../../../../../front_end/models/ai_assistance/BuiltInAi.test.ts"],"names":[],"mappings":"AAAA,sCAAsC;AACtC,yEAAyE;AACzE,6BAA6B;AAE7B,OAAO,EAAC,gBAAgB,EAAC,MAAM,qCAAqC,CAAC;AACrE,OAAO,KAAK,iBAAiB,MAAM,mCAAmC,CAAC;AAEvE,QAAQ,CAAC,WAAW,EAAE,GAAG,EAAE;IACzB,EAAE,CAAC,uCAAuC,EAAE,KAAK,IAAI,EAAE;QACrD,gBAAgB,CAAC;YACf,mBAAmB,EAAE;gBACnB,OAAO,EAAE,IAAI;gBACb,eAAe,EAAE,IAAI;aACtB;SACF,CAAC,CAAC;QAEH,KAAK,SAAS,CAAC,CAAC,eAAe;YAC7B,MAAM,SAAS,CAAC;YAChB,MAAM,kBAAkB,CAAC;QAC3B,CAAC;QAED,MAAM,iBAAiB,GAAG;YACxB,OAAO,EAAE,GAAG,EAAE,GAAE,CAAC;YACjB,KAAK,EAAE,GAAG,EAAE,CAAC,iBAAiB;YAC9B,eAAe;SAChB,CAAC;QACF,mBAAmB;QACnB,MAAM,CAAC,aAAa,GAAG;YACrB,YAAY,EAAE,GAAG,EAAE,CAAC,WAAW;YAC/B,MAAM,EAAE,GAAG,EAAE,CAAC,iBAAiB;SAChC,CAAC;QAEF,MAAM,SAAS,GAAG,IAAI,iBAAiB,CAAC,SAAS,CAAC,SAAS,EAAE,CAAC;QAC9D,MAAM,CAAC,SAAS,CAAC,SAAS,CAAC,CAAC;QAC5B,MAAM,SAAS,CAAC,kBAAkB,CAAC;QACnC,MAAM,CAAC,MAAM,CAAC,SAAS,CAAC,UAAU,EAAE,CAAC,CAAC;QACtC,MAAM,eAAe,GAAG,IAAI,eAAe,EAAE,CAAC;QAC9C,MAAM,MAAM,GAAG,SAAS,CAAC,iBAAiB,CAAC,oBAAoB,EAAE,eAAe,CAAC,CAAC;QAClF,IAAI,QAAQ,GAAG,EAAE,CAAC;QAClB,IAAI,KAAK,EAAE,MAAM,KAAK,IAAI,MAAM,EAAE,CAAC;YACjC,QAAQ,IAAI,KAAK,CAAC;QACpB,CAAC;QACD,MAAM,CAAC,WAAW,CAAC,QAAQ,EAAE,yBAAyB,CAAC,CAAC;QACxD,iBAAiB,CAAC,SAAS,CAAC,SAAS,CAAC,cAAc,EAAE,CAAC;IACzD,CAAC,CAAC,CAAC;IAEH,EAAE,CAAC,+CAA+C,EAAE,KAAK,IAAI,EAAE;QAC7D,gBAAgB,CAAC;YACf,mBAAmB,EAAE;gBACnB,OAAO,EAAE,IAAI;gBACb,eAAe,EAAE,KAAK;aACvB;SACF,CAAC,CAAC;QAEH,mBAAmB;QACnB,MAAM,CAAC,aAAa,GAAG;YACrB,YAAY,EAAE,GAAG,EAAE,CAAC,WAAW;YAC/B,MAAM,EAAE,GAAG,EAAE,CAAC,CAAC,EAAC,GAAG,EAAE,KAAK,EAAC,CAAC;SAC7B,CAAC;QAEF,MAAM,SAAS,GAAG,IAAI,iBAAiB,CAAC,SAAS,CAAC,SAAS,EAAE,CAAC;QAC9D,MAAM,SAAS,CAAC,kBAAkB,CAAC;QACnC,MAAM,CAAC,OAAO,CAAC,SAAS,CAAC,UAAU,EAAE,CAAC,CAAC;IACzC,CAAC,CAAC,CAAC;AACL,CAAC,CAAC,CAAC","sourcesContent":["// Copyright 2025 The Chromium Authors\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport {updateHostConfig} from '../../testing/EnvironmentHelpers.js';\nimport * as AiAssistanceModel from '../ai_assistance/ai_assistance.js';\n\ndescribe('BuiltInAi', () => {\n  it('can generate a console insight teaser', async () => {\n    updateHostConfig({\n      devToolsAiPromptApi: {\n        enabled: true,\n        allowWithoutGpu: true,\n      },\n    });\n\n    async function* promptStreaming() {\n      yield 'This is';\n      yield ' an explanation.';\n    }\n\n    const mockLanguageModel = {\n      destroy: () => {},\n      clone: () => mockLanguageModel,\n      promptStreaming,\n    };\n    // @ts-expect-error\n    window.LanguageModel = {\n      availability: () => 'available',\n      create: () => mockLanguageModel,\n    };\n\n    const builtInAi = new AiAssistanceModel.BuiltInAi.BuiltInAi();\n    assert.isDefined(builtInAi);\n    await builtInAi.initDoneForTesting;\n    assert.isTrue(builtInAi.hasSession());\n    const abortController = new AbortController();\n    const stream = builtInAi.getConsoleInsight('explain this error', abortController);\n    let response = '';\n    for await (const chunk of stream) {\n      response += chunk;\n    }\n    assert.strictEqual(response, 'This is an explanation.');\n    AiAssistanceModel.BuiltInAi.BuiltInAi.removeInstance();\n  });\n\n  it('is not available if there is no dedicated GPU', async () => {\n    updateHostConfig({\n      devToolsAiPromptApi: {\n        enabled: true,\n        allowWithoutGpu: false,\n      },\n    });\n\n    // @ts-expect-error\n    window.LanguageModel = {\n      availability: () => 'available',\n      create: () => ({foo: 'bar'}),\n    };\n\n    const builtInAi = new AiAssistanceModel.BuiltInAi.BuiltInAi();\n    await builtInAi.initDoneForTesting;\n    assert.isFalse(builtInAi.hasSession());\n  });\n});\n"]}