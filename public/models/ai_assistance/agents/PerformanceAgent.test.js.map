{"version":3,"file":"PerformanceAgent.test.js","sourceRoot":"","sources":["../../../../../../../front_end/models/ai_assistance/agents/PerformanceAgent.test.ts"],"names":[],"mappings":"AAAA,4DAA4D;AAC5D,yEAAyE;AACzE,6BAA6B;AAG7B,OAAO,KAAK,IAAI,MAAM,4BAA4B,CAAC;AACnD,OAAO,KAAK,QAAQ,MAAM,oCAAoC,CAAC;AAC/D,OAAO,KAAK,aAAa,MAAM,yCAAyC,CAAC;AACzE,OAAO,EAAC,cAAc,EAAC,MAAM,yCAAyC,CAAC;AACvE,OAAO,EACL,uBAAuB,EACvB,0BAA0B,EAC1B,sBAAsB,EACtB,gBAAgB,EACjB,MAAM,wCAAwC,CAAC;AAChD,OAAO,EAAC,iBAAiB,EAAE,oBAAoB,EAAC,MAAM,oCAAoC,CAAC;AAC3F,OAAO,EAAC,WAAW,EAAC,MAAM,iCAAiC,CAAC;AAC5D,OAAO,KAAK,KAAK,MAAM,sBAAsB,CAAC;AAC9C,OAAO,EAGL,gBAAgB,EAChB,2BAA2B,EAC3B,uBAAuB,EAEvB,mBAAmB,EACpB,MAAM,qBAAqB,CAAC;AAE7B,uBAAuB,CAAC,kBAAkB,EAAE,GAAG,EAAE;IAC/C,SAAS,cAAc,CAAC,OAAgB,EAAE,WAAoB;QAC5D,gBAAgB,CAAC;YACf,oCAAoC,EAAE;gBACpC,OAAO;gBACP,WAAW;aACZ;SACF,CAAC,CAAC;IACL,CAAC;IAED,QAAQ,CAAC,cAAc,EAAE,GAAG,EAAE;QAC5B,UAAU,CAAC,GAAG,EAAE;YACd,KAAK,CAAC,OAAO,EAAE,CAAC;QAClB,CAAC,CAAC,CAAC;QAEH,EAAE,CAAC,kCAAkC,EAAE,KAAK,IAAI,EAAE;YAChD,cAAc,CAAC,YAAY,CAAC,CAAC;YAC7B,MAAM,KAAK,GAAG,IAAI,gBAAgB,CAC9B;gBACE,UAAU,EAAE,EAAgC;aAC7C,2DAC4B,CAAC;YAClC,MAAM,CAAC,WAAW,CACd,KAAK,CAAC,YAAY,CAAC,EAAC,IAAI,EAAE,YAAY,EAAC,EAAE,IAAI,CAAC,UAAU,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,OAAO,EAAE,QAAQ,EACrF,YAAY,CACf,CAAC;QACJ,CAAC,CAAC,CAAC;QAEH,EAAE,CAAC,qCAAqC,EAAE,KAAK,IAAI,EAAE;YACnD,cAAc,CAAC,YAAY,EAAE,CAAC,CAAC,CAAC;YAChC,MAAM,KAAK,GAAG,IAAI,gBAAgB,CAC9B;gBACE,UAAU,EAAE,EAAgC;aAC7C,2DAC4B,CAAC;YAClC,MAAM,CAAC,WAAW,CACd,KAAK,CAAC,YAAY,CAAC,EAAC,IAAI,EAAE,YAAY,EAAC,EAAE,IAAI,CAAC,UAAU,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,OAAO,EAAE,WAAW,EACxF,CAAC,CACJ,CAAC;QACJ,CAAC,CAAC,CAAC;QAEH,EAAE,CAAC,gCAAgC,EAAE,KAAK,IAAI,EAAE;YAC9C,cAAc,CAAC,YAAY,CAAC,CAAC;YAC7B,KAAK,CAAC,IAAI,CAAC,MAAM,EAAE,YAAY,CAAC,CAAC,OAAO,CAAC,WAAkE,CAAC,CAAC;YAC7G,MAAM,KAAK,GAAG,IAAI,gBAAgB,CAC9B;gBACE,UAAU,EAAE,cAAc,CAAC,CAAC,CAAC,EAAC,WAAW,EAAE,QAAQ,EAAC,CAAC,CAAC,CAAC;gBACvD,wBAAwB,EAAE,IAAI;aAC/B,2DAC4B,CAAC;YAElC,MAAM,KAAK,CAAC,SAAS,CAAC,KAAK,CAAC,GAAG,CAAC,UAAU,EAAE,EAAC,QAAQ,EAAE,IAAI,EAAC,CAAC,CAAC,CAAC;YAC/D,sBAAsB,EAAE,CAAC;YAEzB,MAAM,CAAC,SAAS,CACZ,KAAK,CAAC,YAAY,CACd;gBACE,IAAI,EAAE,YAAY;aACnB,EACD,IAAI,CAAC,UAAU,CAAC,IAAI,CAAC,IAAI,CAAC,EAC9B;gBACE,eAAe,EAAE,EAAC,IAAI,EAAE,IAAI,CAAC,UAAU,CAAC,IAAI,CAAC,IAAI,EAAE,KAAK,EAAE,CAAC,EAAC,IAAI,EAAE,YAAY,EAAC,CAAC,EAAC;gBACjF,MAAM,EAAE,iBAAiB;gBACzB,QAAQ,EAAE,SAAS;gBACnB,mBAAmB,EAAE;oBACnB;wBACE,IAAI,EAAE,CAAC;wBACP,KAAK,EAAE,CAAC,EAAC,IAAI,EAAE,UAAU,EAAC,CAAC;qBAC5B;oBACD;wBACE,IAAI,EAAE,CAAC;wBACP,KAAK,EAAE,CAAC,EAAC,IAAI,EAAE,QAAQ,EAAC,CAAC;qBAC1B;iBACF;gBACD,KAAK,EAAE,SAAS;gBAChB,QAAQ,EAAE;oBACR,4BAA4B,EAAE,KAAK;oBACnC,iBAAiB,EAAE,WAAW;oBAC9B,SAAS,EAAE,CAAC;oBACZ,cAAc,EAAE,WAAW;iBAC5B;gBACD,OAAO,EAAE;oBACP,QAAQ,EAAE,YAAY;oBACtB,WAAW,EAAE,SAAS;iBACvB;gBACD,cAAc,EAAE,CAAC;gBACjB,kBAAkB,EAAE,CAAC;aACtB,CACJ,CAAC;YACF,0BAA0B,EAAE,CAAC;QAC/B,CAAC,CAAC,CAAC;IACL,CAAC,CAAC,CAAC;AACL,CAAC,CAAC,CAAC;AAEH,uBAAuB,CAAC,oCAAoC,EAAE,GAAG,EAAE;IACjE,QAAQ,CAAC,aAAa,EAAE,GAAG,EAAE;QAC3B,EAAE,CAAC,iFAAiF,EAAE,KAAK;YACzF,MAAM,EAAC,WAAW,EAAC,GAAG,MAAM,WAAW,CAAC,WAAW,CAAC,IAAI,EAAE,6BAA6B,CAAC,CAAC;YACzF,oFAAoF;YACpF,MAAM,eAAe,GAAG,WAAW,CAAC,QAAQ,CAAC,eAAe,CAAC,IAAI,CAC7D,KAAK,CAAC,EAAE,CAAC,KAAK,CAAC,IAAI,mEAA4C,IAAI,KAAK,CAAC,EAAE,KAAK,YAAY,CAAC,CAAC;YAClG,MAAM,CAAC,MAAM,CAAC,eAAe,CAAC,CAAC;YAC/B,MAAM,UAAU,GAAG,aAAa,CAAC,UAAU,CAAC,UAAU,CAAC,SAAS,CAAC,eAAe,EAAE,WAAW,CAAC,CAAC;YAC/F,MAAM,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC;YACxB,MAAM,OAAO,GAAG,uBAAuB,CAAC,YAAY,CAAC,UAAU,CAAC,CAAC;YACjE,MAAM,CAAC,WAAW,CAAC,OAAO,CAAC,SAAS,EAAE,EAAE,kCAAkC,CAAC,CAAC;QAC9E,CAAC,CAAC,CAAC;QAEH,EAAE,CAAC,mFAAmF,EAAE,KAAK;YAC3F,MAAM,EAAC,WAAW,EAAC,GAAG,MAAM,WAAW,CAAC,WAAW,CAAC,IAAI,EAAE,6BAA6B,CAAC,CAAC;YACzF,+CAA+C;YAC/C,MAAM,WAAW,GAAG,WAAW,CAAC,QAAQ,CAAC,eAAe,CAAC,IAAI,CACzD,KAAK,CAAC,EAAE,CAAC,KAAK,CAAC,IAAI,kDAAmC,IAAI,KAAK,CAAC,EAAE,KAAK,YAAY,CAAC,CAAC;YACzF,MAAM,CAAC,MAAM,CAAC,WAAW,CAAC,CAAC;YAC3B,MAAM,UAAU,GAAG,aAAa,CAAC,UAAU,CAAC,UAAU,CAAC,SAAS,CAAC,WAAW,EAAE,WAAW,CAAC,CAAC;YAC3F,MAAM,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC;YACxB,MAAM,OAAO,GAAG,uBAAuB,CAAC,YAAY,CAAC,UAAU,CAAC,CAAC;YACjE,MAAM,CAAC,WAAW,CAAC,OAAO,CAAC,SAAS,EAAE,EAAE,+BAA+B,CAAC,CAAC;QAC3E,CAAC,CAAC,CAAC;IACL,CAAC,CAAC,CAAC;IAEH,QAAQ,CAAC,KAAK,EAAE;QACd,EAAE,CAAC,qBAAqB,EAAE,KAAK;YAC7B,MAAM,EAAC,WAAW,EAAC,GAAG,MAAM,WAAW,CAAC,WAAW,CAAC,IAAI,EAAE,kCAAkC,CAAC,CAAC;YAC9F,kBAAkB;YAClB,MAAM,SAAS,GAAG,WAAW,CAAC,QAAQ,CAAC,eAAe,CAAC,IAAI,CAAC,KAAK,CAAC,EAAE,CAAC,KAAK,CAAC,EAAE,KAAK,YAAY,CAAC,CAAC;YAChG,MAAM,CAAC,MAAM,CAAC,SAAS,CAAC,CAAC;YACzB,MAAM,UAAU,GAAG,aAAa,CAAC,UAAU,CAAC,UAAU,CAAC,SAAS,CAAC,SAAS,EAAE,WAAW,CAAC,CAAC;YACzF,MAAM,CAAC,MAAM,CAAC,UAAU,CAAC,CAAC;YAE1B,MAAM,KAAK,GAAG,IAAI,gBAAgB,CAC9B;gBACE,UAAU,EAAE,cAAc,CAAC,CAAC,CAAC;4BAC3B,WAAW,EAAE,oBAAoB;4BACjC,QAAQ,EAAE;gCACR,WAAW,EAAE,GAAG;6BACjB;yBACF,CAAC,CAAC,CAAC;aACL,2DAC4B,CAAC;YAElC,MAAM,OAAO,GAAG,uBAAuB,CAAC,YAAY,CAAC,UAAU,CAAC,CAAC;YACjE,MAAM,SAAS,GAAG,MAAM,KAAK,CAAC,SAAS,CAAC,KAAK,CAAC,GAAG,CAAC,MAAM,EAAE,EAAC,QAAQ,EAAE,OAAO,EAAC,CAAC,CAAC,CAAC;YAChF,MAAM,YAAY,GAAG,MAAM;gBACvB;;;;;;iBAMO,CAAC,IAAI,EAAE,CAAC;YAEnB,MAAM,CAAC,SAAS,CAAC,SAAS,EAAE;gBAC1B;oBACE,IAAI,4CAAyB;oBAC7B,KAAK,EAAE,MAAM;oBACb,UAAU,EAAE,SAAS;oBACrB,OAAO,EAAE,SAAS;iBACnB;gBACD;oBACE,IAAI,sCAAsB;oBAC1B,KAAK,EAAE,qBAAqB;oBAC5B,OAAO,EAAE;wBACP,EAAC,KAAK,EAAE,oBAAoB,EAAE,IAAI,EAAE,YAAY,EAAC;qBAClD;iBACF;gBACD;oBACE,IAAI,wCAAuB;iBAC5B;gBACD;oBACE,IAAI,oCAAqB;oBACzB,IAAI,EAAE,oBAAoB;oBAC1B,QAAQ,EAAE,IAAI;oBACd,WAAW,EAAE,SAAS;oBACtB,KAAK,EAAE,GAAG;iBACX;aACF,CAAC,CAAC;YAEH,MAAM,CAAC,SAAS,CAAC,KAAK,CAAC,YAAY,CAAC,EAAC,IAAI,EAAE,EAAE,EAAC,EAAE,IAAI,CAAC,UAAU,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,mBAAmB,EAAE;gBAC9F;oBACE,IAAI,EAAE,CAAC;oBACP,KAAK,EAAE,CAAC,EAAC,IAAI,EAAE,GAAG,UAAU,CAAC,SAAS,EAAE,4BAA4B,EAAC,CAAC;iBACvE;gBACD;oBACE,IAAI,EAAE,CAAC;oBACP,KAAK,EAAE,CAAC,EAAC,IAAI,EAAE,oBAAoB,EAAC,CAAC;iBACtC;aACF,CAAC,CAAC;QACL,CAAC,CAAC,CAAC;IACL,CAAC,CAAC,CAAC;IAEH,QAAQ,CAAC,cAAc,EAAE,GAAG,EAAE;QAC5B,EAAE,CAAC,8FAA8F,EAAE,KAAK,IAAI,EAAE;YAC5G,MAAM,KAAK,GAAG,IAAI,gBAAgB,CAC9B;gBACE,UAAU,EAAE,EAAgC;aAC7C,2DAC4B,CAAC;YAElC,MAAM,cAAc,GAAG;gBACrB,SAAS,EAAE,GAAG,EAAE,CAAC,gBAAgB;aACgB,CAAC;YAEpD,MAAM,QAAQ,GAAG,uBAAuB,CAAC,YAAY,CAAC,cAAc,CAAC,CAAC;YACtE,MAAM,QAAQ,GAAG,uBAAuB,CAAC,YAAY,CAAC,cAAc,CAAC,CAAC;YACtE,MAAM,QAAQ,GAAG,uBAAuB,CAAC,YAAY,CAAC,cAAc,CAAC,CAAC;YAEtE,MAAM,cAAc,GAAG,MAAM,KAAK,CAAC,YAAY,CAAC,eAAe,EAAE,QAAQ,CAAC,CAAC;YAC3E,MAAM,CAAC,WAAW,CAAC,cAAc,EAAE,mDAAmD,CAAC,CAAC;YAExF,MAAM,MAAM,GAAG,yCAAyC,CAAC;YACzD,MAAM,cAAc,GAAG,MAAM,KAAK,CAAC,YAAY,CAAC,MAAM,EAAE,QAAQ,CAAC,CAAC;YAClE,MAAM,CAAC,WAAW,CAAC,cAAc,EAAE,MAAM,CAAC,CAAC;YAC3C,MAAM,CAAC,OAAO,CAAC,cAAc,CAAC,QAAQ,CAAC,cAAc,CAAC,SAAS,EAAE,CAAC,CAAC,CAAC;YAEpE,iEAAiE;YACjE,MAAM,MAAM,GAAG,wBAAwB,CAAC;YACxC,MAAM,cAAc,GAAG,MAAM,KAAK,CAAC,YAAY,CAAC,MAAM,EAAE,QAAQ,CAAC,CAAC;YAClE,MAAM,CAAC,WAAW,CAAC,cAAc,EAAE,MAAM,CAAC,CAAC;YAC3C,MAAM,CAAC,OAAO,CAAC,cAAc,CAAC,QAAQ,CAAC,cAAc,CAAC,SAAS,EAAE,CAAC,CAAC,CAAC;QACtE,CAAC,CAAC,CAAC;IACL,CAAC,CAAC,CAAC;AACL,CAAC,CAAC,CAAC;AAEH,MAAM,cAAc,GAAG;IACrB,UAAU,qEAAgD;IAC1D,OAAO,EAAE,EAAE;IACX,KAAK,EAAE,eAAkD;IACzD,WAAW,EAAE,kBAAqD;IAClE,QAAQ,EAAE,KAAK,CAAC,QAAQ,CAAC,KAAK,CAAC,eAAe,CAAC,GAAG;IAClD,KAAK,EAAE,MAAM;IACb,OAAO,EAAE,KAAK;CACN,CAAC;AACX,MAAM,uBAAuB,GACzB,KAAK,CAAC,OAAO,CAAC,MAAM,CAAC,2BAA2B,CAAC,CAA6B,EAAE,CAA6B,CAAC,CAAC;AACnH,MAAM,cAAc,GAAG;IACrB,UAAU,qEAAgD;IAC1D,OAAO,EAAE,EAAE;IACX,KAAK,EAAE,eAAkD;IACzD,WAAW,EAAE,kBAAqD;IAClE,QAAQ,EAAE,KAAK,CAAC,QAAQ,CAAC,KAAK,CAAC,eAAe,CAAC,GAAG;IAClD,KAAK,EAAE,MAAM;IACb,OAAO,EAAE,KAAK;CACN,CAAC;AACX,MAAM,iBAAiB,GAAG;IACxB,IAAI,EAAE,EAAC,WAAW,EAAE,EAAC,GAAG,EAAE,CAAC,EAAE,GAAG,EAAE,EAAE,EAAC,EAAC;CACQ,CAAC;AAEjD,SAAS,iCAAiC,CAAC,OAAkD,EAAE;IAC7F,OAAO,IAAI,gBAAgB,CAAC,EAAC,UAAU,EAAE,IAAI,CAAC,UAAU,IAAI,cAAc,EAAE,EAAC,mEAAuC,CAAC;AACvH,CAAC;AAED,uBAAuB,CAAC,kCAAkC,EAAE,GAAG,EAAE;IAC/D,EAAE,CAAC,wDAAwD,EAAE,KAAK;QAChE,MAAM,EAAC,WAAW,EAAE,QAAQ,EAAC,GAAG,MAAM,WAAW,CAAC,WAAW,CAAC,IAAI,EAAE,oBAAoB,CAAC,CAAC;QAC1F,MAAM,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;QACtB,MAAM,CAAC,QAAQ,CAAC,GAAG,WAAW,CAAC,IAAI,CAAC,oBAAoB,CAAC;QACzD,MAAM,YAAY,GAAG,iBAAiB,CAAC,cAAc,EAAE,QAAQ,EAAE,QAAQ,CAAC,CAAC;QAC3E,MAAM,UAAU,GAAG,oBAAoB,CAAC,QAAQ,EAAE,QAAQ,CAAC,CAAC;QAC5D,MAAM,OAAO,GAAG,uBAAuB,CAAC,WAAW,CAAC,WAAW,EAAE,YAAY,EAAE,UAAU,CAAC,MAAM,CAAC,CAAC;QAClG,MAAM,CAAC,WAAW,CAAC,OAAO,CAAC,SAAS,EAAE,EAAE,iCAAiC,CAAC,CAAC;IAC7E,CAAC,CAAC,CAAC;IAEH,EAAE,CAAC,kDAAkD,EAAE,KAAK,IAAI,EAAE;QAChE,MAAM,OAAO,GAAG,uBAAuB,CAAC,WAAW,CAAC,iBAAiB,EAAE,cAAc,EAAE,uBAAuB,CAAC,CAAC;QAChH,MAAM,CAAC,WAAW,CAAC,OAAO,CAAC,QAAQ,EAAE,EAAE,wBAAwB,CAAC,CAAC;IACnE,CAAC,CAAC,CAAC;IAEH,iDAAiD;IACjD,QAAQ,CAAC,wBAAwB,EAAE,GAAG,EAAE;QACtC,EAAE,CAAC,iDAAiD,EAAE,KAAK,IAAI,EAAE;YAC/D,MAAM,KAAK,GAAG,iCAAiC,EAAE,CAAC;YAClD,MAAM,QAAQ,GAAG,KAAK,CAAC,iBAAiB,CAAC,uBAAuB,CAAC,CAAC;YAClE,MAAM,CAAC,SAAS,CAAC,QAAQ,EAAE,EAAC,MAAM,EAAE,aAAa,EAAC,CAAC,CAAC;QACtD,CAAC,CAAC,CAAC;QAEH,EAAE,CAAC,0CAA0C,EAAE,KAAK,IAAI,EAAE;YACxD,MAAM,KAAK,GAAG,iCAAiC,EAAE,CAAC;YAClD,MAAM,QAAQ,GAAG,KAAK,CAAC,iBAAiB,CAAC,2BAA2B,CAAC,CAAC;YACtE,MAAM,CAAC,SAAS,CAAC,QAAQ,EAAE,EAAC,MAAM,EAAE,aAAa,EAAC,CAAC,CAAC;QACtD,CAAC,CAAC,CAAC;QAEH,EAAE,CAAC,qFAAqF,EAAE,KAAK,IAAI,EAAE;YACnG,MAAM,KAAK,GAAG,iCAAiC,EAAE,CAAC;YAClD,MAAM,QAAQ,GAAG,KAAK,CAAC,iBAAiB,CAAC,+BAA+B,CAAC,CAAC;YAC1E,MAAM,CAAC,SAAS,CAAC,QAAQ,EAAE,EAAC,MAAM,EAAE,+BAA+B,EAAC,CAAC,CAAC;QACxE,CAAC,CAAC,CAAC;QAEH,EAAE,CAAC,iGAAiG,EAAE,KAAK,IAAI,EAAE;YAC/G,MAAM,KAAK,GAAG,iCAAiC,EAAE,CAAC;YAClD,MAAM,QAAQ,GAAG,KAAK,CAAC,iBAAiB,CAAC,6BAA6B,CAAC,CAAC;YACxE,MAAM,CAAC,SAAS,CAAC,QAAQ,EAAE,EAAC,MAAM,EAAE,mBAAmB,EAAC,CAAC,CAAC;QAC5D,CAAC,CAAC,CAAC;QAEH,EAAE,CAAC,0CAA0C,EAAE,KAAK,IAAI,EAAE;YACxD,MAAM,KAAK,GAAG,iCAAiC,EAAE,CAAC;YAClD,MAAM,QAAQ,GAAG,KAAK,CAAC,iBAAiB,CAAC,qCAAqC,CAAC,CAAC;YAChF,MAAM,CAAC,SAAS,CAAC,QAAQ,EAAE,EAAC,MAAM,EAAE,qCAAqC,EAAC,CAAC,CAAC;QAC9E,CAAC,CAAC,CAAC;QAEH,EAAE,CAAC,2CAA2C,EAAE,KAAK,IAAI,EAAE;YACzD,MAAM,KAAK,GAAG,iCAAiC,EAAE,CAAC;YAClD,MAAM,QAAQ,GAAG,KAAK,CAAC,iBAAiB,CAAC;;OAExC,CAAC,CAAC;YACH,MAAM,CAAC,SAAS,CAAC,QAAQ,EAAE;gBACzB,MAAM,EAAE;;OAET;aACA,CAAC,CAAC;QACL,CAAC,CAAC,CAAC;IACL,CAAC,CAAC,CAAC;IAEH,QAAQ,CAAC,sBAAsB,EAAE,GAAG,EAAE;QACpC,EAAE,CAAC,+DAA+D,EAAE,KAAK,IAAI,EAAE;YAC7E,MAAM,OAAO,GAAG,uBAAuB,CAAC,WAAW,CAAC,iBAAiB,EAAE,cAAc,EAAE,uBAAuB,CAAC,CAAC;YAChH,MAAM,KAAK,GAAG,iCAAiC,CAAC;gBAC9C,UAAU,EAAE,cAAc,CAAC,CAAC,CAAC;4BAC3B,WAAW,EAAE,oBAAoB;4BACjC,QAAQ,EAAE;gCACR,WAAW,EAAE,GAAG;6BACjB;yBACF,CAAC,CAAC,CAAC;aACL,CAAC,CAAC;YAEH,MAAM,kBAAkB,GAAG,IAAI,2BAA2B,CAAC,iBAAiB,EAAE,cAAc,CAAC,CAAC,aAAa,EAAE,CAAC;YAE9G,MAAM,SAAS,GAAG,MAAM,KAAK,CAAC,SAAS,CAAC,KAAK,CAAC,GAAG,CAAC,MAAM,EAAE,EAAC,QAAQ,EAAE,OAAO,EAAC,CAAC,CAAC,CAAC;YAChF,MAAM,CAAC,SAAS,CAAC,SAAS,EAAE;gBAC1B;oBACE,IAAI,4CAAyB;oBAC7B,KAAK,EAAE,MAAM;oBACb,UAAU,EAAE,SAAS;oBACrB,OAAO,EAAE,SAAS;iBACnB;gBACD;oBACE,IAAI,sCAAsB;oBAC1B,KAAK,EAAE,kCAAkC;oBACzC,OAAO,EAAE;wBACP,EAAC,KAAK,EAAE,eAAe,EAAE,IAAI,EAAE,kBAAkB,EAAC;qBACnD;iBACF;gBACD;oBACE,IAAI,wCAAuB;iBAC5B;gBACD;oBACE,IAAI,oCAAqB;oBACzB,IAAI,EAAE,oBAAoB;oBAC1B,QAAQ,EAAE,IAAI;oBACd,WAAW,EAAE,SAAS;oBACtB,KAAK,EAAE,GAAG;iBACX;aACF,CAAC,CAAC;QACL,CAAC,CAAC,CAAC;IACL,CAAC,CAAC,CAAC;IAEH,QAAQ,CAAC,cAAc,EAAE,GAAG,EAAE;QAC5B,EAAE,CAAC,6CAA6C,EAAE,KAAK,IAAI,EAAE;YAC3D,MAAM,KAAK,GAAG,iCAAiC,CAAC;gBAC9C,UAAU,EAAE,EAAgC;aAC7C,CAAC,CAAC;YAEH,MAAM,OAAO,GAAG,uBAAuB,CAAC,WAAW,CAAC,iBAAiB,EAAE,cAAc,EAAE,uBAAuB,CAAC,CAAC;YAChH,MAAM,YAAY,GAAG,IAAI,2BAA2B,CAAC,iBAAiB,EAAE,cAAc,CAAC,CAAC,aAAa,EAAE,CAAC;YAExG,MAAM,UAAU,GAAG,MAAM,KAAK,CAAC,YAAY,CAAC,eAAe,EAAE,OAAO,CAAC,CAAC;YACtE,MAAM,QAAQ,GAAG,GAAG,YAAY;;;cAGxB,CAAC;YAET,MAAM,CAAC,WAAW,CAAC,UAAU,EAAE,QAAQ,CAAC,CAAC;QAC3C,CAAC,CAAC,CAAC;QAEH,EAAE,CAAC,sEAAsE,EAAE,KAAK,IAAI,EAAE;YACpF,MAAM,KAAK,GAAG,iCAAiC,CAAC;gBAC9C,UAAU,EAAE,EAAgC;aAC7C,CAAC,CAAC;YAEH,MAAM,OAAO,GAAG,uBAAuB,CAAC,WAAW,CAAC,iBAAiB,EAAE,cAAc,EAAE,uBAAuB,CAAC,CAAC;YAEhH,MAAM,KAAK,CAAC,YAAY,CAAC,eAAe,EAAE,OAAO,CAAC,CAAC;YACnD,MAAM,UAAU,GAAG,MAAM,KAAK,CAAC,YAAY,CAAC,qBAAqB,EAAE,OAAO,CAAC,CAAC;YAC5E,MAAM,QAAQ,GAAG;oBACH,CAAC;YAEf,MAAM,CAAC,WAAW,CAAC,UAAU,EAAE,QAAQ,CAAC,CAAC;QAC3C,CAAC,CAAC,CAAC;QAEH,EAAE,CAAC,4DAA4D,EAAE,KAAK,IAAI,EAAE;YAC1E,MAAM,KAAK,GAAG,iCAAiC,CAAC;gBAC9C,UAAU,EAAE,EAAgC;aAC7C,CAAC,CAAC;YACH,MAAM,QAAQ,GAAG,uBAAuB,CAAC,WAAW,CAAC,iBAAiB,EAAE,cAAc,EAAE,uBAAuB,CAAC,CAAC;YACjH,MAAM,QAAQ,GAAG,uBAAuB,CAAC,WAAW,CAAC,iBAAiB,EAAE,cAAc,EAAE,uBAAuB,CAAC,CAAC;YACjH,MAAM,UAAU,GAAG,MAAM,KAAK,CAAC,YAAY,CAAC,IAAI,EAAE,QAAQ,CAAC,CAAC;YAC5D,MAAM,WAAW,GAAG,MAAM,KAAK,CAAC,YAAY,CAAC,IAAI,EAAE,QAAQ,CAAC,CAAC;YAC7D,MAAM,UAAU,GAAG,MAAM,KAAK,CAAC,YAAY,CAAC,IAAI,EAAE,QAAQ,CAAC,CAAC;YAC5D,MAAM,CAAC,OAAO,CAAC,UAAU,EAAE,iCAAiC,CAAC,CAAC;YAC9D,MAAM,CAAC,UAAU,CAAC,WAAW,EAAE,kBAAkB,CAAC,CAAC;YACnD,MAAM,CAAC,OAAO,CAAC,UAAU,EAAE,iCAAiC,CAAC,CAAC;QAChE,CAAC,CAAC,CAAC;IACL,CAAC,CAAC,CAAC;IAEH,QAAQ,CAAC,gBAAgB,EAAE,GAAG,EAAE;QAC9B,EAAE,CAAC,kEAAkE,EAAE,KAAK;YAC1E,MAAM,UAAU,GAAG,KAAK,CAAC,GAAG,CAAC,IAAI,CAAC,WAAW,EAAE,yCAAyC,CAAC,CAAC;YAC1F,MAAM,EAAC,WAAW,EAAE,QAAQ,EAAC,GAAG,MAAM,WAAW,CAAC,WAAW,CAAC,IAAI,EAAE,oBAAoB,CAAC,CAAC;YAC1F,MAAM,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;YACtB,MAAM,CAAC,QAAQ,CAAC,GAAG,WAAW,CAAC,IAAI,CAAC,oBAAoB,CAAC;YACzD,MAAM,UAAU,GAAG,oBAAoB,CAAC,QAAQ,EAAE,QAAQ,CAAC,CAAC;YAC5D,MAAM,YAAY,GAAG,iBAAiB,CAAC,cAAc,EAAE,QAAQ,EAAE,QAAQ,CAAC,CAAC;YAC3E,MAAM,KAAK,GAAG,iCAAiC,CAAC;gBAC9C,UAAU,EAAE,cAAc,CAAC;oBACzB,CAAC,EAAC,WAAW,EAAE,EAAE,EAAE,aAAa,EAAE,CAAC,EAAC,IAAI,EAAE,2BAA2B,EAAE,IAAI,EAAE,EAAE,EAAC,CAAC,EAAC,CAAC,EAAE,CAAC,EAAC,WAAW,EAAE,MAAM,EAAC,CAAC;iBAC7G,CAAC;aACH,CAAC,CAAC;YACH,MAAM,OAAO,GAAG,uBAAuB,CAAC,WAAW,CAAC,WAAW,EAAE,YAAY,EAAE,UAAU,CAAC,MAAM,CAAC,CAAC;YAElG,MAAM,SAAS,GAAG,MAAM,KAAK,CAAC,SAAS,CAAC,KAAK,CAAC,GAAG,CAAC,MAAM,EAAE,EAAC,QAAQ,EAAE,OAAO,EAAC,CAAC,CAAC,CAAC;YAChF,MAAM,MAAM,GAAG,SAAS,CAAC,IAAI,CAAC,QAAQ,CAAC,EAAE,CAAC,QAAQ,CAAC,IAAI,uCAAwB,CAAC,CAAC;YAEjF,4DAA4D;YAC5D,MAAM,mBAAmB,GAAG;gBAC1B,iFAAiF;gBACjF,kEAAkE;gBAClE,8EAA8E;gBAC9E,oCAAoC,EAAE,sCAAsC;aAC7E,CAAC;YAEF,MAAM,QAAQ,GAAG,mBAAmB,CAAC,GAAG,CAAC,GAAG,CAAC,EAAE;gBAC7C,MAAM,KAAK,GAAG,WAAW,CAAC,eAAe,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,GAAG,KAAK,GAAG,CAAC,CAAC;gBACpF,MAAM,CAAC,IAAI,CAAC,KAAK,EAAE,wBAAwB,GAAG,EAAE,CAAC,CAAC;gBAClD,OAAO,KAAK,CAAC;YACf,CAAC,CAAC,CAAC;YAEH,MAAM,sBAAsB,GAAG,mBAAmB,CAAC,eAAe,CAAC,QAAQ,EAAE,WAAW,CAAC,CAAC;YAE1F,MAAM,iBAAiB,GAAG,QAAQ,CAAC,eAAe,CAAC,cAAc,CAAC,sBAAsB,CAAC,CAAC;YAC1F,KAAK,CAAC,MAAM,CAAC,UAAU,CAAC,UAAU,EAAE,iBAAiB,CAAC,CAAC;YAEvD,MAAM,cAAc,GAAG,IAAI,CAAC,SAAS,CAAC,EAAC,QAAQ,EAAE,sBAAsB,EAAC,CAAC,CAAC;YAC1E,MAAM,aAAa,GAAG,SAAS,CAAC,IAAI,CAAC,QAAQ,CAAC,EAAE,CAAC,QAAQ,CAAC,IAAI,qCAAuB,CAAC,CAAC;YACvF,MAAM,CAAC,MAAM,CAAC,aAAa,CAAC,CAAC;YAC7B,MAAM,CAAC,WAAW,CAAC,aAAa,CAAC,KAAK,EAAE,iCAAiC,CAAC,CAAC;YAE3E,MAAM,CAAC,MAAM,CAAC,MAAM,CAAC,CAAC;YACtB,MAAM,CAAC,SAAS,CAAC,MAAM,EAAE;gBACvB,IAAI,EAAE,QAAkC;gBACxC,MAAM,EAAE,cAAc;gBACtB,IAAI,EAAE,6BAA6B;gBACnC,QAAQ,EAAE,KAAK;aAChB,CAAC,CAAC;QACL,CAAC,CAAC,CAAC;QAEH,EAAE,CAAC,uEAAuE,EAAE,KAAK;YAC/E,MAAM,UAAU,GAAG,KAAK,CAAC,GAAG,CAAC,IAAI,CAAC,WAAW,EAAE,+CAA+C,CAAC,CAAC;YAEhG,MAAM,EAAC,WAAW,EAAE,QAAQ,EAAC,GAAG,MAAM,WAAW,CAAC,WAAW,CAAC,IAAI,EAAE,oBAAoB,CAAC,CAAC;YAC1F,MAAM,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;YACtB,MAAM,CAAC,QAAQ,CAAC,GAAG,WAAW,CAAC,IAAI,CAAC,oBAAoB,CAAC;YACzD,MAAM,YAAY,GAAG,iBAAiB,CAAC,cAAc,EAAE,QAAQ,EAAE,QAAQ,CAAC,CAAC;YAC3E,MAAM,UAAU,GAAG,oBAAoB,CAAC,QAAQ,EAAE,QAAQ,CAAC,CAAC;YAC5D,MAAM,UAAU,GAAG,8EAA8E,CAAC;YAClG,MAAM,KAAK,GAAG,iCAAiC,CAAC;gBAC9C,UAAU,EAAE,cAAc,CAAC;oBACzB,CAAC,EAAC,WAAW,EAAE,EAAE,EAAE,aAAa,EAAE,CAAC,EAAC,IAAI,EAAE,yBAAyB,EAAE,IAAI,EAAE,EAAC,GAAG,EAAE,UAAU,EAAC,EAAC,CAAC,EAAC,CAAC;oBAChG,CAAC,EAAC,WAAW,EAAE,MAAM,EAAC,CAAC;iBACxB,CAAC;aACH,CAAC,CAAC;YACH,MAAM,OAAO,GAAG,uBAAuB,CAAC,WAAW,CAAC,WAAW,EAAE,YAAY,EAAE,UAAU,CAAC,MAAM,CAAC,CAAC;YAElG,MAAM,SAAS,GAAG,MAAM,KAAK,CAAC,SAAS,CAAC,KAAK,CAAC,GAAG,CAAC,MAAM,EAAE,EAAC,QAAQ,EAAE,OAAO,EAAC,CAAC,CAAC,CAAC;YAChF,MAAM,aAAa,GAAG,SAAS,CAAC,IAAI,CAAC,QAAQ,CAAC,EAAE,CAAC,QAAQ,CAAC,IAAI,qCAAuB,CAAC,CAAC;YACvF,MAAM,CAAC,MAAM,CAAC,aAAa,CAAC,CAAC;YAC7B,MAAM,CAAC,WAAW,CAAC,aAAa,CAAC,KAAK,EAAE,iCAAiC,UAAU,GAAG,CAAC,CAAC;YACxF,MAAM,MAAM,GAAG,SAAS,CAAC,IAAI,CAAC,QAAQ,CAAC,EAAE,CAAC,QAAQ,CAAC,IAAI,uCAAwB,CAAC,CAAC;YACjF,MAAM,OAAO,GAAG,WAAW,CAAC,eAAe,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,GAAG,KAAK,UAAU,CAAC,CAAC;YAC7F,MAAM,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC;YAErB,MAAM,qBAAqB,GAAG,mBAAmB,CAAC,eAAe,CAAC,CAAC,OAAO,CAAC,EAAE,WAAW,EAAE,EAAC,OAAO,EAAE,IAAI,EAAC,CAAC,CAAC;YAC3G,MAAM,cAAc,GAAG,IAAI,CAAC,SAAS,CAAC,EAAC,OAAO,EAAE,qBAAqB,EAAC,CAAC,CAAC;YAExE,MAAM,iBAAiB,GAAG,QAAQ,CAAC,eAAe,CAAC,cAAc,CAAC,qBAAqB,CAAC,CAAC;YACzF,KAAK,CAAC,MAAM,CAAC,UAAU,CAAC,UAAU,EAAE,iBAAiB,CAAC,CAAC;YAEvD,MAAM,CAAC,MAAM,CAAC,MAAM,CAAC,CAAC;YACtB,MAAM,CAAC,SAAS,CAAC,MAAM,EAAE;gBACvB,IAAI,EAAE,QAAkC;gBACxC,MAAM,EAAE,cAAc;gBACtB,IAAI,EAAE,4BAA4B,UAAU,IAAI;gBAChD,QAAQ,EAAE,KAAK;aAChB,CAAC,CAAC;QACL,CAAC,CAAC,CAAC;QAEH,EAAE,CAAC,6BAA6B,EAAE,KAAK;YACrC,MAAM,UAAU,GAAG,KAAK,CAAC,GAAG,CAAC,IAAI,CAAC,WAAW,EAAE,6CAA6C,CAAC,CAAC;YAE9F,MAAM,EAAC,WAAW,EAAE,QAAQ,EAAC,GAAG,MAAM,WAAW,CAAC,WAAW,CAAC,IAAI,EAAE,6BAA6B,CAAC,CAAC;YACnG,MAAM,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;YACtB,MAAM,CAAC,QAAQ,CAAC,GAAG,WAAW,CAAC,IAAI,CAAC,oBAAoB,CAAC;YACzD,MAAM,UAAU,GAAG,oBAAoB,CAAC,QAAQ,EAAE,QAAQ,CAAC,CAAC;YAC5D,MAAM,YAAY,GAAG,iBAAiB,CAAC,cAAc,EAAE,QAAQ,EAAE,QAAQ,CAAC,CAAC;YAC3E,MAAM,KAAK,GAAG,iCAAiC,CAAC;gBAC9C,UAAU,EAAE,cAAc,CACtB,CAAC,CAAC,EAAC,WAAW,EAAE,EAAE,EAAE,aAAa,EAAE,CAAC,EAAC,IAAI,EAAE,uBAAuB,EAAE,IAAI,EAAE,EAAE,EAAC,CAAC,EAAC,CAAC,EAAE,CAAC,EAAC,WAAW,EAAE,MAAM,EAAC,CAAC,CAAC,CAAC;aAChH,CAAC,CAAC;YACH,MAAM,OAAO,GAAG,uBAAuB,CAAC,WAAW,CAAC,WAAW,EAAE,YAAY,EAAE,UAAU,CAAC,MAAM,CAAC,CAAC;YAElG,MAAM,SAAS,GAAG,MAAM,KAAK,CAAC,SAAS,CAAC,KAAK,CAAC,GAAG,CAAC,MAAM,EAAE,EAAC,QAAQ,EAAE,OAAO,EAAC,CAAC,CAAC,CAAC;YAChF,MAAM,aAAa,GAAG,SAAS,CAAC,IAAI,CAAC,QAAQ,CAAC,EAAE,CAAC,QAAQ,CAAC,IAAI,qCAAuB,CAAC,CAAC;YACvF,MAAM,CAAC,MAAM,CAAC,aAAa,CAAC,CAAC;YAC7B,MAAM,CAAC,WAAW,CAAC,aAAa,CAAC,KAAK,EAAE,qCAAqC,CAAC,CAAC;YAE/E,MAAM,MAAM,GAAG,SAAS,CAAC,IAAI,CAAC,QAAQ,CAAC,EAAE,CAAC,QAAQ,CAAC,IAAI,uCAAwB,CAAC,CAAC;YACjF,MAAM,CAAC,MAAM,CAAC,MAAM,CAAC,CAAC;YAEtB,MAAM,YAAY,GACd,aAAa,CAAC,gBAAgB,CAAC,SAAS,CAAC,kBAAkB,CAAC,YAAY,EAAE,UAAU,CAAC,MAAM,EAAE,WAAW,CAAC,CAAC;YAC9G,MAAM,CAAC,IAAI,CAAC,YAAY,CAAC,CAAC;YAE1B,MAAM,iBAAiB,GAAG,QAAQ,CAAC,eAAe,CAAC,cAAc,CAAC,YAAY,CAAC,SAAS,EAAE,CAAC,CAAC;YAC5F,KAAK,CAAC,MAAM,CAAC,UAAU,CAAC,UAAU,EAAE,iBAAiB,CAAC,CAAC;YAEvD,MAAM,cAAc,GAAG,IAAI,CAAC,SAAS,CAAC,EAAC,QAAQ,EAAE,YAAY,CAAC,SAAS,EAAE,EAAC,CAAC,CAAC;YAE5E,MAAM,CAAC,SAAS,CAAC,MAAM,EAAE;gBACvB,IAAI,EAAE,QAAkC;gBACxC,MAAM,EAAE,cAAc;gBACtB,IAAI,EAAE,yBAAyB;gBAC/B,QAAQ,EAAE,KAAK;aAChB,CAAC,CAAC;QACL,CAAC,CAAC,CAAC;QAEH,EAAE,CAAC,oFAAoF,EAAE,KAAK;YAC5F,MAAM,EAAC,WAAW,EAAE,QAAQ,EAAC,GAAG,MAAM,WAAW,CAAC,WAAW,CAAC,IAAI,EAAE,oBAAoB,CAAC,CAAC;YAC1F,MAAM,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;YACtB,MAAM,CAAC,QAAQ,CAAC,GAAG,WAAW,CAAC,IAAI,CAAC,oBAAoB,CAAC;YACzD,MAAM,UAAU,GAAG,oBAAoB,CAAC,QAAQ,EAAE,QAAQ,CAAC,CAAC;YAC5D,MAAM,YAAY,GAAG,iBAAiB,CAAC,cAAc,EAAE,QAAQ,EAAE,QAAQ,CAAC,CAAC;YAC3E,MAAM,KAAK,GAAG,iCAAiC,CAAC;gBAC9C,UAAU,EAAE,cAAc,CAAC;oBACzB,CAAC,EAAC,WAAW,EAAE,EAAE,EAAE,aAAa,EAAE,CAAC,EAAC,IAAI,EAAE,2BAA2B,EAAE,IAAI,EAAE,EAAE,EAAC,CAAC,EAAC,CAAC,EAAE,CAAC,EAAC,WAAW,EAAE,MAAM,EAAC,CAAC;iBAC7G,CAAC;aACH,CAAC,CAAC;YACH,MAAM,OAAO,GAAG,uBAAuB,CAAC,WAAW,CAAC,WAAW,EAAE,YAAY,EAAE,UAAU,CAAC,MAAM,CAAC,CAAC;YAElG,yEAAyE;YACzE,MAAM,SAAS,GAAG,MAAM,KAAK,CAAC,SAAS,CAAC,KAAK,CAAC,GAAG,CAAC,MAAM,EAAE,EAAC,QAAQ,EAAE,OAAO,EAAC,CAAC,CAAC,CAAC;YAChF,MAAM,MAAM,GAAG,SAAS,CAAC,IAAI,CAAC,QAAQ,CAAC,EAAE,CAAC,QAAQ,CAAC,IAAI,uCAAwB,CAAC,CAAC;YACjF,MAAM,CAAC,MAAM,CAAC,MAAM,CAAC,CAAC;YACtB,MAAM,CAAC,WAAW,CAAC,MAAM,CAAC,IAAI,EAAE,6BAA6B,CAAC,CAAC;YAE/D,iEAAiE;YACjE,MAAM,KAAK,CAAC,SAAS,CAAC,KAAK,CAAC,GAAG,CAAC,QAAQ,EAAE,EAAC,QAAQ,EAAE,OAAO,EAAC,CAAC,CAAC,CAAC;YAEhE,MAAM,CAAC,WAAW,CAAC,KAAK,CAAC,YAAY,EAAE,CAAC,IAAI,EAAE,CAAC,CAAC,CAAC;YACjD,MAAM,kBAAkB,GAAG,KAAK,CAAC,IAAI,CAAC,KAAK,CAAC,YAAY,EAAE,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC;YAClE,MAAM,CAAC,MAAM,CAAC,kBAAkB,CAAC,CAAC;YAElC,MAAM,mBAAmB,GAAG;gBAC1B,iFAAiF;gBACjF,kEAAkE;gBAClE,8EAA8E;gBAC9E,oCAAoC,EAAE,sCAAsC;aAC7E,CAAC;YACF,kFAAkF;YAClF,MAAM,CAAC,MAAM,CAAC,mBAAmB,CAAC,KAAK,CAAC,GAAG,CAAC,EAAE;gBAC5C,OAAO,kBAAkB,CAAC,IAAI,CAAC,QAAQ,CAAC,GAAG,CAAC,CAAC;YAC/C,CAAC,CAAC,CAAC,CAAC;YAEJ,4FAA4F;YAC5F,MAAM,KAAK,CAAC,SAAS,CAAC,KAAK,CAAC,GAAG,CAAC,QAAQ,EAAE,EAAC,QAAQ,EAAE,OAAO,EAAC,CAAC,CAAC,CAAC;YAEhE,MAAM,CAAC,WAAW,CAAC,KAAK,CAAC,YAAY,EAAE,CAAC,IAAI,EAAE,CAAC,CAAC,CAAC;QACnD,CAAC,CAAC,CAAC;QAEH,EAAE,CAAC,gFAAgF,EAAE,KAAK;YACxF,MAAM,EAAC,WAAW,EAAE,QAAQ,EAAC,GAAG,MAAM,WAAW,CAAC,WAAW,CAAC,IAAI,EAAE,6BAA6B,CAAC,CAAC;YACnG,MAAM,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;YACtB,MAAM,CAAC,QAAQ,CAAC,GAAG,WAAW,CAAC,IAAI,CAAC,oBAAoB,CAAC;YACzD,MAAM,UAAU,GAAG,oBAAoB,CAAC,QAAQ,EAAE,QAAQ,CAAC,CAAC;YAC5D,MAAM,YAAY,GAAG,iBAAiB,CAAC,cAAc,EAAE,QAAQ,EAAE,QAAQ,CAAC,CAAC;YAC3E,MAAM,KAAK,GAAG,iCAAiC,CAAC;gBAC9C,UAAU,EAAE,cAAc,CACtB,CAAC,CAAC,EAAC,WAAW,EAAE,EAAE,EAAE,aAAa,EAAE,CAAC,EAAC,IAAI,EAAE,uBAAuB,EAAE,IAAI,EAAE,EAAE,EAAC,CAAC,EAAC,CAAC,EAAE,CAAC,EAAC,WAAW,EAAE,MAAM,EAAC,CAAC,CAAC,CAAC;aAChH,CAAC,CAAC;YACH,MAAM,OAAO,GAAG,uBAAuB,CAAC,WAAW,CAAC,WAAW,EAAE,YAAY,EAAE,UAAU,CAAC,MAAM,CAAC,CAAC;YAElG,qEAAqE;YACrE,MAAM,SAAS,GAAG,MAAM,KAAK,CAAC,SAAS,CAAC,KAAK,CAAC,GAAG,CAAC,MAAM,EAAE,EAAC,QAAQ,EAAE,OAAO,EAAC,CAAC,CAAC,CAAC;YAChF,MAAM,MAAM,GAAG,SAAS,CAAC,IAAI,CAAC,QAAQ,CAAC,EAAE,CAAC,QAAQ,CAAC,IAAI,uCAAwB,CAAC,CAAC;YACjF,MAAM,CAAC,MAAM,CAAC,MAAM,CAAC,CAAC;YACtB,MAAM,CAAC,WAAW,CAAC,MAAM,CAAC,IAAI,EAAE,yBAAyB,CAAC,CAAC;YAE3D,iEAAiE;YACjE,MAAM,KAAK,CAAC,SAAS,CAAC,KAAK,CAAC,GAAG,CAAC,QAAQ,EAAE,EAAC,QAAQ,EAAE,OAAO,EAAC,CAAC,CAAC,CAAC;YAEhE,MAAM,CAAC,WAAW,CAAC,KAAK,CAAC,YAAY,EAAE,CAAC,IAAI,EAAE,CAAC,CAAC,CAAC;YACjD,MAAM,sBAAsB,GAAG,KAAK,CAAC,IAAI,CAAC,KAAK,CAAC,YAAY,EAAE,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC;YACtE,MAAM,CAAC,MAAM,CAAC,sBAAsB,CAAC,CAAC;YAEtC,MAAM,YAAY,GACd,aAAa,CAAC,gBAAgB,CAAC,SAAS,CAAC,kBAAkB,CAAC,YAAY,EAAE,UAAU,CAAC,MAAM,EAAE,WAAW,CAAC,CAAC;YAC9G,MAAM,CAAC,IAAI,CAAC,YAAY,CAAC,CAAC;YAC1B,MAAM,CAAC,OAAO,CAAC,sBAAsB,CAAC,IAAI,EAAE,YAAY,CAAC,SAAS,EAAE,CAAC,CAAC;YAEtE,4FAA4F;YAC5F,MAAM,KAAK,CAAC,SAAS,CAAC,KAAK,CAAC,GAAG,CAAC,QAAQ,EAAE,EAAC,QAAQ,EAAE,OAAO,EAAC,CAAC,CAAC,CAAC;YAEhE,MAAM,CAAC,WAAW,CAAC,KAAK,CAAC,YAAY,EAAE,CAAC,IAAI,EAAE,CAAC,CAAC,CAAC;QACnD,CAAC,CAAC,CAAC;QAEH,EAAE,CAAC,oEAAoE,EAAE,KAAK;YAC5E,MAAM,EAAC,WAAW,EAAE,QAAQ,EAAC,GAAG,MAAM,WAAW,CAAC,WAAW,CAAC,IAAI,EAAE,6BAA6B,CAAC,CAAC;YACnG,MAAM,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;YACtB,MAAM,CAAC,QAAQ,CAAC,GAAG,WAAW,CAAC,IAAI,CAAC,oBAAoB,CAAC;YACzD,MAAM,UAAU,GAAG,oBAAoB,CAAC,QAAQ,EAAE,QAAQ,CAAC,CAAC;YAC5D,MAAM,YAAY,GAAG,iBAAiB,CAAC,cAAc,EAAE,QAAQ,EAAE,QAAQ,CAAC,CAAC;YAC3E,MAAM,cAAc,GAAG,iBAAiB,CAAC,gBAAgB,EAAE,QAAQ,EAAE,QAAQ,CAAC,CAAC;YAC/E,MAAM,KAAK,GAAG,iCAAiC,CAAC;gBAC9C,UAAU,EAAE,cAAc,CAAC;oBACzB,CAAC,EAAC,WAAW,EAAE,EAAE,EAAE,aAAa,EAAE,CAAC,EAAC,IAAI,EAAE,uBAAuB,EAAE,IAAI,EAAE,EAAE,EAAC,CAAC,EAAC,CAAC;iBAChF,CAAC;aACH,CAAC,CAAC;YACH,MAAM,UAAU,GAAG,uBAAuB,CAAC,WAAW,CAAC,WAAW,EAAE,YAAY,EAAE,UAAU,CAAC,MAAM,CAAC,CAAC;YACrG,MAAM,qBAAqB,GAAG,uBAAuB,CAAC,WAAW,CAAC,WAAW,EAAE,cAAc,EAAE,UAAU,CAAC,MAAM,CAAC,CAAC;YAElH,kDAAkD;YAClD,MAAM,KAAK,CAAC,SAAS,CAAC,KAAK,CAAC,GAAG,CAAC,YAAY,EAAE,EAAC,QAAQ,EAAE,UAAU,EAAC,CAAC,CAAC,CAAC;YACvE,MAAM,KAAK,CAAC,SAAS,CAAC,KAAK,CAAC,GAAG,CAAC,YAAY,EAAE,EAAC,QAAQ,EAAE,UAAU,EAAC,CAAC,CAAC,CAAC;YACvE,MAAM,CAAC,WAAW,CAAC,KAAK,CAAC,YAAY,EAAE,CAAC,IAAI,EAAE,CAAC,CAAC,CAAC;YACjD,6CAA6C;YAC7C,MAAM,KAAK,CAAC,SAAS,CAAC,KAAK,CAAC,GAAG,CAAC,uBAAuB,EAAE,EAAC,QAAQ,EAAE,qBAAqB,EAAC,CAAC,CAAC,CAAC;YAC7F,iEAAiE;YACjE,MAAM,CAAC,WAAW,CAAC,KAAK,CAAC,YAAY,EAAE,CAAC,IAAI,EAAE,CAAC,CAAC,CAAC;QACnD,CAAC,CAAC,CAAC;QAEH,EAAE,CAAC,0BAA0B,EAAE,KAAK;YAClC,MAAM,EAAC,WAAW,EAAE,QAAQ,EAAC,GAAG,MAAM,WAAW,CAAC,WAAW,CAAC,IAAI,EAAE,6BAA6B,CAAC,CAAC;YACnG,MAAM,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;YACtB,MAAM,CAAC,QAAQ,CAAC,GAAG,WAAW,CAAC,IAAI,CAAC,oBAAoB,CAAC;YACzD,MAAM,UAAU,GAAG,oBAAoB,CAAC,QAAQ,EAAE,QAAQ,CAAC,CAAC;YAC5D,MAAM,YAAY,GAAG,iBAAiB,CAAC,cAAc,EAAE,QAAQ,EAAE,QAAQ,CAAC,CAAC;YAC3E,MAAM,KAAK,GAAG,iCAAiC,CAAC;gBAC9C,UAAU,EAAE,cAAc,CAAC;oBACzB,CAAC,EAAC,WAAW,EAAE,EAAE,EAAE,aAAa,EAAE,CAAC,EAAC,IAAI,EAAE,uBAAuB,EAAE,IAAI,EAAE,EAAE,EAAC,CAAC,EAAC,CAAC;oBAC/E,CAAC,EAAC,WAAW,EAAE,EAAE,EAAE,aAAa,EAAE,CAAC,EAAC,IAAI,EAAE,2BAA2B,EAAE,IAAI,EAAE,EAAE,EAAC,CAAC,EAAC,CAAC,EAAE,CAAC,EAAC,WAAW,EAAE,MAAM,EAAC,CAAC;iBAC7G,CAAC;aACH,CAAC,CAAC;YACH,MAAM,OAAO,GAAG,uBAAuB,CAAC,WAAW,CAAC,WAAW,EAAE,YAAY,EAAE,UAAU,CAAC,MAAM,CAAC,CAAC;YAClG,6CAA6C;YAC7C,MAAM,KAAK,CAAC,SAAS,CAAC,KAAK,CAAC,GAAG,CAAC,QAAQ,EAAE,EAAC,QAAQ,EAAE,OAAO,EAAC,CAAC,CAAC,CAAC;YAChE,qCAAqC;YACrC,MAAM,KAAK,CAAC,SAAS,CAAC,KAAK,CAAC,GAAG,CAAC,QAAQ,EAAE,EAAC,QAAQ,EAAE,OAAO,EAAC,CAAC,CAAC,CAAC;YAChE,MAAM,CAAC,SAAS,CAAC,KAAK,CAAC,IAAI,CAAC,KAAK,CAAC,YAAY,EAAE,EAAE,IAAI,CAAC,EAAE;gBACvD,OAAO,IAAI,CAAC,QAAQ,CAAC,MAAM,CAAC;YAC9B,CAAC,CAAC,EAAE,CAAC,yBAAyB,EAAE,6BAA6B,CAAC,CAAC,CAAC;QAClE,CAAC,CAAC,CAAC;QAEH,EAAE,CAAC,qFAAqF,EAAE,KAAK;YAC7F,MAAM,EAAC,WAAW,EAAE,QAAQ,EAAC,GAAG,MAAM,WAAW,CAAC,WAAW,CAAC,IAAI,EAAE,oBAAoB,CAAC,CAAC;YAC1F,MAAM,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;YACtB,MAAM,CAAC,QAAQ,CAAC,GAAG,WAAW,CAAC,IAAI,CAAC,oBAAoB,CAAC;YACzD,MAAM,UAAU,GAAG,oBAAoB,CAAC,QAAQ,EAAE,QAAQ,CAAC,CAAC;YAC5D,MAAM,YAAY,GAAG,iBAAiB,CAAC,cAAc,EAAE,QAAQ,EAAE,QAAQ,CAAC,CAAC;YAC3E,MAAM,KAAK,GAAG,iCAAiC,CAAC;gBAC9C,UAAU,EAAE,cAAc,CAAC;oBACzB,CAAC,EAAC,WAAW,EAAE,EAAE,EAAE,aAAa,EAAE,CAAC,EAAC,IAAI,EAAE,2BAA2B,EAAE,IAAI,EAAE,EAAE,EAAC,CAAC,EAAC,CAAC;iBACpF,CAAC;aACH,CAAC,CAAC;YACH,MAAM,OAAO,GAAG,uBAAuB,CAAC,WAAW,CAAC,WAAW,EAAE,YAAY,EAAE,UAAU,CAAC,MAAM,CAAC,CAAC;YAClG,MAAM,KAAK,CAAC,SAAS,CAAC,KAAK,CAAC,GAAG,CAAC,QAAQ,EAAE,EAAC,QAAQ,EAAE,OAAO,EAAC,CAAC,CAAC,CAAC;YAChE,MAAM,CAAC,WAAW,CAAC,KAAK,CAAC,YAAY,EAAE,CAAC,IAAI,EAAE,CAAC,CAAC,CAAC;YACjD,MAAM,4BAA4B,GAAG,KAAK,CAAC,IAAI,CAAC,KAAK,CAAC,YAAY,EAAE,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC;YAC5E,MAAM,CAAC,MAAM,CAAC,4BAA4B,CAAC,CAAC;YAE5C,MAAM,yBAAyB,GAAG;;;;;;;;;;;;;;;;;;;;;;;;;;CA0BvC,CAAC;YACI,MAAM,CAAC,SAAS,CAAC,4BAA4B,CAAC,IAAI,EAAE,yBAAyB,CAAC,CAAC;QACjF,CAAC,CAAC,CAAC;QAEH,EAAE,CAAC,8FAA8F,EAC9F,KAAK;YACH,MAAM,EAAC,WAAW,EAAE,QAAQ,EAAC,GAAG,MAAM,WAAW,CAAC,WAAW,CAAC,IAAI,EAAE,6BAA6B,CAAC,CAAC;YACnG,MAAM,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;YACtB,MAAM,CAAC,QAAQ,CAAC,GAAG,WAAW,CAAC,IAAI,CAAC,oBAAoB,CAAC;YACzD,MAAM,UAAU,GAAG,oBAAoB,CAAC,QAAQ,EAAE,QAAQ,CAAC,CAAC;YAC5D,MAAM,YAAY,GAAG,iBAAiB,CAAC,cAAc,EAAE,QAAQ,EAAE,QAAQ,CAAC,CAAC;YAC3E,MAAM,KAAK,GAAG,iCAAiC,CAAC;gBAC9C,UAAU,EAAE,cAAc,CAAC;oBACzB,CAAC,EAAC,WAAW,EAAE,EAAE,EAAE,aAAa,EAAE,CAAC,EAAC,IAAI,EAAE,uBAAuB,EAAE,IAAI,EAAE,EAAE,EAAC,CAAC,EAAC,CAAC;iBAChF,CAAC;aACH,CAAC,CAAC;YACH,MAAM,OAAO,GAAG,uBAAuB,CAAC,WAAW,CAAC,WAAW,EAAE,YAAY,EAAE,UAAU,CAAC,MAAM,CAAC,CAAC;YAClG,MAAM,KAAK,CAAC,SAAS,CAAC,KAAK,CAAC,GAAG,CAAC,QAAQ,EAAE,EAAC,QAAQ,EAAE,OAAO,EAAC,CAAC,CAAC,CAAC;YAChE,MAAM,CAAC,WAAW,CAAC,KAAK,CAAC,YAAY,EAAE,CAAC,IAAI,EAAE,CAAC,CAAC,CAAC;YACjD,MAAM,iCAAiC,GAAG,KAAK,CAAC,IAAI,CAAC,KAAK,CAAC,YAAY,EAAE,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC;YACjF,MAAM,CAAC,MAAM,CAAC,iCAAiC,CAAC,CAAC;YAEjD,MAAM,yBAAyB,GAC3B;;;;;;;;;;;;;mIAasH,CAAC;YAC3H,MAAM,CAAC,SAAS,CAAC,iCAAiC,CAAC,IAAI,EAAE,yBAAyB,CAAC,CAAC;QACtF,CAAC,CAAC,CAAC;IACR,CAAC,CAAC,CAAC;AACL,CAAC,CAAC,CAAC","sourcesContent":["// Copyright 2024 The Chromium Authors. All rights reserved.\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport type * as Common from '../../../core/common/common.js';\nimport * as Host from '../../../core/host/host.js';\nimport * as Platform from '../../../core/platform/platform.js';\nimport * as TimelineUtils from '../../../panels/timeline/utils/utils.js';\nimport {mockAidaClient} from '../../../testing/AiAssistanceHelpers.js';\nimport {\n  describeWithEnvironment,\n  restoreUserAgentForTesting,\n  setUserAgentForTesting,\n  updateHostConfig\n} from '../../../testing/EnvironmentHelpers.js';\nimport {getInsightOrError, getInsightSetOrError} from '../../../testing/InsightHelpers.js';\nimport {TraceLoader} from '../../../testing/TraceLoader.js';\nimport * as Trace from '../../trace/trace.js';\nimport {\n  type ActionResponse,\n  ConversationType,\n  PerformanceAgent,\n  PerformanceInsightFormatter,\n  PerformanceTraceContext,\n  ResponseType,\n  TraceEventFormatter\n} from '../ai_assistance.js';\n\ndescribeWithEnvironment('PerformanceAgent', () => {\n  function mockHostConfig(modelId?: string, temperature?: number) {\n    updateHostConfig({\n      devToolsAiAssistancePerformanceAgent: {\n        modelId,\n        temperature,\n      },\n    });\n  }\n\n  describe('buildRequest', () => {\n    beforeEach(() => {\n      sinon.restore();\n    });\n\n    it('builds a request with a model id', async () => {\n      mockHostConfig('test model');\n      const agent = new PerformanceAgent(\n          {\n            aidaClient: {} as Host.AidaClient.AidaClient,\n          },\n          ConversationType.PERFORMANCE);\n      assert.strictEqual(\n          agent.buildRequest({text: 'test input'}, Host.AidaClient.Role.USER).options?.model_id,\n          'test model',\n      );\n    });\n\n    it('builds a request with a temperature', async () => {\n      mockHostConfig('test model', 1);\n      const agent = new PerformanceAgent(\n          {\n            aidaClient: {} as Host.AidaClient.AidaClient,\n          },\n          ConversationType.PERFORMANCE);\n      assert.strictEqual(\n          agent.buildRequest({text: 'test input'}, Host.AidaClient.Role.USER).options?.temperature,\n          1,\n      );\n    });\n\n    it('structure matches the snapshot', async () => {\n      mockHostConfig('test model');\n      sinon.stub(crypto, 'randomUUID').returns('sessionId' as `${string}-${string}-${string}-${string}-${string}`);\n      const agent = new PerformanceAgent(\n          {\n            aidaClient: mockAidaClient([[{explanation: 'answer'}]]),\n            serverSideLoggingEnabled: true,\n          },\n          ConversationType.PERFORMANCE);\n\n      await Array.fromAsync(agent.run('question', {selected: null}));\n      setUserAgentForTesting();\n\n      assert.deepEqual(\n          agent.buildRequest(\n              {\n                text: 'test input',\n              },\n              Host.AidaClient.Role.USER),\n          {\n            current_message: {role: Host.AidaClient.Role.USER, parts: [{text: 'test input'}]},\n            client: 'CHROME_DEVTOOLS',\n            preamble: undefined,\n            historical_contexts: [\n              {\n                role: 1,\n                parts: [{text: 'question'}],\n              },\n              {\n                role: 2,\n                parts: [{text: 'answer'}],\n              },\n            ],\n            facts: undefined,\n            metadata: {\n              disable_user_content_logging: false,\n              string_session_id: 'sessionId',\n              user_tier: 2,\n              client_version: 'unit_test',\n            },\n            options: {\n              model_id: 'test model',\n              temperature: undefined,\n            },\n            client_feature: 8,\n            functionality_type: 1,\n          },\n      );\n      restoreUserAgentForTesting();\n    });\n  });\n});\n\ndescribeWithEnvironment('PerformanceAgent – call tree focus', () => {\n  describe('getOrigin()', () => {\n    it('calculates the origin of the selected node when it has a URL associated with it', async function() {\n      const {parsedTrace} = await TraceLoader.traceEngine(this, 'web-dev-with-commit.json.gz');\n      // An Evaluate Script event, picked because it has a URL of googletagmanager.com/...\n      const evalScriptEvent = parsedTrace.Renderer.allTraceEntries.find(\n          event => event.name === Trace.Types.Events.Name.EVALUATE_SCRIPT && event.ts === 122411195649);\n      assert.exists(evalScriptEvent);\n      const aiCallTree = TimelineUtils.AICallTree.AICallTree.fromEvent(evalScriptEvent, parsedTrace);\n      assert.isOk(aiCallTree);\n      const context = PerformanceTraceContext.fromCallTree(aiCallTree);\n      assert.strictEqual(context.getOrigin(), 'https://www.googletagmanager.com');\n    });\n\n    it('returns a random but deterministic \"origin\" for nodes that have no URL associated', async function() {\n      const {parsedTrace} = await TraceLoader.traceEngine(this, 'web-dev-with-commit.json.gz');\n      // A random layout event with no URL associated\n      const layoutEvent = parsedTrace.Renderer.allTraceEntries.find(\n          event => event.name === Trace.Types.Events.Name.LAYOUT && event.ts === 122411130078);\n      assert.exists(layoutEvent);\n      const aiCallTree = TimelineUtils.AICallTree.AICallTree.fromEvent(layoutEvent, parsedTrace);\n      assert.isOk(aiCallTree);\n      const context = PerformanceTraceContext.fromCallTree(aiCallTree);\n      assert.strictEqual(context.getOrigin(), 'Layout_90829_259_122411130078');\n    });\n  });\n\n  describe('run', function() {\n    it('generates an answer', async function() {\n      const {parsedTrace} = await TraceLoader.traceEngine(this, 'web-dev-outermost-frames.json.gz');\n      // A basic Layout.\n      const layoutEvt = parsedTrace.Renderer.allTraceEntries.find(event => event.ts === 465457096322);\n      assert.exists(layoutEvt);\n      const aiCallTree = TimelineUtils.AICallTree.AICallTree.fromEvent(layoutEvt, parsedTrace);\n      assert.exists(aiCallTree);\n\n      const agent = new PerformanceAgent(\n          {\n            aidaClient: mockAidaClient([[{\n              explanation: 'This is the answer',\n              metadata: {\n                rpcGlobalId: 123,\n              },\n            }]]),\n          },\n          ConversationType.PERFORMANCE);\n\n      const context = PerformanceTraceContext.fromCallTree(aiCallTree);\n      const responses = await Array.fromAsync(agent.run('test', {selected: context}));\n      const expectedData = '\\n\\n' +\n          `\n\n\n# Call tree:\n\n1;Task;3;;;2\n2;Layout;3;3;;;S`.trim();\n\n      assert.deepEqual(responses, [\n        {\n          type: ResponseType.USER_QUERY,\n          query: 'test',\n          imageInput: undefined,\n          imageId: undefined,\n        },\n        {\n          type: ResponseType.CONTEXT,\n          title: 'Analyzing call tree',\n          details: [\n            {title: 'Selected call tree', text: expectedData},\n          ],\n        },\n        {\n          type: ResponseType.QUERYING,\n        },\n        {\n          type: ResponseType.ANSWER,\n          text: 'This is the answer',\n          complete: true,\n          suggestions: undefined,\n          rpcId: 123,\n        },\n      ]);\n\n      assert.deepEqual(agent.buildRequest({text: ''}, Host.AidaClient.Role.USER).historical_contexts, [\n        {\n          role: 1,\n          parts: [{text: `${aiCallTree.serialize()}\\n\\n# User request\\n\\ntest`}],\n        },\n        {\n          role: 2,\n          parts: [{text: 'This is the answer'}],\n        },\n      ]);\n    });\n  });\n\n  describe('enhanceQuery', () => {\n    it('does not send the serialized calltree again if it is a followup chat about the same calltree', async () => {\n      const agent = new PerformanceAgent(\n          {\n            aidaClient: {} as Host.AidaClient.AidaClient,\n          },\n          ConversationType.PERFORMANCE);\n\n      const mockAiCallTree = {\n        serialize: () => 'Mock call tree',\n      } as unknown as TimelineUtils.AICallTree.AICallTree;\n\n      const context1 = PerformanceTraceContext.fromCallTree(mockAiCallTree);\n      const context2 = PerformanceTraceContext.fromCallTree(mockAiCallTree);\n      const context3 = PerformanceTraceContext.fromCallTree(mockAiCallTree);\n\n      const enhancedQuery1 = await agent.enhanceQuery('What is this?', context1);\n      assert.strictEqual(enhancedQuery1, 'Mock call tree\\n\\n# User request\\n\\nWhat is this?');\n\n      const query2 = 'But what about this follow-up question?';\n      const enhancedQuery2 = await agent.enhanceQuery(query2, context2);\n      assert.strictEqual(enhancedQuery2, query2);\n      assert.isFalse(enhancedQuery2.includes(mockAiCallTree.serialize()));\n\n      // Just making sure any subsequent chat doesnt include it either.\n      const query3 = 'And this 3rd question?';\n      const enhancedQuery3 = await agent.enhanceQuery(query3, context3);\n      assert.strictEqual(enhancedQuery3, query3);\n      assert.isFalse(enhancedQuery3.includes(mockAiCallTree.serialize()));\n    });\n  });\n});\n\nconst FAKE_LCP_MODEL = {\n  insightKey: Trace.Insights.Types.InsightKeys.LCP_BREAKDOWN,\n  strings: {},\n  title: 'LCP breakdown' as Common.UIString.LocalizedString,\n  description: 'some description' as Common.UIString.LocalizedString,\n  category: Trace.Insights.Types.InsightCategory.ALL,\n  state: 'fail',\n  frameId: '123',\n} as const;\nconst FAKE_INSIGHT_SET_BOUNDS =\n    Trace.Helpers.Timing.traceWindowFromMicroSeconds(0 as Trace.Types.Timing.Micro, 0 as Trace.Types.Timing.Micro);\nconst FAKE_INP_MODEL = {\n  insightKey: Trace.Insights.Types.InsightKeys.INP_BREAKDOWN,\n  strings: {},\n  title: 'INP breakdown' as Common.UIString.LocalizedString,\n  description: 'some description' as Common.UIString.LocalizedString,\n  category: Trace.Insights.Types.InsightCategory.ALL,\n  state: 'fail',\n  frameId: '123',\n} as const;\nconst FAKE_PARSED_TRACE = {\n  Meta: {traceBounds: {min: 0, max: 10}},\n} as unknown as Trace.Handlers.Types.ParsedTrace;\n\nfunction createAgentForInsightConversation(opts: {aidaClient?: Host.AidaClient.AidaClient} = {}) {\n  return new PerformanceAgent({aidaClient: opts.aidaClient ?? mockAidaClient()}, ConversationType.PERFORMANCE_INSIGHT);\n}\n\ndescribeWithEnvironment('PerformanceAgent – insight focus', () => {\n  it('uses the min and max bounds of the trace as the origin', async function() {\n    const {parsedTrace, insights} = await TraceLoader.traceEngine(this, 'lcp-images.json.gz');\n    assert.isOk(insights);\n    const [firstNav] = parsedTrace.Meta.mainFrameNavigations;\n    const lcpBreakdown = getInsightOrError('LCPBreakdown', insights, firstNav);\n    const insightSet = getInsightSetOrError(insights, firstNav);\n    const context = PerformanceTraceContext.fromInsight(parsedTrace, lcpBreakdown, insightSet.bounds);\n    assert.strictEqual(context.getOrigin(), 'trace-658799706428-658804825864');\n  });\n\n  it('outputs the right title for the selected insight', async () => {\n    const context = PerformanceTraceContext.fromInsight(FAKE_PARSED_TRACE, FAKE_LCP_MODEL, FAKE_INSIGHT_SET_BOUNDS);\n    assert.strictEqual(context.getTitle(), 'Insight: LCP breakdown');\n  });\n\n  // See b/405054694 for context on why we do this.\n  describe('parsing text responses', () => {\n    it('strips out 5 backticks if the response has them', async () => {\n      const agent = createAgentForInsightConversation();\n      const response = agent.parseTextResponse('`````hello world`````');\n      assert.deepEqual(response, {answer: 'hello world'});\n    });\n\n    it('strips any newlines before the backticks', async () => {\n      const agent = createAgentForInsightConversation();\n      const response = agent.parseTextResponse('\\n\\n`````hello world`````');\n      assert.deepEqual(response, {answer: 'hello world'});\n    });\n\n    it('does not strip the backticks if the response does not fully start and end with them', async () => {\n      const agent = createAgentForInsightConversation();\n      const response = agent.parseTextResponse('answer: `````hello world`````');\n      assert.deepEqual(response, {answer: 'answer: `````hello world`````'});\n    });\n\n    it('does not strip the backticks in the middle of the response even if the response is also wrapped', async () => {\n      const agent = createAgentForInsightConversation();\n      const response = agent.parseTextResponse('`````hello ````` world`````');\n      assert.deepEqual(response, {answer: 'hello ````` world'});\n    });\n\n    it('does not strip out inline code backticks', async () => {\n      const agent = createAgentForInsightConversation();\n      const response = agent.parseTextResponse('This is code `console.log(\"hello\")`');\n      assert.deepEqual(response, {answer: 'This is code `console.log(\"hello\")`'});\n    });\n\n    it('does not strip out code block 3 backticks', async () => {\n      const agent = createAgentForInsightConversation();\n      const response = agent.parseTextResponse(`\\`\\`\\`\ncode\n\\`\\`\\``);\n      assert.deepEqual(response, {\n        answer: `\\`\\`\\`\ncode\n\\`\\`\\``\n      });\n    });\n  });\n\n  describe('handleContextDetails', () => {\n    it('outputs the right context for the initial query from the user', async () => {\n      const context = PerformanceTraceContext.fromInsight(FAKE_PARSED_TRACE, FAKE_LCP_MODEL, FAKE_INSIGHT_SET_BOUNDS);\n      const agent = createAgentForInsightConversation({\n        aidaClient: mockAidaClient([[{\n          explanation: 'This is the answer',\n          metadata: {\n            rpcGlobalId: 123,\n          }\n        }]])\n      });\n\n      const expectedDetailText = new PerformanceInsightFormatter(FAKE_PARSED_TRACE, FAKE_LCP_MODEL).formatInsight();\n\n      const responses = await Array.fromAsync(agent.run('test', {selected: context}));\n      assert.deepEqual(responses, [\n        {\n          type: ResponseType.USER_QUERY,\n          query: 'test',\n          imageInput: undefined,\n          imageId: undefined,\n        },\n        {\n          type: ResponseType.CONTEXT,\n          title: 'Analyzing insight: LCP breakdown',\n          details: [\n            {title: 'LCP breakdown', text: expectedDetailText},\n          ],\n        },\n        {\n          type: ResponseType.QUERYING,\n        },\n        {\n          type: ResponseType.ANSWER,\n          text: 'This is the answer',\n          complete: true,\n          suggestions: undefined,\n          rpcId: 123,\n        },\n      ]);\n    });\n  });\n\n  describe('enhanceQuery', () => {\n    it('adds the context to the query from the user', async () => {\n      const agent = createAgentForInsightConversation({\n        aidaClient: {} as Host.AidaClient.AidaClient,\n      });\n\n      const context = PerformanceTraceContext.fromInsight(FAKE_PARSED_TRACE, FAKE_LCP_MODEL, FAKE_INSIGHT_SET_BOUNDS);\n      const extraContext = new PerformanceInsightFormatter(FAKE_PARSED_TRACE, FAKE_LCP_MODEL).formatInsight();\n\n      const finalQuery = await agent.enhanceQuery('What is this?', context);\n      const expected = `${extraContext}\n\n# User question for you to answer:\nWhat is this?`;\n\n      assert.strictEqual(finalQuery, expected);\n    });\n\n    it('does not add the context for follow-up queries with the same context', async () => {\n      const agent = createAgentForInsightConversation({\n        aidaClient: {} as Host.AidaClient.AidaClient,\n      });\n\n      const context = PerformanceTraceContext.fromInsight(FAKE_PARSED_TRACE, FAKE_LCP_MODEL, FAKE_INSIGHT_SET_BOUNDS);\n\n      await agent.enhanceQuery('What is this?', context);\n      const finalQuery = await agent.enhanceQuery('Help me understand?', context);\n      const expected = `# User question for you to answer:\nHelp me understand?`;\n\n      assert.strictEqual(finalQuery, expected);\n    });\n\n    it('does add context to queries if the insight context changes', async () => {\n      const agent = createAgentForInsightConversation({\n        aidaClient: {} as Host.AidaClient.AidaClient,\n      });\n      const context1 = PerformanceTraceContext.fromInsight(FAKE_PARSED_TRACE, FAKE_LCP_MODEL, FAKE_INSIGHT_SET_BOUNDS);\n      const context2 = PerformanceTraceContext.fromInsight(FAKE_PARSED_TRACE, FAKE_INP_MODEL, FAKE_INSIGHT_SET_BOUNDS);\n      const firstQuery = await agent.enhanceQuery('Q1', context1);\n      const secondQuery = await agent.enhanceQuery('Q2', context1);\n      const thirdQuery = await agent.enhanceQuery('Q3', context2);\n      assert.include(firstQuery, '## Insight Title: LCP breakdown');\n      assert.notInclude(secondQuery, '## Insight Title');\n      assert.include(thirdQuery, '## Insight Title: INP breakdown');\n    });\n  });\n\n  describe('function calls', () => {\n    it('calls getNetworkActivitySummary and logs the response bytes size', async function() {\n      const metricsSpy = sinon.spy(Host.userMetrics, 'performanceAINetworkSummaryResponseSize');\n      const {parsedTrace, insights} = await TraceLoader.traceEngine(this, 'lcp-images.json.gz');\n      assert.isOk(insights);\n      const [firstNav] = parsedTrace.Meta.mainFrameNavigations;\n      const insightSet = getInsightSetOrError(insights, firstNav);\n      const lcpBreakdown = getInsightOrError('LCPBreakdown', insights, firstNav);\n      const agent = createAgentForInsightConversation({\n        aidaClient: mockAidaClient([\n          [{explanation: '', functionCalls: [{name: 'getNetworkActivitySummary', args: {}}]}], [{explanation: 'done'}]\n        ])\n      });\n      const context = PerformanceTraceContext.fromInsight(parsedTrace, lcpBreakdown, insightSet.bounds);\n\n      const responses = await Array.fromAsync(agent.run('test', {selected: context}));\n      const action = responses.find(response => response.type === ResponseType.ACTION);\n\n      // Find the requests we expect the handler to have returned.\n      const expectedRequestUrls = [\n        'https://chromedevtools.github.io/performance-stories/lcp-large-image/index.html',\n        'https://fonts.googleapis.com/css2?family=Poppins:ital,wght@1,800',\n        'https://chromedevtools.github.io/performance-stories/lcp-large-image/app.css',\n        'https://via.placeholder.com/50.jpg', 'https://via.placeholder.com/2000.jpg'\n      ];\n\n      const requests = expectedRequestUrls.map(url => {\n        const match = parsedTrace.NetworkRequests.byTime.find(r => r.args.data.url === url);\n        assert.isOk(match, `no request found for ${url}`);\n        return match;\n      });\n\n      const expectedRequestsOutput = TraceEventFormatter.networkRequests(requests, parsedTrace);\n\n      const expectedBytesSize = Platform.StringUtilities.countWtf8Bytes(expectedRequestsOutput);\n      sinon.assert.calledWith(metricsSpy, expectedBytesSize);\n\n      const expectedOutput = JSON.stringify({requests: expectedRequestsOutput});\n      const titleResponse = responses.find(response => response.type === ResponseType.TITLE);\n      assert.exists(titleResponse);\n      assert.strictEqual(titleResponse.title, 'Investigating network activity…');\n\n      assert.exists(action);\n      assert.deepEqual(action, {\n        type: 'action' as ActionResponse['type'],\n        output: expectedOutput,\n        code: 'getNetworkActivitySummary()',\n        canceled: false\n      });\n    });\n\n    it('can call getNetworkRequestDetail to get detail about a single request', async function() {\n      const metricsSpy = sinon.spy(Host.userMetrics, 'performanceAINetworkRequestDetailResponseSize');\n\n      const {parsedTrace, insights} = await TraceLoader.traceEngine(this, 'lcp-images.json.gz');\n      assert.isOk(insights);\n      const [firstNav] = parsedTrace.Meta.mainFrameNavigations;\n      const lcpBreakdown = getInsightOrError('LCPBreakdown', insights, firstNav);\n      const insightSet = getInsightSetOrError(insights, firstNav);\n      const requestUrl = 'https://chromedevtools.github.io/performance-stories/lcp-large-image/app.css';\n      const agent = createAgentForInsightConversation({\n        aidaClient: mockAidaClient([\n          [{explanation: '', functionCalls: [{name: 'getNetworkRequestDetail', args: {url: requestUrl}}]}],\n          [{explanation: 'done'}]\n        ])\n      });\n      const context = PerformanceTraceContext.fromInsight(parsedTrace, lcpBreakdown, insightSet.bounds);\n\n      const responses = await Array.fromAsync(agent.run('test', {selected: context}));\n      const titleResponse = responses.find(response => response.type === ResponseType.TITLE);\n      assert.exists(titleResponse);\n      assert.strictEqual(titleResponse.title, `Investigating network request ${requestUrl}…`);\n      const action = responses.find(response => response.type === ResponseType.ACTION);\n      const request = parsedTrace.NetworkRequests.byTime.find(r => r.args.data.url === requestUrl);\n      assert.isOk(request);\n\n      const expectedRequestOutput = TraceEventFormatter.networkRequests([request], parsedTrace, {verbose: true});\n      const expectedOutput = JSON.stringify({request: expectedRequestOutput});\n\n      const expectedBytesSize = Platform.StringUtilities.countWtf8Bytes(expectedRequestOutput);\n      sinon.assert.calledWith(metricsSpy, expectedBytesSize);\n\n      assert.exists(action);\n      assert.deepEqual(action, {\n        type: 'action' as ActionResponse['type'],\n        output: expectedOutput,\n        code: `getNetworkRequestDetail('${requestUrl}')`,\n        canceled: false\n      });\n    });\n\n    it('calls getMainThreadActivity', async function() {\n      const metricsSpy = sinon.spy(Host.userMetrics, 'performanceAIMainThreadActivityResponseSize');\n\n      const {parsedTrace, insights} = await TraceLoader.traceEngine(this, 'lcp-discovery-delay.json.gz');\n      assert.isOk(insights);\n      const [firstNav] = parsedTrace.Meta.mainFrameNavigations;\n      const insightSet = getInsightSetOrError(insights, firstNav);\n      const lcpBreakdown = getInsightOrError('LCPBreakdown', insights, firstNav);\n      const agent = createAgentForInsightConversation({\n        aidaClient: mockAidaClient(\n            [[{explanation: '', functionCalls: [{name: 'getMainThreadActivity', args: {}}]}], [{explanation: 'done'}]])\n      });\n      const context = PerformanceTraceContext.fromInsight(parsedTrace, lcpBreakdown, insightSet.bounds);\n\n      const responses = await Array.fromAsync(agent.run('test', {selected: context}));\n      const titleResponse = responses.find(response => response.type === ResponseType.TITLE);\n      assert.exists(titleResponse);\n      assert.strictEqual(titleResponse.title, 'Investigating main thread activity…');\n\n      const action = responses.find(response => response.type === ResponseType.ACTION);\n      assert.exists(action);\n\n      const expectedTree =\n          TimelineUtils.InsightAIContext.AIQueries.mainThreadActivity(lcpBreakdown, insightSet.bounds, parsedTrace);\n      assert.isOk(expectedTree);\n\n      const expectedBytesSize = Platform.StringUtilities.countWtf8Bytes(expectedTree.serialize());\n      sinon.assert.calledWith(metricsSpy, expectedBytesSize);\n\n      const expectedOutput = JSON.stringify({activity: expectedTree.serialize()});\n\n      assert.deepEqual(action, {\n        type: 'action' as ActionResponse['type'],\n        output: expectedOutput,\n        code: 'getMainThreadActivity()',\n        canceled: false\n      });\n    });\n\n    it('caches getNetworkActivitySummary calls and passes them to future requests as facts', async function() {\n      const {parsedTrace, insights} = await TraceLoader.traceEngine(this, 'lcp-images.json.gz');\n      assert.isOk(insights);\n      const [firstNav] = parsedTrace.Meta.mainFrameNavigations;\n      const insightSet = getInsightSetOrError(insights, firstNav);\n      const lcpBreakdown = getInsightOrError('LCPBreakdown', insights, firstNav);\n      const agent = createAgentForInsightConversation({\n        aidaClient: mockAidaClient([\n          [{explanation: '', functionCalls: [{name: 'getNetworkActivitySummary', args: {}}]}], [{explanation: 'done'}]\n        ])\n      });\n      const context = PerformanceTraceContext.fromInsight(parsedTrace, lcpBreakdown, insightSet.bounds);\n\n      // Make the first query to trigger the getNetworkActivitySummary function\n      const responses = await Array.fromAsync(agent.run('test', {selected: context}));\n      const action = responses.find(response => response.type === ResponseType.ACTION);\n      assert.exists(action);\n      assert.strictEqual(action.code, 'getNetworkActivitySummary()');\n\n      // Trigger another request so that the agent populates the facts.\n      await Array.fromAsync(agent.run('test 2', {selected: context}));\n\n      assert.strictEqual(agent.currentFacts().size, 1);\n      const networkSummaryFact = Array.from(agent.currentFacts()).at(0);\n      assert.exists(networkSummaryFact);\n\n      const expectedRequestUrls = [\n        'https://chromedevtools.github.io/performance-stories/lcp-large-image/index.html',\n        'https://fonts.googleapis.com/css2?family=Poppins:ital,wght@1,800',\n        'https://chromedevtools.github.io/performance-stories/lcp-large-image/app.css',\n        'https://via.placeholder.com/50.jpg', 'https://via.placeholder.com/2000.jpg'\n      ];\n      // Ensure that each URL was in the fact as a way to validate the fact is accurate.\n      assert.isTrue(expectedRequestUrls.every(url => {\n        return networkSummaryFact.text.includes(url);\n      }));\n\n      // Now we make one more request; we do this to ensure that we don't add the same fact again.\n      await Array.fromAsync(agent.run('test 3', {selected: context}));\n\n      assert.strictEqual(agent.currentFacts().size, 1);\n    });\n\n    it('caches getMainThreadActivity calls and passes them to future requests as facts', async function() {\n      const {parsedTrace, insights} = await TraceLoader.traceEngine(this, 'lcp-discovery-delay.json.gz');\n      assert.isOk(insights);\n      const [firstNav] = parsedTrace.Meta.mainFrameNavigations;\n      const insightSet = getInsightSetOrError(insights, firstNav);\n      const lcpBreakdown = getInsightOrError('LCPBreakdown', insights, firstNav);\n      const agent = createAgentForInsightConversation({\n        aidaClient: mockAidaClient(\n            [[{explanation: '', functionCalls: [{name: 'getMainThreadActivity', args: {}}]}], [{explanation: 'done'}]])\n      });\n      const context = PerformanceTraceContext.fromInsight(parsedTrace, lcpBreakdown, insightSet.bounds);\n\n      // Make the first query to trigger the getMainThreadActivity function\n      const responses = await Array.fromAsync(agent.run('test', {selected: context}));\n      const action = responses.find(response => response.type === ResponseType.ACTION);\n      assert.exists(action);\n      assert.strictEqual(action.code, 'getMainThreadActivity()');\n\n      // Trigger another request so that the agent populates the facts.\n      await Array.fromAsync(agent.run('test 2', {selected: context}));\n\n      assert.strictEqual(agent.currentFacts().size, 1);\n      const mainThreadActivityFact = Array.from(agent.currentFacts()).at(0);\n      assert.exists(mainThreadActivityFact);\n\n      const expectedTree =\n          TimelineUtils.InsightAIContext.AIQueries.mainThreadActivity(lcpBreakdown, insightSet.bounds, parsedTrace);\n      assert.isOk(expectedTree);\n      assert.include(mainThreadActivityFact.text, expectedTree.serialize());\n\n      // Now we make one more request; we do this to ensure that we don't add the same fact again.\n      await Array.fromAsync(agent.run('test 3', {selected: context}));\n\n      assert.strictEqual(agent.currentFacts().size, 1);\n    });\n\n    it('will not send facts from a previous insight if the context changes', async function() {\n      const {parsedTrace, insights} = await TraceLoader.traceEngine(this, 'lcp-discovery-delay.json.gz');\n      assert.isOk(insights);\n      const [firstNav] = parsedTrace.Meta.mainFrameNavigations;\n      const insightSet = getInsightSetOrError(insights, firstNav);\n      const lcpBreakdown = getInsightOrError('LCPBreakdown', insights, firstNav);\n      const renderBlocking = getInsightOrError('RenderBlocking', insights, firstNav);\n      const agent = createAgentForInsightConversation({\n        aidaClient: mockAidaClient([\n          [{explanation: '', functionCalls: [{name: 'getMainThreadActivity', args: {}}]}],\n        ])\n      });\n      const lcpContext = PerformanceTraceContext.fromInsight(parsedTrace, lcpBreakdown, insightSet.bounds);\n      const renderBlockingContext = PerformanceTraceContext.fromInsight(parsedTrace, renderBlocking, insightSet.bounds);\n\n      // Populate the function calls for the LCP Context\n      await Array.fromAsync(agent.run('test 1 LCP', {selected: lcpContext}));\n      await Array.fromAsync(agent.run('test 2 LCP', {selected: lcpContext}));\n      assert.strictEqual(agent.currentFacts().size, 1);\n      // Now change the context and send a request.\n      await Array.fromAsync(agent.run('test 1 RenderBlocking', {selected: renderBlockingContext}));\n      // Because the context changed, we should now not have any facts.\n      assert.strictEqual(agent.currentFacts().size, 0);\n    });\n\n    it('will send multiple facts', async function() {\n      const {parsedTrace, insights} = await TraceLoader.traceEngine(this, 'lcp-discovery-delay.json.gz');\n      assert.isOk(insights);\n      const [firstNav] = parsedTrace.Meta.mainFrameNavigations;\n      const insightSet = getInsightSetOrError(insights, firstNav);\n      const lcpBreakdown = getInsightOrError('LCPBreakdown', insights, firstNav);\n      const agent = createAgentForInsightConversation({\n        aidaClient: mockAidaClient([\n          [{explanation: '', functionCalls: [{name: 'getMainThreadActivity', args: {}}]}],\n          [{explanation: '', functionCalls: [{name: 'getNetworkActivitySummary', args: {}}]}], [{explanation: 'done'}]\n        ])\n      });\n      const context = PerformanceTraceContext.fromInsight(parsedTrace, lcpBreakdown, insightSet.bounds);\n      // First query to populate the function calls\n      await Array.fromAsync(agent.run('test 1', {selected: context}));\n      // Second query should have two facts\n      await Array.fromAsync(agent.run('test 2', {selected: context}));\n      assert.deepEqual(Array.from(agent.currentFacts(), fact => {\n        return fact.metadata.source;\n      }), ['getMainThreadActivity()', 'getNetworkActivitySummary()']);\n    });\n\n    it('sends network description text as a fact when `getNetworkActivitySummary` is called', async function() {\n      const {parsedTrace, insights} = await TraceLoader.traceEngine(this, 'lcp-images.json.gz');\n      assert.isOk(insights);\n      const [firstNav] = parsedTrace.Meta.mainFrameNavigations;\n      const insightSet = getInsightSetOrError(insights, firstNav);\n      const lcpBreakdown = getInsightOrError('LCPBreakdown', insights, firstNav);\n      const agent = createAgentForInsightConversation({\n        aidaClient: mockAidaClient([\n          [{explanation: '', functionCalls: [{name: 'getNetworkActivitySummary', args: {}}]}],\n        ])\n      });\n      const context = PerformanceTraceContext.fromInsight(parsedTrace, lcpBreakdown, insightSet.bounds);\n      await Array.fromAsync(agent.run('test 1', {selected: context}));\n      assert.strictEqual(agent.currentFacts().size, 1);\n      const networkFormatDescriptionFact = Array.from(agent.currentFacts()).at(0);\n      assert.exists(networkFormatDescriptionFact);\n\n      const expectedFormatDescription = `The format is as follows:\n    \\`urlIndex;queuedTime;requestSentTime;downloadCompleteTime;processingCompleteTime;totalDuration;downloadDuration;mainThreadProcessingDuration;statusCode;mimeType;priority;initialPriority;finalPriority;renderBlocking;protocol;fromServiceWorker;initiatorUrlIndex;redirects:[[redirectUrlIndex|startTime|duration]];responseHeaders:[header1Value|header2Value|...]\\`\n\n    - \\`urlIndex\\`: Numerical index for the request's URL, referencing the \"All URLs\" list.\n    Timings (all in milliseconds, relative to navigation start):\n    - \\`queuedTime\\`: When the request was queued.\n    - \\`requestSentTime\\`: When the request was sent.\n    - \\`downloadCompleteTime\\`: When the download completed.\n    - \\`processingCompleteTime\\`: When main thread processing finished.\n    Durations (all in milliseconds):\n    - \\`totalDuration\\`: Total time from the request being queued until its main thread processing completed.\n    - \\`downloadDuration\\`: Time spent actively downloading the resource.\n    - \\`mainThreadProcessingDuration\\`: Time spent on the main thread after the download completed.\n    - \\`statusCode\\`: The HTTP status code of the response (e.g., 200, 404).\n    - \\`mimeType\\`: The MIME type of the resource (e.g., \"text/html\", \"application/javascript\").\n    - \\`priority\\`: The final network request priority (e.g., \"VeryHigh\", \"Low\").\n    - \\`initialPriority\\`: The initial network request priority.\n    - \\`finalPriority\\`: The final network request priority (redundant if \\`priority\\` is always final, but kept for clarity if \\`initialPriority\\` and \\`priority\\` differ).\n    - \\`renderBlocking\\`: 't' if the request was render-blocking, 'f' otherwise.\n    - \\`protocol\\`: The network protocol used (e.g., \"h2\", \"http/1.1\").\n    - \\`fromServiceWorker\\`: 't' if the request was served from a service worker, 'f' otherwise.\n    - \\`initiatorUrlIndex\\`: Numerical index for the URL of the resource that initiated this request, or empty string if no initiator.\n    - \\`redirects\\`: A comma-separated list of redirects, enclosed in square brackets. Each redirect is formatted as\n    \\`[redirectUrlIndex|startTime|duration]\\`, where: \\`redirectUrlIndex\\`: Numerical index for the redirect's URL. \\`startTime\\`: The start time of the redirect in milliseconds, relative to navigation start. \\`duration\\`: The duration of the redirect in milliseconds.\n    - \\`responseHeaders\\`: A list separated by '|' of values for specific, pre-defined response headers, enclosed in square brackets.\n    The order of headers corresponds to an internal fixed list. If a header is not present, its value will be empty.\n`;\n      assert.deepEqual(networkFormatDescriptionFact.text, expectedFormatDescription);\n    });\n\n    it('sends main thread activity description text as a fact when `getMainThreadActivity` is called',\n       async function() {\n         const {parsedTrace, insights} = await TraceLoader.traceEngine(this, 'lcp-discovery-delay.json.gz');\n         assert.isOk(insights);\n         const [firstNav] = parsedTrace.Meta.mainFrameNavigations;\n         const insightSet = getInsightSetOrError(insights, firstNav);\n         const lcpBreakdown = getInsightOrError('LCPBreakdown', insights, firstNav);\n         const agent = createAgentForInsightConversation({\n           aidaClient: mockAidaClient([\n             [{explanation: '', functionCalls: [{name: 'getMainThreadActivity', args: {}}]}],\n           ]),\n         });\n         const context = PerformanceTraceContext.fromInsight(parsedTrace, lcpBreakdown, insightSet.bounds);\n         await Array.fromAsync(agent.run('test 1', {selected: context}));\n         assert.strictEqual(agent.currentFacts().size, 1);\n         const mainThreadActivityDescriptionFact = Array.from(agent.currentFacts()).at(0);\n         assert.exists(mainThreadActivityDescriptionFact);\n\n         const expectedFormatDescription =\n             `The tree is represented as a call frame with a root task and a series of children.\n  The format of each callframe is:\n\n    'id;name;duration;selfTime;urlIndex;childRange;[S]'\n\n  The fields are:\n\n  * id: A unique numerical identifier for the call frame.\n  * name: A concise string describing the call frame (e.g., 'Evaluate Script', 'render', 'fetchData').\n  * duration: The total execution time of the call frame, including its children.\n  * selfTime: The time spent directly within the call frame, excluding its children's execution.\n  * urlIndex: Index referencing the \"All URLs\" list. Empty if no specific script URL is associated.\n  * childRange: Specifies the direct children of this node using their IDs. If empty ('' or 'S' at the end), the node has no children. If a single number (e.g., '4'), the node has one child with that ID. If in the format 'firstId-lastId' (e.g., '4-5'), it indicates a consecutive range of child IDs from 'firstId' to 'lastId', inclusive.\n  * S: **Optional marker.** The letter 'S' appears at the end of the line **only** for the single call frame selected by the user.`;\n         assert.deepEqual(mainThreadActivityDescriptionFact.text, expectedFormatDescription);\n       });\n  });\n});\n"]}