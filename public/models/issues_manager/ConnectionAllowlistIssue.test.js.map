{"version":3,"file":"ConnectionAllowlistIssue.test.js","sourceRoot":"","sources":["../../../../../../front_end/models/issues_manager/ConnectionAllowlistIssue.test.ts"],"names":[],"mappings":"AAAA,sCAAsC;AACtC,yEAAyE;AACzE,6BAA6B;AAI7B,OAAO,EAAC,gBAAgB,EAAC,MAAM,gCAAgC,CAAC;AAChE,OAAO,EAAC,eAAe,EAAC,MAAM,kCAAkC,CAAC;AACjE,OAAO,KAAK,aAAa,MAAM,qCAAqC,CAAC;AAErE,QAAQ,CAAC,0BAA0B,EAAE,GAAG,EAAE;IACxC,gBAAgB,EAAE,CAAC;IAEnB,MAAM,SAAS,GAAG,IAAI,eAAe,CAAC,EAAE,CAA2C,CAAC;IAEpF,EAAE,CAAC,wCAAwC,EAAE,GAAG,EAAE;QAChD,MAAM,OAAO,GAAoD;YAC/D,KAAK,8EAAwD;YAC7D,OAAO,EAAE;gBACP,SAAS,EAAE,IAAkC;gBAC7C,GAAG,EAAE,qBAAqB;aAC3B;SACF,CAAC;QACF,MAAM,cAAc,GAAmC;YACrD,IAAI,8FAA6D;YACjE,OAAO,EAAE;gBACP,+BAA+B,EAAE,OAAO;aACzC;SACF,CAAC;QAEF,MAAM,MAAM,GACR,aAAa,CAAC,wBAAwB,CAAC,wBAAwB,CAAC,kBAAkB,CAAC,SAAS,EAAE,cAAc,CAAC,CAAC;QAClH,MAAM,CAAC,QAAQ,CAAC,MAAM,EAAE,CAAC,CAAC,CAAC;QAC3B,MAAM,CAAC,WAAW,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC,IAAI,EAAE,EAAE,yCAAyC,CAAC,CAAC;IAClF,CAAC,CAAC,CAAC;IAEH,EAAE,CAAC,oDAAoD,EAAE,GAAG,EAAE;QAC5D,MAAM,MAAM,GAAG;;;;;;;SAOd,CAAC;QAEF,KAAK,MAAM,KAAK,IAAI,MAAM,EAAE,CAAC;YAC3B,MAAM,OAAO,GAAoD;gBAC/D,KAAK;gBACL,OAAO,EAAE;oBACP,SAAS,EAAE,IAAkC;oBAC7C,GAAG,EAAE,qBAAqB;iBAC3B;aACF,CAAC;YACF,MAAM,KAAK,GAAG,IAAI,aAAa,CAAC,wBAAwB,CAAC,wBAAwB,CAAC,OAAO,EAAE,SAAS,CAAC,CAAC;YACtG,MAAM,WAAW,GAAG,KAAK,CAAC,cAAc,EAAE,CAAC;YAC3C,MAAM,CAAC,MAAM,CAAC,WAAW,EAAE,mBAAmB,KAAK,eAAe,CAAC,CAAC;YACpE,MAAM,CAAC,WAAW,CAAC,WAAW,EAAE,IAAI,EAAE,sBAAsB,KAAK,KAAK,CAAC,CAAC;QAC1E,CAAC;IACH,CAAC,CAAC,CAAC;AACL,CAAC,CAAC,CAAC","sourcesContent":["// Copyright 2026 The Chromium Authors\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport type * as SDK from '../../core/sdk/sdk.js';\nimport * as Protocol from '../../generated/protocol.js';\nimport {setupLocaleHooks} from '../../testing/LocaleHelpers.js';\nimport {MockIssuesModel} from '../../testing/MockIssuesModel.js';\nimport * as IssuesManager from '../issues_manager/issues_manager.js';\n\ndescribe('ConnectionAllowlistIssue', () => {\n  setupLocaleHooks();\n\n  const mockModel = new MockIssuesModel([]) as unknown as SDK.IssuesModel.IssuesModel;\n\n  it('can be created from an inspector issue', () => {\n    const details: Protocol.Audits.ConnectionAllowlistIssueDetails = {\n      error: Protocol.Audits.ConnectionAllowlistError.InvalidHeader,\n      request: {\n        requestId: 'n1' as Protocol.Network.RequestId,\n        url: 'https://example.com',\n      },\n    };\n    const inspectorIssue: Protocol.Audits.InspectorIssue = {\n      code: Protocol.Audits.InspectorIssueCode.ConnectionAllowlistIssue,\n      details: {\n        connectionAllowlistIssueDetails: details,\n      },\n    };\n\n    const issues =\n        IssuesManager.ConnectionAllowlistIssue.ConnectionAllowlistIssue.fromInspectorIssue(mockModel, inspectorIssue);\n    assert.lengthOf(issues, 1);\n    assert.strictEqual(issues[0].code(), 'ConnectionAllowlistIssue::InvalidHeader');\n  });\n\n  it('correctly creates descriptions for all error types', () => {\n    const errors = [\n      Protocol.Audits.ConnectionAllowlistError.InvalidHeader,\n      Protocol.Audits.ConnectionAllowlistError.MoreThanOneList,\n      Protocol.Audits.ConnectionAllowlistError.ItemNotInnerList,\n      Protocol.Audits.ConnectionAllowlistError.InvalidAllowlistItemType,\n      Protocol.Audits.ConnectionAllowlistError.ReportingEndpointNotToken,\n      Protocol.Audits.ConnectionAllowlistError.InvalidUrlPattern,\n    ];\n\n    for (const error of errors) {\n      const details: Protocol.Audits.ConnectionAllowlistIssueDetails = {\n        error,\n        request: {\n          requestId: 'n1' as Protocol.Network.RequestId,\n          url: 'https://example.com',\n        },\n      };\n      const issue = new IssuesManager.ConnectionAllowlistIssue.ConnectionAllowlistIssue(details, mockModel);\n      const description = issue.getDescription();\n      assert.exists(description, `Description for ${error} should exist`);\n      assert.strictEqual(description?.file, `connectionAllowlist${error}.md`);\n    }\n  });\n});\n"]}