{"version":3,"file":"PermissionElementIssue.test.js","sourceRoot":"","sources":["../../../../../../front_end/models/issues_manager/PermissionElementIssue.test.ts"],"names":[],"mappings":"AAAA,sCAAsC;AACtC,yEAAyE;AACzE,6BAA6B;AAI7B,OAAO,EAAC,gBAAgB,EAAC,MAAM,gCAAgC,CAAC;AAChE,OAAO,EAAC,eAAe,EAAC,MAAM,kCAAkC,CAAC;AAEjE,OAAO,KAAK,aAAa,MAAM,qBAAqB,CAAC;AAErD,QAAQ,CAAC,wBAAwB,EAAE,GAAG,EAAE;IACtC,gBAAgB,EAAE,CAAC;IACnB,MAAM,SAAS,GAAG,IAAI,eAAe,CAAC,EAAE,CAA2C,CAAC;IAEpF,SAAS,mBAAmB,CAAC,6BAA4E;QAEvG,OAAO;YACL,IAAI,0FAA2D;YAC/D,OAAO,EAAE;gBACP,6BAA6B;aAC9B;SACF,CAAC;IACJ,CAAC;IAED,EAAE,CAAC,iDAAiD,EAAE,GAAG,EAAE;QACzD,MAAM,UAAU,GAAG;;;;;;;;;;;;;;;;;;;;;;SAsBlB,CAAC;QACF,KAAK,MAAM,SAAS,IAAI,UAAU,EAAE,CAAC;YACnC,MAAM,OAAO,GAAkD;gBAC7D,SAAS;gBACT,MAAM,EAAE,CAA+B;gBACvC,IAAI,EAAE,WAAW,EAAG,+BAA+B;aACpD,CAAC;YAEF,+DAA+D;YAC/D,QAAQ,SAAS,EAAE,CAAC;gBAClB;oBACE,OAAO,CAAC,cAAc,GAAG,iBAAiB,CAAC;oBAC3C,MAAM;gBACR;oBACE,OAAO,CAAC,aAAa,GAAG,aAAa,CAAC;oBACtC,MAAM;gBACR;oBACE,OAAO,OAAO,CAAC,IAAI,CAAC,CAAE,0CAA0C;oBAChE,MAAM;YACV,CAAC;YAED,MAAM,cAAc,GAAG,mBAAmB,CAAC,OAAO,CAAC,CAAC;YAEpD,MAAM,MAAM,GACR,aAAa,CAAC,sBAAsB,CAAC,sBAAsB,CAAC,kBAAkB,CAAC,SAAS,EAAE,cAAc,CAAC,CAAC;YAC9G,MAAM,CAAC,QAAQ,CAAC,MAAM,EAAE,CAAC,EAAE,OAAO,SAAS,+CAA+C,CAAC,CAAC;YAC5F,MAAM,KAAK,GAAG,MAAM,CAAC,CAAC,CAAC,CAAC;YACxB,MAAM,CAAC,WAAW,CACd,KAAK,CAAC,IAAI,EAAE,EAAE,GAAG,wFAAyD,KAAK,SAAS,EAAE,EAC1F,OAAO,SAAS,mDAAmD,CAAC,CAAC;YACzE,MAAM,CAAC,WAAW,CACd,KAAK,CAAC,WAAW,EAAE,kFACnB,OAAO,SAAS,0CAA0C,CAAC,CAAC;YAChE,MAAM,CAAC,WAAW,CACd,KAAK,CAAC,OAAO,EAAE,EACf,OAAO,CAAC,SAAS,CAAC,CAAC,+DAA2C,CAAC,2DAAyC,EACxG,OAAO,SAAS,8CAA8C,CAAC,CAAC;YACpE,MAAM,CAAC,OAAO,CAAC,KAAK,CAAC,UAAU,EAAE,EAAE,OAAO,CAAC,SAAS,EAAE,OAAO,SAAS,yCAAyC,CAAC,CAAC;YACjH,IAAI,OAAO,CAAC,MAAM,EAAE,CAAC;gBACnB,MAAM,CAAC,QAAQ,CAAC,KAAK,CAAC,IAAI,CAAC,KAAK,CAAC,QAAQ,EAAE,CAAC,EAAE,CAAC,EAAE,OAAO,SAAS,qCAAqC,CAAC,CAAC;YAC1G,CAAC;YACD,MAAM,WAAW,GAAG,KAAK,CAAC,cAAc,EAAE,CAAC;YAC3C,MAAM,CAAC,SAAS,CAAC,WAAW,EAAE,OAAO,SAAS,mCAAmC,CAAC,CAAC;YACnF,IAAI,WAAW,EAAE,CAAC;gBAChB,MAAM,CAAC,OAAO,CACV,WAAW,CAAC,IAAI,EAAE,mBAAmB,EACrC,OAAO,SAAS,wDAAwD,CAAC,CAAC;YAChF,CAAC;QACH,CAAC;IACH,CAAC,CAAC,CAAC;AACL,CAAC,CAAC,CAAC","sourcesContent":["// Copyright 2025 The Chromium Authors\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport type * as SDK from '../../core/sdk/sdk.js';\nimport * as Protocol from '../../generated/protocol.js';\nimport {setupLocaleHooks} from '../../testing/LocaleHelpers.js';\nimport {MockIssuesModel} from '../../testing/MockIssuesModel.js';\n\nimport * as IssuesManager from './issues_manager.js';\n\ndescribe('PermissionElementIssue', () => {\n  setupLocaleHooks();\n  const mockModel = new MockIssuesModel([]) as unknown as SDK.IssuesModel.IssuesModel;\n\n  function createProtocolIssue(permissionElementIssueDetails: Protocol.Audits.PermissionElementIssueDetails):\n      Protocol.Audits.InspectorIssue {\n    return {\n      code: Protocol.Audits.InspectorIssueCode.PermissionElementIssue,\n      details: {\n        permissionElementIssueDetails,\n      },\n    };\n  }\n\n  it('should be created correctly for all issue types', () => {\n    const enumValues = [\n      Protocol.Audits.PermissionElementIssueType.InvalidType,\n      Protocol.Audits.PermissionElementIssueType.FencedFrameDisallowed,\n      Protocol.Audits.PermissionElementIssueType.CspFrameAncestorsMissing,\n      Protocol.Audits.PermissionElementIssueType.PermissionsPolicyBlocked,\n      Protocol.Audits.PermissionElementIssueType.PaddingRightUnsupported,\n      Protocol.Audits.PermissionElementIssueType.PaddingBottomUnsupported,\n      Protocol.Audits.PermissionElementIssueType.InsetBoxShadowUnsupported,\n      Protocol.Audits.PermissionElementIssueType.RequestInProgress,\n      Protocol.Audits.PermissionElementIssueType.UntrustedEvent,\n      Protocol.Audits.PermissionElementIssueType.RegistrationFailed,\n      Protocol.Audits.PermissionElementIssueType.TypeNotSupported,\n      Protocol.Audits.PermissionElementIssueType.InvalidTypeActivation,\n      Protocol.Audits.PermissionElementIssueType.SecurityChecksFailed,\n      Protocol.Audits.PermissionElementIssueType.ActivationDisabled,\n      Protocol.Audits.PermissionElementIssueType.GeolocationDeprecated,\n      Protocol.Audits.PermissionElementIssueType.InvalidDisplayStyle,\n      Protocol.Audits.PermissionElementIssueType.NonOpaqueColor,\n      Protocol.Audits.PermissionElementIssueType.LowContrast,\n      Protocol.Audits.PermissionElementIssueType.FontSizeTooSmall,\n      Protocol.Audits.PermissionElementIssueType.FontSizeTooLarge,\n      Protocol.Audits.PermissionElementIssueType.InvalidSizeValue,\n    ];\n    for (const issueType of enumValues) {\n      const details: Protocol.Audits.PermissionElementIssueDetails = {\n        issueType,\n        nodeId: 1 as Protocol.DOM.BackendNodeId,\n        type: 'test-type',  // Default type for most issues\n      };\n\n      // Add/override specific fields required by certain issue types\n      switch (issueType) {\n        case Protocol.Audits.PermissionElementIssueType.PermissionsPolicyBlocked:\n          details.permissionName = 'test-permission';\n          break;\n        case Protocol.Audits.PermissionElementIssueType.ActivationDisabled:\n          details.disableReason = 'test-reason';\n          break;\n        case Protocol.Audits.PermissionElementIssueType.GeolocationDeprecated:\n          delete details.type;  // This type does not use the 'type' field\n          break;\n      }\n\n      const inspectorIssue = createProtocolIssue(details);\n\n      const issues =\n          IssuesManager.PermissionElementIssue.PermissionElementIssue.fromInspectorIssue(mockModel, inspectorIssue);\n      assert.lengthOf(issues, 1, `For ${issueType}: fromInspectorIssue should return one issue.`);\n      const issue = issues[0];\n      assert.strictEqual(\n          issue.code(), `${Protocol.Audits.InspectorIssueCode.PermissionElementIssue}::${issueType}`,\n          `For ${issueType}: issue code should be specific to the issueType.`);\n      assert.strictEqual(\n          issue.getCategory(), IssuesManager.Issue.IssueCategory.PERMISSION_ELEMENT,\n          `For ${issueType}: category should be PERMISSION_ELEMENT.`);\n      assert.strictEqual(\n          issue.getKind(),\n          details.isWarning ? IssuesManager.Issue.IssueKind.IMPROVEMENT : IssuesManager.Issue.IssueKind.PAGE_ERROR,\n          `For ${issueType}: kind should be correct based on isWarning.`);\n      assert.include(issue.primaryKey(), details.issueType, `For ${issueType}: primary key should include issueType.`);\n      if (details.nodeId) {\n        assert.lengthOf(Array.from(issue.elements()), 1, `For ${issueType}: should have one affected element.`);\n      }\n      const description = issue.getDescription();\n      assert.isNotNull(description, `For ${issueType}: description should not be null.`);\n      if (description) {\n        assert.include(\n            description.file, 'permissionElement',\n            `For ${issueType}: description file should be a permissionElement file.`);\n      }\n    }\n  });\n});\n"]}