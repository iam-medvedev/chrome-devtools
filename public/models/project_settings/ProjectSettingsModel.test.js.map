{"version":3,"file":"ProjectSettingsModel.test.js","sourceRoot":"","sources":["../../../../../../front_end/models/project_settings/ProjectSettingsModel.test.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright 2025 The Chromium Authors. All rights reserved.\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport * as Platform from '../../core/platform/platform.js';\nimport * as SDK from '../../core/sdk/sdk.js';\n\nimport * as ProjectSettings from './project_settings.js';\n\nconst {urlString} = Platform.DevToolsPath;\n\ndescribe('ProjectSettingsModel', () => {\n  const {ProjectSettingsModel} = ProjectSettings.ProjectSettingsModel;\n\n  afterEach(() => {\n    ProjectSettingsModel.removeInstance();\n  });\n\n  it('yields an empty configuration initially', () => {\n    const hostConfig = {devToolsWellKnown: {enabled: true}};\n    const pageResourceLoader = sinon.createStubInstance(SDK.PageResourceLoader.PageResourceLoader);\n    const targetManager = sinon.createStubInstance(SDK.TargetManager.TargetManager);\n\n    const projectSettingsModel = ProjectSettingsModel.instance({\n      forceNew: true,\n      hostConfig,\n      pageResourceLoader,\n      targetManager,\n    });\n\n    assert.deepEqual(projectSettingsModel.projectSettings, {});\n  });\n\n  it('yields an empty configuration if `devToolsWellKnown` is disabled', () => {\n    const hostConfig = {devToolsWellKnown: {enabled: false}};\n    const pageResourceLoader = sinon.createStubInstance(SDK.PageResourceLoader.PageResourceLoader);\n    const targetManager = sinon.createStubInstance(SDK.TargetManager.TargetManager);\n\n    const projectSettingsModel = ProjectSettingsModel.instance({\n      forceNew: true,\n      hostConfig,\n      pageResourceLoader,\n      targetManager,\n    });\n\n    assert.deepEqual(projectSettingsModel.projectSettings, {});\n  });\n\n  it('doesn\\'t load the devtools.json from non-local origins', async () => {\n    const hostConfig = {devToolsWellKnown: {enabled: true}};\n    const pageResourceLoader = sinon.createStubInstance(SDK.PageResourceLoader.PageResourceLoader);\n    const targetManager = sinon.createStubInstance(SDK.TargetManager.TargetManager);\n\n    const target = sinon.createStubInstance(SDK.Target.Target);\n    targetManager.primaryPageTarget.returns(target);\n\n    const resourceTreeModel = sinon.createStubInstance(SDK.ResourceTreeModel.ResourceTreeModel);\n    target.model.withArgs(SDK.ResourceTreeModel.ResourceTreeModel).returns(resourceTreeModel);\n\n    const frame = sinon.createStubInstance(SDK.ResourceTreeModel.ResourceTreeFrame);\n    resourceTreeModel.mainFrame = frame;\n    sinon.stub(frame, 'securityOriginDetails').get(() => ({isLocalhost: false}));\n\n    const projectSettingsModel = ProjectSettingsModel.instance({\n      forceNew: true,\n      hostConfig,\n      pageResourceLoader,\n      targetManager,\n    });\n\n    const projectSettings = await projectSettingsModel.projectSettingsPromise;\n    assert.deepEqual(projectSettings, {});\n  });\n\n  it('correctly loads the devtools.json from local origins', async () => {\n    const hostConfig = {devToolsWellKnown: {enabled: true}};\n    const pageResourceLoader = sinon.createStubInstance(SDK.PageResourceLoader.PageResourceLoader);\n    const targetManager = sinon.createStubInstance(SDK.TargetManager.TargetManager);\n\n    const target = sinon.createStubInstance(SDK.Target.Target);\n    targetManager.primaryPageTarget.returns(target);\n\n    const resourceTreeModel = sinon.createStubInstance(SDK.ResourceTreeModel.ResourceTreeModel);\n    target.model.withArgs(SDK.ResourceTreeModel.ResourceTreeModel).returns(resourceTreeModel);\n\n    const url = urlString`http://localhost:8090/.well-known/appspecific/com.chrome.devtools.json`;\n    const frameId = 'frame1';\n    const initiatorUrl = urlString`http://localhost:8090/foo`;\n    const frame = sinon.createStubInstance(SDK.ResourceTreeModel.ResourceTreeFrame);\n    resourceTreeModel.mainFrame = frame;\n    sinon.stub(frame, 'securityOriginDetails').get(() => ({isLocalhost: true}));\n    sinon.stub(frame, 'url').get(() => initiatorUrl);\n    sinon.stub(frame, 'id').get(() => frameId);\n\n    pageResourceLoader.loadResource.withArgs(url, sinon.match({target, frameId, initiatorUrl}))\n        .returns(Promise.resolve({content: '{\"workspace\":{\"root\":\"/home/foo\",\"uuid\":\"foo\"}}'}));\n\n    const projectSettingsModel = ProjectSettingsModel.instance({\n      forceNew: true,\n      hostConfig,\n      pageResourceLoader,\n      targetManager,\n    });\n\n    const projectSettings = await projectSettingsModel.projectSettingsPromise;\n    assert.deepEqual(projectSettings, {workspace: {root: '/home/foo', uuid: 'foo'}});\n  });\n\n  it('listens for navigations', () => {\n    const hostConfig = {devToolsWellKnown: {enabled: true}};\n    const pageResourceLoader = sinon.createStubInstance(SDK.PageResourceLoader.PageResourceLoader);\n    const targetManager = sinon.createStubInstance(SDK.TargetManager.TargetManager);\n\n    ProjectSettingsModel.instance({\n      forceNew: true,\n      hostConfig,\n      pageResourceLoader,\n      targetManager,\n    });\n\n    assert.isTrue(targetManager.addEventListener.calledOnceWith(SDK.TargetManager.Events.INSPECTED_URL_CHANGED));\n  });\n\n  it('doesn\\'t listen for navigations if `devToolsWellKnown` is disabled', () => {\n    const hostConfig = {devToolsWellKnown: {enabled: false}};\n    const pageResourceLoader = sinon.createStubInstance(SDK.PageResourceLoader.PageResourceLoader);\n    const targetManager = sinon.createStubInstance(SDK.TargetManager.TargetManager);\n\n    ProjectSettingsModel.instance({\n      forceNew: true,\n      hostConfig,\n      pageResourceLoader,\n      targetManager,\n    });\n\n    assert.isTrue(targetManager.addEventListener.notCalled);\n  });\n});\n"]}