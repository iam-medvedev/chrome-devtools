{"version":3,"file":"Widget.js","sourceRoot":"","sources":["../../../../../../front_end/ui/legacy/Widget.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright 2021 The Chromium Authors. All rights reserved.\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\n/*\n * Copyright (C) 2008 Apple Inc. All Rights Reserved.\n * Copyright (C) 2011 Google Inc. All Rights Reserved.\n *\n * Redistribution and use in source and binary forms, with or without\n * modification, are permitted provided that the following conditions\n * are met:\n * 1. Redistributions of source code must retain the above copyright\n *    notice, this list of conditions and the following disclaimer.\n * 2. Redistributions in binary form must reproduce the above copyright\n *    notice, this list of conditions and the following disclaimer in the\n *    documentation and/or other materials provided with the distribution.\n *\n * THIS SOFTWARE IS PROVIDED BY APPLE INC. ``AS IS'' AND ANY\n * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE\n * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR\n * PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL APPLE INC. OR\n * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,\n * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,\n * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR\n * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY\n * OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\n * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE\n * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n */\n\nimport '../../core/dom_extension/dom_extension.js';\n\nimport * as Platform from '../../core/platform/platform.js';\nimport * as Lit from '../../ui/lit/lit.js';\n\nimport {Constraints, Size} from './Geometry.js';\nimport * as ThemeSupport from './theme_support/theme_support.js';\nimport {createShadowRootWithCoreStyles} from './UIUtils.js';\nimport {XWidget} from './XWidget.js';\n\n// Remember the original DOM mutation methods here, since we\n// will override them below to sanity check the Widget system.\nconst originalAppendChild = Element.prototype.appendChild;\nconst originalInsertBefore = Element.prototype.insertBefore;\nconst originalRemoveChild = Element.prototype.removeChild;\nconst originalRemoveChildren = Element.prototype.removeChildren;\n\nfunction assert(condition: unknown, message: string): void {\n  if (!condition) {\n    throw new Error(message);\n  }\n}\n\ninterface WidgetConstructor<WidgetT extends Widget&WidgetParams, WidgetParams> {\n  new(element: WidgetElement<WidgetT, WidgetParams>): WidgetT;\n}\n\nexport class WidgetConfig<WidgetT extends Widget&WidgetParams, WidgetParams> {\n  constructor(readonly widgetClass: WidgetConstructor<WidgetT, WidgetParams>, readonly widgetParams?: WidgetParams) {\n  }\n}\n\nexport function widgetConfig<WidgetT extends Widget&WidgetParams, WidgetParams>(\n    widgetClass: WidgetConstructor<WidgetT, WidgetParams>, widgetParams?: WidgetParams):\n    // This is a workaround for https://github.com/runem/lit-analyzer/issues/163\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    WidgetConfig<any, any> {\n  return new WidgetConfig(widgetClass, widgetParams);\n}\n\nexport class WidgetElement<WidgetT extends Widget&WidgetParams, WidgetParams = object> extends HTMLElement {\n  #widgetClass?: WidgetConstructor<WidgetT, WidgetParams>;\n  #widgetParams?: WidgetParams;\n  createWidget(): WidgetT {\n    if (!this.#widgetClass) {\n      throw new Error('No widgetClass defined');\n    }\n\n    const widget = new this.#widgetClass(this);\n    if (this.#widgetParams) {\n      Object.assign(widget, this.#widgetParams);\n    }\n    widget.requestUpdate();\n    return widget;\n  }\n\n  set widgetConfig(config: WidgetConfig<WidgetT, WidgetParams>) {\n    const widget = Widget.get(this);\n    if (widget) {\n      let needsUpdate = false;\n      for (const key in config.widgetParams) {\n        if (config.widgetParams.hasOwnProperty(key) && config.widgetParams[key] !== this.#widgetParams?.[key]) {\n          needsUpdate = true;\n        }\n      }\n      if (needsUpdate) {\n        Object.assign(widget, config.widgetParams);\n        widget.requestUpdate();\n      }\n    }\n    this.#widgetClass = config.widgetClass;\n    this.#widgetParams = config.widgetParams;\n  }\n\n  getWidget(): WidgetT|undefined {\n    return Widget.get(this) as WidgetT | undefined;\n  }\n\n  connectedCallback(): void {\n    const widget = Widget.getOrCreateWidget(this);\n    if (!widget.element.parentElement) {\n      widget.markAsRoot();\n    }\n    widget.show(this.parentElement as HTMLElement, undefined, /* suppressOrphanWidgetError= */ true);\n  }\n\n  override appendChild<T extends Node>(child: T): T {\n    if (child instanceof HTMLElement && child.tagName !== 'STYLE') {\n      Widget.getOrCreateWidget(child).show(this);\n      return child;\n    }\n    return super.appendChild(child);\n  }\n\n  override insertBefore<T extends Node>(child: T, referenceChild: Node): T {\n    if (child instanceof HTMLElement && child.tagName !== 'STYLE') {\n      Widget.getOrCreateWidget(child).show(this, referenceChild);\n      return child;\n    }\n    return super.insertBefore(child, referenceChild);\n  }\n\n  override removeChild<T extends Node>(child: T): T {\n    const childWidget = Widget.get(child as unknown as HTMLElement);\n    if (childWidget) {\n      childWidget.detach();\n      return child;\n    }\n    return super.removeChild(child);\n  }\n\n  override removeChildren(): void {\n    for (const child of this.children) {\n      const childWidget = Widget.get(child as unknown as HTMLElement);\n      if (childWidget) {\n        childWidget.detach();\n      }\n    }\n    super.removeChildren();\n  }\n}\n\ncustomElements.define('devtools-widget', WidgetElement);\n\ninterface Constructor<T, Args extends unknown[]> {\n  new(...args: Args): T;\n}\n\nexport function widgetRef<T extends Widget, Args extends unknown[]>(\n    type: Constructor<T, Args>, callback: (_: T) => void): ReturnType<typeof Lit.Directives.ref> {\n  return Lit.Directives.ref((e?: Element) => {\n    if (!(e instanceof HTMLElement)) {\n      return;\n    }\n    const widget = Widget.getOrCreateWidget(e);\n    if (!(widget instanceof type)) {\n      throw new Error(`Expected an element with a widget of type ${type.name} but got ${e?.constructor?.name}`);\n    }\n    callback(widget);\n  });\n}\n\nconst widgetCounterMap = new WeakMap<Node, number>();\nconst widgetMap = new WeakMap<Node, Widget>();\n\nfunction incrementWidgetCounter(parentElement: Element, childElement: Element): void {\n  const count = (widgetCounterMap.get(childElement) || 0) + (widgetMap.get(childElement) ? 1 : 0);\n  for (let el: Element|null = parentElement; el; el = el.parentElementOrShadowHost()) {\n    widgetCounterMap.set(el, (widgetCounterMap.get(el) || 0) + count);\n  }\n}\n\nfunction decrementWidgetCounter(parentElement: Element, childElement: Element): void {\n  const count = (widgetCounterMap.get(childElement) || 0) + (widgetMap.get(childElement) ? 1 : 0);\n  for (let el: Element|null = parentElement; el; el = el.parentElementOrShadowHost()) {\n    const elCounter = widgetCounterMap.get(el);\n    if (elCounter) {\n      widgetCounterMap.set(el, elCounter - count);\n    }\n  }\n}\n\n// The resolved `updateComplete` promise, which is used as a marker for the\n// Widget's `#updateComplete` private property to indicate that there's no\n// pending update.\nconst UPDATE_COMPLETE = Promise.resolve(true);\nconst UPDATE_COMPLETE_RESOLVE = (_result: boolean): void => {};\n\nexport class Widget {\n  readonly element: HTMLElement;\n  contentElement: HTMLElement;\n  private shadowRoot: typeof Element.prototype.shadowRoot;\n  protected visibleInternal: boolean;\n  private isRoot: boolean;\n  private isShowingInternal: boolean;\n  private readonly childrenInternal: Widget[];\n  private hideOnDetach: boolean;\n  private notificationDepth: number;\n  private invalidationsSuspended: number;\n  defaultFocusedChild: Widget|null;\n  private parentWidgetInternal: Widget|null;\n  private defaultFocusedElement?: Element|null;\n  private cachedConstraints?: Constraints;\n  private constraintsInternal?: Constraints;\n  private invalidationsRequested?: boolean;\n  private externallyManaged?: boolean;\n  #updateComplete = UPDATE_COMPLETE;\n  #updateCompleteResolve = UPDATE_COMPLETE_RESOLVE;\n  #updateRequestID = 0;\n  constructor(useShadowDom?: boolean, delegatesFocus?: boolean, element?: HTMLElement) {\n    this.element = element || document.createElement('div');\n    this.shadowRoot = this.element.shadowRoot;\n    if (useShadowDom && !this.shadowRoot) {\n      this.element.classList.add('vbox');\n      this.element.classList.add('flex-auto');\n      this.shadowRoot = createShadowRootWithCoreStyles(this.element, {delegatesFocus});\n      this.contentElement = document.createElement('div');\n      this.shadowRoot.appendChild(this.contentElement);\n    } else {\n      this.contentElement = this.element;\n    }\n    this.contentElement.classList.add('widget');\n    widgetMap.set(this.element, this);\n    this.visibleInternal = false;\n    this.isRoot = false;\n    this.isShowingInternal = false;\n    this.childrenInternal = [];\n    this.hideOnDetach = false;\n    this.notificationDepth = 0;\n    this.invalidationsSuspended = 0;\n    this.defaultFocusedChild = null;\n    this.parentWidgetInternal = null;\n  }\n\n  /**\n   * Returns the {@link Widget} whose element is the given `node`, or `undefined`\n   * if the `node` is not an element for a widget.\n   *\n   * @param node a DOM node.\n   * @returns the {@link Widget} that is attached to the `node` or `undefined`.\n   */\n  static get(node: Node): Widget|undefined {\n    return widgetMap.get(node);\n  }\n\n  static getOrCreateWidget(element: HTMLElement): Widget {\n    const widget = Widget.get(element);\n    if (widget) {\n      return widget;\n    }\n    if (element instanceof WidgetElement) {\n      return element.createWidget();\n    }\n    return new Widget(undefined, undefined, element);\n  }\n\n  markAsRoot(): void {\n    assert(!this.element.parentElement, 'Attempt to mark as root attached node');\n    this.isRoot = true;\n  }\n\n  parentWidget(): Widget|null {\n    return this.parentWidgetInternal;\n  }\n\n  children(): Widget[] {\n    return this.childrenInternal;\n  }\n\n  childWasDetached(_widget: Widget): void {\n  }\n\n  isShowing(): boolean {\n    return this.isShowingInternal;\n  }\n\n  shouldHideOnDetach(): boolean {\n    if (!this.element.parentElement) {\n      return false;\n    }\n    if (this.hideOnDetach) {\n      return true;\n    }\n    for (const child of this.childrenInternal) {\n      if (child.shouldHideOnDetach()) {\n        return true;\n      }\n    }\n    return false;\n  }\n\n  setHideOnDetach(): void {\n    this.hideOnDetach = true;\n  }\n\n  private inNotification(): boolean {\n    return Boolean(this.notificationDepth) || Boolean(this.parentWidgetInternal?.inNotification());\n  }\n\n  private parentIsShowing(): boolean {\n    if (this.isRoot) {\n      return true;\n    }\n    return this.parentWidgetInternal?.isShowing() ?? false;\n  }\n\n  protected callOnVisibleChildren(method: (this: Widget) => void): void {\n    const copy = this.childrenInternal.slice();\n    for (let i = 0; i < copy.length; ++i) {\n      if (copy[i].parentWidgetInternal === this && copy[i].visibleInternal) {\n        method.call(copy[i]);\n      }\n    }\n  }\n\n  private processWillShow(): void {\n    this.callOnVisibleChildren(this.processWillShow);\n    this.isShowingInternal = true;\n  }\n\n  private processWasShown(): void {\n    if (this.inNotification()) {\n      return;\n    }\n    this.restoreScrollPositions();\n    this.notify(this.wasShown);\n    this.callOnVisibleChildren(this.processWasShown);\n  }\n\n  private processWillHide(): void {\n    if (this.inNotification()) {\n      return;\n    }\n    this.storeScrollPositions();\n\n    this.callOnVisibleChildren(this.processWillHide);\n    this.notify(this.willHide);\n    this.isShowingInternal = false;\n  }\n\n  private processWasHidden(): void {\n    this.callOnVisibleChildren(this.processWasHidden);\n  }\n\n  private processOnResize(): void {\n    if (this.inNotification()) {\n      return;\n    }\n    if (!this.isShowing()) {\n      return;\n    }\n    this.notify(this.onResize);\n    this.callOnVisibleChildren(this.processOnResize);\n  }\n\n  private notify(notification: (this: Widget) => void): void {\n    ++this.notificationDepth;\n    try {\n      notification.call(this);\n    } finally {\n      --this.notificationDepth;\n    }\n  }\n\n  wasShown(): void {\n  }\n\n  willHide(): void {\n  }\n\n  onResize(): void {\n  }\n\n  onLayout(): void {\n  }\n\n  onDetach(): void {\n  }\n\n  async ownerViewDisposed(): Promise<void> {\n  }\n\n  show(parentElement: Element, insertBefore?: Node|null, suppressOrphanWidgetError = false): void {\n    assert(parentElement, 'Attempt to attach widget with no parent element');\n\n    if (!this.isRoot) {\n      // Update widget hierarchy.\n      let currentParent: Element|null = parentElement;\n      let currentWidget = undefined;\n      while (!currentWidget) {\n        if (!currentParent) {\n          if (suppressOrphanWidgetError) {\n            this.isRoot = true;\n            console.warn('A Widget has silently been marked as a root widget');\n            this.show(parentElement, insertBefore);\n            return;\n          }\n          throw new Error('Attempt to attach widget to orphan node');\n        }\n        currentWidget = widgetMap.get(currentParent);\n        currentParent = currentParent.parentElementOrShadowHost();\n      }\n      this.attach(currentWidget);\n    }\n    this.showWidgetInternal(parentElement, insertBefore);\n  }\n\n  private attach(parentWidget: Widget): void {\n    if (parentWidget === this.parentWidgetInternal) {\n      return;\n    }\n    if (this.parentWidgetInternal) {\n      this.detach();\n    }\n    this.parentWidgetInternal = parentWidget;\n    this.parentWidgetInternal.childrenInternal.push(this);\n    this.isRoot = false;\n  }\n\n  showWidget(): void {\n    if (this.visibleInternal) {\n      return;\n    }\n    if (!this.element.parentElement) {\n      throw new Error('Attempt to show widget that is not hidden using hideWidget().');\n    }\n    this.showWidgetInternal(this.element.parentElement, this.element.nextSibling);\n  }\n\n  private showWidgetInternal(parentElement: Element, insertBefore?: Node|null): void {\n    let currentParent: Element|null = parentElement;\n    while (currentParent && !widgetMap.get(currentParent)) {\n      currentParent = currentParent.parentElementOrShadowHost();\n    }\n\n    if (this.isRoot) {\n      assert(!currentParent, 'Attempt to show root widget under another widget');\n    } else {\n      assert(\n          currentParent && widgetMap.get(currentParent) === this.parentWidgetInternal,\n          'Attempt to show under node belonging to alien widget');\n    }\n\n    const wasVisible = this.visibleInternal;\n    if (wasVisible && this.element.parentElement === parentElement) {\n      return;\n    }\n\n    this.visibleInternal = true;\n\n    if (!wasVisible && this.parentIsShowing()) {\n      this.processWillShow();\n    }\n\n    this.element.classList.remove('hidden');\n\n    // Reparent\n    if (this.element.parentElement !== parentElement) {\n      if (!this.externallyManaged) {\n        incrementWidgetCounter(parentElement, this.element);\n      }\n      if (insertBefore) {\n        originalInsertBefore.call(parentElement, this.element, insertBefore);\n      } else {\n        originalAppendChild.call(parentElement, this.element);\n      }\n    }\n\n    if (!wasVisible && this.parentIsShowing()) {\n      this.processWasShown();\n    }\n\n    if (this.parentWidgetInternal && this.hasNonZeroConstraints()) {\n      this.parentWidgetInternal.invalidateConstraints();\n    } else {\n      this.processOnResize();\n    }\n  }\n\n  hideWidget(): void {\n    if (!this.visibleInternal) {\n      return;\n    }\n    this.hideWidgetInternal(false);\n  }\n\n  private hideWidgetInternal(removeFromDOM: boolean): void {\n    this.visibleInternal = false;\n    const {parentElement} = this.element;\n\n    if (this.parentIsShowing()) {\n      this.processWillHide();\n    }\n\n    if (removeFromDOM) {\n      if (parentElement) {\n        // Force legal removal\n        decrementWidgetCounter(parentElement, this.element);\n        originalRemoveChild.call(parentElement, this.element);\n      }\n      this.onDetach();\n    } else {\n      this.element.classList.add('hidden');\n    }\n\n    if (this.parentIsShowing()) {\n      this.processWasHidden();\n    }\n    if (this.parentWidgetInternal && this.hasNonZeroConstraints()) {\n      this.parentWidgetInternal.invalidateConstraints();\n    }\n  }\n\n  detach(overrideHideOnDetach?: boolean): void {\n    if (!this.parentWidgetInternal && !this.isRoot) {\n      return;\n    }\n\n    // Cancel any pending update.\n    if (this.#updateRequestID !== 0) {\n      cancelAnimationFrame(this.#updateRequestID);\n      this.#updateCompleteResolve(true);\n      this.#updateCompleteResolve = UPDATE_COMPLETE_RESOLVE;\n      this.#updateComplete = UPDATE_COMPLETE;\n      this.#updateRequestID = 0;\n    }\n\n    // hideOnDetach means that we should never remove element from dom - content\n    // has iframes and detaching it will hurt.\n    //\n    // overrideHideOnDetach will override hideOnDetach and the client takes\n    // responsibility for the consequences.\n    const removeFromDOM = overrideHideOnDetach || !this.shouldHideOnDetach();\n    if (this.visibleInternal) {\n      this.hideWidgetInternal(removeFromDOM);\n    } else if (removeFromDOM) {\n      const {parentElement} = this.element;\n      if (parentElement) {\n        // Force kick out from DOM.\n        decrementWidgetCounter(parentElement, this.element);\n        originalRemoveChild.call(parentElement, this.element);\n      }\n    }\n\n    // Update widget hierarchy.\n    if (this.parentWidgetInternal) {\n      const childIndex = this.parentWidgetInternal.childrenInternal.indexOf(this);\n      assert(childIndex >= 0, 'Attempt to remove non-child widget');\n      this.parentWidgetInternal.childrenInternal.splice(childIndex, 1);\n      if (this.parentWidgetInternal.defaultFocusedChild === this) {\n        this.parentWidgetInternal.defaultFocusedChild = null;\n      }\n      this.parentWidgetInternal.childWasDetached(this);\n      this.parentWidgetInternal = null;\n    } else {\n      assert(this.isRoot, 'Removing non-root widget from DOM');\n    }\n  }\n\n  detachChildWidgets(): void {\n    const children = this.childrenInternal.slice();\n    for (let i = 0; i < children.length; ++i) {\n      children[i].detach();\n    }\n  }\n\n  elementsToRestoreScrollPositionsFor(): Element[] {\n    return [this.element];\n  }\n\n  storeScrollPositions(): void {\n    const elements = this.elementsToRestoreScrollPositionsFor();\n    for (const container of elements) {\n      storedScrollPositions.set(container, {scrollLeft: container.scrollLeft, scrollTop: container.scrollTop});\n    }\n  }\n\n  restoreScrollPositions(): void {\n    const elements = this.elementsToRestoreScrollPositionsFor();\n    for (const container of elements) {\n      const storedPositions = storedScrollPositions.get(container);\n      if (storedPositions) {\n        container.scrollLeft = storedPositions.scrollLeft;\n        container.scrollTop = storedPositions.scrollTop;\n      }\n    }\n  }\n\n  doResize(): void {\n    if (!this.isShowing()) {\n      return;\n    }\n    // No matter what notification we are in, dispatching onResize is not needed.\n    if (!this.inNotification()) {\n      this.callOnVisibleChildren(this.processOnResize);\n    }\n  }\n\n  doLayout(): void {\n    if (!this.isShowing()) {\n      return;\n    }\n    this.notify(this.onLayout);\n    this.doResize();\n  }\n\n  registerRequiredCSS(...cssFiles: Array<{cssContent: string}>): void {\n    for (const cssFile of cssFiles) {\n      ThemeSupport.ThemeSupport.instance().appendStyle(this.shadowRoot ?? this.element, cssFile);\n    }\n  }\n\n  // Unused, but useful for debugging.\n  printWidgetHierarchy(): void {\n    const lines: string[] = [];\n    this.collectWidgetHierarchy('', lines);\n    console.log(lines.join('\\n'));  // eslint-disable-line no-console\n  }\n\n  private collectWidgetHierarchy(prefix: string, lines: string[]): void {\n    lines.push(prefix + '[' + this.element.className + ']' + (this.childrenInternal.length ? ' {' : ''));\n\n    for (let i = 0; i < this.childrenInternal.length; ++i) {\n      this.childrenInternal[i].collectWidgetHierarchy(prefix + '    ', lines);\n    }\n\n    if (this.childrenInternal.length) {\n      lines.push(prefix + '}');\n    }\n  }\n\n  setDefaultFocusedElement(element: Element|null): void {\n    this.defaultFocusedElement = element;\n  }\n\n  setDefaultFocusedChild(child: Widget): void {\n    assert(child.parentWidgetInternal === this, 'Attempt to set non-child widget as default focused.');\n    this.defaultFocusedChild = child;\n  }\n\n  focus(): void {\n    if (!this.isShowing()) {\n      return;\n    }\n\n    const element = (this.defaultFocusedElement as HTMLElement | null);\n    if (element) {\n      if (!element.hasFocus()) {\n        element.focus();\n      }\n      return;\n    }\n\n    if (this.defaultFocusedChild?.visibleInternal) {\n      this.defaultFocusedChild.focus();\n    } else {\n      for (const child of this.childrenInternal) {\n        if (child.visibleInternal) {\n          child.focus();\n          return;\n        }\n      }\n      let child = this.contentElement.traverseNextNode(this.contentElement);\n      while (child) {\n        if (child instanceof XWidget) {\n          child.focus();\n          return;\n        }\n        child = child.traverseNextNode(this.contentElement);\n      }\n    }\n  }\n\n  hasFocus(): boolean {\n    return this.element.hasFocus();\n  }\n\n  calculateConstraints(): Constraints {\n    return new Constraints();\n  }\n\n  constraints(): Constraints {\n    if (typeof this.constraintsInternal !== 'undefined') {\n      return this.constraintsInternal;\n    }\n    if (typeof this.cachedConstraints === 'undefined') {\n      this.cachedConstraints = this.calculateConstraints();\n    }\n    return this.cachedConstraints;\n  }\n\n  setMinimumAndPreferredSizes(width: number, height: number, preferredWidth: number, preferredHeight: number): void {\n    this.constraintsInternal = new Constraints(new Size(width, height), new Size(preferredWidth, preferredHeight));\n    this.invalidateConstraints();\n  }\n\n  setMinimumSize(width: number, height: number): void {\n    this.minimumSize = new Size(width, height);\n  }\n\n  set minimumSize(size: Size) {\n    this.constraintsInternal = new Constraints(size);\n    this.invalidateConstraints();\n  }\n\n  private hasNonZeroConstraints(): boolean {\n    const constraints = this.constraints();\n    return Boolean(\n        constraints.minimum.width || constraints.minimum.height || constraints.preferred.width ||\n        constraints.preferred.height);\n  }\n\n  suspendInvalidations(): void {\n    ++this.invalidationsSuspended;\n  }\n\n  resumeInvalidations(): void {\n    --this.invalidationsSuspended;\n    if (!this.invalidationsSuspended && this.invalidationsRequested) {\n      this.invalidateConstraints();\n    }\n  }\n\n  invalidateConstraints(): void {\n    if (this.invalidationsSuspended) {\n      this.invalidationsRequested = true;\n      return;\n    }\n    this.invalidationsRequested = false;\n    const cached = this.cachedConstraints;\n    delete this.cachedConstraints;\n    const actual = this.constraints();\n    if (!actual.isEqual(cached || null) && this.parentWidgetInternal) {\n      this.parentWidgetInternal.invalidateConstraints();\n    } else {\n      this.doLayout();\n    }\n  }\n\n  // Excludes the widget from being tracked by its parents/ancestors via\n  // widgetCounter because the widget is being handled by external code.\n  // Widgets marked as being externally managed are responsible for\n  // finishing out their own lifecycle (i.e. calling detach() before being\n  // removed from the DOM). This is e.g. used for CodeMirror.\n  //\n  // Also note that this must be called before the widget is shown so that\n  // so that its ancestor's widgetCounter is not incremented.\n  markAsExternallyManaged(): void {\n    assert(!this.parentWidgetInternal, 'Attempt to mark widget as externally managed after insertion to the DOM');\n    this.externallyManaged = true;\n  }\n\n  /**\n   * Override this method in derived classes to perform the actual view update.\n   *\n   * This is not meant to be called directly, but invoked (indirectly) through\n   * the `requestAnimationFrame` and executed with the animation frame. Instead,\n   * use the `requestUpdate()` method to schedule an asynchronous update.\n   *\n   * @return can either return nothing or a promise; in that latter case, the\n   *         update logic will await the resolution of the returned promise\n   *         before proceeding.\n   */\n  performUpdate(): Promise<void>|void {\n  }\n\n  async #performUpdateCallback(): Promise<boolean> {\n    // Mark this update cycle as complete by assigning\n    // the marker sentinel.\n    this.#updateComplete = UPDATE_COMPLETE;\n    this.#updateCompleteResolve = UPDATE_COMPLETE_RESOLVE;\n    this.#updateRequestID = 0;\n\n    // Run the actual update logic.\n    await this.performUpdate();\n\n    // Resolve the `updateComplete` with `true` if no\n    // new update was triggered during this cycle.\n    return this.#updateComplete === UPDATE_COMPLETE;\n  }\n\n  /**\n   * Schedules an asynchronous update for this widget.\n   *\n   * The update will be deduplicated and executed with the next animation\n   * frame.\n   */\n  requestUpdate(): void {\n    if (this.#updateComplete === UPDATE_COMPLETE) {\n      this.#updateComplete = new Promise((resolve, reject) => {\n        this.#updateCompleteResolve = resolve;\n        this.#updateRequestID = requestAnimationFrame(() => this.#performUpdateCallback().then(resolve, reject));\n      });\n    }\n  }\n\n  /**\n   * The `updateComplete` promise resolves when the widget has finished updating.\n   *\n   * Use `updateComplete` to wait for an update:\n   * ```js\n   * await widget.updateComplete;\n   * // do stuff\n   * ```\n   *\n   * This method is primarily useful for unit tests, to wait for widgets to build\n   * their DOM. For example:\n   * ```js\n   * // Set up the test widget, and wait for the initial update cycle to complete.\n   * const widget = new SomeWidget(someData);\n   * widget.requestUpdate();\n   * await widget.updateComplete;\n   *\n   * // Assert state of the widget.\n   * assert.isTrue(widget.someDataLoaded);\n   * ```\n   *\n   * @returns a promise that resolves to a `boolean` when the widget has finished\n   *          updating, the value is `true` if there are no more pending updates,\n   *          and `false` if the update cycle triggered another update.\n   */\n  get updateComplete(): Promise<boolean> {\n    return this.#updateComplete;\n  }\n}\n\nconst storedScrollPositions = new WeakMap<Element, {\n  scrollLeft: number,\n  scrollTop: number,\n}>();\n\nexport class VBox extends Widget {\n  constructor(useShadowDom?: boolean|HTMLElement, delegatesFocus?: boolean, element?: HTMLElement) {\n    if (useShadowDom instanceof HTMLElement) {\n      element = useShadowDom;\n      useShadowDom = false;\n    }\n    super(useShadowDom, delegatesFocus, element);\n    this.contentElement.classList.add('vbox');\n  }\n\n  override calculateConstraints(): Constraints {\n    let constraints: Constraints = new Constraints();\n\n    function updateForChild(this: Widget): void {\n      const child = this.constraints();\n      constraints = constraints.widthToMax(child);\n      constraints = constraints.addHeight(child);\n    }\n\n    this.callOnVisibleChildren(updateForChild);\n    return constraints;\n  }\n}\n\nexport class HBox extends Widget {\n  constructor(useShadowDom?: boolean) {\n    super(useShadowDom);\n    this.contentElement.classList.add('hbox');\n  }\n\n  override calculateConstraints(): Constraints {\n    let constraints: Constraints = new Constraints();\n\n    function updateForChild(this: Widget): void {\n      const child = this.constraints();\n      constraints = constraints.addWidth(child);\n      constraints = constraints.heightToMax(child);\n    }\n\n    this.callOnVisibleChildren(updateForChild);\n    return constraints;\n  }\n}\n\nexport class VBoxWithResizeCallback extends VBox {\n  private readonly resizeCallback: () => void;\n  constructor(resizeCallback: () => void) {\n    super();\n    this.resizeCallback = resizeCallback;\n  }\n\n  override onResize(): void {\n    this.resizeCallback();\n  }\n}\n\nexport class WidgetFocusRestorer {\n  private widget: Widget|null;\n  private previous: HTMLElement|null;\n  constructor(widget: Widget) {\n    this.widget = widget;\n    this.previous = (Platform.DOMUtilities.deepActiveElement(widget.element.ownerDocument) as HTMLElement | null);\n    widget.focus();\n  }\n\n  restore(): void {\n    if (!this.widget) {\n      return;\n    }\n    if (this.widget.hasFocus() && this.previous) {\n      this.previous.focus();\n    }\n    this.previous = null;\n    this.widget = null;\n  }\n}\n\nElement.prototype.appendChild = function<T extends Node>(node: T): T {\n  if (widgetMap.get(node) && node.parentElement !== this) {\n    throw new Error('Attempt to add widget via regular DOM operation.');\n  }\n  return originalAppendChild.call(this, node) as T;\n};\n\nElement.prototype.insertBefore = function<T extends Node>(node: T, child: Node|null): T {\n  if (widgetMap.get(node) && node.parentElement !== this) {\n    throw new Error('Attempt to add widget via regular DOM operation.');\n  }\n  return originalInsertBefore.call(this, node, child) as T;\n};\n\nElement.prototype.removeChild = function<T extends Node>(child: T): T {\n  if (widgetCounterMap.get(child) || widgetMap.get(child)) {\n    throw new Error('Attempt to remove element containing widget via regular DOM operation');\n  }\n  return originalRemoveChild.call(this, child) as T;\n};\n\nElement.prototype.removeChildren = function(): void {\n  if (widgetCounterMap.get(this)) {\n    throw new Error('Attempt to remove element containing widget via regular DOM operation');\n  }\n  return originalRemoveChildren.call(this);\n};\n"]}