{"version":3,"file":"CanvasHelper.js","sourceRoot":"","sources":["../../../../../../../../front_end/ui/legacy/components/perf_ui/CanvasHelper.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright (c) 2024 The Chromium Authors. All rights reserved.\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\nimport * as ThemeSupport from '../../theme_support/theme_support.js';\n\nimport {ARROW_SIDE, type Legend} from './FlameChart.js';\nimport {getFontFamilyForCanvas} from './Font.js';\n\nconst LEGEND_SHAPE_DIMENSION = 8;\nconst LEGEND_SHAPE_RADIUS = 2;\nconst LEGEND_SHAPE_TEXT_GAP = 4;\nconst LEGEND_ITEM_GAP = 12;\n\n// The DEFAULT_FONT_SIZE is 11px, the legends' font size should be slightly smaller.\nconst LEGEND_FONT_SIZE = '8px';\n\nexport function horizontalLine(context: CanvasRenderingContext2D, width: number, y: number): void {\n  context.moveTo(0, y);\n  context.lineTo(width, y);\n}\n\nexport function drawExpansionArrow(context: CanvasRenderingContext2D, x: number, y: number, expanded: boolean): void {\n  // We will draw a equilateral triangle, so first calculate the height of the triangle.\n  const arrowHeight = ARROW_SIDE * Math.sqrt(3) / 2;\n  const arrowCenterOffset = Math.round(arrowHeight / 2);\n  context.save();\n  context.beginPath();\n  context.translate(x, y);\n  context.rotate(expanded ? Math.PI / 2 : 0);\n  // The final triangle will be this shape: (the rotation will be handled by `context.rotate`)\n  // |\\\n  // | \\\n  // | /\n  // |/\n\n  // Move to the top vertex\n  context.moveTo(-arrowCenterOffset, -ARROW_SIDE / 2);\n  // Line to the bottom vertex\n  context.lineTo(-arrowCenterOffset, ARROW_SIDE / 2);\n  // Line to the right vertex\n  context.lineTo(arrowHeight - arrowCenterOffset, 0);\n  context.fill();\n  context.restore();\n}\n\nexport function drawIcon(\n    context: CanvasRenderingContext2D, x: number, y: number, width: number, pathData: string,\n    iconColor: string = '--sys-color-on-surface'): void {\n  const p = new Path2D(pathData);\n\n  context.save();\n  context.translate(x, y);\n  // This color is same as the background of the whole flame chart.\n  context.fillStyle = ThemeSupport.ThemeSupport.instance().getComputedValue('--sys-color-cdt-base-container');\n  context.fillRect(0, 0, width, width);\n\n  context.fillStyle = ThemeSupport.ThemeSupport.instance().getComputedValue(iconColor);\n  // The pathData from front_end/images folder is for a 20 pixel icon.\n  // So we add a scale to draw the icon in a correct size.\n  const scale = width / 20;\n  context.scale(scale, scale);\n  context.fill(p);\n  context.restore();\n}\n\nexport function drawLegends(context: CanvasRenderingContext2D, x: number, y: number, legends: Legend[]): void {\n  context.save();\n  context.translate(x, y);\n  let xForLegend = 0;\n  for (const legend of legends) {\n    xForLegend = drawOneLegend(context, xForLegend, 4, legend.color, legend.category);\n  }\n  context.restore();\n}\n\n/**\n * Draw a legend for the given color and category.\n *\n * @param color should be a string parsed as CSS <color> value\n * @returns the x offset of the current legend\n */\nfunction drawOneLegend(\n    context: CanvasRenderingContext2D, x: number, y: number, color: string, category: string): number {\n  context.save();\n\n  context.beginPath();\n  context.fillStyle = color;\n  drawRoundedRectangle(context, x, y, LEGEND_SHAPE_DIMENSION, LEGEND_SHAPE_DIMENSION, LEGEND_SHAPE_RADIUS);\n  context.fill();\n\n  context.textBaseline = 'top';\n  context.fillStyle = ThemeSupport.ThemeSupport.instance().getComputedValue('--color-text-primary');\n  context.font = `${LEGEND_FONT_SIZE} ${getFontFamilyForCanvas()}`;\n  context.fillText(category, x + LEGEND_SHAPE_DIMENSION + LEGEND_SHAPE_TEXT_GAP, y);\n  const renderedTextWidth = context.measureText(category).width;\n  const endXPositionForEntry = x + LEGEND_SHAPE_DIMENSION + LEGEND_SHAPE_TEXT_GAP + renderedTextWidth;\n\n  context.restore();\n\n  return endXPositionForEntry + LEGEND_ITEM_GAP;\n}\n\nfunction drawRoundedRectangle(\n    context: CanvasRenderingContext2D, startX: number, startY: number, width: number, height: number,\n    borderRadius: number): void {\n  context.save();\n  const endY = startY + height;\n  const endX = startX + width;\n\n  const bezierCurveHandlerAmount = borderRadius * 0.25;\n\n  context.beginPath();\n  // Start at the top left, and draw a line to the top right.\n  context.moveTo(startX + borderRadius, startY);\n  context.lineTo(endX - borderRadius, startY);\n  // Curve from top right corner round and down\n  context.bezierCurveTo(\n      endX - bezierCurveHandlerAmount, startY, endX, startY + bezierCurveHandlerAmount, endX, startY + borderRadius);\n  // Draw down to bottom right corner\n  context.lineTo(endX, endY - borderRadius);\n  // Curve from bottom right corner round to face the bottom left corner\n  context.bezierCurveTo(\n      endX, endY - bezierCurveHandlerAmount, endX - bezierCurveHandlerAmount, endY, endX - borderRadius, endY);\n  // Draw line to bottom left corner\n  context.lineTo(startX + borderRadius, endY);\n  // Curve round and up from bottom left corner\n  context.bezierCurveTo(\n      startX + bezierCurveHandlerAmount, endY, startX, endY - bezierCurveHandlerAmount, startX, endY - borderRadius);\n  // Draw line up to top left corner\n  context.lineTo(startX, startY + borderRadius);\n  // Curve from top left corner round to meet the line we first drew.\n  context.bezierCurveTo(\n      startX, startY + bezierCurveHandlerAmount, startX + bezierCurveHandlerAmount, startY, startX + borderRadius,\n      startY);\n  context.closePath();\n  context.restore();\n}\n"]}