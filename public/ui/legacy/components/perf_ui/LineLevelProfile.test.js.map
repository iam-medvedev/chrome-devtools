{"version":3,"file":"LineLevelProfile.test.js","sourceRoot":"","sources":["../../../../../../../../front_end/ui/legacy/components/perf_ui/LineLevelProfile.test.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright 2025 The Chromium Authors\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport * as Platform from '../../../../core/platform/platform.js';\nimport * as SDK from '../../../../core/sdk/sdk.js';\nimport type * as Protocol from '../../../../generated/protocol.js';\nimport * as Bindings from '../../../../models/bindings/bindings.js';\nimport * as Workspace from '../../../../models/workspace/workspace.js';\nimport {createTarget, deinitializeGlobalVars, initializeGlobalVars} from '../../../../testing/EnvironmentHelpers.js';\nimport {describeWithMockConnection} from '../../../../testing/MockConnection.js';\nimport {setupMockedUISourceCode} from '../../../../testing/UISourceCodeHelpers.js';\n\nimport * as PerfUI from './perf_ui.js';\n\nconst {urlString} = Platform.DevToolsPath;\n\ndescribeWithMockConnection('LineLevelProfile', () => {\n  before(async () => {\n    await initializeGlobalVars();\n  });\n  after(async () => {\n    await deinitializeGlobalVars();\n  });\n\n  describe('Helper', () => {\n    it('should collect and apply performance decorations', async () => {\n      const helper = new PerfUI.LineLevelProfile.Helper(Workspace.UISourceCode.DecoratorType.PERFORMANCE);\n      const {sut: uiSourceCode} = setupMockedUISourceCode(urlString`file:///script.js`);\n\n      const target = createTarget();\n      const debuggerModel = target.model(SDK.DebuggerModel.DebuggerModel);\n      if (!debuggerModel) {\n        assert.fail('DebuggerModel not found');\n        return;\n      }\n\n      const debuggerWorkspaceBinding =\n          sinon.createStubInstance(Bindings.DebuggerWorkspaceBinding.DebuggerWorkspaceBinding);\n      sinon.stub(Bindings.DebuggerWorkspaceBinding.DebuggerWorkspaceBinding, 'instance')\n          .returns(debuggerWorkspaceBinding);\n\n      sinon.stub(debuggerModel, 'createRawLocationByURL')\n          .returns(new SDK.DebuggerModel.Location(debuggerModel, 'scriptId' as Protocol.Runtime.ScriptId, 4, 9));\n\n      const uiLocation = new Workspace.UISourceCode.UILocation(uiSourceCode, 4, 9);\n      debuggerWorkspaceBinding.rawLocationToUILocation.resolves(uiLocation);\n\n      helper.addLocationData(target, urlString`file:///script.js`, {line: 5, column: 10}, 100);\n\n      // scheduleUpdate uses a setTimeout which we need to wait for.\n      await new Promise(resolve => setTimeout(resolve, 0));\n\n      const decorations = uiSourceCode.getDecorationData(Workspace.UISourceCode.DecoratorType.PERFORMANCE);\n      assert.isDefined(decorations, 'Decorations should be defined');\n      const lineData = decorations.get(5);\n      assert.isDefined(lineData, 'Line data should be defined');\n      const columnData = lineData.get(10);\n      assert.strictEqual(columnData, 100);\n    });\n  });\n});\n"]}