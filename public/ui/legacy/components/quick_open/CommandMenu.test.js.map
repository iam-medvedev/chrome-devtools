{"version":3,"file":"CommandMenu.test.js","sourceRoot":"","sources":["../../../../../../../../front_end/ui/legacy/components/quick_open/CommandMenu.test.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright 2022 The Chromium Authors\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport * as Common from '../../../../core/common/common.js';\nimport * as i18n from '../../../../core/i18n/i18n.js';\nimport type * as Platform from '../../../../core/platform/platform.js';\nimport {\n  createFakeSetting,\n  deinitializeGlobalVars,\n  describeWithLocale,\n  initializeGlobalVars\n} from '../../../../testing/EnvironmentHelpers.js';\n\nimport * as QuickOpen from './quick_open.js';\n\nfunction createCommandMenuProvider(\n    deprecationNotice: Common.SettingRegistration.SettingRegistration['deprecationNotice']) {\n  const setting = createFakeSetting<boolean>('test-setting', false);\n  setting.setRegistration({\n    settingName: 'test-setting',\n    settingType: Common.SettingRegistration.SettingType.BOOLEAN,\n    category: Common.SettingRegistration.SettingCategory.APPEARANCE,\n    defaultValue: false,\n    deprecationNotice,\n  });\n  const command =\n      QuickOpen.CommandMenu.CommandMenu.createSettingCommand(setting, i18n.i18n.lockedString('Test Set Value'), true);\n  const provider = new QuickOpen.CommandMenu.CommandMenuProvider([command]);\n  return {setting, provider, command};\n}\n\nconst warning = () => ('Deprecation Warning' as Platform.UIString.LocalizedString);\n\nfunction setupElements() {\n  const toplevel = document.createElement('div');\n  const container = toplevel.createChild('div');\n  const title = container.createChild('div');\n  const subtitle = container.createChild('div');\n  return {toplevel, container, title, subtitle};\n}\n\ndescribeWithLocale('CommandMenu', () => {\n  let elements: {title: HTMLDivElement, subtitle: HTMLDivElement, toplevel: HTMLDivElement, container: HTMLDivElement};\n  beforeEach(() => {\n    elements = setupElements();\n  });\n\n  afterEach(() => {\n    const {toplevel, container, title, subtitle} = elements;\n    subtitle.remove();\n    title.remove();\n    container.remove();\n    toplevel.remove();\n  });\n\n  it('shows a deprecation warning for deprecated settings', () => {\n    const deprecation = {disabled: true, warning};\n    const {provider} = createCommandMenuProvider(deprecation);\n\n    provider.renderItem(0, 'Test', elements.title, elements.subtitle);\n\n    const tags = Array.from(elements.toplevel.querySelectorAll('.deprecated-tag')) as HTMLElement[];\n    assert.deepEqual(tags.map(e => e.textContent), ['â€” deprecated']);\n    assert.deepEqual(tags[0].title, 'Deprecation Warning');\n  });\n\n  it('reveals the setting when calling a deprecated setting', () => {\n    const deprecation = {disabled: true, warning};\n    const {setting, command} = createCommandMenuProvider(deprecation);\n    const reveal = sinon.stub(Common.Revealer.RevealerRegistry.prototype, 'reveal');\n\n    command.execute();\n\n    assert.isTrue(\n        reveal.calledOnceWithExactly(setting, false),\n        'Revealer was either not called or was called with unexpected arguments');\n  });\n});\n\ndescribe('CommandMenu', () => {\n  const settingName = 'mock-setting';\n  const settingTitle = 'Mock setting';\n  const enableTitle = 'Enable mock setting';\n  const disableTitle = 'Disable mock setting';\n  const settingCategory = Common.Settings.SettingCategory.CONSOLE;\n\n  before(async () => {\n    Common.Settings.registerSettingsForTest(\n        [{\n          category: settingCategory,\n          title: i18n.i18n.lockedLazyString(settingTitle),\n          settingType: Common.Settings.SettingType.BOOLEAN,\n          settingName,\n          defaultValue: false,\n          options: [\n            {\n              value: true,\n              title: i18n.i18n.lockedLazyString(enableTitle),\n            },\n            {\n              value: false,\n              title: i18n.i18n.lockedLazyString(disableTitle),\n            },\n          ],\n        }],\n        true);\n    await initializeGlobalVars({reset: false});\n  });\n\n  after(async () => {\n    await deinitializeGlobalVars();\n  });\n\n  it('adds commands for changing a setting\\'s value', async () => {\n    const settingCategory = Common.Settings.SettingCategory.CONSOLE;\n    Common.Settings.registerSettingsForTest(\n        [{\n          category: settingCategory,\n          title: i18n.i18n.lockedLazyString(settingTitle),\n          settingType: Common.Settings.SettingType.BOOLEAN,\n          settingName,\n          defaultValue: false,\n          options: [\n            {\n              value: true,\n              title: i18n.i18n.lockedLazyString(enableTitle),\n            },\n            {\n              value: false,\n              title: i18n.i18n.lockedLazyString(disableTitle),\n            },\n          ],\n        }],\n        true);\n\n    const allCommands = QuickOpen.CommandMenu.CommandMenu.instance({forceNew: true}).commands();\n    const disableSettingCommands = allCommands.filter(\n        command => command.title === disableTitle &&\n            command.category === Common.Settings.getLocalizedSettingsCategory(settingCategory));\n    const enableSettingCommands = allCommands.filter(\n        command => command.title === enableTitle &&\n            command.category === Common.Settings.getLocalizedSettingsCategory(settingCategory));\n    assert.lengthOf(disableSettingCommands, 1, 'Commands for changing a setting\\'s value were not added correctly');\n    assert.lengthOf(enableSettingCommands, 1, 'Commands for changing a setting\\'s value were not added correctly');\n  });\n});\n"]}