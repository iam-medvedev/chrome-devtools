{"version":3,"file":"FilteredListWidget.test.js","sourceRoot":"","sources":["../../../../../../../../front_end/ui/legacy/components/quick_open/FilteredListWidget.test.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright 2024 The Chromium Authors. All rights reserved.\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport * as Common from '../../../../core/common/common.js';\nimport * as i18n from '../../../../core/i18n/i18n.js';\nimport {createFakeSetting, describeWithLocale} from '../../../../testing/EnvironmentHelpers.js';\nimport {ListModel} from '../../legacy.js';\n\nimport * as QuickOpen from './quick_open.js';\n\nfunction createCommandMenuProvider(inputs: string[]) {\n  const setting = createFakeSetting<boolean>('test-setting', false);\n  setting.setRegistration({\n    settingName: 'test-setting',\n    settingType: Common.SettingRegistration.SettingType.BOOLEAN,\n    category: Common.SettingRegistration.SettingCategory.APPEARANCE,\n    defaultValue: false,\n  });\n  const provider = new QuickOpen.CommandMenu.CommandMenuProvider(\n      inputs.map(\n          input =>\n              QuickOpen.CommandMenu.CommandMenu.createSettingCommand(setting, i18n.i18n.lockedString(input), true)),\n  );\n  return provider;\n}\n\nasync function testMatch(inputs: string[], query: string, expectedSelection: number, expectedMatches: number[]) {\n  const provider = createCommandMenuProvider(inputs);\n  const selectItem = sinon.spy(provider, 'selectItem');\n  const listModelReplaceAll = sinon.spy(ListModel.ListModel.prototype, 'replaceAll');\n  const history: string[] = [];\n  const filteredListWidget = new QuickOpen.FilteredListWidget.FilteredListWidget(provider, history, () => undefined);\n  await filteredListWidget.setQuery(query);\n  // FilteredListWidget.scheduleFilter uses setTimeout.\n  await new Promise(resolve => window.setTimeout(resolve, 0));\n  const keyboardEvent = new KeyboardEvent('keydown', {key: 'Enter'});\n  filteredListWidget.contentElement.dispatchEvent(keyboardEvent);\n  assert.deepEqual([query], history);\n  assert.strictEqual(1, selectItem.callCount);\n  assert.strictEqual(expectedSelection, selectItem.lastCall.args[0]);\n  assert.deepEqual(expectedMatches, listModelReplaceAll.lastCall.args[0]);\n}\n\ndescribeWithLocale('FilteredListWidget', () => {\n  beforeEach(() => {\n    sinon.reset();\n  });\n\n  it('set query to select item and type Enter', async () => {\n    const provider = createCommandMenuProvider([\n      'first setting',\n      'second setting',\n      'third setting',\n    ]);\n    const selectItem = sinon.spy(provider, 'selectItem');\n    let callCount = 0;\n\n    async function testSetting(query: string, expectation: number) {\n      const filteredListWidget = new QuickOpen.FilteredListWidget.FilteredListWidget(provider, [], () => undefined);\n      await filteredListWidget.setQuery(query);\n      // FilteredListWidget.scheduleFilter uses setTimeout.\n      await new Promise(resolve => window.setTimeout(resolve, 0));\n      const keyboardEvent = new KeyboardEvent('keydown', {key: 'Enter'});\n      filteredListWidget.contentElement.dispatchEvent(keyboardEvent);\n      assert.strictEqual(++callCount, selectItem.callCount);\n      assert.strictEqual(expectation, selectItem.lastCall.args[0]);\n    }\n\n    await testSetting('third', 2);\n    await testSetting('second', 1);\n    await testSetting('first', 0);\n  });\n\n  it('type Enter when no item has been selected', () => {\n    const provider = createCommandMenuProvider([\n      'setting a',\n      'setting b',\n      'setting c',\n    ]);\n    const selectItem = sinon.spy(provider, 'selectItem');\n    const filteredListWidget = new QuickOpen.FilteredListWidget.FilteredListWidget(provider, [], () => undefined);\n    const keyboardEvent = new KeyboardEvent('keydown', {key: 'Enter'});\n    filteredListWidget.contentElement.dispatchEvent(keyboardEvent);\n    assert.isTrue(selectItem.notCalled);\n  });\n\n  it('empty query matches everything', async () => {\n    await testMatch(['a', 'bc'], '', 0, [0, 1]);\n  });\n\n  it('case-insensitive matching: upper case', async () => {\n    await testMatch(['abc', 'acB'], 'aB', 0, [0, 1]);\n  });\n\n  it('case-insensitive matching: lower case', async () => {\n    await testMatch(['abc', 'bac', 'a_B'], 'ab', 0, [0, 2]);\n  });\n\n  it('duplicate symbols in matching', async () => {\n    await testMatch(['abab', 'abaa', 'caab', 'baac', 'fooaab'], 'aab', 2, [2, 4, 0]);\n  });\n\n  it('ranking by score', async () => {\n    await testMatch(['fxxxoxxxo', 'barforo', 'foobar', 'fxoxoxo'], 'foo', 2, [2, 1, 0, 3]);\n  });\n\n  it('dangerous input escaping', async () => {\n    await testMatch(['^[]{}()\\\\.$*+?|', '0123456789abcdef'], '^[]{}()\\\\.$*+?|', 0, [0]);\n  });\n});\n"]}