{"version":3,"file":"CSSLength.js","sourceRoot":"","sources":["../../../../../../../../front_end/ui/legacy/components/inline_editor/CSSLength.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright (c) 2021 The Chromium Authors. All rights reserved.\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport * as Host from '../../../../core/host/host.js';\nimport * as UI from '../../../legacy/legacy.js';\nimport * as LitHtml from '../../../lit-html/lit-html.js';\n\nimport cssLengthStyles from './cssLength.css.js';\nimport {ValueChangedEvent} from './InlineEditorUtils.js';\n\nconst {render, html} = LitHtml;\n\nexport class DraggingFinishedEvent extends Event {\n  static readonly eventName = 'draggingfinished';\n  constructor() {\n    super(DraggingFinishedEvent.eventName, {});\n  }\n}\n\nexport enum CSSLengthUnit {\n  // absolute units\n  PIXEL = 'px',\n  CENTIMETER = 'cm',\n  MILLIMETER = 'mm',\n  QUARTERMILLIMETER = 'Q',\n  INCH = 'in',\n  PICA = 'pc',\n  POINT = 'pt',\n\n  // relative units\n  CAP = 'cap',\n  CH = 'ch',\n  EM = 'em',\n  EX = 'ex',\n  IC = 'ic',\n  LH = 'lh',\n  RCAP = 'rcap',\n  RCH = 'rch',\n  REM = 'rem',\n  REX = 'rex',\n  RIC = 'ric',\n  RLH = 'rlh',\n  VB = 'vb',\n  VH = 'vh',\n  VI = 'vi',\n  VW = 'vw',\n  VMIN = 'vmin',\n  VMAX = 'vmax',\n}\n\nexport const CSS_LENGTH_REGEX =\n    new RegExp(`(?<value>[+-]?\\\\d*\\\\.?\\\\d+([Ee][+-]?\\\\d+)?)(?<unit>${Object.values(CSSLengthUnit).join('|')})`);\n\ntype CSSLengthData = {\n  lengthText: string,\n};\n\nexport class CSSLength extends HTMLElement {\n  static readonly litTagName = LitHtml.literal`devtools-css-length`;\n\n  private readonly shadow = this.attachShadow({mode: 'open'});\n  private readonly onDraggingValue = this.dragValue.bind(this);\n  private value = '';\n  private unit = CSSLengthUnit.PIXEL;\n  private isEditingSlot = false;\n  private isDraggingValue = false;\n  #valueMousedownTime = 0;\n\n  set data({lengthText}: CSSLengthData) {\n    const groups = lengthText.match(CSS_LENGTH_REGEX)?.groups;\n    if (!groups) {\n      throw new Error();\n    }\n    this.value = groups.value;\n    this.unit = groups.unit as CSSLengthUnit;\n    this.render();\n  }\n\n  connectedCallback(): void {\n    this.shadow.adoptedStyleSheets = [cssLengthStyles];\n  }\n\n  private dragValue(event: MouseEvent): void {\n    event.preventDefault();\n    event.stopPropagation();\n    if (Date.now() - this.#valueMousedownTime <= 300) {\n      // Delay drag callback by 300ms to prioritize click over drag.\n      return;\n    }\n\n    this.isDraggingValue = true;\n    const newValue = UI.UIUtils.createReplacementString(this.value, event);\n    if (newValue) {\n      this.value = newValue;\n      this.dispatchEvent(new ValueChangedEvent(`${this.value}${this.unit}`));\n      Host.userMetrics.swatchActivated(Host.UserMetrics.SwatchType.Length);\n      this.render();\n    }\n  }\n\n  private onValueMousedown(event: MouseEvent): void {\n    if (event.button !== 0) {\n      return;\n    }\n\n    this.#valueMousedownTime = Date.now();\n\n    const targetDocument = event.target instanceof Node && event.target.ownerDocument;\n    if (targetDocument) {\n      targetDocument.addEventListener('mousemove', this.onDraggingValue, {capture: true});\n      targetDocument.addEventListener('mouseup', (event: MouseEvent) => {\n        targetDocument.removeEventListener('mousemove', this.onDraggingValue, {capture: true});\n\n        if (!this.isDraggingValue) {\n          return;\n        }\n\n        event.preventDefault();\n        event.stopPropagation();\n        this.isDraggingValue = false;\n        this.dispatchEvent(new DraggingFinishedEvent());\n      }, {once: true, capture: true});\n    }\n  }\n\n  private onValueMouseup(): void {\n    if (!this.isDraggingValue) {\n      this.isEditingSlot = true;\n      this.render();\n    }\n  }\n\n  private render(): void {\n    render(this.renderContent(), this.shadow, {\n      host: this,\n    });\n  }\n\n  private renderContent(): LitHtml.TemplateResult {\n    if (this.isEditingSlot) {\n      return html`<slot></slot>`;\n    }\n    // Disabled until https://crbug.com/1079231 is fixed.\n    // clang-format off\n      return html`\n        <span class=\"value\"\n          @mousedown=${this.onValueMousedown}\n          @mouseup=${this.onValueMouseup}\n        >${this.value}</span>${this.unit}\n      `;\n    // clang-format on\n  }\n}\n\ncustomElements.define('devtools-css-length', CSSLength);\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    'devtools-css-length': CSSLength;\n  }\n}\n"]}