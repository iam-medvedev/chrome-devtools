{"version":3,"file":"LinkSwatch.js","sourceRoot":"","sources":["../../../../../../../../front_end/ui/legacy/components/inline_editor/LinkSwatch.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright (c) 2020 The Chromium Authors. All rights reserved.\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport * as i18n from '../../../../core/i18n/i18n.js';\nimport * as LitHtml from '../../../lit-html/lit-html.js';\nimport * as VisualLogging from '../../../visual_logging/visual_logging.js';\nimport textButtonStyles from '../../textButton.css.legacy.js';\nimport * as ThemeSupport from '../../theme_support/theme_support.js';\n\nimport linkSwatchStyles from './linkSwatch.css.js';\n\nconst UIStrings = {\n  /**\n   *@description Text displayed in a tooltip shown when hovering over a var() CSS function in the Styles pane when the custom property in this function does not exist. The parameter is the name of the property.\n   *@example {--my-custom-property-name} PH1\n   */\n  sIsNotDefined: '{PH1} is not defined',\n};\nconst str_ = i18n.i18n.registerUIStrings('ui/legacy/components/inline_editor/LinkSwatch.ts', UIStrings);\nconst i18nString = i18n.i18n.getLocalizedString.bind(undefined, str_);\nconst {render, html, Directives: {ifDefined, classMap}} = LitHtml;\n\ninterface BaseLinkSwatchRenderData {\n  text: string;\n  title: string;\n  showTitle: boolean;\n  isDefined: boolean;\n  onLinkActivate: (linkText: string) => void;\n}\n\nclass BaseLinkSwatch extends HTMLElement {\n  protected readonly shadow = this.attachShadow({mode: 'open'});\n  protected onLinkActivate: (linkText: string, event: MouseEvent|KeyboardEvent) => void = () => undefined;\n  #linkElement: HTMLSpanElement|undefined;\n\n  connectedCallback(): void {\n    this.shadow.adoptedStyleSheets = [linkSwatchStyles];\n    ThemeSupport.ThemeSupport.instance().appendStyle(this.shadow, textButtonStyles);\n  }\n\n  set data(data: BaseLinkSwatchRenderData) {\n    this.onLinkActivate = (linkText: string, event: MouseEvent|KeyboardEvent) => {\n      if (event instanceof MouseEvent && event.button !== 0) {\n        return;\n      }\n\n      data.onLinkActivate(linkText);\n      event.consume(true);\n    };\n    data.showTitle = data.showTitle === undefined ? true : data.showTitle;\n    this.render(data);\n  }\n\n  get linkElement(): HTMLElement|undefined {\n    return this.#linkElement;\n  }\n\n  private render(data: BaseLinkSwatchRenderData): void {\n    const {isDefined, text, title} = data;\n    const classes = classMap({\n      'link-style': true,\n      'text-button': true,\n      'link-swatch-link': true,\n      undefined: !isDefined,\n    });\n    // The linkText's space must be removed, otherwise it cannot be triggered when clicked.\n    const onActivate = isDefined ? this.onLinkActivate.bind(this, text.trim()) : null;\n\n    // We added var popover, so don't need the title attribute when no need for showing title and\n    // only provide the data-title for the popover to get the data.\n    const {startNode} = render(\n        html`<button .disabled=${!isDefined} class=${classes}\n                     title=${ifDefined(data.showTitle ? title : undefined)}\n                     data-title=${ifDefined(!data.showTitle ? title : undefined)}\n                     @click=${onActivate} role=\"link\" tabindex=\"-1\">${text}</button>`,\n        this.shadow, {host: this});\n    if (startNode?.nextSibling instanceof HTMLButtonElement) {\n      this.#linkElement = startNode?.nextSibling;\n    }\n  }\n}\n\ninterface CSSVarSwatchRenderData {\n  variableName: string;\n  computedValue: string|null;\n  fromFallback: boolean;\n  fallbackText: string|null;\n  onLinkActivate: (linkText: string) => void;\n}\n\nexport class CSSVarSwatch extends HTMLElement {\n  protected readonly shadow = this.attachShadow({mode: 'open'});\n  #link: BaseLinkSwatch|undefined;\n\n  constructor() {\n    super();\n\n    this.tabIndex = -1;\n\n    this.addEventListener('focus', () => {\n      const link = this.shadow.querySelector<HTMLElement>('[role=\"link\"]');\n\n      if (link) {\n        link.focus();\n      }\n    });\n  }\n\n  set data(data: CSSVarSwatchRenderData) {\n    this.render(data);\n  }\n\n  get link(): BaseLinkSwatch|undefined {\n    return this.#link;\n  }\n\n  protected render(data: CSSVarSwatchRenderData): void {\n    const {variableName, fromFallback, computedValue, onLinkActivate} = data;\n\n    const isDefined = computedValue !== null && !fromFallback;\n    const title = isDefined ? computedValue ?? '' : i18nString(UIStrings.sIsNotDefined, {PH1: variableName});\n\n    this.#link = new BaseLinkSwatch();\n    this.#link.data = {\n      title,\n      showTitle: false,\n      text: variableName,\n      isDefined,\n      onLinkActivate,\n    };\n    this.#link.classList.add('css-var-link');\n    // clang-format off\n    render(\n        html`<span data-title=${data.computedValue || ''}\n          jslog=${VisualLogging.link('css-variable').track({click: true, hover: true})}\n        >var(${this.#link}<slot name=\"fallback\">${data.fallbackText ? `, ${data.fallbackText}` : ''}</slot>)</span>`,\n        this.shadow, {host: this});\n    // clang-format on\n  }\n}\n\nexport interface LinkSwatchRenderData {\n  isDefined: boolean;\n  text: string;\n  onLinkActivate: (linkText: string) => void;\n  jslogContext: string;\n}\n\nexport class LinkSwatch extends HTMLElement {\n  protected readonly shadow = this.attachShadow({mode: 'open'});\n\n  set data(data: LinkSwatchRenderData) {\n    this.render(data);\n  }\n\n  protected render(data: LinkSwatchRenderData): void {\n    const {text, isDefined, onLinkActivate, jslogContext} = data;\n    const title = isDefined ? text : i18nString(UIStrings.sIsNotDefined, {PH1: text});\n    render(\n        html`<span title=${data.text} jslog=${\n            VisualLogging.link().track({click: true}).context(jslogContext)}><devtools-base-link-swatch .data=${{\n          text,\n          isDefined,\n          title,\n          onLinkActivate,\n        } as BaseLinkSwatchRenderData}></devtools-base-link-swatch></span>`,\n        this.shadow, {host: this});\n  }\n}\n\ncustomElements.define('devtools-base-link-swatch', BaseLinkSwatch);\ncustomElements.define('devtools-link-swatch', LinkSwatch);\ncustomElements.define('devtools-css-var-swatch', CSSVarSwatch);\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    'devtools-base-link-swatch': BaseLinkSwatch;\n    'devtools-link-swatch': LinkSwatch;\n    'devtools-css-var-swatch': CSSVarSwatch;\n  }\n}\n"]}