{"version":3,"file":"ObjectPropertiesSection.test.js","sourceRoot":"","sources":["../../../../../../../../front_end/ui/legacy/components/object_ui/ObjectPropertiesSection.test.ts"],"names":[],"mappings":"AAAA,sCAAsC;AACtC,yEAAyE;AACzE,6BAA6B;AAE7B,OAAO,KAAK,MAAM,MAAM,mCAAmC,CAAC;AAC5D,OAAO,KAAK,IAAI,MAAM,+BAA+B,CAAC;AACtD,OAAO,KAAK,GAAG,MAAM,6BAA6B,CAAC;AACnD,OAAO,EAAC,gBAAgB,EAAE,kBAAkB,EAAE,oBAAoB,EAAC,MAAM,mCAAmC,CAAC;AAC7G,OAAO,EAAC,uBAAuB,EAAC,MAAM,2CAA2C,CAAC;AAClF,OAAO,EAAC,UAAU,EAAC,MAAM,uCAAuC,CAAC;AAEjE,OAAO,KAAK,QAAQ,MAAM,gBAAgB,CAAC;AAE3C,QAAQ,CAAC,yBAAyB,EAAE,GAAG,EAAE;IACvC,uBAAuB,CAAC,yBAAyB,EAAE,GAAG,EAAE;QACtD,QAAQ,CAAC,kBAAkB,EAAE,GAAG,EAAE;YAChC,EAAE,CAAC,oDAAoD,EAAE,GAAG,EAAE;gBAC5D,MAAM,MAAM,GAAG,KAAK,CAAC,kBAAkB,CAAC,GAAG,CAAC,YAAY,CAAC,YAAY,CAAC,CAAC;gBACvE,MAAM,CAAC,yBAAyB,CAAC,OAAO,CAAC,IAAI,CAAC,CAAC;gBAE/C,MAAM,GAAG,GAAG,QAAQ,CAAC,aAAa,CAAC,KAAK,CAAC,CAAC;gBAC1C,MAAM,CAAC,OAAO,CAAC,GAAG,CAAC,aAAa,EAAE,CAAC,CAAC;gBACpC,QAAQ,CAAC,uBAAuB,CAAC,uBAAuB,CAAC,gBAAgB,CAAC,GAAG,EAAE,MAAM,CAAC,CAAC;gBACvF,MAAM,CAAC,MAAM,CAAC,GAAG,CAAC,aAAa,EAAE,CAAC,CAAC;gBACnC,MAAM,IAAI,GAAG,GAAG,CAAC,aAAa,CAAC,eAAe,CAAC,CAAC;gBAChD,MAAM,CAAC,SAAS,CAAC,IAAI,CAAC,CAAC;YACzB,CAAC,CAAC,CAAC;YAEH,EAAE,CAAC,gEAAgE,EAAE,GAAG,EAAE;gBACxE,MAAM,MAAM,GAAG,KAAK,CAAC,kBAAkB,CAAC,GAAG,CAAC,YAAY,CAAC,YAAY,CAAC,CAAC;gBACvE,MAAM,CAAC,yBAAyB,CAAC,OAAO,CAAC,KAAK,CAAC,CAAC;gBAEhD,MAAM,GAAG,GAAG,QAAQ,CAAC,aAAa,CAAC,KAAK,CAAC,CAAC;gBAC1C,MAAM,CAAC,OAAO,CAAC,GAAG,CAAC,aAAa,EAAE,CAAC,CAAC;gBACpC,QAAQ,CAAC,uBAAuB,CAAC,uBAAuB,CAAC,gBAAgB,CAAC,GAAG,EAAE,MAAM,CAAC,CAAC;gBACvF,MAAM,CAAC,WAAW,CAAC,GAAG,CAAC,iBAAiB,EAAE,CAAC,CAAC,CAAC;YAC/C,CAAC,CAAC,CAAC;YAEH,EAAE,CAAC,8CAA8C,EAAE,GAAG,EAAE;gBACtD,MAAM,MAAM,GAAG,KAAK,CAAC,kBAAkB,CAAC,GAAG,CAAC,YAAY,CAAC,YAAY,CAAC,CAAC;gBACvE,MAAM,CAAC,yBAAyB,CAAC,OAAO,CAAC,IAAI,CAAC,CAAC;gBAC/C,MAAM,UAAU,GAAG,KAAK,CAAC;gBAEzB,MAAM,GAAG,GAAG,QAAQ,CAAC,aAAa,CAAC,KAAK,CAAC,CAAC;gBAC1C,QAAQ,CAAC,uBAAuB,CAAC,uBAAuB,CAAC,gBAAgB,CAAC,GAAG,EAAE,MAAM,EAAE,UAAU,CAAC,CAAC;gBACnG,MAAM,IAAI,GAAG,GAAG,CAAC,aAAa,CAAC,eAAe,CAAC,CAAC;gBAChD,MAAM,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC;gBACpB,MAAM,MAAM,GAAG,KAAK,CAAC,IAAI,CAAC,MAAM,CAAC,QAAQ,CAAC,gBAAgB,CAAC,SAAS,EAAE,QAAQ,CAAC,CAAC;gBAEhF,kBAAkB,CAAC,IAAI,CAAC,CAAC;gBAEzB,KAAK,CAAC,MAAM,CAAC,mBAAmB,CAAC,MAAM,EAAE,KAAK,CAAC,KAAK,CAAC,EAAC,MAAM,EAAE,UAAU,EAAC,CAAC,EAAE,KAAK,CAAC,CAAC;YACrF,CAAC,CAAC,CAAC;QACL,CAAC,CAAC,CAAC;IACL,CAAC,CAAC,CAAC;AACL,CAAC,CAAC,CAAC;AAEH,uBAAuB,CAAC,2BAA2B,EAAE,GAAG,EAAE;IACxD,EAAE,CAAC,iBAAiB,EAAE,KAAK,IAAI,EAAE;QAC/B,MAAM,QAAQ,GAAG,IAAI,GAAG,CAAC,YAAY,CAAC,oBAAoB,CACtD,MAAM,EAAE,GAAG,CAAC,YAAY,CAAC,YAAY,CAAC,eAAe,CAAC,EAAE,CAAC,EAAE,IAAI,EAAE,IAAI,CAAC,CAAC;QAC3E,MAAM,SAAS,GAAG,QAAQ,CAAC,aAAa,CAAC,KAAK,CAAC,CAAC;QAChD,MAAM,KAAK,GAAG;YACZ,YAAY,EAAE,KAAK,CAAC,IAAI,EAAE;YAC1B,YAAY,EAAE,KAAK,CAAC,IAAI,EAAE;YAC1B,cAAc,EAAE,KAAK,CAAC,IAAI,EAAE;YAC5B,SAAS,EAAE,SAAS;YACpB,WAAW,EAAE,EAAE;YACf,QAAQ,EAAE,KAAK;YACf,OAAO,EAAE,KAAK;YACd,YAAY,EAAE,KAAK,CAAC,IAAI,EAAE;YAC1B,gBAAgB,EAAE,KAAK,CAAC,IAAI,EAAE;YAC9B,IAAI,EAAE,IAAI,QAAQ,CAAC,uBAAuB,CAAC,cAAc,CAAC,QAAQ,CAAC;SACpE,CAAC;QACF,MAAM,MAAM,GAAG,EAAC,YAAY,EAAE,SAAS,EAAE,WAAW,EAAE,SAAS,EAAC,CAAC;QACjE,QAAQ,CAAC,uBAAuB,CAAC,yBAAyB,CAAC,KAAK,EAAE,MAAM,EAAE,SAAS,CAAC,CAAC;QAErF,KAAK,CAAC,MAAM,CAAC,SAAS,CAAC,KAAK,CAAC,YAAY,CAAC,CAAC;QAC3C,MAAM,KAAK,GAAG,IAAI,UAAU,CAAC,UAAU,EAAE,EAAC,OAAO,EAAE,IAAI,EAAE,UAAU,EAAE,IAAI,EAAC,CAAC,CAAC;QAC5E,MAAM,YAAY,GAAG,SAAS,CAAC,aAAa,CAAC,QAAQ,CAAC,CAAC;QACvD,MAAM,CAAC,MAAM,CAAC,YAAY,CAAC,CAAC;QAC5B,MAAM,CAAC,WAAW,CAAC,YAAY,EAAE,MAAM,CAAC,YAAY,CAAC,CAAC;QACtD,YAAY,CAAC,aAAa,CAAC,KAAK,CAAC,CAAC;QAClC,KAAK,CAAC,MAAM,CAAC,UAAU,CAAC,KAAK,CAAC,YAAY,CAAC,CAAC;QAE5C,MAAM,YAAY,GAAG,KAAK,CAAC,IAAI,EAAgF,CAAC;QAChH,MAAM,OAAO,GAAG,IAAI,QAAQ,CAAC,uBAAuB,CAAC,yBAAyB,CAC1E,IAAI,QAAQ,CAAC,uBAAuB,CAAC,cAAc,CAAC,QAAQ,CAAC,EAAE,SAAS,EAAE,YAAY,CAAC,CAAC;QAC5F,OAAO,CAAC,WAAW,GAAG,IAAI,QAAQ,CAAC,uBAAuB,CAAC,mCAAmC,EAAE,CAAC;QAEjG,oBAAoB,CAAC,OAAO,CAAC,eAAe,CAAC,CAAC;QAC9C,MAAM,iBAAiB,GAAG,UAAU,CAAC,YAAY,CAAC,CAAC;QACnD,OAAO,CAAC,aAAa,EAAE,CAAC;QACxB,MAAM,CAAC,UAAU,CAAC,GAAG,MAAM,iBAAiB,CAAC;QAC7C,MAAM,CAAC,OAAO,CAAC,UAAU,CAAC,OAAO,CAAC,CAAC;QAEnC,MAAM,kBAAkB,GAAG,UAAU,CAAC,YAAY,CAAC,CAAC;QACpD,UAAU,CAAC,YAAY,EAAE,CAAC;QAC1B,MAAM,CAAC,WAAW,CAAC,GAAG,MAAM,kBAAkB,CAAC;QAC/C,MAAM,CAAC,MAAM,CAAC,WAAW,CAAC,OAAO,CAAC,CAAC;IACrC,CAAC,CAAC,CAAC;IAEH,EAAE,CAAC,oDAAoD,EAAE,KAAK,IAAI,EAAE;QAClE,MAAM,UAAU,GAAG,IAAI,GAAG,CAAC,MAAM,CAAC,KAAK,CAAC,IAAI,CAAC;QAC7C,MAAM,KAAK,GAAG,QAAQ,CAAC,uBAAuB,CAAC,uBAAuB,CAAC,mBAAmB,CACtF,GAAG,CAAC,YAAY,CAAC,YAAY,CAAC,eAAe,CAAC,UAAU,CAAC,EAAE,KAAK,EAAE,IAAI,CAAC,CAAC;QAE5E,oBAAoB,CAAC,KAAK,EAAE,EAAC,mBAAmB,EAAE,IAAI,EAAC,CAAC,CAAC;QAEzD,MAAM,gBAAgB,CAAC,kCAAkC,CAAC,CAAC;QAE3D,MAAM,QAAQ,GAAG,KAAK,CAAC,IAAI,CAAC,IAAI,CAAC,qBAAqB,CAAC,6BAA6B,EAAE,UAAU,CAAC,CAAC;QAClG,MAAM,UAAU,GAAG,KAAK,CAAC,aAAa,CAAoB,oBAAoB,CAAC,CAAC;QAChF,MAAM,CAAC,MAAM,CAAC,UAAU,CAAC,CAAC;QAC1B,MAAM,YAAY,GAAG,KAAK,CAAC,aAAa,CAAoB,sCAAsC,CAAC,CAAC;QACpG,MAAM,CAAC,MAAM,CAAC,YAAY,CAAC,CAAC;QAE5B,KAAK,CAAC,MAAM,CAAC,SAAS,CAAC,QAAQ,CAAC,CAAC;QACjC,UAAU,CAAC,KAAK,EAAE,CAAC;QACnB,KAAK,CAAC,MAAM,CAAC,qBAAqB,CAAC,QAAQ,EAAE,IAAI,UAAU,GAAG,CAAC,CAAC;QAEhE,MAAM,CAAC,cAAc,CAAC,KAAK,CAAC,WAAW,EAAE,IAAI,UAAU,GAAG,CAAC,CAAC;QAC5D,YAAY,CAAC,KAAK,EAAE,CAAC;QACrB,MAAM,CAAC,WAAW,CAAC,KAAK,CAAC,WAAW,EAAE,IAAI,UAAU,GAAG,CAAC,CAAC;IAC3D,CAAC,CAAC,CAAC;AACL,CAAC,CAAC,CAAC","sourcesContent":["// Copyright 2022 The Chromium Authors\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport * as Common from '../../../../core/common/common.js';\nimport * as Host from '../../../../core/host/host.js';\nimport * as SDK from '../../../../core/sdk/sdk.js';\nimport {assertScreenshot, dispatchClickEvent, renderElementIntoDOM} from '../../../../testing/DOMHelpers.js';\nimport {describeWithEnvironment} from '../../../../testing/EnvironmentHelpers.js';\nimport {expectCall} from '../../../../testing/ExpectStubCall.js';\n\nimport * as ObjectUI from './object_ui.js';\n\ndescribe('ObjectPropertiesSection', () => {\n  describeWithEnvironment('ObjectPropertiesSection', () => {\n    describe('appendMemoryIcon', () => {\n      it('appends a memory icon for inspectable object types', () => {\n        const object = sinon.createStubInstance(SDK.RemoteObject.RemoteObject);\n        object.isLinearMemoryInspectable.returns(true);\n\n        const div = document.createElement('div');\n        assert.isFalse(div.hasChildNodes());\n        ObjectUI.ObjectPropertiesSection.ObjectPropertiesSection.appendMemoryIcon(div, object);\n        assert.isTrue(div.hasChildNodes());\n        const icon = div.querySelector('devtools-icon');\n        assert.isNotNull(icon);\n      });\n\n      it('doesn\\'t append a memory icon for non-inspectable object types', () => {\n        const object = sinon.createStubInstance(SDK.RemoteObject.RemoteObject);\n        object.isLinearMemoryInspectable.returns(false);\n\n        const div = document.createElement('div');\n        assert.isFalse(div.hasChildNodes());\n        ObjectUI.ObjectPropertiesSection.ObjectPropertiesSection.appendMemoryIcon(div, object);\n        assert.strictEqual(div.childElementCount, 0);\n      });\n\n      it('triggers the correct revealer upon \\'click\\'', () => {\n        const object = sinon.createStubInstance(SDK.RemoteObject.RemoteObject);\n        object.isLinearMemoryInspectable.returns(true);\n        const expression = 'foo';\n\n        const div = document.createElement('div');\n        ObjectUI.ObjectPropertiesSection.ObjectPropertiesSection.appendMemoryIcon(div, object, expression);\n        const icon = div.querySelector('devtools-icon');\n        assert.exists(icon);\n        const reveal = sinon.stub(Common.Revealer.RevealerRegistry.prototype, 'reveal');\n\n        dispatchClickEvent(icon);\n\n        sinon.assert.calledOnceWithMatch(reveal, sinon.match({object, expression}), false);\n      });\n    });\n  });\n});\n\ndescribeWithEnvironment('ObjectPropertyTreeElement', () => {\n  it('can edit values', async () => {\n    const property = new SDK.RemoteObject.RemoteObjectProperty(\n        'name', SDK.RemoteObject.RemoteObject.fromLocalObject(42), true, true);\n    const container = document.createElement('div');\n    const input = {\n      startEditing: sinon.stub(),\n      invokeGetter: sinon.stub(),\n      onAutoComplete: sinon.stub(),\n      linkifier: undefined,\n      completions: [],\n      expanded: false,\n      editing: false,\n      editingEnded: sinon.stub(),\n      editingCommitted: sinon.stub(),\n      node: new ObjectUI.ObjectPropertiesSection.ObjectTreeNode(property),\n    };\n    const output = {valueElement: undefined, nameElement: undefined};\n    ObjectUI.ObjectPropertiesSection.TREE_ELEMENT_DEFAULT_VIEW(input, output, container);\n\n    sinon.assert.notCalled(input.startEditing);\n    const event = new MouseEvent('dblclick', {bubbles: true, cancelable: true});\n    const valueElement = container.querySelector('.value');\n    assert.exists(valueElement);\n    assert.strictEqual(valueElement, output.valueElement);\n    valueElement.dispatchEvent(event);\n    sinon.assert.calledOnce(input.startEditing);\n\n    const viewFunction = sinon.stub<[ObjectUI.ObjectPropertiesSection.TreeElementViewInput, object, HTMLElement]>();\n    const section = new ObjectUI.ObjectPropertiesSection.ObjectPropertyTreeElement(\n        new ObjectUI.ObjectPropertiesSection.ObjectTreeNode(property), undefined, viewFunction);\n    section.treeOutline = new ObjectUI.ObjectPropertiesSection.ObjectPropertiesSectionsTreeOutline();\n\n    renderElementIntoDOM(section.listItemElement);\n    const firstExpectedCall = expectCall(viewFunction);\n    section.performUpdate();\n    const [firstInput] = await firstExpectedCall;\n    assert.isFalse(firstInput.editing);\n\n    const secondExpectedCall = expectCall(viewFunction);\n    firstInput.startEditing();\n    const [secondInput] = await secondExpectedCall;\n    assert.isTrue(secondInput.editing);\n  });\n\n  it('shows expandable text contents for lengthy strings', async () => {\n    const longString = `l${'o'.repeat(15000)}ng`;\n    const value = ObjectUI.ObjectPropertiesSection.ObjectPropertiesSection.createPropertyValue(\n        SDK.RemoteObject.RemoteObject.fromLocalObject(longString), false, true);\n\n    renderElementIntoDOM(value, {includeCommonStyles: true});\n\n    await assertScreenshot('object_ui/expandable_strings.png');\n\n    const copyStub = sinon.stub(Host.InspectorFrontendHost.InspectorFrontendHostInstance, 'copyText');\n    const copyButton = value.querySelector<HTMLButtonElement>('[data-text=\"Copy\"]');\n    assert.exists(copyButton);\n    const expandButton = value.querySelector<HTMLButtonElement>('[data-text=\"Show more (15.0\\xA0kB)\"]');\n    assert.exists(expandButton);\n\n    sinon.assert.notCalled(copyStub);\n    copyButton.click();\n    sinon.assert.calledOnceWithExactly(copyStub, `\"${longString}\"`);\n\n    assert.notStrictEqual(value.textContent, `\"${longString}\"`);\n    expandButton.click();\n    assert.strictEqual(value.textContent, `\"${longString}\"`);\n  });\n});\n"]}