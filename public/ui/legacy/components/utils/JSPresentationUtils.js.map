{"version":3,"file":"JSPresentationUtils.js","sourceRoot":"","sources":["../../../../../../../../front_end/ui/legacy/components/utils/JSPresentationUtils.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright 2021 The Chromium Authors. All rights reserved.\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\n/*\n * Copyright (C) 2011 Google Inc.  All rights reserved.\n * Copyright (C) 2007, 2008 Apple Inc.  All rights reserved.\n * Copyright (C) 2008 Matt Lilek <webkit@mattlilek.com>\n * Copyright (C) 2009 Joseph Pecoraro\n *\n * Redistribution and use in source and binary forms, with or without\n * modification, are permitted provided that the following conditions\n * are met:\n *\n * 1.  Redistributions of source code must retain the above copyright\n *     notice, this list of conditions and the following disclaimer.\n * 2.  Redistributions in binary form must reproduce the above copyright\n *     notice, this list of conditions and the following disclaimer in the\n *     documentation and/or other materials provided with the distribution.\n * 3.  Neither the name of Apple Computer, Inc. (\"Apple\") nor the names of\n *     its contributors may be used to endorse or promote products derived\n *     from this software without specific prior written permission.\n *\n * THIS SOFTWARE IS PROVIDED BY APPLE AND ITS CONTRIBUTORS \"AS IS\" AND ANY\n * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\n * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\n * DISCLAIMED. IN NO EVENT SHALL APPLE OR ITS CONTRIBUTORS BE LIABLE FOR ANY\n * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES\n * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;\n * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND\n * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\n * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF\n * THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n */\n\nimport * as Common from '../../../../core/common/common.js';\nimport * as i18n from '../../../../core/i18n/i18n.js';\nimport * as SDK from '../../../../core/sdk/sdk.js';\nimport type * as Protocol from '../../../../generated/protocol.js';\nimport * as Bindings from '../../../../models/bindings/bindings.js';\nimport * as VisualLogging from '../../../visual_logging/visual_logging.js';\nimport * as UI from '../../legacy.js';\n\nimport jsUtilsStyles from './jsUtils.css.js';\nimport {Events as LinkifierEvents, Linkifier} from './Linkifier.js';\n\nconst UIStrings = {\n  /**\n   *@description Text to stop preventing the debugger from stepping into library code\n   */\n  removeFromIgnore: 'Remove from ignore list',\n  /**\n   *@description Text for scripts that should not be stepped into when debugging\n   */\n  addToIgnore: 'Add script to ignore list',\n  /**\n   * @description A link to show more frames when they are available.\n   */\n  showMoreFrames: 'Show ignore-listed frames',\n  /**\n   * @description A link to rehide frames that are by default hidden.\n   */\n  showLess: 'Show less',\n  /**\n   *@description Text indicating that source url of a link is currently unknown\n   */\n  unknownSource: 'unknown',\n};\nconst str_ = i18n.i18n.registerUIStrings('ui/legacy/components/utils/JSPresentationUtils.ts', UIStrings);\nconst i18nString = i18n.i18n.getLocalizedString.bind(undefined, str_);\n\nfunction populateContextMenu(link: Element, event: Event): void {\n  const contextMenu = new UI.ContextMenu.ContextMenu(event);\n  event.consume(true);\n  const uiLocation = Linkifier.uiLocation(link);\n  if (uiLocation &&\n      Bindings.IgnoreListManager.IgnoreListManager.instance().canIgnoreListUISourceCode(uiLocation.uiSourceCode)) {\n    if (Bindings.IgnoreListManager.IgnoreListManager.instance().isUserIgnoreListedURL(uiLocation.uiSourceCode.url())) {\n      contextMenu.debugSection().appendItem(\n          i18nString(UIStrings.removeFromIgnore),\n          () =>\n              Bindings.IgnoreListManager.IgnoreListManager.instance().unIgnoreListUISourceCode(uiLocation.uiSourceCode),\n          {jslogContext: 'remove-from-ignore-list'});\n    } else {\n      contextMenu.debugSection().appendItem(\n          i18nString(UIStrings.addToIgnore),\n          () => Bindings.IgnoreListManager.IgnoreListManager.instance().ignoreListUISourceCode(uiLocation.uiSourceCode),\n          {jslogContext: 'add-to-ignore-list'});\n    }\n  }\n  contextMenu.appendApplicableItems(event);\n  void contextMenu.show();\n}\n\nexport function buildStackTraceRows(\n    stackTrace: Protocol.Runtime.StackTrace,\n    target: SDK.Target.Target|null,\n    linkifier: Linkifier,\n    tabStops: boolean|undefined,\n    updateCallback?: (arg0: Array<StackTraceRegularRow|StackTraceAsyncRow>) => void,\n    showColumnNumber?: boolean,\n    ): Array<StackTraceRegularRow|StackTraceAsyncRow> {\n  const stackTraceRows: Array<StackTraceRegularRow|StackTraceAsyncRow> = [];\n\n  if (updateCallback) {\n    const throttler = new Common.Throttler.Throttler(100);\n    linkifier.addEventListener(LinkifierEvents.LIVE_LOCATION_UPDATED, () => {\n      void throttler.schedule(async () => updateCallback(stackTraceRows));\n    });\n  }\n\n  function buildStackTraceRowsHelper(\n      stackTrace: Protocol.Runtime.StackTrace,\n      previousCallFrames: Protocol.Runtime.CallFrame[]|undefined = undefined): void {\n    let asyncRow: StackTraceAsyncRow|null = null;\n    if (previousCallFrames) {\n      asyncRow = {\n        asyncDescription: UI.UIUtils.asyncStackTraceLabel(stackTrace.description, previousCallFrames),\n      };\n      stackTraceRows.push(asyncRow);\n    }\n    let previousStackFrameWasBreakpointCondition = false;\n    for (const stackFrame of stackTrace.callFrames) {\n      const functionName = UI.UIUtils.beautifyFunctionName(stackFrame.functionName);\n      const link = linkifier.maybeLinkifyConsoleCallFrame(target, stackFrame, {\n        showColumnNumber,\n        tabStop: Boolean(tabStops),\n        inlineFrameIndex: 0,\n        revealBreakpoint: previousStackFrameWasBreakpointCondition,\n      });\n      if (link) {\n        link.setAttribute('jslog', `${VisualLogging.link('stack-trace').track({click: true})}`);\n        link.addEventListener('contextmenu', populateContextMenu.bind(null, link));\n\n        if (!link.textContent) {\n          link.textContent = i18nString(UIStrings.unknownSource);\n        }\n      }\n      stackTraceRows.push({functionName, link});\n      previousStackFrameWasBreakpointCondition = [\n        SDK.DebuggerModel.COND_BREAKPOINT_SOURCE_URL,\n        SDK.DebuggerModel.LOGPOINT_SOURCE_URL,\n      ].includes(stackFrame.url);\n    }\n  }\n\n  buildStackTraceRowsHelper(stackTrace);\n  let previousCallFrames = stackTrace.callFrames;\n  for (let asyncStackTrace = stackTrace.parent; asyncStackTrace; asyncStackTrace = asyncStackTrace.parent) {\n    if (asyncStackTrace.callFrames.length) {\n      buildStackTraceRowsHelper(asyncStackTrace, previousCallFrames);\n    }\n    previousCallFrames = asyncStackTrace.callFrames;\n  }\n  return stackTraceRows;\n}\n\nexport function buildStackTracePreviewContents(\n    target: SDK.Target.Target|null, linkifier: Linkifier, options: Options = {\n      widthConstrained: false,\n      stackTrace: undefined,\n      tabStops: undefined,\n    }): {element: HTMLElement, links: HTMLElement[]} {\n  const {stackTrace, tabStops} = options;\n  const element = document.createElement('span');\n  element.classList.add('monospace');\n  element.classList.add('stack-preview-container');\n  element.classList.toggle('width-constrained', options.widthConstrained);\n  element.style.display = 'inline-block';\n  const shadowRoot = UI.UIUtils.createShadowRootWithCoreStyles(element, {cssFile: jsUtilsStyles});\n  const contentElement = shadowRoot.createChild('table', 'stack-preview-container');\n  contentElement.classList.toggle('width-constrained', options.widthConstrained);\n\n  const updateCallback = renderStackTraceTable.bind(null, contentElement, element);\n  const stackTraceRows = buildStackTraceRows(\n      stackTrace ?? {callFrames: []}, target, linkifier, tabStops, updateCallback, options.showColumnNumber);\n  const links = renderStackTraceTable(contentElement, element, stackTraceRows);\n  return {element, links};\n}\n\nfunction renderStackTraceTable(\n    container: Element, parent: Element,\n    stackTraceRows: Array<StackTraceRegularRow|StackTraceAsyncRow>): HTMLElement[] {\n  container.removeChildren();\n  const links: HTMLElement[] = [];\n\n  // The tableSection groups one or more synchronous call frames together.\n  // Wherever there is an asynchronous call, a new section is created.\n  let tableSection: Element|null = null;\n  for (const item of stackTraceRows) {\n    if (!tableSection || 'asyncDescription' in item) {\n      tableSection = container.createChild('tbody');\n    }\n\n    const row = tableSection.createChild('tr');\n    if ('asyncDescription' in item) {\n      row.createChild('td').textContent = '\\n';\n      row.createChild('td', 'stack-preview-async-description').textContent = item.asyncDescription;\n      row.createChild('td');\n      row.createChild('td');\n      row.classList.add('stack-preview-async-row');\n    } else {\n      row.createChild('td').textContent = '\\n';\n      row.createChild('td', 'function-name').textContent = item.functionName;\n      row.createChild('td').textContent = ' @ ';\n      if (item.link) {\n        row.createChild('td', 'link').appendChild(item.link);\n        links.push(item.link);\n      }\n    }\n  }\n\n  tableSection = container.createChild('tfoot');\n  const showAllRow = tableSection.createChild('tr', 'show-all-link');\n  showAllRow.createChild('td');\n  const cell = showAllRow.createChild('td');\n  cell.colSpan = 4;\n  const showAllLink = cell.createChild('span', 'link');\n  // Don't directly put the text of the link in the DOM, as it will likely be\n  // invisible and it may be confusing if it is copied to the clipboard.\n  showAllLink.createChild('span', 'css-inserted-text')\n      .setAttribute('data-inserted-text', i18nString(UIStrings.showMoreFrames));\n  showAllLink.addEventListener('click', () => {\n    container.classList.add('show-hidden-rows');\n    parent.classList.add('show-hidden-rows');\n    // If we are in a popup, this will trigger a re-layout\n    UI.GlassPane.GlassPane.containerMoved(container);\n  }, false);\n  const showLessRow = tableSection.createChild('tr', 'show-less-link');\n  showLessRow.createChild('td');\n  const showLesscell = showLessRow.createChild('td');\n  showLesscell.colSpan = 4;\n  const showLessLink = showLesscell.createChild('span', 'link');\n  showLessLink.createChild('span', 'css-inserted-text')\n      .setAttribute('data-inserted-text', i18nString(UIStrings.showLess));\n  showLessLink.addEventListener('click', () => {\n    container.classList.remove('show-hidden-rows');\n    parent.classList.remove('show-hidden-rows');\n    // If we are in a popup, this will trigger a re-layout\n    UI.GlassPane.GlassPane.containerMoved(container);\n  }, false);\n\n  return links;\n}\n\nexport interface Options {\n  stackTrace: Protocol.Runtime.StackTrace|undefined;\n  tabStops: boolean|undefined;\n  // Whether the width of stack trace preview\n  // is constrained to its container or whether\n  // it can grow the container.\n  widthConstrained?: boolean;\n  showColumnNumber?: boolean;\n}\n\nexport interface StackTraceRegularRow {\n  functionName: string;\n  link: HTMLElement|null;\n}\n\nexport interface StackTraceAsyncRow {\n  asyncDescription: string;\n}\n"]}