{"version":3,"file":"OpenInNewTab.test.js","sourceRoot":"","sources":["../../../../../../front_end/ui/helpers/OpenInNewTab.test.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright 2022 The Chromium Authors\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport * as Host from '../../core/host/host.js';\nimport * as Platform from '../../core/platform/platform.js';\nimport type * as Root from '../../core/root/root.js';\nimport {createTarget, updateHostConfig} from '../../testing/EnvironmentHelpers.js';\nimport {describeWithMockConnection} from '../../testing/MockConnection.js';\n\nimport * as UIHelpers from './helpers.js';\n\nconst {urlString} = Platform.DevToolsPath;\n\ndescribe('openInNewTab', () => {\n  const {openInNewTab} = UIHelpers;\n  const {InspectorFrontendHostInstance} = Host.InspectorFrontendHost;\n\n  it('throws a TypeError if the URL is invalid', () => {\n    assert.throws(() => openInNewTab('ThisIsNotAValidURL'), TypeError);\n  });\n\n  it('opens URLs via host bindings', () => {\n    const stub = sinon.stub(InspectorFrontendHostInstance, 'openInNewTab');\n\n    openInNewTab('https://www.google.com/');\n\n    sinon.assert.callCount(stub, 1);\n    assert.deepEqual(stub.args[0], ['https://www.google.com/']);\n  });\n\n  it('opens URLs and appends slash if needed', () => {\n    const stub = sinon.stub(InspectorFrontendHostInstance, 'openInNewTab');\n\n    openInNewTab('https://www.google.com');\n\n    sinon.assert.callCount(stub, 1);\n    assert.deepEqual(stub.args[0], ['https://www.google.com/']);\n  });\n\n  it('doesn\\'t override existing `utm_source` search parameters', () => {\n    const URLs = [\n      'http://developer.chrome.com/docs/devtools/workspaces/?utm_source=unittests',\n      'http://developers.google.com/learn/?utm_source=unittests',\n      'http://web.dev/?utm_source=unittests',\n      'http://www.google.com/?utm_source=unittests',\n      'https://developer.chrome.com/docs/devtools/?utm_source=unittests',\n      'https://developers.google.com/community/?utm_source=unittests',\n      'https://www.google.com/?utm_source=unittests',\n      'https://web.dev/baseline/?utm_source=unittests',\n    ];\n    for (const url of URLs) {\n      const stub = sinon.stub(InspectorFrontendHostInstance, 'openInNewTab');\n\n      openInNewTab(url);\n\n      sinon.assert.calledOnceWithExactly(stub, urlString`${url}`);\n      stub.restore();\n    }\n  });\n\n  it('adds `utm_source` search parameter to Google documentation set links', () => {\n    const URLs = [\n      'http://developer.chrome.com/docs/devtools/workspaces/',\n      'http://developers.google.com/learn/',\n      'http://web.dev/',\n      'https://developer.chrome.com/docs/devtools/',\n      'https://developers.google.com/community/',\n      'https://web.dev/baseline/',\n    ];\n    for (const url of URLs) {\n      const stub = sinon.stub(InspectorFrontendHostInstance, 'openInNewTab');\n\n      openInNewTab(url);\n\n      sinon.assert.calledOnce(stub);\n      assert.strictEqual(new URL(stub.args[0][0]).searchParams.get('utm_source'), 'devtools');\n      stub.restore();\n    }\n  });\n\n  it('adds `utm_campaign` search parameter to Google documentation set links', () => {\n    const CHANNELS: Array<typeof Root.Runtime.hostConfig.channel> = [\n      'stable',\n      'beta',\n      'dev',\n      'canary',\n    ];\n    const URLs = [\n      'http://developer.chrome.com/docs/devtools/workspaces/',\n      'http://developers.google.com/learn/',\n      'http://web.dev/',\n      'https://developer.chrome.com/docs/devtools/',\n      'https://developers.google.com/community/',\n      'https://web.dev/baseline/',\n    ];\n    for (const channel of CHANNELS) {\n      updateHostConfig({channel});\n\n      for (const url of URLs) {\n        const stub = sinon.stub(InspectorFrontendHostInstance, 'openInNewTab');\n\n        openInNewTab(url);\n\n        sinon.assert.calledOnce(stub);\n        assert.strictEqual(new URL(stub.args[0][0]).searchParams.get('utm_campaign'), channel);\n        stub.restore();\n      }\n    }\n  });\n\n  it('correctly preserves anchors', () => {\n    updateHostConfig({channel: 'stable'});\n    const stub = sinon.stub(InspectorFrontendHostInstance, 'openInNewTab');\n\n    openInNewTab('https://developer.chrome.com/docs/devtools/settings/ignore-list/#skip-third-party');\n\n    sinon.assert.calledOnce(stub);\n    const url = new URL(stub.args[0][0]);\n    assert.strictEqual(url.hash, '#skip-third-party');\n    assert.strictEqual(url.searchParams.get('utm_campaign'), 'stable');\n    assert.strictEqual(url.searchParams.get('utm_source'), 'devtools');\n  });\n\n  it('correctly preserves other search params', () => {\n    updateHostConfig({channel: 'stable'});\n    const stub = sinon.stub(InspectorFrontendHostInstance, 'openInNewTab');\n\n    openInNewTab('http://web.dev/route?foo=bar&baz=devtools');\n\n    sinon.assert.calledOnce(stub);\n    const url = new URL(stub.args[0][0]);\n    assert.strictEqual(url.searchParams.get('baz'), 'devtools');\n    assert.strictEqual(url.searchParams.get('foo'), 'bar');\n    assert.strictEqual(url.searchParams.get('utm_campaign'), 'stable');\n    assert.strictEqual(url.searchParams.get('utm_source'), 'devtools');\n  });\n\n  it('does nothing for javascript: urls', () => {\n    const stub = sinon.stub(InspectorFrontendHostInstance, 'openInNewTab');\n\n    openInNewTab('javascript:alert(\"Hey\")');\n\n    sinon.assert.callCount(stub, 0);\n  });\n\n  describeWithMockConnection('chrome:// link', () => {\n    it('call the correct API for chrome:// links', async () => {\n      const target = createTarget();\n      const spy = sinon.spy(target.targetAgent(), 'invoke_createTarget');\n\n      openInNewTab('chrome://settings');\n\n      sinon.assert.calledOnce(spy);\n      assert.deepEqual(spy.firstCall.firstArg, {url: 'chrome://settings/'});\n    });\n  });\n});\n"]}