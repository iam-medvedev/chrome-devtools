{"version":3,"file":"IssueCounter.js","sourceRoot":"","sources":["../../../../../../../front_end/ui/components/issue_counter/IssueCounter.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright 2021 The Chromium Authors. All rights reserved.\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport '../icon_button/icon_button.js';\n\nimport * as Common from '../../../core/common/common.js';\nimport * as i18n from '../../../core/i18n/i18n.js';\nimport * as IssuesManager from '../../../models/issues_manager/issues_manager.js';\nimport {html, render} from '../../lit/lit.js';\nimport type * as IconButton from '../icon_button/icon_button.js';\n\nimport issueCounterStyles from './issueCounter.css.js';\n\nconst UIStrings = {\n  /**\n   *@description Label for link to Issues tab, specifying how many issues there are.\n   */\n  pageErrors: '{issueCount, plural, =1 {# page error} other {# page errors}}',\n  /**\n   *@description Label for link to Issues tab, specifying how many issues there are.\n   */\n  breakingChanges: '{issueCount, plural, =1 {# breaking change} other {# breaking changes}}',\n  /**\n   *@description Label for link to Issues tab, specifying how many issues there are.\n   */\n  possibleImprovements: '{issueCount, plural, =1 {# possible improvement} other {# possible improvements}}',\n} as const;\nconst str_ = i18n.i18n.registerUIStrings('ui/components/issue_counter/IssueCounter.ts', UIStrings);\nconst i18nString = i18n.i18n.getLocalizedString.bind(undefined, str_);\n\nexport function getIssueKindIconData(issueKind: IssuesManager.Issue.IssueKind): IconButton.Icon.IconWithName {\n  switch (issueKind) {\n    case IssuesManager.Issue.IssueKind.PAGE_ERROR:\n      return {iconName: 'issue-cross-filled', color: 'var(--icon-error)', width: '20px', height: '20px'};\n    case IssuesManager.Issue.IssueKind.BREAKING_CHANGE:\n      return {iconName: 'issue-exclamation-filled', color: 'var(--icon-warning)', width: '20px', height: '20px'};\n    case IssuesManager.Issue.IssueKind.IMPROVEMENT:\n      return {iconName: 'issue-text-filled', color: 'var(--icon-info)', width: '20px', height: '20px'};\n  }\n}\n\nfunction toIconGroup({iconName, color, width, height}: IconButton.Icon.IconWithName, sizeOverride?: string):\n    IconButton.IconButton.IconWithTextData {\n  if (sizeOverride) {\n    return {iconName, iconColor: color, iconWidth: sizeOverride, iconHeight: sizeOverride};\n  }\n  return {iconName, iconColor: color, iconWidth: width, iconHeight: height};\n}\n\nexport const enum DisplayMode {\n  OMIT_EMPTY = 'OmitEmpty',\n  SHOW_ALWAYS = 'ShowAlways',\n  ONLY_MOST_IMPORTANT = 'OnlyMostImportant',\n}\n\nexport interface IssueCounterData {\n  clickHandler?: () => void;\n  tooltipCallback?: () => void;\n  leadingText?: string;\n  displayMode?: DisplayMode;\n  issuesManager: IssuesManager.IssuesManager.IssuesManager;\n  throttlerTimeout?: number;\n  accessibleName?: string;\n  compact?: boolean;\n}\n\n// Lazily instantiate the formatter as the constructor takes 50ms+\n// TODO: move me and others like me to i18n module\nconst listFormatter = (function defineFormatter() {\n  let intlListFormat: Intl.ListFormat;\n  return {\n    format(...args: Parameters<Intl.ListFormat['format']>): ReturnType<Intl.ListFormat['format']> {\n      if (!intlListFormat) {\n        const opts: Intl.ListFormatOptions = {type: 'unit', style: 'short'};\n        intlListFormat = new Intl.ListFormat(i18n.DevToolsLocale.DevToolsLocale.instance().locale, opts);\n      }\n      return intlListFormat.format(...args);\n    },\n  };\n})();\n\nexport function getIssueCountsEnumeration(\n    issuesManager: IssuesManager.IssuesManager.IssuesManager, omitEmpty = true): string {\n  const counts: [number, number, number] = [\n    issuesManager.numberOfIssues(IssuesManager.Issue.IssueKind.PAGE_ERROR),\n    issuesManager.numberOfIssues(IssuesManager.Issue.IssueKind.BREAKING_CHANGE),\n    issuesManager.numberOfIssues(IssuesManager.Issue.IssueKind.IMPROVEMENT),\n  ];\n  const phrases = [\n    i18nString(UIStrings.pageErrors, {issueCount: counts[0]}),\n    i18nString(UIStrings.breakingChanges, {issueCount: counts[1]}),\n    i18nString(UIStrings.possibleImprovements, {issueCount: counts[2]}),\n  ];\n  return listFormatter.format(phrases.filter((_, i) => omitEmpty ? counts[i] > 0 : true));\n}\n\nexport class IssueCounter extends HTMLElement {\n  readonly #shadow = this.attachShadow({mode: 'open'});\n  #clickHandler: undefined|(() => void) = undefined;\n  #tooltipCallback: undefined|(() => void) = undefined;\n  #leadingText = '';\n  #throttler: undefined|Common.Throttler.Throttler;\n  #counts: [number, number, number] = [0, 0, 0];\n  #displayMode: DisplayMode = DisplayMode.OMIT_EMPTY;\n  #issuesManager: IssuesManager.IssuesManager.IssuesManager|undefined = undefined;\n  #accessibleName: string|undefined = undefined;\n  #throttlerTimeout: number|undefined;\n  #compact = false;\n\n  scheduleUpdate(): void {\n    if (this.#throttler) {\n      void this.#throttler.schedule(async () => this.#render());\n    } else {\n      this.#render();\n    }\n  }\n\n  set data(data: IssueCounterData) {\n    this.#clickHandler = data.clickHandler;\n    this.#leadingText = data.leadingText ?? '';\n    this.#tooltipCallback = data.tooltipCallback;\n    this.#displayMode = data.displayMode ?? DisplayMode.OMIT_EMPTY;\n    this.#accessibleName = data.accessibleName;\n    this.#throttlerTimeout = data.throttlerTimeout;\n    this.#compact = Boolean(data.compact);\n    if (this.#issuesManager !== data.issuesManager) {\n      this.#issuesManager?.removeEventListener(\n          IssuesManager.IssuesManager.Events.ISSUES_COUNT_UPDATED, this.scheduleUpdate, this);\n      this.#issuesManager = data.issuesManager;\n      this.#issuesManager.addEventListener(\n          IssuesManager.IssuesManager.Events.ISSUES_COUNT_UPDATED, this.scheduleUpdate, this);\n    }\n    if (data.throttlerTimeout !== 0) {\n      this.#throttler = new Common.Throttler.Throttler(data.throttlerTimeout ?? 100);\n    } else {\n      this.#throttler = undefined;\n    }\n    this.scheduleUpdate();\n  }\n\n  get data(): IssueCounterData {\n    return {\n      clickHandler: this.#clickHandler,\n      leadingText: this.#leadingText,\n      tooltipCallback: this.#tooltipCallback,\n      displayMode: this.#displayMode,\n      accessibleName: this.#accessibleName,\n      throttlerTimeout: this.#throttlerTimeout,\n      compact: this.#compact,\n      issuesManager: this.#issuesManager as IssuesManager.IssuesManager.IssuesManager,\n    };\n  }\n\n  #render(): void {\n    if (!this.#issuesManager) {\n      return;\n    }\n    this.#counts = [\n      this.#issuesManager.numberOfIssues(IssuesManager.Issue.IssueKind.PAGE_ERROR),\n      this.#issuesManager.numberOfIssues(IssuesManager.Issue.IssueKind.BREAKING_CHANGE),\n      this.#issuesManager.numberOfIssues(IssuesManager.Issue.IssueKind.IMPROVEMENT),\n    ];\n    const importance = [\n      IssuesManager.Issue.IssueKind.PAGE_ERROR,\n      IssuesManager.Issue.IssueKind.BREAKING_CHANGE,\n      IssuesManager.Issue.IssueKind.IMPROVEMENT,\n    ];\n    const mostImportant = importance[this.#counts.findIndex(x => x > 0) ?? 2];\n\n    const countToString = (kind: IssuesManager.Issue.IssueKind, count: number): string|undefined => {\n      switch (this.#displayMode) {\n        case DisplayMode.OMIT_EMPTY:\n          return count > 0 ? `${count}` : undefined;\n        case DisplayMode.SHOW_ALWAYS:\n          return `${count}`;\n        case DisplayMode.ONLY_MOST_IMPORTANT:\n          return kind === mostImportant ? `${count}` : undefined;\n      }\n    };\n    const iconSize = '2ex';\n    const data: IconButton.IconButton.IconButtonData = {\n      groups: [\n        {\n          ...toIconGroup(getIssueKindIconData(IssuesManager.Issue.IssueKind.PAGE_ERROR), iconSize),\n          text: countToString(IssuesManager.Issue.IssueKind.PAGE_ERROR, this.#counts[0]),\n        },\n        {\n          ...toIconGroup(getIssueKindIconData(IssuesManager.Issue.IssueKind.BREAKING_CHANGE), iconSize),\n          text: countToString(IssuesManager.Issue.IssueKind.BREAKING_CHANGE, this.#counts[1]),\n        },\n        {\n          ...toIconGroup(getIssueKindIconData(IssuesManager.Issue.IssueKind.IMPROVEMENT), iconSize),\n          text: countToString(IssuesManager.Issue.IssueKind.IMPROVEMENT, this.#counts[2]),\n        },\n      ],\n      clickHandler: this.#clickHandler,\n      leadingText: this.#leadingText,\n      accessibleName: this.#accessibleName,\n      compact: this.#compact,\n    };\n    render(\n        html`\n        <style>${issueCounterStyles.cssContent}</style>\n        <icon-button .data=${data} .accessibleName=${this.#accessibleName}></icon-button>\n        `,\n        this.#shadow, {host: this});\n    this.#tooltipCallback?.();\n  }\n}\n\ncustomElements.define('devtools-issue-counter', IssueCounter);\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    'devtools-issue-counter': IssueCounter;\n  }\n}\n"]}