{"version":3,"file":"RequestLinkIcon.js","sourceRoot":"","sources":["../../../../../../../front_end/ui/components/request_link_icon/RequestLinkIcon.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright (c) 2021 The Chromium Authors. All rights reserved.\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport '../../../ui/components/icon_button/icon_button.js';\n\nimport * as Common from '../../../core/common/common.js';\nimport * as i18n from '../../../core/i18n/i18n.js';\nimport type * as Platform from '../../../core/platform/platform.js';\nimport type * as SDK from '../../../core/sdk/sdk.js';\nimport type * as Protocol from '../../../generated/protocol.js';\nimport type * as Logs from '../../../models/logs/logs.js';\nimport * as NetworkForward from '../../../panels/network/forward/forward.js';\nimport * as RenderCoordinator from '../../../ui/components/render_coordinator/render_coordinator.js';\nimport * as Lit from '../../../ui/lit/lit.js';\nimport * as VisualLogging from '../../../ui/visual_logging/visual_logging.js';\n\nimport requestLinkIconStylesRaw from './requestLinkIcon.css.js';\n\n// TODO(crbug.com/391381439): Fully migrate off of constructed style sheets.\nconst requestLinkIconStyles = new CSSStyleSheet();\nrequestLinkIconStyles.replaceSync(requestLinkIconStylesRaw.cssContent);\n\nconst {html} = Lit;\n\nconst UIStrings = {\n  /**\n   * @description Title for a link to show a request in the network panel\n   * @example {https://example.org/index.html} url\n   */\n  clickToShowRequestInTheNetwork: 'Click to open the network panel and show request for URL: {url}',\n  /**\n   * @description Title for an link to show a request that is unavailable because the request couldn't be resolved\n   */\n  requestUnavailableInTheNetwork: 'Request unavailable in the network panel, try reloading the inspected page',\n  /**\n   * @description Label for the shortened URL displayed in a link to show a request in the network panel\n   */\n  shortenedURL: 'Shortened URL',\n} as const;\nconst str_ = i18n.i18n.registerUIStrings('ui/components/request_link_icon/RequestLinkIcon.ts', UIStrings);\nconst i18nString = i18n.i18n.getLocalizedString.bind(undefined, str_);\n\nexport interface RequestLinkIconData {\n  linkToPreflight?: boolean;\n  request?: SDK.NetworkRequest.NetworkRequest|null;\n  affectedRequest?: {requestId?: Protocol.Network.RequestId, url?: string};\n  highlightHeader?: {section: NetworkForward.UIRequestLocation.UIHeaderSection, name: string};\n  networkTab?: NetworkForward.UIRequestLocation.UIRequestTabs;\n  requestResolver?: Logs.RequestResolver.RequestResolver;\n  displayURL?: boolean;\n  // If displayURL && urlToDisplay !== undefined, uses urlToDisplay for the text of the link.\n  // If displayURL only, uses filename of the URL.\n  urlToDisplay?: string;\n  additionalOnClickAction?: () => void;\n  revealOverride?: (revealable: unknown, omitFocus?: boolean) => Promise<void>;\n}\n\nexport const extractShortPath = (path: Platform.DevToolsPath.UrlString): string => {\n  // 1st regex matches everything after last '/'\n  // if path ends with '/', 2nd regex returns everything between the last two '/'\n  return (/[^/]+$/.exec(path) || /[^/]+\\/$/.exec(path) || [''])[0];\n};\n\nexport class RequestLinkIcon extends HTMLElement {\n  readonly #shadow = this.attachShadow({mode: 'open'});\n  #linkToPreflight?: boolean;\n  // The value `null` indicates that the request is not available,\n  // `undefined` that it is still being resolved.\n  #request?: SDK.NetworkRequest.NetworkRequest|null;\n  #highlightHeader?: {section: NetworkForward.UIRequestLocation.UIHeaderSection, name: string};\n  #requestResolver?: Logs.RequestResolver.RequestResolver;\n  #displayURL = false;\n  #urlToDisplay?: string;\n  #networkTab?: NetworkForward.UIRequestLocation.UIRequestTabs;\n  #affectedRequest?: {requestId?: Protocol.Network.RequestId, url?: string};\n  #additionalOnClickAction?: () => void;\n  #reveal = Common.Revealer.reveal;\n\n  set data(data: RequestLinkIconData) {\n    this.#linkToPreflight = data.linkToPreflight;\n    this.#request = data.request;\n    if (data.affectedRequest) {\n      this.#affectedRequest = {...data.affectedRequest};\n    }\n    this.#highlightHeader = data.highlightHeader;\n    this.#networkTab = data.networkTab;\n    this.#requestResolver = data.requestResolver;\n    this.#displayURL = data.displayURL ?? false;\n    this.#urlToDisplay = data.urlToDisplay;\n    this.#additionalOnClickAction = data.additionalOnClickAction;\n    if (data.revealOverride) {\n      this.#reveal = data.revealOverride;\n    }\n    if (!this.#request && typeof data.affectedRequest?.requestId !== 'undefined') {\n      if (!this.#requestResolver) {\n        throw new Error('A `RequestResolver` must be provided if an `affectedRequest` is provided.');\n      }\n      this.#requestResolver.waitFor(data.affectedRequest.requestId)\n          .then(request => {\n            this.#request = request;\n            return this.#render();\n          })\n          .catch(() => {\n            this.#request = null;\n          });\n    }\n    void this.#render();\n  }\n\n  connectedCallback(): void {\n    this.#shadow.adoptedStyleSheets = [requestLinkIconStyles];\n  }\n\n  get data(): RequestLinkIconData {\n    return {\n      linkToPreflight: this.#linkToPreflight,\n      request: this.#request,\n      affectedRequest: this.#affectedRequest,\n      highlightHeader: this.#highlightHeader,\n      networkTab: this.#networkTab,\n      requestResolver: this.#requestResolver,\n      displayURL: this.#displayURL,\n      urlToDisplay: this.#urlToDisplay,\n      additionalOnClickAction: this.#additionalOnClickAction,\n      revealOverride: this.#reveal !== Common.Revealer.reveal ? this.#reveal : undefined,\n    };\n  }\n\n  handleClick(event: MouseEvent): void {\n    if (event.button !== 0) {\n      return;  // Only handle left-click for now.\n    }\n    const linkedRequest = this.#linkToPreflight ? this.#request?.preflightRequest() : this.#request;\n    if (!linkedRequest) {\n      return;\n    }\n    if (this.#highlightHeader) {\n      const requestLocation = NetworkForward.UIRequestLocation.UIRequestLocation.header(\n          linkedRequest, this.#highlightHeader.section, this.#highlightHeader.name);\n      void this.#reveal(requestLocation);\n    } else {\n      const requestLocation = NetworkForward.UIRequestLocation.UIRequestLocation.tab(\n          linkedRequest, this.#networkTab ?? NetworkForward.UIRequestLocation.UIRequestTabs.HEADERS_COMPONENT);\n      void this.#reveal(requestLocation);\n    }\n    this.#additionalOnClickAction?.();\n    event.consume();\n  }\n\n  #getTooltip(): Platform.UIString.LocalizedString {\n    if (this.#request) {\n      return i18nString(UIStrings.clickToShowRequestInTheNetwork, {url: this.#request.url()});\n    }\n    return i18nString(UIStrings.requestUnavailableInTheNetwork);\n  }\n\n  #getUrlForDisplaying(): string|undefined {\n    if (!this.#displayURL) {\n      return undefined;\n    }\n    if (this.#request) {\n      return this.#request.url();\n    }\n    return this.#affectedRequest?.url;\n  }\n\n  #maybeRenderURL(): Lit.LitTemplate {\n    const url = this.#getUrlForDisplaying();\n    if (!url) {\n      return Lit.nothing;\n    }\n\n    if (this.#urlToDisplay) {\n      return html`<span title=${url}>${this.#urlToDisplay}</span>`;\n    }\n\n    const filename = extractShortPath(url as Platform.DevToolsPath.UrlString);\n    return html`<span aria-label=${i18nString(UIStrings.shortenedURL)} title=${url}>${filename}</span>`;\n  }\n\n  async #render(): Promise<void> {\n    return await RenderCoordinator.write(() => {\n      // By default we render just the URL for the request link. If we also know\n      // the concrete network request, or at least its request ID, we surround\n      // the URL with a button, that opens the request in the Network panel.\n      let template = this.#maybeRenderURL();\n      if (this.#request || this.#affectedRequest?.requestId !== undefined) {\n        // clang-format off\n        template = html`\n          <button class=${Lit.Directives.classMap({link: Boolean(this.#request)})}\n                  title=${this.#getTooltip()}\n                  jslog=${VisualLogging.link('request').track({click: true})}\n                  @click=${this.handleClick}>\n            <devtools-icon name=\"arrow-up-down-circle\"></devtools-icon>\n            ${template}\n          </button>`;\n        // clang-format on\n      }\n      Lit.render(template, this.#shadow, {host: this});\n    });\n  }\n}\n\ncustomElements.define('devtools-request-link-icon', RequestLinkIcon);\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    'devtools-request-link-icon': RequestLinkIcon;\n  }\n}\n"]}