{"version":3,"file":"Button.test.js","sourceRoot":"","sources":["../../../../../../../front_end/ui/components/buttons/Button.test.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright 2021 The Chromium Authors. All rights reserved.\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport {dispatchKeyDownEvent, renderElementIntoDOM} from '../../../testing/DOMHelpers.js';\n\nimport * as Buttons from './buttons.js';\n\ndescribe('Button', () => {\n  const iconName = 'file-image';\n\n  function renderButton(\n      data: Buttons.Button.ButtonData = {\n        variant: Buttons.Button.Variant.PRIMARY,\n      },\n      text = 'Button'): Buttons.Button.Button {\n    const button = new Buttons.Button.Button();\n    button.data = data;\n    // Toolbar and round buttons do not take text, and error if you try to set any.\n    if (data.variant !== Buttons.Button.Variant.TOOLBAR && data.variant !== Buttons.Button.Variant.ICON) {\n      button.innerText = text;\n    }\n    renderElementIntoDOM(button);\n    return button;\n  }\n\n  function testClick(\n      data: Buttons.Button.ButtonData = {\n        variant: Buttons.Button.Variant.PRIMARY,\n        disabled: false,\n      },\n      expectedClickCount = 1): void {\n    const button = renderButton(data);\n\n    let clicks = 0;\n    button.onclick = () => clicks++;\n\n    const innerButton = button.shadowRoot?.querySelector('button') as HTMLButtonElement;\n    assert.instanceOf(innerButton, HTMLButtonElement);\n\n    innerButton.click();\n    dispatchKeyDownEvent(innerButton, {\n      key: 'Enter',\n    });\n\n    assert.strictEqual(clicks, expectedClickCount);\n  }\n\n  it('changes to `disabled` state are reflect in the property', () => {\n    const button = renderButton();\n    button.disabled = false;\n    assert.isFalse(button.disabled);\n    button.disabled = true;\n    assert.isTrue(button.disabled);\n  });\n\n  describe('focus', () => {\n    it('correctly focuses the <button> element in the shadow DOM', () => {\n      const button = renderButton();\n\n      button.focus();\n\n      assert.isTrue(button.shadowRoot!.querySelector('button')!.hasFocus());\n    });\n  });\n\n  describe('hasFocus', () => {\n    it('correctly reflects the focus state of the button', () => {\n      const button = renderButton();\n\n      button.focus();\n\n      assert.isTrue(button.hasFocus());\n    });\n  });\n\n  it('primary button can be clicked', () => {\n    testClick({\n      variant: Buttons.Button.Variant.PRIMARY,\n    });\n  });\n\n  it('disabled primary button cannot be clicked', () => {\n    testClick(\n        {\n          variant: Buttons.Button.Variant.PRIMARY,\n          disabled: true,\n        },\n        0);\n  });\n\n  it('secondary button can be clicked', () => {\n    testClick({\n      variant: Buttons.Button.Variant.OUTLINED,\n    });\n  });\n\n  it('disabled secondary button cannot be clicked', () => {\n    testClick(\n        {\n          variant: Buttons.Button.Variant.OUTLINED,\n          disabled: true,\n        },\n        0);\n  });\n\n  it('toolbar button can be clicked', () => {\n    testClick({\n      variant: Buttons.Button.Variant.TOOLBAR,\n      iconName,\n    });\n  });\n\n  it('disabled toolbar button cannot be clicked', () => {\n    testClick(\n        {\n          variant: Buttons.Button.Variant.TOOLBAR,\n          iconName,\n          disabled: true,\n        },\n        0);\n  });\n\n  it('gets the no additional classes set for the inner button if only text is provided', () => {\n    const button = renderButton();\n    const innerButton = button.shadowRoot?.querySelector('button') as HTMLButtonElement;\n    assert.isTrue(!innerButton.classList.contains('text-with-icon'));\n    assert.isTrue(!innerButton.classList.contains('only-icon'));\n  });\n\n  it('gets title set', () => {\n    const button = renderButton({\n      variant: Buttons.Button.Variant.PRIMARY,\n      title: 'Custom',\n    });\n    const innerButton = button.shadowRoot?.querySelector('button') as HTMLButtonElement;\n    assert.strictEqual(innerButton.title, 'Custom');\n\n    button.title = 'Custom2';\n    assert.strictEqual(innerButton.title, 'Custom2');\n  });\n\n  it('gets the text-with-icon class set for the inner button if text and icon is provided', () => {\n    const button = renderButton(\n        {\n          variant: Buttons.Button.Variant.PRIMARY,\n          iconName,\n        },\n        'text');\n    const innerButton = button.shadowRoot?.querySelector('button') as HTMLButtonElement;\n    assert.isTrue(innerButton.classList.contains('text-with-icon'));\n    assert.isTrue(!innerButton.classList.contains('only-icon'));\n  });\n\n  it('gets the only-icon class set for the inner button if only icon is provided', () => {\n    const button = renderButton(\n        {\n          variant: Buttons.Button.Variant.PRIMARY,\n          iconName,\n        },\n        '');\n    const innerButton = button.shadowRoot?.querySelector('button') as HTMLButtonElement;\n    assert.isTrue(!innerButton.classList.contains('text-with-icon'));\n    assert.isTrue(innerButton.classList.contains('only-icon'));\n  });\n\n  it('gets the `small` class set for the inner button if size === SMALL', () => {\n    const button = renderButton(\n        {\n          variant: Buttons.Button.Variant.PRIMARY,\n          size: Buttons.Button.Size.SMALL,\n        },\n        '');\n    const innerButton = button.shadowRoot?.querySelector('button') as HTMLButtonElement;\n    assert.isTrue(innerButton.classList.contains('small'));\n  });\n\n  it('does not get the `small` class set for the inner button if size === MEDIUM', () => {\n    const button = renderButton(\n        {\n          variant: Buttons.Button.Variant.PRIMARY,\n          iconName,\n        },\n        '');\n    const innerButton = button.shadowRoot?.querySelector('button') as HTMLButtonElement;\n    assert.isFalse(innerButton.classList.contains('small'));\n  });\n\n  it('prevents only \"keydown\" events for Enter and Space to bubble up', () => {\n    const button = renderButton({variant: Buttons.Button.Variant.PRIMARY});\n    const onKeydown = sinon.spy();\n    button.addEventListener('keydown', onKeydown);\n\n    const innerButton = button.shadowRoot!.querySelector('button') as HTMLButtonElement;\n    dispatchKeyDownEvent(innerButton, {bubbles: true, composed: true, key: 'Enter'});\n    dispatchKeyDownEvent(innerButton, {bubbles: true, composed: true, key: ' '});\n    dispatchKeyDownEvent(innerButton, {bubbles: true, composed: true, key: 'x'});\n\n    assert.isTrue(onKeydown.calledOnce);\n    assert.strictEqual(onKeydown.getCall(0).args[0].key, 'x');\n  });\n\n  describe('in forms', () => {\n    function renderForm(data: Buttons.Button.ButtonData = {\n      variant: Buttons.Button.Variant.PRIMARY,\n    }) {\n      const form = document.createElement('form');\n      const input = document.createElement('input');\n      const button = new Buttons.Button.Button();\n      const reference = {\n        submitCount: 0,\n        form,\n        button,\n        input,\n      };\n      form.onsubmit = (event: Event) => {\n        event.preventDefault();\n        reference.submitCount++;\n      };\n      button.data = data;\n      button.innerText = 'button';\n\n      form.append(input);\n      form.append(button);\n\n      renderElementIntoDOM(form);\n      return reference;\n    }\n\n    it('submits a form with button[type=submit]', () => {\n      const state = renderForm({\n        variant: Buttons.Button.Variant.PRIMARY,\n        type: 'submit',\n      });\n      state.button.click();\n      assert.strictEqual(state.submitCount, 1);\n    });\n\n    it('does not submit a form with button[type=button]', () => {\n      const state = renderForm({\n        variant: Buttons.Button.Variant.PRIMARY,\n        type: 'button',\n      });\n      state.button.click();\n      assert.strictEqual(state.submitCount, 0);\n    });\n\n    it('resets a form with button[type=reset]', () => {\n      const state = renderForm({\n        variant: Buttons.Button.Variant.PRIMARY,\n        type: 'reset',\n      });\n      state.input.value = 'test';\n      state.button.click();\n      assert.strictEqual(state.input.value, '');\n    });\n  });\n});\n"]}