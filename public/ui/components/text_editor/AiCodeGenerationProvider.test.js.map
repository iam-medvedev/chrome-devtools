{"version":3,"file":"AiCodeGenerationProvider.test.js","sourceRoot":"","sources":["../../../../../../../front_end/ui/components/text_editor/AiCodeGenerationProvider.test.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright 2025 The Chromium Authors\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport * as Common from '../../../core/common/common.js';\nimport * as Host from '../../../core/host/host.js';\nimport * as AiCodeCompletion from '../../../models/ai_code_completion/ai_code_completion.js';\nimport * as AiCodeGeneration from '../../../models/ai_code_generation/ai_code_generation.js';\nimport * as PanelCommon from '../../../panels/common/common.js';\nimport {renderElementIntoDOM} from '../../../testing/DOMHelpers.js';\nimport {describeWithEnvironment, updateHostConfig} from '../../../testing/EnvironmentHelpers.js';\nimport * as CodeMirror from '../../../third_party/codemirror.next/codemirror.next.js';\n\nimport {AiCodeGenerationProvider, Config, TextEditor} from './text_editor.js';\n\nfunction createEditorWithProvider(doc: string, config: AiCodeGenerationProvider.AiCodeGenerationConfig = {\n  panel: AiCodeCompletion.AiCodeCompletion.ContextFlavor.CONSOLE,\n  generationContext: {},\n  onSuggestionAccepted: () => {},\n  onRequestTriggered: () => {},\n  onResponseReceived: () => {},\n}): {editor: TextEditor.TextEditor, provider: AiCodeGenerationProvider.AiCodeGenerationProvider} {\n  const provider = AiCodeGenerationProvider.AiCodeGenerationProvider.createInstance(config);\n  const editor = new TextEditor.TextEditor(\n      CodeMirror.EditorState.create({\n        doc,\n        extensions: [\n          CodeMirror.javascript.javascriptLanguage,\n          provider.extension(),\n        ],\n      }),\n  );\n  renderElementIntoDOM(editor);\n  provider.editorInitialized(editor);\n  return {editor, provider};\n}\n\nfunction dispatchCtrlI(editor: TextEditor.TextEditor) {\n  const event = new KeyboardEvent('keydown', {\n    key: 'i',\n    ctrlKey: Host.Platform.isMac() ? false : true,\n    metaKey: Host.Platform.isMac() ? true : false,\n  });\n  editor.editor.contentDOM.dispatchEvent(event);\n}\n\ndescribeWithEnvironment('AiCodeGenerationProvider', () => {\n  let clock: sinon.SinonFakeTimers;\n  let checkAccessPreconditionsStub: sinon.SinonStub;\n  let generateCodeStub: sinon.SinonStub;\n\n  beforeEach(() => {\n    clock = sinon.useFakeTimers();\n    updateHostConfig({\n      devToolsAiCodeGeneration: {\n        enabled: true,\n      },\n      aidaAvailability: {\n        enabled: true,\n        blockedByAge: false,\n        blockedByGeo: false,\n      }\n    });\n    checkAccessPreconditionsStub = sinon.stub(Host.AidaClient.AidaClient, 'checkAccessPreconditions');\n    checkAccessPreconditionsStub.resolves(Host.AidaClient.AidaAccessPreconditions.AVAILABLE);\n    sinon.stub(Host.AidaClient.HostConfigTracker, 'instance').returns({\n      addEventListener: () => {},\n      removeEventListener: () => {},\n      dispose: () => {},\n    } as unknown as Host.AidaClient.HostConfigTracker);\n    Common.Settings.Settings.instance().settingForTest('ai-code-completion-enabled').set(true);\n    Common.Settings.Settings.instance().createSetting('ai-code-generation-onboarding-completed', true);\n    generateCodeStub = sinon.stub(AiCodeGeneration.AiCodeGeneration.AiCodeGeneration.prototype, 'generateCode');\n    sinon.stub(PanelCommon.AiCodeGenerationTeaser.AiCodeGenerationTeaser.prototype, 'displayState').set(_ => {});\n  });\n\n  afterEach(() => {\n    clock.restore();\n  });\n\n  it('does not create a provider when the feature is disabled', () => {\n    updateHostConfig({\n      devToolsAiCodeGeneration: {\n        enabled: false,\n      },\n    });\n    assert.throws(() => createEditorWithProvider(''), 'AI code generation feature is not enabled.');\n  });\n\n  describe('Teaser decoration', () => {\n    it('shows teaser when cursor is in empty line', async () => {\n      const {editor, provider} = createEditorWithProvider('');\n      await clock.tickAsync(0);\n      assert.isNotNull(editor.editor.dom.querySelector('.cm-placeholder'));\n      provider.dispose();\n    });\n\n    it('shows teaser when cursor is at the end of an inline comment', async () => {\n      const {editor, provider} = createEditorWithProvider('// Hello');\n      editor.dispatch({selection: {anchor: 8}});\n      await clock.tickAsync(0);\n      assert.isNotNull(editor.editor.dom.querySelector('.cm-placeholder'));\n      provider.dispose();\n    });\n\n    it('shows teaser when cursor is at the end of a block comment', async () => {\n      const {editor, provider} = createEditorWithProvider(`/**\n  * Hello\n  */`);\n      editor.dispatch({selection: {anchor: 18}});\n      await clock.tickAsync(0);\n      assert.isNotNull(editor.editor.dom.querySelector('.cm-placeholder'));\n      provider.dispose();\n    });\n\n    it('shows teaser when cursor is not at the end of a block comment', async () => {\n      const {editor, provider} = createEditorWithProvider(`/**\n  * Hello\n  */`);\n      editor.dispatch({selection: {anchor: 13}});\n      await clock.tickAsync(0);\n      assert.isNotNull(editor.editor.dom.querySelector('.cm-placeholder'));\n      provider.dispose();\n    });\n\n    it('hides teaser when block comment syntax is incomplete', async () => {\n      const {editor, provider} = createEditorWithProvider(`/**\n  * Hello`);\n      editor.dispatch({selection: {anchor: 13}});\n      await clock.tickAsync(0);\n      assert.isNull(editor.editor.dom.querySelector('.cm-placeholder'));\n      provider.dispose();\n    });\n\n    it('shows teaser when cursor is not at the end of the line', async () => {\n      const {editor, provider} = createEditorWithProvider('// Hello');\n      editor.dispatch({selection: {anchor: 5}});\n      await clock.tickAsync(0);\n      assert.isNotNull(editor.editor.dom.querySelector('.cm-placeholder'));\n      provider.dispose();\n    });\n\n    it('hides teaser when the line is not a comment', async () => {\n      const {editor, provider} = createEditorWithProvider('console');\n      editor.dispatch({selection: {anchor: 7}});\n      await clock.tickAsync(0);\n      assert.isNull(editor.editor.dom.querySelector('.cm-placeholder'));\n      provider.dispose();\n    });\n\n    it('hides teaser when mode is DISMISSED', async () => {\n      const {editor, provider} = createEditorWithProvider('// Hello');\n      editor.dispatch({selection: {anchor: 8}});\n      await clock.tickAsync(0);\n      assert.isNotNull(editor.editor.dom.querySelector('.cm-placeholder'));\n\n      editor.dispatch({\n        effects: AiCodeGenerationProvider.setAiCodeGenerationTeaserMode.of(\n            AiCodeGenerationProvider.AiCodeGenerationTeaserMode.DISMISSED)\n      });\n      await clock.tickAsync(0);\n      assert.isNull(editor.editor.dom.querySelector('.cm-placeholder'));\n      provider.dispose();\n    });\n\n    it('shows teaser again after a document change', async () => {\n      const {editor, provider} = createEditorWithProvider('// Hello');\n      editor.dispatch({selection: {anchor: 8}});\n      await clock.tickAsync(0);\n      assert.isNotNull(editor.editor.dom.querySelector('.cm-placeholder'));\n\n      editor.dispatch({\n        effects: AiCodeGenerationProvider.setAiCodeGenerationTeaserMode.of(\n            AiCodeGenerationProvider.AiCodeGenerationTeaserMode.DISMISSED)\n      });\n      await clock.tickAsync(0);\n      assert.isNull(editor.editor.dom.querySelector('.cm-placeholder'));\n\n      editor.dispatch({changes: {from: 8, insert: 'W'}, selection: {anchor: 9}});\n      await clock.tickAsync(0);\n      assert.isNotNull(editor.editor.dom.querySelector('.cm-placeholder'));\n      provider.dispose();\n    });\n  });\n\n  describe('Editor keymap', () => {\n    it('accepts suggestion on Tab', async () => {\n      const {editor, provider} = createEditorWithProvider('');\n      await clock.tickAsync(0);  // for the initial onAidaAvailabilityChange call\n\n      editor.dispatch({\n        effects: Config.setAiAutoCompleteSuggestion.of({\n          text: 'code suggestion',\n          from: 0,\n          rpcGlobalId: 1,\n          sampleId: 1,\n          startTime: performance.now(),\n          onImpression: () => {},\n          source: Config.AiSuggestionSource.GENERATION,\n        }),\n      });\n      editor.editor.contentDOM.dispatchEvent(new KeyboardEvent('keydown', {key: 'Tab'}));\n\n      assert.strictEqual(editor.state.doc.toString(), 'code suggestion');\n      provider.dispose();\n    });\n\n    it('dismisses suggestion on Escape', async () => {\n      const {editor, provider} = createEditorWithProvider('');\n      await clock.tickAsync(0);  // for the initial onAidaAvailabilityChange call\n\n      editor.dispatch({\n        effects: Config.setAiAutoCompleteSuggestion.of({\n          text: 'code suggestion',\n          from: 0,\n          rpcGlobalId: 1,\n          sampleId: 1,\n          startTime: performance.now(),\n          onImpression: () => {},\n          source: Config.AiSuggestionSource.GENERATION,\n        }),\n      });\n\n      assert.isNotNull(editor.editor.state.field(Config.aiAutoCompleteSuggestionState));\n\n      editor.editor.contentDOM.dispatchEvent(new KeyboardEvent('keydown', {key: 'Escape'}));\n\n      assert.isNull(editor.editor.state.field(Config.aiAutoCompleteSuggestionState));\n      provider.dispose();\n    });\n\n    it('dismisses teaser on Escape when loading', async () => {\n      generateCodeStub.returns(new Promise(() => {}));\n      const generationTeaser = PanelCommon.AiCodeGenerationTeaser.AiCodeGenerationTeaser.prototype;\n      const loadingSetter = sinon.spy(generationTeaser, 'displayState', ['set']);\n      const {editor, provider} = createEditorWithProvider('// Hello');\n      editor.dispatch({selection: {anchor: 8}});\n      await clock.tickAsync(0);\n\n      dispatchCtrlI(editor);\n      // Explicitly set display state to LOADING, so that loading state can be cancelled as expected\n      sinon.stub(generationTeaser, 'displayState')\n          .get(() => PanelCommon.AiCodeGenerationTeaser.AiCodeGenerationTeaserDisplayState.LOADING);\n      await clock.tickAsync(0);\n\n      assert.deepEqual(\n          loadingSetter.set.lastCall.args[0],\n          PanelCommon.AiCodeGenerationTeaser.AiCodeGenerationTeaserDisplayState.LOADING);\n      sinon.assert.calledOnce(generateCodeStub);\n\n      const dispatchSpy = sinon.spy(editor, 'dispatch');\n      editor.editor.contentDOM.dispatchEvent(new KeyboardEvent('keydown', {key: 'Escape'}));\n      await clock.tickAsync(0);\n\n      sinon.assert.calledOnce(dispatchSpy);\n      sinon.assert.calledWith(dispatchSpy, {\n        effects: [\n          AiCodeGenerationProvider.setAiCodeGenerationTeaserMode.of(\n              AiCodeGenerationProvider.AiCodeGenerationTeaserMode.DISMISSED),\n          Config.setAiAutoCompleteSuggestion.of(null),\n        ]\n      });\n      assert.deepEqual(\n          loadingSetter.set.lastCall.args[0],\n          PanelCommon.AiCodeGenerationTeaser.AiCodeGenerationTeaserDisplayState.TRIGGER);\n      provider.dispose();\n    });\n\n    describe('Triggers code generation on Ctrl+I', () => {\n      beforeEach(() => {\n        generateCodeStub.returns(Promise.resolve({samples: [], metadata: {rpcGlobalId: 1}}));\n      });\n\n      it('for inline comments', async () => {\n        const {editor, provider} = createEditorWithProvider('// Hello');\n        editor.dispatch({selection: {anchor: 8}});\n        await clock.tickAsync(0);\n\n        dispatchCtrlI(editor);\n        await clock.tickAsync(0);\n\n        sinon.assert.calledOnce(generateCodeStub);\n        assert.deepEqual(generateCodeStub.firstCall.args[0], 'Hello');\n        provider.dispose();\n      });\n\n      it('for block comments', async () => {\n        const {editor, provider} = createEditorWithProvider(`/**\n  * Create a helper function\n  * that adds two numbers\n  */`);\n        editor.dispatch({selection: {anchor: 63}});\n        await clock.tickAsync(0);\n\n        dispatchCtrlI(editor);\n        await clock.tickAsync(0);\n\n        sinon.assert.calledOnce(generateCodeStub);\n        assert.deepEqual(generateCodeStub.firstCall.args[0], 'Create a helper function\\nthat adds two numbers');\n        provider.dispose();\n      });\n    });\n\n    it('triggers loading state on Ctrl+I', async () => {\n      generateCodeStub.returns(Promise.resolve({samples: [], metadata: {rpcGlobalId: 1}}));\n      const {editor, provider} = createEditorWithProvider('// Hello');\n      const generationTeaser = PanelCommon.AiCodeGenerationTeaser.AiCodeGenerationTeaser.prototype;\n      sinon.stub(PanelCommon.AiCodeGenerationTeaser.AiCodeGenerationTeaser.prototype, 'isShowing').returns(true);\n      editor.dispatch({selection: {anchor: 8}});\n      await clock.tickAsync(0);\n\n      const event = new KeyboardEvent('keydown', {\n        key: 'i',\n        ctrlKey: Host.Platform.isMac() ? false : true,\n        metaKey: Host.Platform.isMac() ? true : false,\n      });\n      const loadingSetter = sinon.spy(generationTeaser, 'displayState', ['set']);\n      editor.editor.contentDOM.dispatchEvent(event);\n      await clock.tickAsync(0);\n\n      assert.deepEqual(\n          loadingSetter.set.firstCall.args[0],\n          PanelCommon.AiCodeGenerationTeaser.AiCodeGenerationTeaserDisplayState.LOADING);\n      provider.dispose();\n    });\n\n    it('aborts code generation request when Escape is pressed while loading', async () => {\n      generateCodeStub.returns(new Promise(() => {}));\n      const generationTeaser = PanelCommon.AiCodeGenerationTeaser.AiCodeGenerationTeaser.prototype;\n      const abortSpy = sinon.spy(AbortController.prototype, 'abort');\n      const {editor, provider} = createEditorWithProvider('// Hello');\n      editor.dispatch({selection: {anchor: 8}});\n      await clock.tickAsync(0);\n\n      dispatchCtrlI(editor);\n      // Explicitly set display state to LOADING, so that abort is called as expected\n      sinon.stub(generationTeaser, 'displayState')\n          .get(() => PanelCommon.AiCodeGenerationTeaser.AiCodeGenerationTeaserDisplayState.LOADING);\n      await clock.tickAsync(0);\n\n      sinon.assert.calledOnce(generateCodeStub);\n\n      editor.editor.contentDOM.dispatchEvent(new KeyboardEvent('keydown', {key: 'Escape'}));\n      await clock.tickAsync(0);\n\n      sinon.assert.calledOnce(abortSpy);\n      const suggestion = editor.editor.state.field(Config.aiAutoCompleteSuggestionState);\n      assert.notExists(suggestion);\n      provider.dispose();\n    });\n  });\n\n  it('aborts code generation request when user starts typing again', async () => {\n    generateCodeStub.returns(new Promise(() => {}));\n    const generationTeaser = PanelCommon.AiCodeGenerationTeaser.AiCodeGenerationTeaser.prototype;\n    const abortSpy = sinon.spy(AbortController.prototype, 'abort');\n    const {editor, provider} = createEditorWithProvider('// Hello');\n    editor.dispatch({selection: {anchor: 8}});\n    await clock.tickAsync(0);\n\n    dispatchCtrlI(editor);\n    // Explicitly set display state to LOADING, so that abort is called as expected\n    sinon.stub(generationTeaser, 'displayState')\n        .get(() => PanelCommon.AiCodeGenerationTeaser.AiCodeGenerationTeaserDisplayState.LOADING);\n    await clock.tickAsync(0);\n\n    sinon.assert.calledOnce(generateCodeStub);\n\n    editor.dispatch({changes: {from: 8, insert: '!'}});\n    await clock.tickAsync(0);\n\n    sinon.assert.calledOnce(abortSpy);\n    const suggestion = editor.editor.state.field(Config.aiAutoCompleteSuggestionState);\n    assert.notExists(suggestion);\n    provider.dispose();\n  });\n\n  describe('Dispatches', () => {\n    it('dispatches a suggestion to the editor and updates teaser state when AIDA returns suggestion', async () => {\n      const generationTeaser = PanelCommon.AiCodeGenerationTeaser.AiCodeGenerationTeaser.prototype;\n      const loadingSetter = sinon.spy(generationTeaser, 'displayState', ['set']);\n      generateCodeStub.returns(Promise.resolve({\n        samples: [{\n          generationString: '```javascript\\nconsole.log(\\'suggestion\\');\\n```',\n          sampleId: 1,\n          score: 1,\n        }],\n        metadata: {rpcGlobalId: 1},\n      }));\n      const {editor, provider} = createEditorWithProvider('// Hello');\n      editor.dispatch({selection: {anchor: 8}});\n      await clock.tickAsync(0);\n\n      dispatchCtrlI(editor);\n      await clock.tickAsync(0);\n\n      sinon.assert.calledOnce(generateCodeStub);\n      const suggestion = editor.editor.state.field(Config.aiAutoCompleteSuggestionState);\n      assert.exists(suggestion);\n      assert.strictEqual(suggestion.text, '\\nconsole.log(\\'suggestion\\');');\n      assert.strictEqual(suggestion.from, 8);\n      assert.strictEqual(suggestion.sampleId, 1);\n      assert.strictEqual(suggestion.rpcGlobalId, 1);\n      sinon.assert.calledWith(\n          loadingSetter.set, PanelCommon.AiCodeGenerationTeaser.AiCodeGenerationTeaserDisplayState.GENERATED);\n      provider.dispose();\n    });\n\n    it('does not dispatch suggestion or citation if recitation action is BLOCK', async () => {\n      generateCodeStub.returns(Promise.resolve({\n        samples: [{\n          generationString: 'suggestion',\n          sampleId: 1,\n          score: 1,\n          attributionMetadata: {\n            attributionAction: Host.AidaClient.RecitationAction.BLOCK,\n            citations: [{uri: 'https://www.example.com'}],\n          }\n        }],\n        metadata: {},\n      }));\n      const {editor, provider} = createEditorWithProvider('// Hello');\n      editor.dispatch({selection: {anchor: 8}});\n      await clock.tickAsync(0);\n\n      dispatchCtrlI(editor);\n      await clock.tickAsync(0);\n\n      sinon.assert.calledOnce(generateCodeStub);\n      const suggestion = editor.editor.state.field(Config.aiAutoCompleteSuggestionState);\n      assert.notExists(suggestion);\n      provider.dispose();\n    });\n  });\n\n  it('logs error and dismisses teaser when generateCode rejects', async () => {\n    generateCodeStub.rejects(new Error('AIDA Error'));\n    const actionTakenStub = sinon.stub(Host.userMetrics, 'actionTaken');\n    const {editor, provider} = createEditorWithProvider('// Hello');\n    const generationTeaser = PanelCommon.AiCodeGenerationTeaser.AiCodeGenerationTeaser.prototype;\n    sinon.stub(generationTeaser, 'isShowing').returns(true);\n    const loadingSetter = sinon.spy(generationTeaser, 'displayState', ['set']);\n    editor.dispatch({selection: {anchor: 8}});\n    await clock.tickAsync(0);\n\n    const event = new KeyboardEvent('keydown', {\n      key: 'i',\n      ctrlKey: Host.Platform.isMac() ? false : true,\n      metaKey: Host.Platform.isMac() ? true : false,\n    });\n    const dispatchSpy = sinon.spy(editor, 'dispatch');\n    editor.editor.contentDOM.dispatchEvent(event);\n    await clock.tickAsync(0);\n\n    sinon.assert.calledOnce(generateCodeStub);\n    sinon.assert.calledWith(actionTakenStub, Host.UserMetrics.Action.AiCodeGenerationError);\n    const suggestion = editor.editor.state.field(Config.aiAutoCompleteSuggestionState);\n    assert.notExists(suggestion);\n    sinon.assert.calledWith(\n        loadingSetter.set, PanelCommon.AiCodeGenerationTeaser.AiCodeGenerationTeaserDisplayState.TRIGGER);\n    sinon.assert.calledWith(dispatchSpy, {\n      effects: [\n        AiCodeGenerationProvider.setAiCodeGenerationTeaserMode.of(\n            AiCodeGenerationProvider.AiCodeGenerationTeaserMode.DISMISSED),\n        Config.setAiAutoCompleteSuggestion.of(null),\n      ]\n    });\n    provider.dispose();\n  });\n\n  it('shows the upgrade dialog if the user opts when code generation is not enabled', async () => {\n    // To simulate this, `ai-code-completion-enabled` setting is already set to true and then we are creating provider.\n    Common.Settings.Settings.instance().settingForTest('ai-code-generation-onboarding-completed').set(false);\n    const showDialogSpy = sinon.spy(PanelCommon.AiCodeGenerationUpgradeDialog, 'show');\n    const {editor, provider} = createEditorWithProvider('// Hello');\n    editor.dispatch({selection: {anchor: 8}});\n\n    await clock.tickAsync(0);\n    dispatchCtrlI(editor);\n    await clock.tickAsync(0);\n\n    assert.isFalse(Common.Settings.Settings.instance().settingForTest('ai-code-generation-onboarding-completed').get());\n    sinon.assert.called(showDialogSpy);\n    provider.dispose();\n  });\n\n  it('does not show the upgrade dialog if the user opts when code generation is already enabled', async () => {\n    // To simulate this, `ai-code-completion-enabled` setting is set to false.\n    // After creating the provider, we set the `ai-code-completion-enabled` setting to true.\n    Common.Settings.Settings.instance().settingForTest('ai-code-generation-onboarding-completed').set(false);\n    Common.Settings.Settings.instance().settingForTest('ai-code-completion-enabled').set(false);\n    const showDialogSpy = sinon.spy(PanelCommon.AiCodeGenerationUpgradeDialog, 'show');\n    const {editor, provider} = createEditorWithProvider('// Hello');\n    editor.dispatch({selection: {anchor: 8}});\n    await clock.tickAsync(0);\n\n    Common.Settings.Settings.instance().settingForTest('ai-code-completion-enabled').set(true);\n    await clock.tickAsync(0);\n    dispatchCtrlI(editor);\n    await clock.tickAsync(0);\n\n    assert.isTrue(Common.Settings.Settings.instance().settingForTest('ai-code-generation-onboarding-completed').get());\n    sinon.assert.notCalled(showDialogSpy);\n    sinon.assert.calledOnce(generateCodeStub);\n    provider.dispose();\n  });\n});\n"]}