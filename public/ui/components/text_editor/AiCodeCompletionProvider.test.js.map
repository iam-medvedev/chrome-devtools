{"version":3,"file":"AiCodeCompletionProvider.test.js","sourceRoot":"","sources":["../../../../../../../front_end/ui/components/text_editor/AiCodeCompletionProvider.test.ts"],"names":[],"mappings":"AAAA,sCAAsC;AACtC,yEAAyE;AACzE,6BAA6B;AAE7B,OAAO,KAAK,MAAM,MAAM,gCAAgC,CAAC;AACzD,OAAO,KAAK,IAAI,MAAM,4BAA4B,CAAC;AACnD,OAAO,KAAK,gBAAgB,MAAM,0DAA0D,CAAC;AAC7F,OAAO,EAAC,oBAAoB,EAAC,MAAM,gCAAgC,CAAC;AACpE,OAAO,EAAC,uBAAuB,EAAE,gBAAgB,EAAC,MAAM,wCAAwC,CAAC;AACjG,OAAO,KAAK,UAAU,MAAM,yDAAyD,CAAC;AAEtF,OAAO,EAAC,wBAAwB,EAAE,MAAM,EAAE,UAAU,EAAC,MAAM,kBAAkB,CAAC;AAE9E,SAAS,wBAAwB,CAAC,GAAW,EAAE,SAA0D;IACvG,iBAAiB,EAAE,EAAE;IACrB,gBAAgB,EAAE,GAAG,EAAE,GAAE,CAAC;IAC1B,iBAAiB,EAAE,GAAG,EAAE,GAAE,CAAC;IAC3B,oBAAoB,EAAE,GAAG,EAAE,GAAE,CAAC;IAC9B,kBAAkB,EAAE,GAAG,EAAE,GAAE,CAAC;IAC5B,kBAAkB,EAAE,GAAG,EAAE,GAAE,CAAC;IAC5B,KAAK,yEAAyD;CAC/D;IACC,MAAM,QAAQ,GAAG,wBAAwB,CAAC,wBAAwB,CAAC,cAAc,CAAC,MAAM,CAAC,CAAC;IAC1F,MAAM,MAAM,GAAG,IAAI,UAAU,CAAC,UAAU,CACpC,UAAU,CAAC,WAAW,CAAC,MAAM,CAAC;QAC5B,GAAG;QACH,UAAU,EAAE;YACV,QAAQ,CAAC,SAAS,EAAE;SACrB;KACF,CAAC,CACL,CAAC;IACF,oBAAoB,CAAC,MAAM,CAAC,CAAC;IAC7B,QAAQ,CAAC,iBAAiB,CAAC,MAAM,CAAC,CAAC;IACnC,OAAO,EAAC,MAAM,EAAE,QAAQ,EAAC,CAAC;AAC5B,CAAC;AAED,uBAAuB,CAAC,0BAA0B,EAAE,GAAG,EAAE;IACvD,IAAI,KAA4B,CAAC;IACjC,IAAI,4BAA6C,CAAC;IAElD,UAAU,CAAC,GAAG,EAAE;QACd,KAAK,GAAG,KAAK,CAAC,aAAa,EAAE,CAAC;QAC9B,gBAAgB,CAAC;YACf,wBAAwB,EAAE;gBACxB,OAAO,EAAE,IAAI;aACd;YACD,gBAAgB,EAAE;gBAChB,OAAO,EAAE,IAAI;gBACb,YAAY,EAAE,KAAK;gBACnB,YAAY,EAAE,KAAK;aACpB;SACF,CAAC,CAAC;QAEH,4BAA4B,GAAG,KAAK,CAAC,IAAI,CAAC,IAAI,CAAC,UAAU,CAAC,UAAU,EAAE,0BAA0B,CAAC,CAAC;IACpG,CAAC,CAAC,CAAC;IAEH,SAAS,CAAC,GAAG,EAAE;QACb,MAAM,CAAC,QAAQ,CAAC,QAAQ,CAAC,QAAQ,EAAE,CAAC,cAAc,CAAC,qCAAqC,CAAC,CAAC,GAAG,CAAC,KAAK,CAAC,CAAC;QACrG,MAAM,CAAC,QAAQ,CAAC,QAAQ,CAAC,QAAQ,EAAE,CAAC,cAAc,CAAC,4BAA4B,CAAC,CAAC,GAAG,CAAC,KAAK,CAAC,CAAC;QAC5F,KAAK,CAAC,OAAO,EAAE,CAAC;IAClB,CAAC,CAAC,CAAC;IAEH,EAAE,CAAC,yDAAyD,EAAE,GAAG,EAAE;QACjE,gBAAgB,CAAC;YACf,wBAAwB,EAAE;gBACxB,OAAO,EAAE,KAAK;aACf;SACF,CAAC,CAAC;QACH,MAAM,CAAC,MAAM,CAAC,GAAG,EAAE,CAAC,wBAAwB,CAAC,EAAE,CAAC,EAAE,4CAA4C,CAAC,CAAC;IAClG,CAAC,CAAC,CAAC;IAEH,QAAQ,CAAC,mBAAmB,EAAE,GAAG,EAAE;QACjC,UAAU,CAAC,GAAG,EAAE;YACd,4BAA4B,CAAC,QAAQ,qEAAmD,CAAC;QAC3F,CAAC,CAAC,CAAC;QAEH,EAAE,CAAC,8BAA8B,EAAE,KAAK,IAAI,EAAE;YAC5C,MAAM,EAAC,MAAM,EAAE,QAAQ,EAAC,GAAG,wBAAwB,CAAC,EAAE,CAAC,CAAC;YACxD,MAAM,CAAC,QAAQ,CAAC;gBACd,OAAO,EAAE,wBAAwB,CAAC,6BAA6B,CAAC,EAAE,CAC9D,wBAAwB,CAAC,0BAA0B,CAAC,EAAE,CAAC;aAC5D,CAAC,CAAC;YACH,MAAM,KAAK,CAAC,SAAS,CAAC,CAAC,CAAC,CAAC;YACzB,MAAM,CAAC,SAAS,CAAC,MAAM,CAAC,MAAM,CAAC,GAAG,CAAC,aAAa,CAAC,iBAAiB,CAAC,CAAC,CAAC;YACrE,QAAQ,CAAC,OAAO,EAAE,CAAC;QACrB,CAAC,CAAC,CAAC;QAEH,EAAE,CAAC,mEAAmE,EAAE,KAAK,IAAI,EAAE;YACjF,MAAM,EAAC,MAAM,EAAE,QAAQ,EAAC,GAAG,wBAAwB,CAAC,OAAO,CAAC,CAAC;YAC7D,MAAM,CAAC,QAAQ,CAAC;gBACd,OAAO,EAAE,wBAAwB,CAAC,6BAA6B,CAAC,EAAE,CAC9D,wBAAwB,CAAC,0BAA0B,CAAC,EAAE,CAAC;aAC5D,CAAC,CAAC;YACH,MAAM,CAAC,QAAQ,CAAC,EAAC,OAAO,EAAE,EAAC,IAAI,EAAE,CAAC,EAAE,MAAM,EAAE,GAAG,EAAC,EAAE,SAAS,EAAE,EAAC,MAAM,EAAE,CAAC,EAAC,EAAC,CAAC,CAAC;YAC3E,MAAM,KAAK,CAAC,SAAS,CACjB,gBAAgB,CAAC,gBAAgB,CAAC,gCAAgC;gBAClE,gBAAgB,CAAC,gBAAgB,CAAC,gCAAgC,GAAG,CAAC,CAAC,CAAC;YAC5E,MAAM,CAAC,SAAS,CAAC,MAAM,CAAC,MAAM,CAAC,GAAG,CAAC,aAAa,CAAC,iBAAiB,CAAC,CAAC,CAAC;YACrE,QAAQ,CAAC,OAAO,EAAE,CAAC;QACrB,CAAC,CAAC,CAAC;QAEH,EAAE,CAAC,uEAAuE,EAAE,KAAK,IAAI,EAAE;YACrF,MAAM,EAAC,MAAM,EAAE,QAAQ,EAAC,GAAG,wBAAwB,CAAC,OAAO,CAAC,CAAC;YAC7D,MAAM,CAAC,QAAQ,CAAC;gBACd,OAAO,EAAE,wBAAwB,CAAC,6BAA6B,CAAC,EAAE,CAC9D,wBAAwB,CAAC,0BAA0B,CAAC,EAAE,CAAC;aAC5D,CAAC,CAAC;YACH,MAAM,CAAC,QAAQ,CAAC,EAAC,OAAO,EAAE,EAAC,IAAI,EAAE,CAAC,EAAE,MAAM,EAAE,GAAG,EAAC,EAAE,SAAS,EAAE,EAAC,MAAM,EAAE,CAAC,EAAC,EAAC,CAAC,CAAC;YAC3E,MAAM,KAAK,CAAC,SAAS,CACjB,gBAAgB,CAAC,gBAAgB,CAAC,gCAAgC;gBAClE,gBAAgB,CAAC,gBAAgB,CAAC,gCAAgC,GAAG,CAAC,CAAC,CAAC;YAC5E,MAAM,CAAC,SAAS,CAAC,MAAM,CAAC,MAAM,CAAC,GAAG,CAAC,aAAa,CAAC,iBAAiB,CAAC,CAAC,CAAC;YAErE,MAAM,CAAC,QAAQ,CAAC,EAAC,OAAO,EAAE,EAAC,IAAI,EAAE,CAAC,EAAE,MAAM,EAAE,GAAG,EAAC,EAAE,SAAS,EAAE,EAAC,MAAM,EAAE,CAAC,EAAC,EAAC,CAAC,CAAC;YAC3E,MAAM,KAAK,CAAC,SAAS,CACjB,gBAAgB,CAAC,gBAAgB,CAAC,gCAAgC;gBAClE,gBAAgB,CAAC,gBAAgB,CAAC,gCAAgC,GAAG,CAAC,CAAC,CAAC;YAC5E,MAAM,CAAC,MAAM,CAAC,MAAM,CAAC,MAAM,CAAC,GAAG,CAAC,aAAa,CAAC,iBAAiB,CAAC,CAAC,CAAC;YAClE,QAAQ,CAAC,OAAO,EAAE,CAAC;QACrB,CAAC,CAAC,CAAC;QAEH,EAAE,CAAC,mDAAmD,EAAE,KAAK,IAAI,EAAE;YACjE,MAAM,EAAC,MAAM,EAAE,QAAQ,EAAC,GAAG,wBAAwB,CAAC,OAAO,CAAC,CAAC;YAC7D,MAAM,CAAC,QAAQ,CAAC;gBACd,OAAO,EAAE,wBAAwB,CAAC,6BAA6B,CAAC,EAAE,CAC9D,wBAAwB,CAAC,0BAA0B,CAAC,EAAE,CAAC;aAC5D,CAAC,CAAC;YACH,MAAM,CAAC,QAAQ,CAAC,EAAC,OAAO,EAAE,EAAC,IAAI,EAAE,CAAC,EAAE,MAAM,EAAE,GAAG,EAAC,EAAE,SAAS,EAAE,EAAC,MAAM,EAAE,CAAC,EAAC,EAAC,CAAC,CAAC;YAC3E,MAAM,KAAK,CAAC,SAAS,CACjB,gBAAgB,CAAC,gBAAgB,CAAC,gCAAgC;gBAClE,gBAAgB,CAAC,gBAAgB,CAAC,gCAAgC,GAAG,CAAC,CAAC,CAAC;YAC5E,MAAM,CAAC,SAAS,CAAC,MAAM,CAAC,MAAM,CAAC,GAAG,CAAC,aAAa,CAAC,iBAAiB,CAAC,CAAC,CAAC;YAErE,MAAM,CAAC,QAAQ,CAAC,EAAC,SAAS,EAAE,EAAC,MAAM,EAAE,CAAC,EAAE,IAAI,EAAE,CAAC,EAAC,EAAC,CAAC,CAAC;YACnD,MAAM,CAAC,MAAM,CAAC,MAAM,CAAC,MAAM,CAAC,GAAG,CAAC,aAAa,CAAC,iBAAiB,CAAC,CAAC,CAAC;YAClE,QAAQ,CAAC,OAAO,EAAE,CAAC;QACrB,CAAC,CAAC,CAAC;QAEH,EAAE,CAAC,+BAA+B,EAAE,KAAK,IAAI,EAAE;YAC7C,MAAM,EAAC,MAAM,EAAE,QAAQ,EAAC,GAAG,wBAAwB,CAAC,EAAE,CAAC,CAAC;YACxD,MAAM,CAAC,QAAQ,CAAC;gBACd,OAAO,EAAE,wBAAwB,CAAC,6BAA6B,CAAC,EAAE,CAC9D,wBAAwB,CAAC,0BAA0B,CAAC,EAAE,CAAC;aAC5D,CAAC,CAAC;YACH,MAAM,KAAK,CAAC,SAAS,CAAC,CAAC,CAAC,CAAC;YAEzB,MAAM,CAAC,SAAS,CAAC,MAAM,CAAC,MAAM,CAAC,GAAG,CAAC,aAAa,CAAC,iBAAiB,CAAC,CAAC,CAAC;YAErE,MAAM,CAAC,QAAQ,CAAC;gBACd,OAAO,EAAE,wBAAwB,CAAC,6BAA6B,CAAC,EAAE,CAC9D,wBAAwB,CAAC,0BAA0B,CAAC,GAAG,CAAC;aAC7D,CAAC,CAAC;YACH,MAAM,KAAK,CAAC,SAAS,CAAC,CAAC,CAAC,CAAC;YAEzB,MAAM,CAAC,MAAM,CAAC,MAAM,CAAC,aAAa,CAAC,iBAAiB,CAAC,CAAC,CAAC;YACvD,QAAQ,CAAC,OAAO,EAAE,CAAC;QACrB,CAAC,CAAC,CAAC;QAEH,EAAE,CAAC,kEAAkE,EAAE,KAAK,IAAI,EAAE;YAChF,MAAM,EAAC,MAAM,EAAE,QAAQ,EAAC,GAAG,wBAAwB,CAAC,EAAE,CAAC,CAAC;YACxD,MAAM,CAAC,QAAQ,CAAC;gBACd,OAAO,EAAE,wBAAwB,CAAC,6BAA6B,CAAC,EAAE,CAC9D,wBAAwB,CAAC,0BAA0B,CAAC,kBAAkB,CAAC;aAC5E,CAAC,CAAC;YACH,MAAM,KAAK,CAAC,SAAS,CAAC,CAAC,CAAC,CAAC;YACzB,MAAM,CAAC,SAAS,CAAC,MAAM,CAAC,MAAM,CAAC,GAAG,CAAC,aAAa,CAAC,iBAAiB,CAAC,CAAC,CAAC;YACrE,QAAQ,CAAC,OAAO,EAAE,CAAC;QACrB,CAAC,CAAC,CAAC;QAEH,EAAE,CAAC,sEAAsE,EAAE,KAAK,IAAI,EAAE;YACpF,MAAM,EAAC,MAAM,EAAE,QAAQ,EAAC,GAAG,wBAAwB,CAAC,EAAE,CAAC,CAAC;YACxD,MAAM,CAAC,QAAQ,CAAC;gBACd,OAAO,EAAE,wBAAwB,CAAC,6BAA6B,CAAC,EAAE,CAC9D,wBAAwB,CAAC,0BAA0B,CAAC,kBAAkB,CAAC;aAC5E,CAAC,CAAC;YACH,MAAM,KAAK,CAAC,SAAS,CAAC,CAAC,CAAC,CAAC;YAEzB,MAAM,CAAC,SAAS,CAAC,MAAM,CAAC,MAAM,CAAC,GAAG,CAAC,aAAa,CAAC,iBAAiB,CAAC,CAAC,CAAC;YAErE,MAAM,CAAC,QAAQ,CAAC,EAAC,OAAO,EAAE,EAAC,IAAI,EAAE,CAAC,EAAE,MAAM,EAAE,GAAG,EAAC,EAAC,CAAC,CAAC;YAEnD,MAAM,KAAK,CAAC,SAAS,CAAC,CAAC,CAAC,CAAC;YACzB,MAAM,CAAC,MAAM,CAAC,MAAM,CAAC,aAAa,CAAC,iBAAiB,CAAC,CAAC,CAAC;YACvD,QAAQ,CAAC,OAAO,EAAE,CAAC;QACrB,CAAC,CAAC,CAAC;IACL,CAAC,CAAC,CAAC;IAEH,QAAQ,CAAC,0BAA0B,EAAE,GAAG,EAAE;QACxC,EAAE,CAAC,yCAAyC,EAAE,KAAK,IAAI,EAAE;YACvD,4BAA4B,CAAC,QAAQ,qEAAmD,CAAC;YACzF,MAAM,CAAC,QAAQ,CAAC,QAAQ,CAAC,QAAQ,EAAE,CAAC,cAAc,CAAC,4BAA4B,CAAC,CAAC,GAAG,CAAC,IAAI,CAAC,CAAC;YAC3F,MAAM,EAAC,MAAM,EAAE,QAAQ,EAAC,GAAG,wBAAwB,CAAC,EAAE,CAAC,CAAC;YACxD,MAAM,gBAAgB,GAAG,KAAK,CAAC,IAAI,CAAC,gBAAgB,CAAC,gBAAgB,CAAC,gBAAgB,CAAC,SAAS,EAAE,cAAc,CAAC,CAAC;YAClH,MAAM,KAAK,CAAC,SAAS,CAAC,CAAC,CAAC,CAAC,CAAE,gDAAgD;YAE3E,MAAM,CAAC,QAAQ,CAAC,EAAC,OAAO,EAAE,EAAC,IAAI,EAAE,CAAC,EAAE,MAAM,EAAE,OAAO,EAAC,EAAE,SAAS,EAAE,EAAC,MAAM,EAAE,CAAC,EAAC,EAAC,CAAC,CAAC;YAC/E,MAAM,KAAK,CAAC,SAAS,CAAC,gBAAgB,CAAC,gBAAgB,CAAC,gCAAgC,CAAC,CAAC;YAE1F,KAAK,CAAC,MAAM,CAAC,MAAM,CAAC,gBAAgB,CAAC,CAAC;YACtC,MAAM,CAAC,SAAS,CAAC,gBAAgB,CAAC,SAAS,CAAC,IAAI,EAAE,CAAC,OAAO,EAAE,EAAE,EAAE,CAAC,EAAE,SAAS,EAAE,SAAS,CAAC,CAAC,CAAC;YAC1F,QAAQ,CAAC,OAAO,EAAE,CAAC;QACrB,CAAC,CAAC,CAAC;QAEH,EAAE,CAAC,sDAAsD,EAAE,KAAK,IAAI,EAAE;YACpE,4BAA4B,CAAC,QAAQ,mFAA0D,CAAC;YAChG,MAAM,gBAAgB,GAAG,KAAK,CAAC,IAAI,CAAC,gBAAgB,CAAC,gBAAgB,CAAC,gBAAgB,CAAC,SAAS,EAAE,cAAc,CAAC,CAAC;YAClH,MAAM,CAAC,QAAQ,CAAC,QAAQ,CAAC,QAAQ,EAAE,CAAC,cAAc,CAAC,4BAA4B,CAAC,CAAC,GAAG,CAAC,IAAI,CAAC,CAAC;YAC3F,MAAM,EAAC,MAAM,EAAE,QAAQ,EAAC,GAAG,wBAAwB,CAAC,EAAE,CAAC,CAAC;YACxD,MAAM,KAAK,CAAC,SAAS,CAAC,CAAC,CAAC,CAAC,CAAE,gDAAgD;YAE3E,MAAM,CAAC,QAAQ,CAAC,EAAC,OAAO,EAAE,EAAC,IAAI,EAAE,CAAC,EAAE,MAAM,EAAE,OAAO,EAAC,EAAE,SAAS,EAAE,EAAC,MAAM,EAAE,CAAC,EAAC,EAAC,CAAC,CAAC;YAC/E,MAAM,KAAK,CAAC,SAAS,CAAC,gBAAgB,CAAC,gBAAgB,CAAC,gCAAgC,CAAC,CAAC;YAE1F,KAAK,CAAC,MAAM,CAAC,SAAS,CAAC,gBAAgB,CAAC,CAAC;YAEzC,4BAA4B,CAAC,QAAQ,qEAAmD,CAAC;YACzF,MAAM,IAAI,CAAC,UAAU,CAAC,iBAAiB,CAAC,QAAQ,EAAE,CAAC,wBAAwB,kFACtB,CAAC;YACtD,MAAM,KAAK,CAAC,SAAS,CAAC,CAAC,CAAC,CAAC;YAEzB,MAAM,CAAC,QAAQ,CAAC,EAAC,OAAO,EAAE,EAAC,IAAI,EAAE,CAAC,EAAE,MAAM,EAAE,KAAK,EAAC,EAAE,SAAS,EAAE,EAAC,MAAM,EAAE,CAAC,EAAC,EAAC,CAAC,CAAC;YAC7E,MAAM,KAAK,CAAC,SAAS,CAAC,gBAAgB,CAAC,gBAAgB,CAAC,gCAAgC,CAAC,CAAC;YAE1F,KAAK,CAAC,MAAM,CAAC,UAAU,CAAC,gBAAgB,CAAC,CAAC;YAC1C,MAAM,CAAC,SAAS,CAAC,gBAAgB,CAAC,SAAS,CAAC,IAAI,EAAE,CAAC,UAAU,EAAE,EAAE,EAAE,CAAC,EAAE,SAAS,EAAE,SAAS,CAAC,CAAC,CAAC;YAC7F,QAAQ,CAAC,OAAO,EAAE,CAAC;QACrB,CAAC,CAAC,CAAC;QAEH,EAAE,CAAC,gEAAgE,EAAE,KAAK,IAAI,EAAE;YAC9E,4BAA4B,CAAC,QAAQ,qEAAmD,CAAC;YACzF,MAAM,gBAAgB,GAAG,KAAK,CAAC,IAAI,CAAC,gBAAgB,CAAC,gBAAgB,CAAC,gBAAgB,CAAC,SAAS,EAAE,cAAc,CAAC,CAAC;YAClH,MAAM,CAAC,QAAQ,CAAC,QAAQ,CAAC,QAAQ,EAAE,CAAC,cAAc,CAAC,4BAA4B,CAAC,CAAC,GAAG,CAAC,IAAI,CAAC,CAAC;YAC3F,MAAM,EAAC,MAAM,EAAE,QAAQ,EAAC,GAAG,wBAAwB,CAAC,EAAE,CAAC,CAAC;YACxD,MAAM,KAAK,CAAC,SAAS,CAAC,CAAC,CAAC,CAAC,CAAE,gDAAgD;YAE3E,MAAM,CAAC,QAAQ,CAAC,EAAC,OAAO,EAAE,EAAC,IAAI,EAAE,CAAC,EAAE,MAAM,EAAE,OAAO,EAAC,EAAE,SAAS,EAAE,EAAC,MAAM,EAAE,CAAC,EAAC,EAAC,CAAC,CAAC;YAC/E,MAAM,KAAK,CAAC,SAAS,CAAC,gBAAgB,CAAC,gBAAgB,CAAC,gCAAgC,CAAC,CAAC;YAE1F,KAAK,CAAC,MAAM,CAAC,UAAU,CAAC,gBAAgB,CAAC,CAAC;YAE1C,4BAA4B,CAAC,QAAQ,mFAA0D,CAAC;YAChG,MAAM,IAAI,CAAC,UAAU,CAAC,iBAAiB,CAAC,QAAQ,EAAE,CAAC,wBAAwB,kFACtB,CAAC;YACtD,MAAM,KAAK,CAAC,SAAS,CAAC,CAAC,CAAC,CAAC;YAEzB,MAAM,CAAC,QAAQ,CAAC,EAAC,OAAO,EAAE,EAAC,IAAI,EAAE,CAAC,EAAE,MAAM,EAAE,KAAK,EAAC,EAAE,SAAS,EAAE,EAAC,MAAM,EAAE,CAAC,EAAC,EAAC,CAAC,CAAC;YAC7E,MAAM,KAAK,CAAC,SAAS,CAAC,gBAAgB,CAAC,gBAAgB,CAAC,gCAAgC,CAAC,CAAC;YAE1F,KAAK,CAAC,MAAM,CAAC,UAAU,CAAC,gBAAgB,CAAC,CAAC;YAC1C,MAAM,CAAC,SAAS,CAAC,gBAAgB,CAAC,SAAS,CAAC,IAAI,EAAE,CAAC,OAAO,EAAE,EAAE,EAAE,CAAC,EAAE,SAAS,EAAE,SAAS,CAAC,CAAC,CAAC;YAC1F,QAAQ,CAAC,OAAO,EAAE,CAAC;QACrB,CAAC,CAAC,CAAC;QAEH,EAAE,CAAC,wCAAwC,EAAE,KAAK,IAAI,EAAE;YACtD,4BAA4B,CAAC,QAAQ,qEAAmD,CAAC;YACzF,MAAM,gBAAgB,GAAG,KAAK,CAAC,IAAI,CAAC,gBAAgB,CAAC,gBAAgB,CAAC,gBAAgB,CAAC,SAAS,EAAE,cAAc,CAAC,CAAC;YAClH,MAAM,CAAC,QAAQ,CAAC,QAAQ,CAAC,QAAQ,EAAE,CAAC,cAAc,CAAC,4BAA4B,CAAC,CAAC,GAAG,CAAC,IAAI,CAAC,CAAC;YAC3F,MAAM,EAAC,MAAM,EAAE,QAAQ,EAAC,GAAG,wBAAwB,CAAC,EAAE,CAAC,CAAC;YACxD,MAAM,KAAK,CAAC,SAAS,CAAC,CAAC,CAAC,CAAC,CAAE,gDAAgD;YAE3E,MAAM,CAAC,QAAQ,CAAC,EAAC,OAAO,EAAE,EAAC,IAAI,EAAE,CAAC,EAAE,MAAM,EAAE,GAAG,EAAC,EAAE,SAAS,EAAE,EAAC,MAAM,EAAE,CAAC,EAAC,EAAC,CAAC,CAAC;YAC3E,MAAM,CAAC,QAAQ,CAAC,EAAC,OAAO,EAAE,EAAC,IAAI,EAAE,CAAC,EAAE,MAAM,EAAE,GAAG,EAAC,EAAE,SAAS,EAAE,EAAC,MAAM,EAAE,CAAC,EAAC,EAAC,CAAC,CAAC;YAC3E,MAAM,CAAC,QAAQ,CAAC,EAAC,OAAO,EAAE,EAAC,IAAI,EAAE,CAAC,EAAE,MAAM,EAAE,GAAG,EAAC,EAAE,SAAS,EAAE,EAAC,MAAM,EAAE,CAAC,EAAC,EAAC,CAAC,CAAC;YAC3E,MAAM,KAAK,CAAC,SAAS,CAAC,gBAAgB,CAAC,gBAAgB,CAAC,gCAAgC,CAAC,CAAC;YAE1F,KAAK,CAAC,MAAM,CAAC,UAAU,CAAC,gBAAgB,CAAC,CAAC;YAC1C,MAAM,CAAC,SAAS,CAAC,gBAAgB,CAAC,SAAS,CAAC,IAAI,EAAE,CAAC,KAAK,EAAE,EAAE,EAAE,CAAC,EAAE,SAAS,EAAE,SAAS,CAAC,CAAC,CAAC;YACxF,QAAQ,CAAC,OAAO,EAAE,CAAC;QACrB,CAAC,CAAC,CAAC;IACL,CAAC,CAAC,CAAC;IAEH,QAAQ,CAAC,YAAY,EAAE,GAAG,EAAE;QAC1B,UAAU,CAAC,GAAG,EAAE;YACd,4BAA4B,CAAC,QAAQ,qEAAmD,CAAC;YACzF,MAAM,CAAC,QAAQ,CAAC,QAAQ,CAAC,QAAQ,EAAE,CAAC,cAAc,CAAC,4BAA4B,CAAC,CAAC,GAAG,CAAC,IAAI,CAAC,CAAC;QAC7F,CAAC,CAAC,CAAC;QAEH,EAAE,CAAC,6DAA6D,EAAE,KAAK,IAAI,EAAE;YAC3E,MAAM,gBAAgB,GAAG,KAAK,CAAC,IAAI,CAAC,gBAAgB,CAAC,gBAAgB,CAAC,gBAAgB,CAAC,SAAS,EAAE,cAAc,CAAC;iBACnF,OAAO,CAAC,OAAO,CAAC,OAAO,CAAC;gBACvB,QAAQ,EAAE;oBACR,gBAAgB,EAAE,CAAC;4BACjB,gBAAgB,EAAE,YAAY;4BAC9B,QAAQ,EAAE,CAAC;4BACX,KAAK,EAAE,CAAC;yBACT,CAAC;oBACF,QAAQ,EAAE,EAAC,WAAW,EAAE,CAAC,EAAC;iBAC3B;gBACD,SAAS,EAAE,KAAK;aACjB,CAAC,CAAC,CAAC;YACjC,MAAM,EAAC,MAAM,EAAE,QAAQ,EAAC,GAAG,wBAAwB,CAAC,EAAE,CAAC,CAAC;YACxD,MAAM,KAAK,CAAC,SAAS,CAAC,CAAC,CAAC,CAAC,CAAE,gDAAgD;YAE3E,MAAM,CAAC,QAAQ,CAAC,EAAC,OAAO,EAAE,EAAC,IAAI,EAAE,CAAC,EAAE,MAAM,EAAE,QAAQ,EAAC,EAAE,SAAS,EAAE,EAAC,MAAM,EAAE,CAAC,EAAC,EAAC,CAAC,CAAC;YAEhF,MAAM,KAAK,CAAC,SAAS,CAAC,gBAAgB,CAAC,gBAAgB,CAAC,gCAAgC,GAAG,CAAC,CAAC,CAAC;YAC9F,KAAK,CAAC,MAAM,CAAC,UAAU,CAAC,gBAAgB,CAAC,CAAC;YAC1C,MAAM,WAAW,GAAG,KAAK,CAAC,GAAG,CAAC,MAAM,EAAE,UAAU,CAAC,CAAC;YAClD,MAAM,KAAK,CAAC,SAAS,CAAC,gBAAgB,CAAC,gBAAgB,CAAC,gCAAgC,GAAG,CAAC,CAAC,CAAC;YAC9F,MAAM,UAAU,GAAG,MAAM,CAAC,MAAM,CAAC,KAAK,CAAC,KAAK,CAAC,MAAM,CAAC,6BAA6B,CAAC,CAAC;YACnF,MAAM,CAAC,WAAW,CAAC,UAAU,EAAE,IAAI,EAAE,YAAY,CAAC,CAAC;YACnD,MAAM,CAAC,WAAW,CAAC,UAAU,EAAE,IAAI,EAAE,CAAC,CAAC,CAAC;YACxC,MAAM,CAAC,WAAW,CAAC,UAAU,EAAE,QAAQ,EAAE,CAAC,CAAC,CAAC;YAC5C,MAAM,CAAC,WAAW,CAAC,UAAU,EAAE,WAAW,EAAE,CAAC,CAAC,CAAC;YAC/C,KAAK,CAAC,MAAM,CAAC,UAAU,CAAC,WAAW,CAAC,CAAC;YACrC,QAAQ,CAAC,OAAO,EAAE,CAAC;QACrB,CAAC,CAAC,CAAC;QAEH,EAAE,CAAC,wEAAwE,EAAE,KAAK,IAAI,EAAE;YACtF,MAAM,gBAAgB,GAAG,KAAK,CAAC,IAAI,CAAC,gBAAgB,CAAC,gBAAgB,CAAC,gBAAgB,CAAC,SAAS,EAAE,cAAc,CAAC;iBACnF,OAAO,CAAC,OAAO,CAAC,OAAO,CAAC;gBACvB,QAAQ,EAAE;oBACR,gBAAgB,EAAE,CAAC;4BACjB,gBAAgB,EAAE,gBAAgB;4BAClC,QAAQ,EAAE,CAAC;4BACX,KAAK,EAAE,CAAC;yBACT,CAAC;oBACF,QAAQ,EAAE,EAAC,WAAW,EAAE,CAAC,EAAC;iBAC3B;gBACD,SAAS,EAAE,KAAK;aACjB,CAAC,CAAC,CAAC;YACjC,MAAM,EAAC,MAAM,EAAE,QAAQ,EAAC,GAAG,wBAAwB,CAAC,EAAE,CAAC,CAAC;YACxD,MAAM,KAAK,CAAC,SAAS,CAAC,CAAC,CAAC,CAAC,CAAE,gDAAgD;YAE3E,MAAM,CAAC,QAAQ,CAAC,EAAC,OAAO,EAAE,EAAC,IAAI,EAAE,CAAC,EAAE,MAAM,EAAE,oBAAoB,EAAC,EAAE,SAAS,EAAE,EAAC,MAAM,EAAE,EAAE,EAAC,EAAC,CAAC,CAAC;YAE7F,MAAM,KAAK,CAAC,SAAS,CAAC,gBAAgB,CAAC,gBAAgB,CAAC,gCAAgC,GAAG,CAAC,CAAC,CAAC;YAC9F,KAAK,CAAC,MAAM,CAAC,UAAU,CAAC,gBAAgB,CAAC,CAAC;YAC1C,MAAM,WAAW,GAAG,KAAK,CAAC,GAAG,CAAC,MAAM,EAAE,UAAU,CAAC,CAAC;YAClD,MAAM,KAAK,CAAC,SAAS,CAAC,gBAAgB,CAAC,gBAAgB,CAAC,gCAAgC,GAAG,CAAC,CAAC,CAAC;YAC9F,MAAM,UAAU,GAAG,MAAM,CAAC,MAAM,CAAC,KAAK,CAAC,KAAK,CAAC,MAAM,CAAC,6BAA6B,CAAC,CAAC;YACnF,MAAM,CAAC,WAAW,CAAC,UAAU,EAAE,IAAI,EAAE,aAAa,CAAC,CAAC;YACpD,MAAM,CAAC,WAAW,CAAC,UAAU,EAAE,IAAI,EAAE,EAAE,CAAC,CAAC;YACzC,MAAM,CAAC,WAAW,CAAC,UAAU,EAAE,QAAQ,EAAE,CAAC,CAAC,CAAC;YAC5C,MAAM,CAAC,WAAW,CAAC,UAAU,EAAE,WAAW,EAAE,CAAC,CAAC,CAAC;YAC/C,KAAK,CAAC,MAAM,CAAC,UAAU,CAAC,WAAW,CAAC,CAAC;YACrC,QAAQ,CAAC,OAAO,EAAE,CAAC;QACrB,CAAC,CAAC,CAAC;QAEH,EAAE,CAAC,wEAAwE,EAAE,KAAK,IAAI,EAAE;YACtF,MAAM,gBAAgB,GAAG,KAAK,CAAC,IAAI,CAAC,gBAAgB,CAAC,gBAAgB,CAAC,gBAAgB,CAAC,SAAS,EAAE,cAAc,CAAC;iBACnF,OAAO,CAAC,OAAO,CAAC,OAAO,CAAC;gBACvB,QAAQ,EAAE;oBACR,gBAAgB,EAAE,CAAC;4BACjB,gBAAgB,EAAE,YAAY;4BAC9B,QAAQ,EAAE,CAAC;4BACX,KAAK,EAAE,CAAC;4BACR,mBAAmB,EAAE;gCACnB,iBAAiB,EAAE,IAAI,CAAC,UAAU,CAAC,gBAAgB,CAAC,KAAK;gCACzD,SAAS,EAAE,CAAC,EAAC,GAAG,EAAE,yBAAyB,EAAC,CAAC;6BAC9C;yBACF,CAAC;oBACF,QAAQ,EAAE,EAAE;iBACb;gBACD,SAAS,EAAE,KAAK;aACjB,CAAC,CAAC,CAAC;YACjC,MAAM,EAAC,MAAM,EAAE,QAAQ,EAAC,GAAG,wBAAwB,CAAC,EAAE,CAAC,CAAC;YACxD,MAAM,KAAK,CAAC,SAAS,CAAC,CAAC,CAAC,CAAC,CAAE,gDAAgD;YAE3E,MAAM,CAAC,QAAQ,CAAC,EAAC,OAAO,EAAE,EAAC,IAAI,EAAE,CAAC,EAAE,MAAM,EAAE,QAAQ,EAAC,EAAE,SAAS,EAAE,EAAC,MAAM,EAAE,CAAC,EAAC,EAAC,CAAC,CAAC;YAEhF,MAAM,KAAK,CAAC,SAAS,CAAC,gBAAgB,CAAC,gBAAgB,CAAC,gCAAgC,GAAG,CAAC,CAAC,CAAC;YAC9F,KAAK,CAAC,MAAM,CAAC,UAAU,CAAC,gBAAgB,CAAC,CAAC;YAC1C,MAAM,WAAW,GAAG,KAAK,CAAC,GAAG,CAAC,MAAM,EAAE,UAAU,CAAC,CAAC;YAClD,MAAM,KAAK,CAAC,SAAS,CAAC,gBAAgB,CAAC,gBAAgB,CAAC,gCAAgC,GAAG,CAAC,CAAC,CAAC;YAC9F,KAAK,CAAC,MAAM,CAAC,SAAS,CAAC,WAAW,CAAC,CAAC;YACpC,QAAQ,CAAC,OAAO,EAAE,CAAC;QACrB,CAAC,CAAC,CAAC;QAEH,EAAE,CAAC,wFAAwF,EAAE,KAAK,IAAI,EAAE;YACtG,MAAM,gBAAgB,GAAG,KAAK,CAAC,IAAI,CAAC,gBAAgB,CAAC,gBAAgB,CAAC,gBAAgB,CAAC,SAAS,EAAE,cAAc,CAAC;iBACnF,OAAO,CAAC,OAAO,CAAC,OAAO,CAAC;gBACvB,QAAQ,EAAE;oBACR,gBAAgB,EAAE,CAAC;4BACjB,gBAAgB,EAAE,YAAY;4BAC9B,QAAQ,EAAE,CAAC;4BACX,KAAK,EAAE,CAAC;yBACT,CAAC;oBACF,QAAQ,EAAE,EAAE;iBACb;gBACD,SAAS,EAAE,KAAK;aACjB,CAAC,CAAC,CAAC;YACjC,MAAM,EAAC,MAAM,EAAE,QAAQ,EAAC,GAAG,wBAAwB,CAAC,EAAE,CAAC,CAAC;YACxD,MAAM,KAAK,CAAC,SAAS,CAAC,CAAC,CAAC,CAAC,CAAE,gDAAgD;YAE3E,MAAM,CAAC,QAAQ,CAAC,EAAC,OAAO,EAAE,EAAC,IAAI,EAAE,CAAC,EAAE,MAAM,EAAE,mBAAmB,EAAC,EAAE,SAAS,EAAE,EAAC,MAAM,EAAE,EAAE,EAAC,EAAC,CAAC,CAAC;YAE5F,MAAM,KAAK,CAAC,SAAS,CAAC,gBAAgB,CAAC,gBAAgB,CAAC,gCAAgC,GAAG,CAAC,CAAC,CAAC;YAC9F,KAAK,CAAC,MAAM,CAAC,UAAU,CAAC,gBAAgB,CAAC,CAAC;YAC1C,MAAM,WAAW,GAAG,KAAK,CAAC,GAAG,CAAC,MAAM,EAAE,UAAU,CAAC,CAAC;YAClD,MAAM,KAAK,CAAC,SAAS,CAAC,gBAAgB,CAAC,gBAAgB,CAAC,gCAAgC,GAAG,CAAC,CAAC,CAAC;YAC9F,KAAK,CAAC,MAAM,CAAC,SAAS,CAAC,WAAW,CAAC,CAAC;YACpC,QAAQ,CAAC,OAAO,EAAE,CAAC;QACrB,CAAC,CAAC,CAAC;QAEH,EAAE,CAAC,8CAA8C,EAAE,KAAK,IAAI,EAAE;YAC5D,MAAM,gBAAgB,GAAG,KAAK,CAAC,IAAI,CAAC,gBAAgB,CAAC,gBAAgB,CAAC,gBAAgB,CAAC,SAAS,EAAE,cAAc,CAAC;iBACnF,OAAO,CAAC,OAAO,CAAC,OAAO,CAAC;gBACvB,QAAQ,EAAE;oBACR,gBAAgB,EAAE,CAAC;4BACjB,gBAAgB,EAAE,YAAY;4BAC9B,QAAQ,EAAE,CAAC;4BACX,KAAK,EAAE,CAAC;yBACT,CAAC;oBACF,QAAQ,EAAE,EAAE;iBACb;gBACD,SAAS,EAAE,KAAK;aACjB,CAAC,CAAC,CAAC;YACjC,MAAM,EAAC,MAAM,EAAE,QAAQ,EAAC,GAAG,wBAAwB,CAAC,EAAE,CAAC,CAAC;YACxD,MAAM,KAAK,CAAC,SAAS,CAAC,CAAC,CAAC,CAAC,CAAE,gDAAgD;YAE3E,MAAM,CAAC,QAAQ,CAAC,EAAC,OAAO,EAAE,EAAC,IAAI,EAAE,CAAC,EAAE,MAAM,EAAE,QAAQ,EAAC,EAAE,SAAS,EAAE,EAAC,MAAM,EAAE,CAAC,EAAC,EAAC,CAAC,CAAC;YAEhF,MAAM,KAAK,CAAC,SAAS,CAAC,gBAAgB,CAAC,gBAAgB,CAAC,gCAAgC,GAAG,CAAC,CAAC,CAAC;YAC9F,KAAK,CAAC,MAAM,CAAC,UAAU,CAAC,gBAAgB,CAAC,CAAC;YAC1C,MAAM,CAAC,MAAM,CAAC,QAAQ,CAAC;gBACrB,SAAS,EAAE,UAAU,CAAC,eAAe,CAAC,MAAM,CAAC,CAAC,CAAC;aAChD,CAAC,CAAC;YACH,MAAM,WAAW,GAAG,KAAK,CAAC,GAAG,CAAC,MAAM,EAAE,UAAU,CAAC,CAAC;YAClD,MAAM,KAAK,CAAC,SAAS,CAAC,gBAAgB,CAAC,gBAAgB,CAAC,gCAAgC,GAAG,CAAC,CAAC,CAAC;YAC9F,KAAK,CAAC,MAAM,CAAC,SAAS,CAAC,WAAW,CAAC,CAAC;YACpC,QAAQ,CAAC,OAAO,EAAE,CAAC;QACrB,CAAC,CAAC,CAAC;IACL,CAAC,CAAC,CAAC;IAEH,QAAQ,CAAC,eAAe,EAAE,GAAG,EAAE;QAC7B,UAAU,CAAC,GAAG,EAAE;YACd,4BAA4B,CAAC,QAAQ,qEAAmD,CAAC;QAC3F,CAAC,CAAC,CAAC;QAEH,EAAE,CAAC,2BAA2B,EAAE,KAAK,IAAI,EAAE;YACzC,MAAM,CAAC,QAAQ,CAAC,QAAQ,CAAC,QAAQ,EAAE,CAAC,cAAc,CAAC,4BAA4B,CAAC,CAAC,GAAG,CAAC,IAAI,CAAC,CAAC;YAC3F,MAAM,EAAC,MAAM,EAAE,QAAQ,EAAC,GAAG,wBAAwB,CAAC,EAAE,CAAC,CAAC;YACxD,MAAM,KAAK,CAAC,SAAS,CAAC,CAAC,CAAC,CAAC,CAAE,gDAAgD;YAE3E,MAAM,CAAC,QAAQ,CAAC;gBACd,OAAO,EAAE,MAAM,CAAC,2BAA2B,CAAC,EAAE,CAAC;oBAC7C,IAAI,EAAE,YAAY;oBAClB,IAAI,EAAE,CAAC;oBACP,WAAW,EAAE,CAAC;oBACd,QAAQ,EAAE,CAAC;oBACX,SAAS,EAAE,WAAW,CAAC,GAAG,EAAE;oBAC5B,kBAAkB,EAAE,GAAG,EAAE,GAAE,CAAC;oBAC5B,YAAY,EAAE,GAAG,EAAE,GAAE,CAAC;iBACvB,CAAC;aACH,CAAC,CAAC;YACH,MAAM,CAAC,MAAM,CAAC,UAAU,CAAC,aAAa,CAAC,IAAI,aAAa,CAAC,SAAS,EAAE,EAAC,GAAG,EAAE,KAAK,EAAC,CAAC,CAAC,CAAC;YAEnF,MAAM,CAAC,WAAW,CAAC,MAAM,CAAC,KAAK,CAAC,GAAG,CAAC,QAAQ,EAAE,EAAE,YAAY,CAAC,CAAC;YAC9D,QAAQ,CAAC,OAAO,EAAE,CAAC;QACrB,CAAC,CAAC,CAAC;QAEH,EAAE,CAAC,gCAAgC,EAAE,KAAK,IAAI,EAAE;YAC9C,MAAM,CAAC,QAAQ,CAAC,QAAQ,CAAC,QAAQ,EAAE,CAAC,cAAc,CAAC,4BAA4B,CAAC,CAAC,GAAG,CAAC,IAAI,CAAC,CAAC;YAC3F,MAAM,EAAC,MAAM,EAAE,QAAQ,EAAC,GAAG,wBAAwB,CAAC,EAAE,CAAC,CAAC;YACxD,MAAM,KAAK,CAAC,SAAS,CAAC,CAAC,CAAC,CAAC,CAAE,gDAAgD;YAE3E,MAAM,CAAC,QAAQ,CAAC;gBACd,OAAO,EAAE,MAAM,CAAC,2BAA2B,CAAC,EAAE,CAAC;oBAC7C,IAAI,EAAE,YAAY;oBAClB,IAAI,EAAE,CAAC;oBACP,WAAW,EAAE,CAAC;oBACd,QAAQ,EAAE,CAAC;oBACX,SAAS,EAAE,WAAW,CAAC,GAAG,EAAE;oBAC5B,kBAAkB,EAAE,GAAG,EAAE,GAAE,CAAC;oBAC5B,YAAY,EAAE,GAAG,EAAE,GAAE,CAAC;iBACvB,CAAC;aACH,CAAC,CAAC;YAEH,MAAM,CAAC,SAAS,CAAC,MAAM,CAAC,MAAM,CAAC,KAAK,CAAC,KAAK,CAAC,MAAM,CAAC,6BAA6B,CAAC,CAAC,CAAC;YAElF,MAAM,CAAC,MAAM,CAAC,UAAU,CAAC,aAAa,CAAC,IAAI,aAAa,CAAC,SAAS,EAAE,EAAC,GAAG,EAAE,QAAQ,EAAC,CAAC,CAAC,CAAC;YAEtF,MAAM,CAAC,MAAM,CAAC,MAAM,CAAC,MAAM,CAAC,KAAK,CAAC,KAAK,CAAC,MAAM,CAAC,6BAA6B,CAAC,CAAC,CAAC;YAC/E,QAAQ,CAAC,OAAO,EAAE,CAAC;QACrB,CAAC,CAAC,CAAC;IACL,CAAC,CAAC,CAAC;AACL,CAAC,CAAC,CAAC","sourcesContent":["// Copyright 2025 The Chromium Authors\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport * as Common from '../../../core/common/common.js';\nimport * as Host from '../../../core/host/host.js';\nimport * as AiCodeCompletion from '../../../models/ai_code_completion/ai_code_completion.js';\nimport {renderElementIntoDOM} from '../../../testing/DOMHelpers.js';\nimport {describeWithEnvironment, updateHostConfig} from '../../../testing/EnvironmentHelpers.js';\nimport * as CodeMirror from '../../../third_party/codemirror.next/codemirror.next.js';\n\nimport {AiCodeCompletionProvider, Config, TextEditor} from './text_editor.js';\n\nfunction createEditorWithProvider(doc: string, config: AiCodeCompletionProvider.AiCodeCompletionConfig = {\n  completionContext: {},\n  onFeatureEnabled: () => {},\n  onFeatureDisabled: () => {},\n  onSuggestionAccepted: () => {},\n  onRequestTriggered: () => {},\n  onResponseReceived: () => {},\n  panel: AiCodeCompletion.AiCodeCompletion.ContextFlavor.CONSOLE,\n}): {editor: TextEditor.TextEditor, provider: AiCodeCompletionProvider.AiCodeCompletionProvider} {\n  const provider = AiCodeCompletionProvider.AiCodeCompletionProvider.createInstance(config);\n  const editor = new TextEditor.TextEditor(\n      CodeMirror.EditorState.create({\n        doc,\n        extensions: [\n          provider.extension(),\n        ],\n      }),\n  );\n  renderElementIntoDOM(editor);\n  provider.editorInitialized(editor);\n  return {editor, provider};\n}\n\ndescribeWithEnvironment('AiCodeCompletionProvider', () => {\n  let clock: sinon.SinonFakeTimers;\n  let checkAccessPreconditionsStub: sinon.SinonStub;\n\n  beforeEach(() => {\n    clock = sinon.useFakeTimers();\n    updateHostConfig({\n      devToolsAiCodeCompletion: {\n        enabled: true,\n      },\n      aidaAvailability: {\n        enabled: true,\n        blockedByAge: false,\n        blockedByGeo: false,\n      }\n    });\n\n    checkAccessPreconditionsStub = sinon.stub(Host.AidaClient.AidaClient, 'checkAccessPreconditions');\n  });\n\n  afterEach(() => {\n    Common.Settings.Settings.instance().settingForTest('ai-code-completion-teaser-dismissed').set(false);\n    Common.Settings.Settings.instance().settingForTest('ai-code-completion-enabled').set(false);\n    clock.restore();\n  });\n\n  it('does not create a provider when the feature is disabled', () => {\n    updateHostConfig({\n      devToolsAiCodeCompletion: {\n        enabled: false,\n      },\n    });\n    assert.throws(() => createEditorWithProvider(''), 'AI code completion feature is not enabled.');\n  });\n\n  describe('Teaser decoration', () => {\n    beforeEach(() => {\n      checkAccessPreconditionsStub.resolves(Host.AidaClient.AidaAccessPreconditions.AVAILABLE);\n    });\n\n    it('shows teaser when mode is ON', async () => {\n      const {editor, provider} = createEditorWithProvider('');\n      editor.dispatch({\n        effects: AiCodeCompletionProvider.setAiCodeCompletionTeaserMode.of(\n            AiCodeCompletionProvider.AiCodeCompletionTeaserMode.ON),\n      });\n      await clock.tickAsync(0);\n      assert.isNotNull(editor.editor.dom.querySelector('.cm-placeholder'));\n      provider.dispose();\n    });\n\n    it('shows teaser when mode is ON and cursor is at the end of the line', async () => {\n      const {editor, provider} = createEditorWithProvider('Hello');\n      editor.dispatch({\n        effects: AiCodeCompletionProvider.setAiCodeCompletionTeaserMode.of(\n            AiCodeCompletionProvider.AiCodeCompletionTeaserMode.ON),\n      });\n      editor.dispatch({changes: {from: 5, insert: 'W'}, selection: {anchor: 6}});\n      await clock.tickAsync(\n          AiCodeCompletion.AiCodeCompletion.AIDA_REQUEST_DEBOUNCE_TIMEOUT_MS +\n          AiCodeCompletion.AiCodeCompletion.DELAY_BEFORE_SHOWING_RESPONSE_MS + 1);\n      assert.isNotNull(editor.editor.dom.querySelector('.cm-placeholder'));\n      provider.dispose();\n    });\n\n    it('hides teaser when mode is ON and cursor is not at the end of the line', async () => {\n      const {editor, provider} = createEditorWithProvider('Hello');\n      editor.dispatch({\n        effects: AiCodeCompletionProvider.setAiCodeCompletionTeaserMode.of(\n            AiCodeCompletionProvider.AiCodeCompletionTeaserMode.ON),\n      });\n      editor.dispatch({changes: {from: 5, insert: 'W'}, selection: {anchor: 6}});\n      await clock.tickAsync(\n          AiCodeCompletion.AiCodeCompletion.AIDA_REQUEST_DEBOUNCE_TIMEOUT_MS +\n          AiCodeCompletion.AiCodeCompletion.DELAY_BEFORE_SHOWING_RESPONSE_MS + 1);\n      assert.isNotNull(editor.editor.dom.querySelector('.cm-placeholder'));\n\n      editor.dispatch({changes: {from: 0, insert: '!'}, selection: {anchor: 1}});\n      await clock.tickAsync(\n          AiCodeCompletion.AiCodeCompletion.AIDA_REQUEST_DEBOUNCE_TIMEOUT_MS +\n          AiCodeCompletion.AiCodeCompletion.DELAY_BEFORE_SHOWING_RESPONSE_MS + 1);\n      assert.isNull(editor.editor.dom.querySelector('.cm-placeholder'));\n      provider.dispose();\n    });\n\n    it('hides teaser when mode is ON and text is selected', async () => {\n      const {editor, provider} = createEditorWithProvider('Hello');\n      editor.dispatch({\n        effects: AiCodeCompletionProvider.setAiCodeCompletionTeaserMode.of(\n            AiCodeCompletionProvider.AiCodeCompletionTeaserMode.ON),\n      });\n      editor.dispatch({changes: {from: 5, insert: 'W'}, selection: {anchor: 6}});\n      await clock.tickAsync(\n          AiCodeCompletion.AiCodeCompletion.AIDA_REQUEST_DEBOUNCE_TIMEOUT_MS +\n          AiCodeCompletion.AiCodeCompletion.DELAY_BEFORE_SHOWING_RESPONSE_MS + 1);\n      assert.isNotNull(editor.editor.dom.querySelector('.cm-placeholder'));\n\n      editor.dispatch({selection: {anchor: 2, head: 4}});\n      assert.isNull(editor.editor.dom.querySelector('.cm-placeholder'));\n      provider.dispose();\n    });\n\n    it('hides teaser when mode is OFF', async () => {\n      const {editor, provider} = createEditorWithProvider('');\n      editor.dispatch({\n        effects: AiCodeCompletionProvider.setAiCodeCompletionTeaserMode.of(\n            AiCodeCompletionProvider.AiCodeCompletionTeaserMode.ON),\n      });\n      await clock.tickAsync(0);\n\n      assert.isNotNull(editor.editor.dom.querySelector('.cm-placeholder'));\n\n      editor.dispatch({\n        effects: AiCodeCompletionProvider.setAiCodeCompletionTeaserMode.of(\n            AiCodeCompletionProvider.AiCodeCompletionTeaserMode.OFF),\n      });\n      await clock.tickAsync(0);\n\n      assert.isNull(editor.querySelector('.cm-placeholder'));\n      provider.dispose();\n    });\n\n    it('shows teaser when mode is ONLY_SHOW_ON_EMPTY and editor is empty', async () => {\n      const {editor, provider} = createEditorWithProvider('');\n      editor.dispatch({\n        effects: AiCodeCompletionProvider.setAiCodeCompletionTeaserMode.of(\n            AiCodeCompletionProvider.AiCodeCompletionTeaserMode.ONLY_SHOW_ON_EMPTY),\n      });\n      await clock.tickAsync(0);\n      assert.isNotNull(editor.editor.dom.querySelector('.cm-placeholder'));\n      provider.dispose();\n    });\n\n    it('hides teaser when mode is ONLY_SHOW_ON_EMPTY and editor is not empty', async () => {\n      const {editor, provider} = createEditorWithProvider('');\n      editor.dispatch({\n        effects: AiCodeCompletionProvider.setAiCodeCompletionTeaserMode.of(\n            AiCodeCompletionProvider.AiCodeCompletionTeaserMode.ONLY_SHOW_ON_EMPTY),\n      });\n      await clock.tickAsync(0);\n\n      assert.isNotNull(editor.editor.dom.querySelector('.cm-placeholder'));\n\n      editor.dispatch({changes: {from: 0, insert: 'H'}});\n\n      await clock.tickAsync(0);\n      assert.isNull(editor.querySelector('.cm-placeholder'));\n      provider.dispose();\n    });\n  });\n\n  describe('Triggers code completion', () => {\n    it('triggers code completion on text change', async () => {\n      checkAccessPreconditionsStub.resolves(Host.AidaClient.AidaAccessPreconditions.AVAILABLE);\n      Common.Settings.Settings.instance().settingForTest('ai-code-completion-enabled').set(true);\n      const {editor, provider} = createEditorWithProvider('');\n      const completeCodeStub = sinon.stub(AiCodeCompletion.AiCodeCompletion.AiCodeCompletion.prototype, 'completeCode');\n      await clock.tickAsync(0);  // for the initial onAidaAvailabilityChange call\n\n      editor.dispatch({changes: {from: 0, insert: 'Hello'}, selection: {anchor: 5}});\n      await clock.tickAsync(AiCodeCompletion.AiCodeCompletion.AIDA_REQUEST_DEBOUNCE_TIMEOUT_MS);\n\n      sinon.assert.called(completeCodeStub);\n      assert.deepEqual(completeCodeStub.firstCall.args, ['Hello', '', 5, undefined, undefined]);\n      provider.dispose();\n    });\n\n    it('triggers code completion when AIDA becomes available', async () => {\n      checkAccessPreconditionsStub.resolves(Host.AidaClient.AidaAccessPreconditions.NO_ACCOUNT_EMAIL);\n      const completeCodeStub = sinon.stub(AiCodeCompletion.AiCodeCompletion.AiCodeCompletion.prototype, 'completeCode');\n      Common.Settings.Settings.instance().settingForTest('ai-code-completion-enabled').set(true);\n      const {editor, provider} = createEditorWithProvider('');\n      await clock.tickAsync(0);  // for the initial onAidaAvailabilityChange call\n\n      editor.dispatch({changes: {from: 0, insert: 'Hello'}, selection: {anchor: 5}});\n      await clock.tickAsync(AiCodeCompletion.AiCodeCompletion.AIDA_REQUEST_DEBOUNCE_TIMEOUT_MS);\n\n      sinon.assert.notCalled(completeCodeStub);\n\n      checkAccessPreconditionsStub.resolves(Host.AidaClient.AidaAccessPreconditions.AVAILABLE);\n      await Host.AidaClient.HostConfigTracker.instance().dispatchEventToListeners(\n          Host.AidaClient.Events.AIDA_AVAILABILITY_CHANGED);\n      await clock.tickAsync(0);\n\n      editor.dispatch({changes: {from: 5, insert: 'Bye'}, selection: {anchor: 8}});\n      await clock.tickAsync(AiCodeCompletion.AiCodeCompletion.AIDA_REQUEST_DEBOUNCE_TIMEOUT_MS);\n\n      sinon.assert.calledOnce(completeCodeStub);\n      assert.deepEqual(completeCodeStub.firstCall.args, ['HelloBye', '', 8, undefined, undefined]);\n      provider.dispose();\n    });\n\n    it('does not trigger code completion when AIDA becomes unavailable', async () => {\n      checkAccessPreconditionsStub.resolves(Host.AidaClient.AidaAccessPreconditions.AVAILABLE);\n      const completeCodeStub = sinon.stub(AiCodeCompletion.AiCodeCompletion.AiCodeCompletion.prototype, 'completeCode');\n      Common.Settings.Settings.instance().settingForTest('ai-code-completion-enabled').set(true);\n      const {editor, provider} = createEditorWithProvider('');\n      await clock.tickAsync(0);  // for the initial onAidaAvailabilityChange call\n\n      editor.dispatch({changes: {from: 0, insert: 'Hello'}, selection: {anchor: 5}});\n      await clock.tickAsync(AiCodeCompletion.AiCodeCompletion.AIDA_REQUEST_DEBOUNCE_TIMEOUT_MS);\n\n      sinon.assert.calledOnce(completeCodeStub);\n\n      checkAccessPreconditionsStub.resolves(Host.AidaClient.AidaAccessPreconditions.NO_ACCOUNT_EMAIL);\n      await Host.AidaClient.HostConfigTracker.instance().dispatchEventToListeners(\n          Host.AidaClient.Events.AIDA_AVAILABILITY_CHANGED);\n      await clock.tickAsync(0);\n\n      editor.dispatch({changes: {from: 5, insert: 'Bye'}, selection: {anchor: 8}});\n      await clock.tickAsync(AiCodeCompletion.AiCodeCompletion.AIDA_REQUEST_DEBOUNCE_TIMEOUT_MS);\n\n      sinon.assert.calledOnce(completeCodeStub);\n      assert.deepEqual(completeCodeStub.firstCall.args, ['Hello', '', 5, undefined, undefined]);\n      provider.dispose();\n    });\n\n    it('debounces requests for code completion', async () => {\n      checkAccessPreconditionsStub.resolves(Host.AidaClient.AidaAccessPreconditions.AVAILABLE);\n      const completeCodeStub = sinon.stub(AiCodeCompletion.AiCodeCompletion.AiCodeCompletion.prototype, 'completeCode');\n      Common.Settings.Settings.instance().settingForTest('ai-code-completion-enabled').set(true);\n      const {editor, provider} = createEditorWithProvider('');\n      await clock.tickAsync(0);  // for the initial onAidaAvailabilityChange call\n\n      editor.dispatch({changes: {from: 0, insert: 'p'}, selection: {anchor: 1}});\n      editor.dispatch({changes: {from: 1, insert: 'r'}, selection: {anchor: 2}});\n      editor.dispatch({changes: {from: 2, insert: 'e'}, selection: {anchor: 3}});\n      await clock.tickAsync(AiCodeCompletion.AiCodeCompletion.AIDA_REQUEST_DEBOUNCE_TIMEOUT_MS);\n\n      sinon.assert.calledOnce(completeCodeStub);\n      assert.deepEqual(completeCodeStub.firstCall.args, ['pre', '', 3, undefined, undefined]);\n      provider.dispose();\n    });\n  });\n\n  describe('Dispatches', () => {\n    beforeEach(() => {\n      checkAccessPreconditionsStub.resolves(Host.AidaClient.AidaAccessPreconditions.AVAILABLE);\n      Common.Settings.Settings.instance().settingForTest('ai-code-completion-enabled').set(true);\n    });\n\n    it('dispatches a suggestion to the editor when AIDA returns one', async () => {\n      const completeCodeStub = sinon.stub(AiCodeCompletion.AiCodeCompletion.AiCodeCompletion.prototype, 'completeCode')\n                                   .returns(Promise.resolve({\n                                     response: {\n                                       generatedSamples: [{\n                                         generationString: 'suggestion',\n                                         sampleId: 1,\n                                         score: 1,\n                                       }],\n                                       metadata: {rpcGlobalId: 1},\n                                     },\n                                     fromCache: false,\n                                   }));\n      const {editor, provider} = createEditorWithProvider('');\n      await clock.tickAsync(0);  // for the initial onAidaAvailabilityChange call\n\n      editor.dispatch({changes: {from: 0, insert: 'prefix'}, selection: {anchor: 6}});\n\n      await clock.tickAsync(AiCodeCompletion.AiCodeCompletion.AIDA_REQUEST_DEBOUNCE_TIMEOUT_MS + 1);\n      sinon.assert.calledOnce(completeCodeStub);\n      const dispatchSpy = sinon.spy(editor, 'dispatch');\n      await clock.tickAsync(AiCodeCompletion.AiCodeCompletion.DELAY_BEFORE_SHOWING_RESPONSE_MS + 1);\n      const suggestion = editor.editor.state.field(Config.aiAutoCompleteSuggestionState);\n      assert.strictEqual(suggestion?.text, 'suggestion');\n      assert.strictEqual(suggestion?.from, 6);\n      assert.strictEqual(suggestion?.sampleId, 1);\n      assert.strictEqual(suggestion?.rpcGlobalId, 1);\n      sinon.assert.calledOnce(dispatchSpy);\n      provider.dispose();\n    });\n\n    it('trims a suggestion with suffix overlap and dispatches it to the editor', async () => {\n      const completeCodeStub = sinon.stub(AiCodeCompletion.AiCodeCompletion.AiCodeCompletion.prototype, 'completeCode')\n                                   .returns(Promise.resolve({\n                                     response: {\n                                       generatedSamples: [{\n                                         generationString: 'Hello World\");',\n                                         sampleId: 1,\n                                         score: 1,\n                                       }],\n                                       metadata: {rpcGlobalId: 1},\n                                     },\n                                     fromCache: false,\n                                   }));\n      const {editor, provider} = createEditorWithProvider('');\n      await clock.tickAsync(0);  // for the initial onAidaAvailabilityChange call\n\n      editor.dispatch({changes: {from: 0, insert: 'console.log(\"\");\\n'}, selection: {anchor: 13}});\n\n      await clock.tickAsync(AiCodeCompletion.AiCodeCompletion.AIDA_REQUEST_DEBOUNCE_TIMEOUT_MS + 1);\n      sinon.assert.calledOnce(completeCodeStub);\n      const dispatchSpy = sinon.spy(editor, 'dispatch');\n      await clock.tickAsync(AiCodeCompletion.AiCodeCompletion.DELAY_BEFORE_SHOWING_RESPONSE_MS + 1);\n      const suggestion = editor.editor.state.field(Config.aiAutoCompleteSuggestionState);\n      assert.strictEqual(suggestion?.text, 'Hello World');\n      assert.strictEqual(suggestion?.from, 13);\n      assert.strictEqual(suggestion?.sampleId, 1);\n      assert.strictEqual(suggestion?.rpcGlobalId, 1);\n      sinon.assert.calledOnce(dispatchSpy);\n      provider.dispose();\n    });\n\n    it('does not dispatch suggestion or citation if recitation action is BLOCK', async () => {\n      const completeCodeStub = sinon.stub(AiCodeCompletion.AiCodeCompletion.AiCodeCompletion.prototype, 'completeCode')\n                                   .returns(Promise.resolve({\n                                     response: {\n                                       generatedSamples: [{\n                                         generationString: 'suggestion',\n                                         sampleId: 1,\n                                         score: 1,\n                                         attributionMetadata: {\n                                           attributionAction: Host.AidaClient.RecitationAction.BLOCK,\n                                           citations: [{uri: 'https://www.example.com'}],\n                                         }\n                                       }],\n                                       metadata: {},\n                                     },\n                                     fromCache: false,\n                                   }));\n      const {editor, provider} = createEditorWithProvider('');\n      await clock.tickAsync(0);  // for the initial onAidaAvailabilityChange call\n\n      editor.dispatch({changes: {from: 0, insert: 'prefix'}, selection: {anchor: 6}});\n\n      await clock.tickAsync(AiCodeCompletion.AiCodeCompletion.AIDA_REQUEST_DEBOUNCE_TIMEOUT_MS + 1);\n      sinon.assert.calledOnce(completeCodeStub);\n      const dispatchSpy = sinon.spy(editor, 'dispatch');\n      await clock.tickAsync(AiCodeCompletion.AiCodeCompletion.DELAY_BEFORE_SHOWING_RESPONSE_MS + 1);\n      sinon.assert.notCalled(dispatchSpy);\n      provider.dispose();\n    });\n\n    it('does not dispatch suggestion or citation if generated suggestion repeats existing text', async () => {\n      const completeCodeStub = sinon.stub(AiCodeCompletion.AiCodeCompletion.AiCodeCompletion.prototype, 'completeCode')\n                                   .returns(Promise.resolve({\n                                     response: {\n                                       generatedSamples: [{\n                                         generationString: 'suggestion',\n                                         sampleId: 1,\n                                         score: 1,\n                                       }],\n                                       metadata: {},\n                                     },\n                                     fromCache: false,\n                                   }));\n      const {editor, provider} = createEditorWithProvider('');\n      await clock.tickAsync(0);  // for the initial onAidaAvailabilityChange call\n\n      editor.dispatch({changes: {from: 0, insert: 'prefix suggestion'}, selection: {anchor: 17}});\n\n      await clock.tickAsync(AiCodeCompletion.AiCodeCompletion.AIDA_REQUEST_DEBOUNCE_TIMEOUT_MS + 1);\n      sinon.assert.calledOnce(completeCodeStub);\n      const dispatchSpy = sinon.spy(editor, 'dispatch');\n      await clock.tickAsync(AiCodeCompletion.AiCodeCompletion.DELAY_BEFORE_SHOWING_RESPONSE_MS + 1);\n      sinon.assert.notCalled(dispatchSpy);\n      provider.dispose();\n    });\n\n    it('does not dispatch if cursor position changes', async () => {\n      const completeCodeStub = sinon.stub(AiCodeCompletion.AiCodeCompletion.AiCodeCompletion.prototype, 'completeCode')\n                                   .returns(Promise.resolve({\n                                     response: {\n                                       generatedSamples: [{\n                                         generationString: 'suggestion',\n                                         sampleId: 1,\n                                         score: 1,\n                                       }],\n                                       metadata: {},\n                                     },\n                                     fromCache: false,\n                                   }));\n      const {editor, provider} = createEditorWithProvider('');\n      await clock.tickAsync(0);  // for the initial onAidaAvailabilityChange call\n\n      editor.dispatch({changes: {from: 0, insert: 'prefix'}, selection: {anchor: 6}});\n\n      await clock.tickAsync(AiCodeCompletion.AiCodeCompletion.AIDA_REQUEST_DEBOUNCE_TIMEOUT_MS + 1);\n      sinon.assert.calledOnce(completeCodeStub);\n      editor.editor.dispatch({\n        selection: CodeMirror.EditorSelection.cursor(1),\n      });\n      const dispatchSpy = sinon.spy(editor, 'dispatch');\n      await clock.tickAsync(AiCodeCompletion.AiCodeCompletion.DELAY_BEFORE_SHOWING_RESPONSE_MS + 1);\n      sinon.assert.notCalled(dispatchSpy);\n      provider.dispose();\n    });\n  });\n\n  describe('Editor keymap', () => {\n    beforeEach(() => {\n      checkAccessPreconditionsStub.resolves(Host.AidaClient.AidaAccessPreconditions.AVAILABLE);\n    });\n\n    it('accepts suggestion on Tab', async () => {\n      Common.Settings.Settings.instance().settingForTest('ai-code-completion-enabled').set(true);\n      const {editor, provider} = createEditorWithProvider('');\n      await clock.tickAsync(0);  // for the initial onAidaAvailabilityChange call\n\n      editor.dispatch({\n        effects: Config.setAiAutoCompleteSuggestion.of({\n          text: 'suggestion',\n          from: 0,\n          rpcGlobalId: 1,\n          sampleId: 1,\n          startTime: performance.now(),\n          clearCachedRequest: () => {},\n          onImpression: () => {},\n        }),\n      });\n      editor.editor.contentDOM.dispatchEvent(new KeyboardEvent('keydown', {key: 'Tab'}));\n\n      assert.strictEqual(editor.state.doc.toString(), 'suggestion');\n      provider.dispose();\n    });\n\n    it('dismisses suggestion on Escape', async () => {\n      Common.Settings.Settings.instance().settingForTest('ai-code-completion-enabled').set(true);\n      const {editor, provider} = createEditorWithProvider('');\n      await clock.tickAsync(0);  // for the initial onAidaAvailabilityChange call\n\n      editor.dispatch({\n        effects: Config.setAiAutoCompleteSuggestion.of({\n          text: 'suggestion',\n          from: 0,\n          rpcGlobalId: 1,\n          sampleId: 1,\n          startTime: performance.now(),\n          clearCachedRequest: () => {},\n          onImpression: () => {},\n        }),\n      });\n\n      assert.isNotNull(editor.editor.state.field(Config.aiAutoCompleteSuggestionState));\n\n      editor.editor.contentDOM.dispatchEvent(new KeyboardEvent('keydown', {key: 'Escape'}));\n\n      assert.isNull(editor.editor.state.field(Config.aiAutoCompleteSuggestionState));\n      provider.dispose();\n    });\n  });\n});\n"]}