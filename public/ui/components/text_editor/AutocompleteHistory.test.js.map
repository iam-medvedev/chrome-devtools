{"version":3,"file":"AutocompleteHistory.test.js","sourceRoot":"","sources":["../../../../../../../front_end/ui/components/text_editor/AutocompleteHistory.test.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright 2023 The Chromium Authors\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport type * as Common from '../../../core/common/common.js';\nimport {\n  createFakeSetting,\n  describeWithEnvironment,\n} from '../../../testing/EnvironmentHelpers.js';\n\nimport * as TextEditor from './text_editor.js';\n\ndescribeWithEnvironment('AutocompleteHistory', () => {\n  let setting: Common.Settings.Setting<string[]>;\n  let history: TextEditor.AutocompleteHistory.AutocompleteHistory;\n\n  beforeEach(() => {\n    setting = createFakeSetting('history', []);\n    history = new TextEditor.AutocompleteHistory.AutocompleteHistory(setting);\n  });\n\n  describe('pushHistoryItem', () => {\n    it('stores the commited text in the setting', () => {\n      history.pushHistoryItem('sample input');\n\n      assert.deepEqual(setting.get(), ['sample input']);\n    });\n\n    it('ignores sub-sequent identical inputs', () => {\n      history.pushHistoryItem('entry x');\n      history.pushHistoryItem('entry x');\n\n      assert.deepEqual(setting.get(), ['entry x']);\n    });\n\n    it('resets the history navigation back to the beginning', () => {\n      history.pushHistoryItem('entry 1');\n      history.pushHistoryItem('entry 2');\n      history.previous('');\n      history.previous('');\n\n      // Even though the user navigated back in the history, they can still commit a different text\n      history.pushHistoryItem('entry 3');\n\n      assert.isUndefined(history.next());\n      assert.strictEqual(history.previous(''), 'entry 3');\n    });\n  });\n\n  describe('previous', () => {\n    it('returns \"undefined\" for an empty history', () => {\n      assert.isUndefined(history.previous(''));\n    });\n\n    it('moves backwards through history', () => {\n      history.pushHistoryItem('entry 1');\n      history.pushHistoryItem('entry 2');\n\n      assert.strictEqual(history.previous(''), 'entry 2');\n      assert.strictEqual(history.previous(''), 'entry 1');\n      assert.isUndefined(history.previous(''));\n    });\n\n  });\n\n  describe('next', () => {\n    it('returns \"undefined\" for an empty history', () => {\n      assert.isUndefined(history.next());\n    });\n\n    it('returns \"undefined\" when not navigating through the history', () => {\n      history.pushHistoryItem('entry 1');\n      history.pushHistoryItem('entry 2');\n\n      assert.isUndefined(history.next());\n    });\n\n    it('moves forwards through history', () => {\n      history.pushHistoryItem('entry 1');\n      history.pushHistoryItem('entry 2');\n      history.previous('');\n      history.previous('');\n      history.previous('');\n\n      assert.strictEqual(history.next(), 'entry 1');\n      assert.strictEqual(history.next(), 'entry 2');\n    });\n\n  });\n\n  it('stores the \"temporary input\" on the first \"previous\" call with a non-empty history', () => {\n    history.pushHistoryItem('entry 1');\n    history.pushHistoryItem('entry 2');\n\n    assert.strictEqual(history.previous('incomplete user inp'), 'entry 2');\n\n    assert.strictEqual(history.next(), 'incomplete user inp');\n  });\n\n  it('does not write the temporary user input to the setting', () => {\n    history.pushHistoryItem('entry 1');\n    assert.strictEqual(history.previous('incomplete user inp'), 'entry 1');\n\n    assert.deepEqual(setting.get(), ['entry 1']);\n  });\n\n  describe('matchingEntries', () => {\n    it('returns the appropriate matches', () => {\n      history.pushHistoryItem('x === 5');\n      history.pushHistoryItem('y < 42');\n      history.pushHistoryItem('x > 20');\n\n      const matches = history.matchingEntries('x ');\n\n      assert.deepEqual([...matches], ['x > 20', 'x === 5']);\n    });\n\n    it('respects the \"limit\" argument', () => {\n      for (let i = 0; i < 20; ++i) {\n        history.pushHistoryItem(`x === ${i}`);\n      }\n\n      const matches = history.matchingEntries('x ', 3);\n\n      assert.deepEqual([...matches], ['x === 19', 'x === 18', 'x === 17']);\n    });\n  });\n\n  describe('edit preservation during navigation', () => {\n    it('preserves edits made to history entries when navigating backward', () => {\n      history.pushHistoryItem('entry 1');\n      history.pushHistoryItem('entry 2');\n      history.pushHistoryItem('entry 3');\n\n      // Navigate to entry 2\n      history.previous('');  // now at entry 3\n      history.previous('');  // now at entry 2\n\n      // Edit entry 2 and navigate further back (passing edited text to previous)\n      history.previous('entry 2 EDITED');  // now at entry 1\n\n      // Navigate forward - should see the edit\n      assert.strictEqual(history.next(), 'entry 2 EDITED');\n    });\n\n    it('preserves multiple edits at different history positions', () => {\n      history.pushHistoryItem('entry 1');\n      history.pushHistoryItem('entry 2');\n      history.pushHistoryItem('entry 3');\n\n      // Edit entry 3 by passing edit when navigating away\n      history.previous('entry 3 EDITED');  // save edit, now at entry 2\n\n      // Edit entry 2 by passing edit when navigating away\n      history.previous('entry 2 EDITED');  // save edit, now at entry 1\n\n      // Navigate forward through edits\n      assert.strictEqual(history.next(), 'entry 2 EDITED');\n      assert.strictEqual(history.next(), 'entry 3 EDITED');\n    });\n\n    it('clears edits when a new command is committed', () => {\n      history.pushHistoryItem('entry 1');\n      history.pushHistoryItem('entry 2');\n\n      // Edit entry 2 by passing edit when navigating away\n      history.previous('entry 2 EDITED');\n\n      // Commit a new command\n      history.pushHistoryItem('entry 3');\n\n      // Navigate back - edit should be gone\n      assert.strictEqual(history.previous(''), 'entry 3');\n      assert.strictEqual(history.previous(''), 'entry 2');  // Original, not edited\n    });\n\n    it('preserves uncommitted input alongside history edits', () => {\n      history.pushHistoryItem('entry 1');\n      history.pushHistoryItem('entry 2');\n\n      // Start typing, then navigate back\n      history.previous('my uncommitted input');  // now at entry 2\n\n      // Edit entry 2 and go further back\n      history.previous('entry 2 EDITED');  // now at entry 1\n\n      // Navigate all the way forward\n      assert.strictEqual(history.next(), 'entry 2 EDITED');\n      assert.strictEqual(history.next(), 'my uncommitted input');\n    });\n\n    it('restores original if edit matches original', () => {\n      history.pushHistoryItem('entry 1');\n      history.pushHistoryItem('entry 2');\n\n      // Navigate to entry 2, \"edit\" it to same value\n      history.previous('');\n      history.previous('entry 2');  // edit back to original\n\n      // Should still work\n      assert.strictEqual(history.next(), 'entry 2');\n    });\n\n    it('restores original if text was emptied', () => {\n      history.pushHistoryItem('entry 1');\n      history.pushHistoryItem('entry 2');\n\n      // Navigate to entry 2, edit it\n      history.previous('');\n      history.previous('entry 2 EDITED');  // now at entry 1 with edit saved\n\n      // Verify edit is there\n      assert.strictEqual(history.next(), 'entry 2 EDITED');\n\n      // Now empty the text and navigate away\n      history.previous('');  // empty text, navigate back to entry 1\n\n      // Edit should be cleared, original restored\n      assert.strictEqual(history.next(), 'entry 2');\n    });\n  });\n\n});\n"]}