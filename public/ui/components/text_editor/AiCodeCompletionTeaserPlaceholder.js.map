{"version":3,"file":"AiCodeCompletionTeaserPlaceholder.js","sourceRoot":"","sources":["../../../../../../../front_end/ui/components/text_editor/AiCodeCompletionTeaserPlaceholder.ts"],"names":[],"mappings":"AAAA,sCAAsC;AACtC,yEAAyE;AACzE,6BAA6B;AAC7B,mDAAmD;AAGnD,OAAO,KAAK,EAAE,MAAM,yDAAyD,CAAC;AAE9E,MAAM,UAAU,WAAW,CAAC,IAAa,EAAE,IAAa;IAMtD,MAAM,CAAC,GAAG,IAAI,CAAC,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC,IAAI,CAAC,KAAK,CAAC;IACxC,OAAO,EAAC,IAAI,EAAE,CAAC,EAAE,KAAK,EAAE,CAAC,EAAE,GAAG,EAAE,IAAI,CAAC,GAAG,EAAE,MAAM,EAAE,IAAI,CAAC,MAAM,EAAC,CAAC;AACjE,CAAC;AAED,MAAM,OAAO,iCAAkC,SAAQ,EAAE,CAAC,UAAU;IAC7C;IAArB,YAAqB,MAA0C;QAC7D,KAAK,EAAE,CAAC;QADW,WAAM,GAAN,MAAM,CAAoC;IAE/D,CAAC;IAED,KAAK;QACH,MAAM,IAAI,GAAG,QAAQ,CAAC,aAAa,CAAC,MAAM,CAAC,CAAC;QAC5C,IAAI,CAAC,SAAS,CAAC,GAAG,CAAC,gBAAgB,CAAC,CAAC;QACrC,IAAI,CAAC,KAAK,CAAC,aAAa,GAAG,MAAM,CAAC;QAClC,IAAI,CAAC,QAAQ,GAAG,CAAC,CAAC;QAClB,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,IAAI,EAAE,SAAS,EAAE,IAAI,CAAC,CAAC;QACxC,OAAO,IAAI,CAAC;IACd,CAAC;IAED;;;;OAIG;IACM,QAAQ,CAAC,GAAgB;QAMhC,MAAM,kBAAkB,GAAG,GAAG,CAAC,iBAAiB,EAAE,qBAAqB,EAAE,CAAC;QAC1E,IAAI,CAAC,kBAAkB,EAAE,CAAC;YACxB,OAAO,IAAI,CAAC;QACd,CAAC;QACD,MAAM,KAAK,GAAG,MAAM,CAAC,gBAAgB,CAAC,GAAG,CAAC,UAAyB,CAAC,CAAC;QACrE,MAAM,IAAI,GAAG,WAAW,CAAC,kBAAkB,EAAE,KAAK,CAAC,SAAS,KAAK,KAAK,CAAC,CAAC;QACxE,MAAM,UAAU,GAAG,QAAQ,CAAC,KAAK,CAAC,UAAU,EAAE,EAAE,CAAC,CAAC;QAClD,IAAI,IAAI,CAAC,MAAM,GAAG,IAAI,CAAC,GAAG,GAAG,UAAU,GAAG,GAAG,EAAE,CAAC;YAC9C,OAAO,EAAC,IAAI,EAAE,IAAI,CAAC,IAAI,EAAE,KAAK,EAAE,IAAI,CAAC,KAAK,EAAE,GAAG,EAAE,IAAI,CAAC,GAAG,EAAE,MAAM,EAAE,IAAI,CAAC,GAAG,GAAG,UAAU,EAAC,CAAC;QAC5F,CAAC;QACD,OAAO,IAAI,CAAC;IACd,CAAC;IAEQ,WAAW,CAAC,CAAQ;QAC3B,OAAO,KAAK,CAAC;IACf,CAAC;IAEQ,OAAO,CAAC,GAAgB;QAC/B,KAAK,CAAC,OAAO,CAAC,GAAG,CAAC,CAAC;QACnB,IAAI,CAAC,MAAM,EAAE,UAAU,EAAE,CAAC;IAC5B,CAAC;CACF;AAED,MAAM,UAAU,iCAAiC,CAAC,MAA0C;IAC1F,MAAM,MAAM,GAAG,EAAE,CAAC,UAAU,CAAC,SAAS,CAAC;QAGhB;QAFrB,WAAW,CAAmB;QAE9B,YAAqB,IAAmB;YAAnB,SAAI,GAAJ,IAAI,CAAe;YACtC,IAAI,CAAC,WAAW,GAAG,EAAE,CAAC,UAAU,CAAC,GAAG,CAChC,CAAC,EAAE,CAAC,UAAU,CAAC,MAAM,CAAC,EAAC,MAAM,EAAE,IAAI,iCAAiC,CAAC,MAAM,CAAC,EAAE,IAAI,EAAE,CAAC,EAAC,CAAC,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;QACzG,CAAC;QAID,IAAI,WAAW;YACb,OAAO,IAAI,CAAC,IAAI,CAAC,KAAK,CAAC,GAAG,CAAC,MAAM,CAAC,CAAC,CAAC,EAAE,CAAC,UAAU,CAAC,IAAI,CAAC,CAAC,CAAC,IAAI,CAAC,WAAW,CAAC;QAC5E,CAAC;KACF,EAAE,EAAC,WAAW,EAAE,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,WAAW,EAAC,CAAC,CAAC;IACtC,OAAO,MAAM,CAAC;AAChB,CAAC","sourcesContent":["// Copyright 2025 The Chromium Authors\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n/* eslint-disable rulesdir/no-imperative-dom-api */\n\nimport type * as PanelCommon from '../../../panels/common/common.js';\nimport * as CM from '../../../third_party/codemirror.next/codemirror.next.js';\n\nexport function flattenRect(rect: DOMRect, left: boolean): {\n  left: number,\n  right: number,\n  top: number,\n  bottom: number,\n} {\n  const x = left ? rect.left : rect.right;\n  return {left: x, right: x, top: rect.top, bottom: rect.bottom};\n}\n\nexport class AiCodeCompletionTeaserPlaceholder extends CM.WidgetType {\n  constructor(readonly teaser: PanelCommon.AiCodeCompletionTeaser) {\n    super();\n  }\n\n  toDOM(): HTMLElement {\n    const wrap = document.createElement('span');\n    wrap.classList.add('cm-placeholder');\n    wrap.style.pointerEvents = 'none';\n    wrap.tabIndex = 0;\n    this.teaser.show(wrap, undefined, true);\n    return wrap;\n  }\n\n  /**\n   * Controls the cursor's height by reporting this widget's bounds as a\n   * single line. This prevents the cursor from expanding vertically when the\n   * placeholder content wraps across multiple lines.\n   */\n  override coordsAt(dom: HTMLElement): {\n    left: number,\n    right: number,\n    top: number,\n    bottom: number,\n  }|null {\n    const boundingClientRect = dom.firstElementChild?.getBoundingClientRect();\n    if (!boundingClientRect) {\n      return null;\n    }\n    const style = window.getComputedStyle(dom.parentNode as HTMLElement);\n    const rect = flattenRect(boundingClientRect, style.direction !== 'rtl');\n    const lineHeight = parseInt(style.lineHeight, 10);\n    if (rect.bottom - rect.top > lineHeight * 1.5) {\n      return {left: rect.left, right: rect.right, top: rect.top, bottom: rect.top + lineHeight};\n    }\n    return rect;\n  }\n\n  override ignoreEvent(_: Event): boolean {\n    return false;\n  }\n\n  override destroy(dom: HTMLElement): void {\n    super.destroy(dom);\n    this.teaser?.hideWidget();\n  }\n}\n\nexport function aiCodeCompletionTeaserPlaceholder(teaser: PanelCommon.AiCodeCompletionTeaser): CM.Extension {\n  const plugin = CM.ViewPlugin.fromClass(class {\n    placeholder: CM.DecorationSet;\n\n    constructor(readonly view: CM.EditorView) {\n      this.placeholder = CM.Decoration.set(\n          [CM.Decoration.widget({widget: new AiCodeCompletionTeaserPlaceholder(teaser), side: 1}).range(0)]);\n    }\n\n    declare update: () => void;\n\n    get decorations(): CM.DecorationSet {\n      return this.view.state.doc.length ? CM.Decoration.none : this.placeholder;\n    }\n  }, {decorations: v => v.decorations});\n  return plugin;\n}\n"]}