{"version":3,"file":"CodeBlock.test.js","sourceRoot":"","sources":["../../../../../../../front_end/ui/components/markdown_view/CodeBlock.test.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright 2023 The Chromium Authors\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport * as Host from '../../../core/host/host.js';\nimport {\n  dispatchClickEvent,\n  renderElementIntoDOM,\n} from '../../../testing/DOMHelpers.js';\nimport {describeWithEnvironment} from '../../../testing/EnvironmentHelpers.js';\n\nimport * as MarkdownView from './markdown_view.js';\n\ndescribeWithEnvironment('CodeBlock', () => {\n  it('copies the code to clipboard', async () => {\n    const component = new MarkdownView.CodeBlock.CodeBlock();\n    component.code = 'test';\n    component.showCopyButton = true;\n    renderElementIntoDOM(component);\n    const clock = sinon.useFakeTimers();\n    try {\n      const copyText = sinon\n                           .stub(\n                               Host.InspectorFrontendHost.InspectorFrontendHostInstance,\n                               'copyText',\n                               )\n                           .returns();\n      const button = component.shadowRoot!.querySelector('devtools-button');\n      assert.exists(button);\n      dispatchClickEvent(button, {\n        bubbles: true,\n        composed: true,\n      });\n      sinon.assert.calledWith(copyText, 'test');\n\n      clock.tick(100);\n      let buttonContainer = component.shadowRoot!.querySelector('.copy-button-container');\n      assert.exists(buttonContainer);\n      assert.strictEqual(buttonContainer.textContent?.trim(), 'Copied to clipboard');\n      clock.tick(1100);\n      buttonContainer = component.shadowRoot!.querySelector('.copy-button-container');\n      assert.exists(buttonContainer);\n      assert.strictEqual(buttonContainer.textContent?.trim(), '');\n    } finally {\n      clock.restore();\n    }\n  });\n\n  it('renders no legal notice by default', () => {\n    const component = new MarkdownView.CodeBlock.CodeBlock();\n    component.code = 'test';\n    renderElementIntoDOM(component);\n    const notice = component.shadowRoot!.querySelector('.notice') as HTMLElement;\n    assert.isNull(notice, '.notice was found');\n  });\n\n  it('renders legal notice if configured', () => {\n    const component = new MarkdownView.CodeBlock.CodeBlock();\n    component.code = 'test';\n    component.displayNotice = true;\n    renderElementIntoDOM(component);\n    const notice = component.shadowRoot!.querySelector('.notice') as HTMLElement;\n    assert.exists(notice);\n    assert.strictEqual(notice.innerText, 'Use code snippets with caution');\n  });\n\n  it('renders citations', () => {\n    const handler1 = sinon.spy();\n    const handler2 = sinon.spy();\n    const component = new MarkdownView.CodeBlock.CodeBlock();\n    component.code = 'test';\n    component.citations = [\n      {\n        index: 1,\n        clickHandler: handler1,\n      },\n      {\n        index: 2,\n        clickHandler: handler2,\n      },\n    ];\n    renderElementIntoDOM(component);\n    const citations = component.shadowRoot!.querySelectorAll('button.citation');\n    assert.lengthOf(citations, 2);\n    assert.strictEqual(citations[0].textContent, '[1]');\n    assert.strictEqual(citations[1].textContent, '[2]');\n    (citations[0] as HTMLElement).click();\n    sinon.assert.calledOnce(handler1);\n    (citations[1] as HTMLElement).click();\n    sinon.assert.calledOnce(handler2);\n  });\n});\n"]}