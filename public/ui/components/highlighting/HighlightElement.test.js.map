{"version":3,"file":"HighlightElement.test.js","sourceRoot":"","sources":["../../../../../../../front_end/ui/components/highlighting/HighlightElement.test.ts"],"names":[],"mappings":"AAAA,sCAAsC;AACtC,yEAAyE;AACzE,6BAA6B;AAE7B,OAAO,KAAK,SAAS,MAAM,0CAA0C,CAAC;AACtE,OAAO,EAAC,oBAAoB,EAAC,MAAM,gCAAgC,CAAC;AAEpE,OAAO,KAAK,YAAY,MAAM,mBAAmB,CAAC;AAElD,QAAQ,CAAC,kBAAkB,EAAE,GAAG,EAAE;IAChC,IAAI,OAAwB,CAAC;IAE7B,UAAU,CAAC,GAAG,EAAE;QACd,OAAO,GAAG,KAAK,CAAC,IAAI,CAAC,YAAY,CAAC,gBAAgB,CAAC,gBAAgB,CAAC,QAAQ,CAAC,EAAC,QAAQ,EAAE,IAAI,EAAC,CAAC,EAAE,KAAK,CAAC,CAAC;IACzG,CAAC,CAAC,CAAC;IAEH,SAAS,sBAAsB;QAC7B,MAAM,OAAO,GAAG,QAAQ,CAAC,aAAa,CAAC,oBAAoB,CAAC,CAAC;QAC7D,oBAAoB,CAAC,OAAO,CAAC,CAAC;QAC9B,OAAO,OAAO,CAAC;IACjB,CAAC;IAED,EAAE,CAAC,gEAAgE,EAAE,KAAK,IAAI,EAAE;QAC9E,MAAM,OAAO,GAAG,sBAAsB,EAAE,CAAC;QACzC,OAAO,CAAC,YAAY,CAAC,QAAQ,EAAE,SAAS,CAAC,CAAC;QAC1C,MAAM,IAAI,OAAO,CAAO,OAAO,CAAC,EAAE,CAAC,cAAc,CAAC,OAAO,CAAC,CAAC,CAAC;QAE5D,MAAM,cAAc,GAAG;YACrB,IAAI,SAAS,CAAC,SAAS,CAAC,WAAW,CAAC,CAAC,EAAE,CAAC,CAAC;SAC1C,CAAC;QACF,KAAK,CAAC,MAAM,CAAC,UAAU,CAAC,OAAO,CAAC,CAAC;QACjC,MAAM,UAAU,GAAG,OAAO,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC;QACtC,MAAM,CAAC,WAAW,CAAC,UAAU,CAAC,IAAI,CAAC,CAAC,CAAC,EAAE,OAAO,CAAC,CAAC;QAChD,MAAM,CAAC,SAAS,CAAC,UAAU,CAAC,IAAI,CAAC,CAAC,CAAC,EAAE,cAAc,CAAC,CAAC;QACrD,MAAM,CAAC,WAAW,CAAC,UAAU,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,CAAC;IACzC,CAAC,CAAC,CAAC;IAEH,EAAE,CAAC,uEAAuE,EAAE,KAAK,IAAI,EAAE;QACrF,MAAM,OAAO,GAAG,sBAAsB,EAAE,CAAC;QACzC,OAAO,CAAC,YAAY,CAAC,eAAe,EAAE,KAAK,CAAC,CAAC;QAC7C,MAAM,IAAI,OAAO,CAAO,OAAO,CAAC,EAAE,CAAC,cAAc,CAAC,OAAO,CAAC,CAAC,CAAC;QAE5D,MAAM,YAAY,GAAG,IAAI,SAAS,CAAC,SAAS,CAAC,WAAW,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC;QAC/D,MAAM,CAAC,MAAM,CAAC,OAAO,CAAC,cAAc,CAAC,OAAO,EAAE,EAAE,EAAE,YAAY,CAAC,CAAC,CAAC;IACnE,CAAC,CAAC,CAAC;IAEH,EAAE,CAAC,gEAAgE,EAAE,KAAK,IAAI,EAAE;QAC9E,MAAM,OAAO,GAAG,sBAAsB,EAAE,CAAC;QAEzC,OAAO,CAAC,YAAY,CAAC,QAAQ,EAAE,SAAS,CAAC,CAAC;QAC1C,MAAM,IAAI,OAAO,CAAO,OAAO,CAAC,EAAE,CAAC,cAAc,CAAC,OAAO,CAAC,CAAC,CAAC;QAC5D,MAAM,cAAc,GAAG;YACrB,IAAI,SAAS,CAAC,SAAS,CAAC,WAAW,CAAC,CAAC,EAAE,CAAC,CAAC;SAC1C,CAAC;QACF,KAAK,CAAC,MAAM,CAAC,UAAU,CAAC,OAAO,CAAC,CAAC;QACjC,MAAM,CAAC,SAAS,CAAC,OAAO,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,EAAE,cAAc,CAAC,CAAC;QAE7D,OAAO,CAAC,YAAY,EAAE,CAAC;QAEvB,OAAO,CAAC,YAAY,CAAC,eAAe,EAAE,KAAK,CAAC,CAAC;QAC7C,MAAM,IAAI,OAAO,CAAO,OAAO,CAAC,EAAE,CAAC,cAAc,CAAC,OAAO,CAAC,CAAC,CAAC;QAC5D,MAAM,oBAAoB,GAAG,IAAI,SAAS,CAAC,SAAS,CAAC,WAAW,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC;QACvE,KAAK,CAAC,MAAM,CAAC,UAAU,CAAC,OAAO,CAAC,CAAC;QACjC,MAAM,UAAU,GAAG,OAAO,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC;QACtC,MAAM,CAAC,WAAW,CAAC,UAAU,CAAC,IAAI,CAAC,CAAC,CAAC,EAAE,OAAO,CAAC,CAAC;QAChD,MAAM,CAAC,SAAS,CAAC,UAAU,CAAC,IAAI,CAAC,CAAC,CAAC,EAAE,cAAc,CAAC,CAAC;QACrD,MAAM,CAAC,SAAS,CAAC,UAAU,CAAC,IAAI,CAAC,CAAC,CAAC,EAAE,oBAAoB,CAAC,CAAC;IAC7D,CAAC,CAAC,CAAC;IAEH,EAAE,CAAC,gEAAgE,EAAE,KAAK,IAAI,EAAE;QAC9E,MAAM,OAAO,GAAG,sBAAsB,EAAE,CAAC;QAEzC,OAAO,CAAC,YAAY,CAAC,eAAe,EAAE,KAAK,CAAC,CAAC;QAC7C,MAAM,IAAI,OAAO,CAAO,OAAO,CAAC,EAAE,CAAC,cAAc,CAAC,OAAO,CAAC,CAAC,CAAC;QAC5D,MAAM,oBAAoB,GAAG,IAAI,SAAS,CAAC,SAAS,CAAC,WAAW,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC;QACvE,KAAK,CAAC,MAAM,CAAC,UAAU,CAAC,OAAO,CAAC,CAAC;QACjC,MAAM,CAAC,SAAS,CAAC,OAAO,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,EAAE,oBAAoB,CAAC,CAAC;QAEnE,OAAO,CAAC,YAAY,EAAE,CAAC;QAEvB,OAAO,CAAC,YAAY,CAAC,QAAQ,EAAE,SAAS,CAAC,CAAC;QAC1C,MAAM,IAAI,OAAO,CAAO,OAAO,CAAC,EAAE,CAAC,cAAc,CAAC,OAAO,CAAC,CAAC,CAAC;QAC5D,MAAM,cAAc,GAAG;YACrB,IAAI,SAAS,CAAC,SAAS,CAAC,WAAW,CAAC,CAAC,EAAE,CAAC,CAAC;SAC1C,CAAC;QACF,KAAK,CAAC,MAAM,CAAC,UAAU,CAAC,OAAO,CAAC,CAAC;QACjC,MAAM,UAAU,GAAG,OAAO,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC;QACtC,MAAM,CAAC,WAAW,CAAC,UAAU,CAAC,IAAI,CAAC,CAAC,CAAC,EAAE,OAAO,CAAC,CAAC;QAChD,MAAM,CAAC,SAAS,CAAC,UAAU,CAAC,IAAI,CAAC,CAAC,CAAC,EAAE,cAAc,CAAC,CAAC;QACrD,MAAM,CAAC,SAAS,CAAC,UAAU,CAAC,IAAI,CAAC,CAAC,CAAC,EAAE,oBAAoB,CAAC,CAAC;IAC7D,CAAC,CAAC,CAAC;IAEH,EAAE,CAAC,gCAAgC,EAAE,KAAK,IAAI,EAAE;QAC9C,MAAM,OAAO,GAAG,sBAAsB,EAAE,CAAC;QAEzC,OAAO,CAAC,YAAY,CAAC,QAAQ,EAAE,EAAE,CAAC,CAAC;QACnC,MAAM,IAAI,OAAO,CAAO,OAAO,CAAC,EAAE,CAAC,cAAc,CAAC,OAAO,CAAC,CAAC,CAAC;QAC5D,MAAM,CAAC,MAAM,CAAC,OAAO,CAAC,cAAc,CAAC,OAAO,EAAE,EAAE,EAAE,SAAS,CAAC,CAAC,CAAC;IAChE,CAAC,CAAC,CAAC;IAEH,EAAE,CAAC,kCAAkC,EAAE,KAAK,IAAI,EAAE;QAChD,MAAM,OAAO,GAAG,sBAAsB,EAAE,CAAC;QAEzC,OAAO,CAAC,YAAY,CAAC,QAAQ,EAAE,iBAAiB,CAAC,CAAC;QAClD,MAAM,IAAI,OAAO,CAAO,OAAO,CAAC,EAAE,CAAC,cAAc,CAAC,OAAO,CAAC,CAAC,CAAC;QAC5D,MAAM,CAAC,MAAM,CAAC,OAAO,CAAC,cAAc,CAAC,OAAO,EAAE,EAAE,EAAE,SAAS,CAAC,CAAC,CAAC;IAChE,CAAC,CAAC,CAAC;IAEH,EAAE,CAAC,yBAAyB,EAAE,KAAK,IAAI,EAAE;QACvC,MAAM,OAAO,GAAG,sBAAsB,EAAE,CAAC;QACzC,OAAO,CAAC,YAAY,CAAC,QAAQ,EAAE,cAAc,CAAC,CAAC;QAC/C,MAAM,IAAI,OAAO,CAAO,OAAO,CAAC,EAAE,CAAC,cAAc,CAAC,OAAO,CAAC,CAAC,CAAC;QAE5D,MAAM,MAAM,GAAG;YACb,IAAI,SAAS,CAAC,SAAS,CAAC,WAAW,CAAC,CAAC,EAAE,CAAC,CAAC;YACzC,IAAI,SAAS,CAAC,SAAS,CAAC,WAAW,CAAC,EAAE,EAAE,CAAC,CAAC;SAC3C,CAAC;QACF,MAAM,CAAC,MAAM,CAAC,OAAO,CAAC,cAAc,CAAC,OAAO,EAAE,MAAM,EAAE,SAAS,CAAC,CAAC,CAAC;IACpE,CAAC,CAAC,CAAC;IAEH,EAAE,CAAC,sDAAsD,EAAE,KAAK,IAAI,EAAE;QACpE,MAAM,OAAO,GAAG,sBAAsB,EAAE,CAAC;QAEzC,OAAO,CAAC,YAAY,CAAC,QAAQ,EAAE,KAAK,CAAC,CAAC;QACtC,MAAM,IAAI,OAAO,CAAO,OAAO,CAAC,EAAE,CAAC,cAAc,CAAC,OAAO,CAAC,CAAC,CAAC;QAC5D,KAAK,CAAC,MAAM,CAAC,UAAU,CAAC,OAAO,CAAC,CAAC;QAEjC,OAAO,CAAC,YAAY,EAAE,CAAC;QAEvB,OAAO,CAAC,YAAY,CAAC,QAAQ,EAAE,KAAK,CAAC,CAAC;QACtC,MAAM,IAAI,OAAO,CAAO,OAAO,CAAC,EAAE,CAAC,cAAc,CAAC,OAAO,CAAC,CAAC,CAAC;QAC5D,KAAK,CAAC,MAAM,CAAC,SAAS,CAAC,OAAO,CAAC,CAAC;IAClC,CAAC,CAAC,CAAC;AACL,CAAC,CAAC,CAAC","sourcesContent":["// Copyright 2025 The Chromium Authors\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport * as TextUtils from '../../../models/text_utils/text_utils.js';\nimport {renderElementIntoDOM} from '../../../testing/DOMHelpers.js';\n\nimport * as Highlighting from './highlighting.js';\n\ndescribe('HighlightElement', () => {\n  let setStub: sinon.SinonStub;\n\n  beforeEach(() => {\n    setStub = sinon.stub(Highlighting.HighlightManager.HighlightManager.instance({forceNew: true}), 'set');\n  });\n\n  function createHighlightElement(): HTMLElement {\n    const element = document.createElement('devtools-highlight');\n    renderElementIntoDOM(element);\n    return element;\n  }\n\n  it('sets ranges on the highlight manager when the attribute is set', async () => {\n    const element = createHighlightElement();\n    element.setAttribute('ranges', '1,2 3,4');\n    await new Promise<void>(resolve => queueMicrotask(resolve));\n\n    const expectedRanges = [\n      new TextUtils.TextRange.SourceRange(1, 6),\n    ];\n    sinon.assert.calledOnce(setStub);\n    const actualCall = setStub.getCall(0);\n    assert.strictEqual(actualCall.args[0], element);\n    assert.deepEqual(actualCall.args[1], expectedRanges);\n    assert.isUndefined(actualCall.args[2]);\n  });\n\n  it('sets current range on the highlight manager when the attribute is set', async () => {\n    const element = createHighlightElement();\n    element.setAttribute('current-range', '5,6');\n    await new Promise<void>(resolve => queueMicrotask(resolve));\n\n    const currentRange = new TextUtils.TextRange.SourceRange(5, 6);\n    assert.isTrue(setStub.calledOnceWith(element, [], currentRange));\n  });\n\n  it('updates both ranges and current range on the highlight manager', async () => {\n    const element = createHighlightElement();\n\n    element.setAttribute('ranges', '1,2 3,4');\n    await new Promise<void>(resolve => queueMicrotask(resolve));\n    const expectedRanges = [\n      new TextUtils.TextRange.SourceRange(1, 6),\n    ];\n    sinon.assert.calledOnce(setStub);\n    assert.deepEqual(setStub.getCall(0).args[1], expectedRanges);\n\n    setStub.resetHistory();\n\n    element.setAttribute('current-range', '5,6');\n    await new Promise<void>(resolve => queueMicrotask(resolve));\n    const expectedCurrentRange = new TextUtils.TextRange.SourceRange(5, 6);\n    sinon.assert.calledOnce(setStub);\n    const actualCall = setStub.getCall(0);\n    assert.strictEqual(actualCall.args[0], element);\n    assert.deepEqual(actualCall.args[1], expectedRanges);\n    assert.deepEqual(actualCall.args[2], expectedCurrentRange);\n  });\n\n  it('updates both current range and ranges on the highlight manager', async () => {\n    const element = createHighlightElement();\n\n    element.setAttribute('current-range', '5,6');\n    await new Promise<void>(resolve => queueMicrotask(resolve));\n    const expectedCurrentRange = new TextUtils.TextRange.SourceRange(5, 6);\n    sinon.assert.calledOnce(setStub);\n    assert.deepEqual(setStub.getCall(0).args[2], expectedCurrentRange);\n\n    setStub.resetHistory();\n\n    element.setAttribute('ranges', '1,2 3,4');\n    await new Promise<void>(resolve => queueMicrotask(resolve));\n    const expectedRanges = [\n      new TextUtils.TextRange.SourceRange(1, 6),\n    ];\n    sinon.assert.calledOnce(setStub);\n    const actualCall = setStub.getCall(0);\n    assert.strictEqual(actualCall.args[0], element);\n    assert.deepEqual(actualCall.args[1], expectedRanges);\n    assert.deepEqual(actualCall.args[2], expectedCurrentRange);\n  });\n\n  it('handles empty range attributes', async () => {\n    const element = createHighlightElement();\n\n    element.setAttribute('ranges', '');\n    await new Promise<void>(resolve => queueMicrotask(resolve));\n    assert.isTrue(setStub.calledOnceWith(element, [], undefined));\n  });\n\n  it('handles invalid range attributes', async () => {\n    const element = createHighlightElement();\n\n    element.setAttribute('ranges', 'foo bar 1,2,3 4');\n    await new Promise<void>(resolve => queueMicrotask(resolve));\n    assert.isTrue(setStub.calledOnceWith(element, [], undefined));\n  });\n\n  it('sorts and merges ranges', async () => {\n    const element = createHighlightElement();\n    element.setAttribute('ranges', '10,2 1,3 2,3');\n    await new Promise<void>(resolve => queueMicrotask(resolve));\n\n    const ranges = [\n      new TextUtils.TextRange.SourceRange(1, 4),\n      new TextUtils.TextRange.SourceRange(10, 2),\n    ];\n    assert.isTrue(setStub.calledOnceWith(element, ranges, undefined));\n  });\n\n  it('does not call set if attribute value does not change', async () => {\n    const element = createHighlightElement();\n\n    element.setAttribute('ranges', '1,2');\n    await new Promise<void>(resolve => queueMicrotask(resolve));\n    sinon.assert.calledOnce(setStub);\n\n    setStub.resetHistory();\n\n    element.setAttribute('ranges', '1,2');\n    await new Promise<void>(resolve => queueMicrotask(resolve));\n    sinon.assert.notCalled(setStub);\n  });\n});\n"]}