{"version":3,"file":"Tooltip.test.js","sourceRoot":"","sources":["../../../../../../../front_end/ui/components/tooltip/Tooltip.test.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright 2025 The Chromium Authors. All rights reserved.\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport {renderElementIntoDOM} from '../../../testing/DOMHelpers.js';\nimport {checkForPendingActivity} from '../../../testing/TrackAsyncOperations.js';\nimport * as Lit from '../../lit/lit.js';\n\nimport * as TooltipModule from './Tooltip.js';\nimport type {TooltipVariant} from './Tooltip.js';\n\nconst {\n  closestAnchor,\n  Tooltip,\n} = TooltipModule;\n\nconst {html, Directives} = Lit;\nconst {ref, createRef} = Directives;\n\ninterface RenderProps {\n  variant?: TooltipVariant;\n  attribute?: 'aria-describedby'|'aria-details';\n  useClick?: boolean;\n}\n\nfunction renderTooltip({\n  variant = 'simple',\n  attribute = 'aria-describedby',\n  useClick = false,\n}: RenderProps = {}) {\n  const container = document.createElement('div');\n  // clang-format off\n  Lit.render(html`\n    ${attribute === 'aria-details' ?\n      html`<button aria-details=\"tooltip-id\">Button</button>` :\n      html`<button aria-describedby=\"tooltip-id\">Button</button>`\n    }\n    <devtools-tooltip id=\"tooltip-id\" variant=${variant} ?use-click=${useClick}>\n      ${variant === 'rich' ? html`<p>Rich content</p>` : 'Simple content'}\n    </devtools-tooltip>\n  `, container);\n  // clang-format on\n  renderElementIntoDOM(container);\n  return container;\n}\n\ndescribe('Tooltip', () => {\n  it('renders a simple tooltip', () => {\n    const container = renderTooltip();\n    const tooltip = container.querySelector('devtools-tooltip');\n    assert.strictEqual(tooltip?.variant, 'simple');\n    assert.strictEqual(container.querySelector('devtools-tooltip')?.textContent?.trim(), 'Simple content');\n  });\n\n  it('renders a rich tooltip', () => {\n    const container = renderTooltip({variant: 'rich', attribute: 'aria-details'});\n    const tooltip = container.querySelector('devtools-tooltip');\n    assert.strictEqual(tooltip?.variant, 'rich');\n    assert.strictEqual(container.querySelector('devtools-tooltip')?.querySelector('p')?.textContent, 'Rich content');\n  });\n\n  it('should be activated if hovered', async () => {\n    const container = renderTooltip();\n\n    const button = container.querySelector('button');\n    button?.dispatchEvent(new MouseEvent('mouseenter'));\n\n    await checkForPendingActivity();\n    assert.isTrue(container.querySelector('devtools-tooltip')?.open);\n  });\n\n  it('should not open on hover if use-click is set', async () => {\n    const container = renderTooltip({useClick: true});\n\n    const button = container.querySelector('button');\n    button?.dispatchEvent(new MouseEvent('mouseenter'));\n\n    await checkForPendingActivity();\n    assert.isFalse(container.querySelector('devtools-tooltip')?.open);\n  });\n\n  it('should open with click if use-click is set', () => {\n    const container = renderTooltip({useClick: true});\n\n    const button = container.querySelector('button');\n    button?.click();\n\n    assert.isTrue(container.querySelector('devtools-tooltip')?.open);\n  });\n\n  const eventsNotToPropagate = ['click', 'mouseup'];\n\n  eventsNotToPropagate.forEach(eventName => {\n    it('shoould stop propagation of click events', () => {\n      const container = renderTooltip();\n      const callback = sinon.spy();\n      container.addEventListener(eventName, callback);\n\n      const tooltip = container.querySelector('devtools-tooltip');\n      tooltip?.dispatchEvent(new Event(eventName, {bubbles: true}));\n\n      assert.isFalse(callback.called);\n      container.removeEventListener(eventName, callback);\n    });\n  });\n\n  it('should print a warning if rich tooltip is used with wrong aria label on anchor', () => {\n    const consoleSpy = sinon.spy(console, 'warn');\n    renderTooltip({variant: 'rich'});\n    assert.isTrue(consoleSpy.calledOnce);\n  });\n\n  it('can be instantiated programatically', () => {\n    const container = document.createElement('div');\n    const anchor = document.createElement('button');\n    const tooltip = new Tooltip({id: 'tooltip-id', anchor});\n    tooltip.append('Text content');\n    container.appendChild(anchor);\n    container.appendChild(tooltip);\n    renderElementIntoDOM(container);\n\n    assert.strictEqual(anchor.style.anchorName, '--tooltip-id-anchor');\n  });\n});\n\ndescribe('closestAnchor', () => {\n  function renderTemplate(template: Lit.TemplateResult) {\n    const container = document.createElement('div');\n    Lit.render(template, container);\n    renderElementIntoDOM(container);\n  }\n\n  it('finds a previous sibling anchor', () => {\n    const origin = createRef();\n    const expectedAchnor = createRef();\n    // clang-format off\n    renderTemplate(html`\n      <div class=\"anchor\" ${ref(expectedAchnor)}></div>\n      <div ${ref(origin)}></div>\n    `);\n    // clang-format on\n\n    const actual = closestAnchor(origin.value!, '.anchor');\n\n    assert.strictEqual(actual, expectedAchnor.value);\n  });\n\n  it('finds a parent', () => {\n    const origin = createRef();\n    const expectedAchnor = createRef();\n    // clang-format off\n    renderTemplate(html`\n      <div class=\"anchor\" ${ref(expectedAchnor)}>\n        <div ${ref(origin)}></div>\n      </div>\n    `);\n    // clang-format on\n\n    const actual = closestAnchor(origin.value!, '.anchor');\n\n    assert.strictEqual(actual, expectedAchnor.value);\n  });\n\n  it('finds an ancestors decendant', () => {\n    const origin = createRef();\n    const expectedAchnor = createRef();\n    // clang-format off\n    renderTemplate(html`\n      <div>\n        <div>\n          <div class=\"anchor\" ${ref(expectedAchnor)}></div>\n        </div>\n        <div>\n          <div ${ref(origin)}></div>\n        </div>\n      </div>\n    `);\n    // clang-format on\n\n    const actual = closestAnchor(origin.value!, '.anchor');\n\n    assert.strictEqual(actual, expectedAchnor.value);\n  });\n\n  it('takes the next anchor up the tree', () => {\n    const origin = createRef();\n    const expectedAchnor = createRef();\n    // clang-format off\n    renderTemplate(html`\n      <div class=\"anchor a\"></div>\n      <div class=\"anchor b\"></div>\n      <div class=\"anchor c\" ${ref(expectedAchnor)}></div>\n      <div ${ref(origin)}></div>\n      <div class=\"anchor d\"></div>\n    `);\n    // clang-format on\n\n    const actual = closestAnchor(origin.value!, '.anchor');\n\n    assert.strictEqual(actual, expectedAchnor.value);\n  });\n});\n"]}