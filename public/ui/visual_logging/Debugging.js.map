{"version":3,"file":"Debugging.js","sourceRoot":"","sources":["../../../../../../front_end/ui/visual_logging/Debugging.ts"],"names":[],"mappings":"AAAA,4DAA4D;AAC5D,yEAAyE;AACzE,6BAA6B;AAE7B,OAAO,EAAC,wBAAwB,EAAC,MAAM,iCAAiC,CAAC;AAGzE,OAAO,EAAqB,cAAc,EAAC,MAAM,oBAAoB,CAAC;AACtE,OAAO,EAAC,eAAe,EAAoB,MAAM,mBAAmB,CAAC;AAErE,IAAI,kBAAkB,GAAG,KAAK,CAAC;AAC/B,IAAI,YAAY,GAAqB,IAAI,CAAC;AAC1C,MAAM,mBAAmB,GAAG,IAAI,OAAO,EAAyB,CAAC;AAEjE,SAAS,qBAAqB,CAAC,OAAgB;IAC7C,kBAAkB,GAAG,OAAO,CAAC;IAC7B,IAAI,OAAO,IAAI,CAAC,YAAY,EAAE;QAC5B,YAAY,GAAG,QAAQ,CAAC,aAAa,CAAC,KAAK,CAAC,CAAC;QAC7C,YAAY,CAAC,SAAS,CAAC,GAAG,CAAC,UAAU,CAAC,CAAC;QACvC,YAAY,CAAC,KAAK,CAAC,QAAQ,GAAG,UAAU,CAAC;QACzC,YAAY,CAAC,KAAK,CAAC,MAAM,GAAG,OAAO,CAAC;QACpC,YAAY,CAAC,KAAK,CAAC,IAAI,GAAG,OAAO,CAAC;QAClC,YAAY,CAAC,KAAK,CAAC,UAAU,GAAG,OAAO,CAAC;QACxC,YAAY,CAAC,KAAK,CAAC,KAAK,GAAG,OAAO,CAAC;QACnC,YAAY,CAAC,KAAK,CAAC,MAAM,GAAG,QAAQ,CAAC;QACrC,QAAQ,CAAC,IAAI,CAAC,WAAW,CAAC,YAAY,CAAC,CAAC;KACzC;AACH,CAAC;AAED,aAAa;AACb,UAAU,CAAC,qBAAqB,GAAG,qBAAqB,CAAC;AAEzD,MAAM,UAAU,mBAAmB,CAAC,QAAkB;IACpD,MAAM,YAAY,GAAG,eAAe,CAAC,QAAQ,CAAC,CAAC;IAC/C,IAAI,CAAC,kBAAkB,IAAI,CAAC,YAAY,IAAI,YAAY,CAAC,qBAAqB,EAAE;QAC9E,OAAO;KACR;IACD,IAAI,QAAQ,YAAY,OAAO,EAAE;QAC/B,0BAA0B,CAAC,QAAQ,EAAE,YAAY,CAAC,CAAC;KACpD;SAAM;QACL,iCAAiC,CAAC,QAAQ,EAAE,YAAY,CAAC,CAAC;KAC3D;AACH,CAAC;AAED,SAAS,gBAAgB,CAAC,OAAe;IACvC,IAAI,CAAC,YAAY,EAAE;QACjB,OAAO;KACR;IACD,YAAY,CAAC,KAAK,CAAC,OAAO,GAAG,OAAO,CAAC;IACrC,YAAY,CAAC,SAAS,GAAG,OAAO,CAAC;AACnC,CAAC;AAED,SAAS,0BAA0B,CAAC,OAAgB,EAAE,YAA0B;IAC9E,IAAI,OAAO,CAAC,OAAO,KAAK,QAAQ,EAAE;QAChC,IAAI,YAAY,CAAC,MAAM,EAAE,UAAU,IAAI,YAAY,EAAE;YACnD,YAAY,CAAC,SAAS,IAAI,MAAM,GAAG,WAAW,CAAC,YAAY,CAAC,MAAM,CAAC,CAAC;YACpE,YAAY,CAAC,qBAAqB,GAAG,IAAI,CAAC;SAC3C;KACF;SAAM;QACJ,OAAuB,CAAC,KAAK,CAAC,OAAO,GAAG,eAAe,CAAC;QACzD,OAAO,CAAC,gBAAgB,CAAC,YAAY,EAAE,GAAG,EAAE;YAC1C,wBAAwB,CAAC,YAAY,CAAC,CAAC;YACvC,MAAM,UAAU,GAAG,CAAC,YAAY,CAAC,CAAC;YAClC,IAAI,QAAQ,GAAG,YAAY,CAAC,MAAM,CAAC;YACnC,OAAO,QAAQ,EAAE;gBACf,UAAU,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;gBAC1B,QAAQ,GAAG,QAAQ,CAAC,MAAM,CAAC;aAC5B;YACD,gBAAgB,CAAC,UAAU,CAAC,GAAG,CAAC,CAAC,CAAC,EAAE,CAAC,WAAW,CAAC,CAAC,CAAC,MAAM,CAAC,CAAC,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC,CAAC;QAC5E,CAAC,EAAE,EAAC,OAAO,EAAE,IAAI,EAAC,CAAC,CAAC;QACpB,OAAO,CAAC,gBAAgB,CAAC,YAAY,EAAE,GAAG,EAAE;YAC1C,wBAAwB,CAAC,YAAY,CAAC,CAAC;YACvC,YAAY,CAAC,KAAK,CAAC,OAAO,GAAG,MAAM,CAAC;QACtC,CAAC,EAAE,EAAC,OAAO,EAAE,IAAI,EAAC,CAAC,CAAC;QACpB,YAAY,CAAC,qBAAqB,GAAG,IAAI,CAAC;KAC3C;AACH,CAAC;AAED,MAAM,UAAU,wBAAwB,CAAC,IAAY,EAAE,MAAsB,EAAE,OAAgB;IAC7F,IAAI,CAAC,kBAAkB,EAAE;QACvB,OAAO;KACR;IACD,gBAAgB,CAAC,GAAG,IAAI,KAAK,MAAM,CAAC,CAAC,CAAC,WAAW,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC,EAAE,KAAK,OAAO,CAAC,CAAC,CAAC,WAAW,GAAG,OAAO,CAAC,CAAC,CAAC,EAAE,EAAE,CAAC,CAAC;AAC7G,CAAC;AAED,SAAS,iCAAiC,CAAC,QAAkB,EAAE,YAA0B;IACvF,IAAI,YAAY,GAAG,mBAAmB,CAAC,GAAG,CAAC,QAAQ,CAAC,CAAC;IACrD,IAAI,CAAC,YAAY,EAAE;QACjB,YAAY,GAAG,QAAQ,CAAC,aAAa,CAAC,KAAK,CAAC,CAAC;QAC7C,YAAY,CAAC,SAAS,CAAC,GAAG,CAAC,UAAU,CAAC,CAAC;QACvC,YAAY,CAAC,KAAK,CAAC,UAAU,GAAG,OAAO,CAAC;QACxC,YAAY,CAAC,KAAK,CAAC,KAAK,GAAG,OAAO,CAAC;QACnC,YAAY,CAAC,KAAK,CAAC,MAAM,GAAG,QAAQ,CAAC;QACrC,YAAY,CAAC,WAAW,GAAG,WAAW,CAAC,YAAY,CAAC,MAAM,CAAC,CAAC;QAC5D,mBAAmB,CAAC,GAAG,CAAC,QAAQ,EAAE,YAAY,CAAC,CAAC;QAChD,UAAU,CAAC,GAAG,EAAE;YACd,IAAI,CAAC,YAAY,CAAC,IAAI,EAAE,KAAK,IAAI,CAAC,YAAY,CAAC,IAAI,EAAE,MAAM,EAAE;gBAC3D,YAAY,EAAE,aAAa,EAAE,WAAW,CAAC,YAAY,CAAC,CAAC;gBACvD,mBAAmB,CAAC,MAAM,CAAC,QAAQ,CAAC,CAAC;aACtC;QACH,CAAC,EAAE,KAAK,CAAC,CAAC;KACX;IACD,MAAM,kBAAkB,GACpB,MAAM,YAAY,WAAW,CAAC,CAAC,CAAC,MAAM,CAAC,CAAC,CAAC,mBAAmB,CAAC,GAAG,CAAC,MAAkB,CAAC,IAAI,YAAY,CAAC;IACzG,wBAAwB,CAAC,kBAAkB,CAAC,CAAC;IAC7C,IAAI,CAAC,kBAAkB,CAAC,SAAS,CAAC,QAAQ,CAAC,UAAU,CAAC,EAAE;QACtD,YAAY,CAAC,KAAK,CAAC,QAAQ,GAAG,UAAU,CAAC;QACzC,kBAAkB,CAAC,YAAY,CAAC,YAAY,EAAE,kBAAkB,CAAC,UAAU,CAAC,CAAC;KAC9E;SAAM;QACL,YAAY,CAAC,KAAK,CAAC,UAAU,GAAG,MAAM,CAAC;QACvC,kBAAkB,CAAC,WAAW,CAAC,YAAY,CAAC,CAAC;KAC9C;AACH,CAAC;AAED,MAAM,UAAU,WAAW,CAAC,MAAqB;IAC/C,MAAM,UAAU,GAAG,CAAC,cAAc,CAAC,MAAM,CAAC,EAAE,CAAC,CAAC,CAAC;IAC/C,IAAI,MAAM,CAAC,OAAO,EAAE;QAClB,UAAU,CAAC,IAAI,CAAC,YAAY,MAAM,CAAC,OAAO,EAAE,CAAC,CAAC;KAC/C;IACD,IAAI,MAAM,CAAC,MAAM,EAAE;QACjB,UAAU,CAAC,IAAI,CAAC,WAAW,MAAM,CAAC,MAAM,EAAE,CAAC,CAAC;KAC7C;IACD,IAAI,MAAM,CAAC,KAAK,EAAE,IAAI,EAAE;QACtB,UAAU,CAAC,IAAI,CAAC,UACR,CAAC,GAAG,MAAM,CAAC,KAAK,EAAE,OAAO,EAAE,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC,GAAG,EAAE,KAAK,CAAC,EAAE,EAAE,CAAC,GAAG,GAAG,GAAG,KAAK,CAAC,CAAC,CAAC,KAAK,KAAK,EAAE,CAAC,CAAC,CAAC,EAAE,EAAE,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,EAAE,CAAC,CAAC;KAChH;IACD,OAAO,UAAU,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;AAC/B,CAAC","sourcesContent":["// Copyright 2023 The Chromium Authors. All rights reserved.\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport {assertNotNullOrUndefined} from '../../core/platform/platform.js';\n\nimport {type Loggable} from './Loggable.js';\nimport {type LoggingConfig, VisualElements} from './LoggingConfig.js';\nimport {getLoggingState, type LoggingState} from './LoggingState.js';\n\nlet veDebuggingEnabled = false;\nlet debugPopover: HTMLElement|null = null;\nconst nonDomDebugElements = new WeakMap<Loggable, HTMLElement>();\n\nfunction setVeDebuggingEnabled(enabled: boolean): void {\n  veDebuggingEnabled = enabled;\n  if (enabled && !debugPopover) {\n    debugPopover = document.createElement('div');\n    debugPopover.classList.add('ve-debug');\n    debugPopover.style.position = 'absolute';\n    debugPopover.style.bottom = '100px';\n    debugPopover.style.left = '100px';\n    debugPopover.style.background = 'black';\n    debugPopover.style.color = 'white';\n    debugPopover.style.zIndex = '100000';\n    document.body.appendChild(debugPopover);\n  }\n}\n\n// @ts-ignore\nglobalThis.setVeDebuggingEnabled = setVeDebuggingEnabled;\n\nexport function processForDebugging(loggable: Loggable): void {\n  const loggingState = getLoggingState(loggable);\n  if (!veDebuggingEnabled || !loggingState || loggingState.processedForDebugging) {\n    return;\n  }\n  if (loggable instanceof Element) {\n    processElementForDebugging(loggable, loggingState);\n  } else {\n    processNonDomLoggableForDebugging(loggable, loggingState);\n  }\n}\n\nfunction showDebugPopover(content: string): void {\n  if (!debugPopover) {\n    return;\n  }\n  debugPopover.style.display = 'block';\n  debugPopover.innerHTML = content;\n}\n\nfunction processElementForDebugging(element: Element, loggingState: LoggingState): void {\n  if (element.tagName === 'OPTION') {\n    if (loggingState.parent?.selectOpen && debugPopover) {\n      debugPopover.innerHTML += '<br>' + debugString(loggingState.config);\n      loggingState.processedForDebugging = true;\n    }\n  } else {\n    (element as HTMLElement).style.outline = 'solid 1px red';\n    element.addEventListener('mouseenter', () => {\n      assertNotNullOrUndefined(debugPopover);\n      const pathToRoot = [loggingState];\n      let ancestor = loggingState.parent;\n      while (ancestor) {\n        pathToRoot.push(ancestor);\n        ancestor = ancestor.parent;\n      }\n      showDebugPopover(pathToRoot.map(s => debugString(s.config)).join('<br>'));\n    }, {capture: true});\n    element.addEventListener('mouseleave', () => {\n      assertNotNullOrUndefined(debugPopover);\n      debugPopover.style.display = 'none';\n    }, {capture: true});\n    loggingState.processedForDebugging = true;\n  }\n}\n\nexport function showDebugPopoverForEvent(name: string, config?: LoggingConfig, context?: string): void {\n  if (!veDebuggingEnabled) {\n    return;\n  }\n  showDebugPopover(`${name}: ${config ? debugString(config) : ''}; ${context ? 'context: ' + context : ''}`);\n}\n\nfunction processNonDomLoggableForDebugging(loggable: Loggable, loggingState: LoggingState): void {\n  let debugElement = nonDomDebugElements.get(loggable);\n  if (!debugElement) {\n    debugElement = document.createElement('div');\n    debugElement.classList.add('ve-debug');\n    debugElement.style.background = 'black';\n    debugElement.style.color = 'white';\n    debugElement.style.zIndex = '100000';\n    debugElement.textContent = debugString(loggingState.config);\n    nonDomDebugElements.set(loggable, debugElement);\n    setTimeout(() => {\n      if (!loggingState.size?.width || !loggingState.size?.height) {\n        debugElement?.parentElement?.removeChild(debugElement);\n        nonDomDebugElements.delete(loggable);\n      }\n    }, 10000);\n  }\n  const parentDebugElement =\n      parent instanceof HTMLElement ? parent : nonDomDebugElements.get(parent as Loggable) || debugPopover;\n  assertNotNullOrUndefined(parentDebugElement);\n  if (!parentDebugElement.classList.contains('ve-debug')) {\n    debugElement.style.position = 'absolute';\n    parentDebugElement.insertBefore(debugElement, parentDebugElement.firstChild);\n  } else {\n    debugElement.style.marginLeft = '10px';\n    parentDebugElement.appendChild(debugElement);\n  }\n}\n\nexport function debugString(config: LoggingConfig): string {\n  const components = [VisualElements[config.ve]];\n  if (config.context) {\n    components.push(`context: ${config.context}`);\n  }\n  if (config.parent) {\n    components.push(`parent: ${config.parent}`);\n  }\n  if (config.track?.size) {\n    components.push(`track: ${\n            [...config.track?.entries()].map(([key, value]) => `${key}${value ? `: ${value}` : ''}`).join(', ')}`);\n  }\n  return components.join('; ');\n}\n"]}