{"version":3,"file":"LoggingEvents.js","sourceRoot":"","sources":["../../../../../../front_end/ui/visual_logging/LoggingEvents.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright 2023 The Chromium Authors. All rights reserved.\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport type * as Common from '../../core/common/common.js';\nimport * as Host from '../../core/host/host.js';\nimport {assertNotNullOrUndefined} from '../../core/platform/platform.js';\n\nimport {showDebugPopoverForEvent} from './Debugging.js';\nimport {type Loggable} from './Loggable.js';\nimport {getLoggingState} from './LoggingState.js';\n\nexport async function logImpressions(loggables: Loggable[]): Promise<void> {\n  const impressions = await Promise.all(loggables.map(async loggable => {\n    const loggingState = getLoggingState(loggable);\n    assertNotNullOrUndefined(loggingState);\n    const impression:\n        Host.InspectorFrontendHostAPI.VisualElementImpression = {id: loggingState.veid, type: loggingState.config.ve};\n    if (typeof loggingState.config.context !== 'undefined') {\n      impression.context = await contextAsNumber(loggingState.config.context);\n    }\n    if (loggingState.parent) {\n      impression.parent = loggingState.parent.veid;\n    }\n    if (loggingState.size) {\n      impression.width = loggingState.size.width;\n      impression.height = loggingState.size.height;\n    }\n    return impression;\n  }));\n  if (impressions.length) {\n    Host.InspectorFrontendHost.InspectorFrontendHostInstance.recordImpression({impressions});\n  }\n}\n\nexport const logResize = (throttler: Common.Throttler.Throttler) => (loggable: Loggable, size: DOMRect) => {\n  const loggingState = getLoggingState(loggable);\n  if (!loggingState) {\n    return;\n  }\n  loggingState.size = size;\n  const resizeEvent: Host.InspectorFrontendHostAPI\n      .ResizeEvent = {veid: loggingState.veid, width: loggingState.size.width, height: loggingState.size.height};\n  void throttler.schedule(async () => {\n    Host.InspectorFrontendHost.InspectorFrontendHostInstance.recordResize(resizeEvent);\n    showDebugPopoverForEvent('Resize', loggingState?.config);\n  });\n};\n\nexport const logClick = (throttler: Common.Throttler.Throttler) => (\n    loggable: Loggable, event: Event, options?: {doubleClick?: boolean}) => {\n  const loggingState = getLoggingState(loggable);\n  if (!loggingState) {\n    return;\n  }\n  const button = event instanceof MouseEvent ? event.button : 0;\n  const clickEvent: Host.InspectorFrontendHostAPI\n      .ClickEvent = {veid: loggingState.veid, mouseButton: button, doubleClick: Boolean(options?.doubleClick)};\n  void throttler.schedule(async () => {\n    Host.InspectorFrontendHost.InspectorFrontendHostInstance.recordClick(clickEvent);\n    showDebugPopoverForEvent('Click', loggingState?.config);\n  });\n};\n\nexport const logHover = (throttler: Common.Throttler.Throttler) => async (event: Event) => {\n  const loggingState = getLoggingState(event.currentTarget as Element);\n  assertNotNullOrUndefined(loggingState);\n  const hoverEvent: Host.InspectorFrontendHostAPI.HoverEvent = {veid: loggingState.veid};\n  void throttler.schedule(async () => {\n    Host.InspectorFrontendHost.InspectorFrontendHostInstance.recordHover(hoverEvent);\n    showDebugPopoverForEvent('Hover', loggingState?.config);\n  });\n};\n\nexport const logDrag = (throttler: Common.Throttler.Throttler) => async (event: Event) => {\n  const loggingState = getLoggingState(event.currentTarget as Element);\n  assertNotNullOrUndefined(loggingState);\n  const dragEvent: Host.InspectorFrontendHostAPI.DragEvent = {veid: loggingState.veid};\n  void throttler.schedule(async () => {\n    Host.InspectorFrontendHost.InspectorFrontendHostInstance.recordDrag(dragEvent);\n    showDebugPopoverForEvent('Drag', loggingState?.config);\n  });\n};\n\nexport async function logChange(event: Event): Promise<void> {\n  const loggingState = getLoggingState(event.currentTarget as Element);\n  assertNotNullOrUndefined(loggingState);\n  const changeEvent: Host.InspectorFrontendHostAPI.ChangeEvent = {veid: loggingState.veid};\n  Host.InspectorFrontendHost.InspectorFrontendHostInstance.recordChange(changeEvent);\n  showDebugPopoverForEvent('Change', loggingState?.config);\n}\n\nexport const logKeyDown =\n    (throttler: Common.Throttler.Throttler, codes?: string[]) => async (event: Event|null, context?: string) => {\n      if (!(event instanceof KeyboardEvent)) {\n        return;\n      }\n      if (codes?.length && !codes.includes(event.code)) {\n        return;\n      }\n      const loggingState = event?.currentTarget ? getLoggingState(event.currentTarget) : null;\n      const keyDownEvent: Host.InspectorFrontendHostAPI.KeyDownEvent = {veid: loggingState?.veid};\n      if (!context && codes?.length) {\n        context = contextFromKeyCodes(event);\n      }\n      if (context) {\n        keyDownEvent.context = await contextAsNumber(context);\n      }\n      void throttler.schedule(async () => {\n        Host.InspectorFrontendHost.InspectorFrontendHostInstance.recordKeyDown(keyDownEvent);\n        showDebugPopoverForEvent('KeyDown', loggingState?.config, context);\n      });\n    };\n\nfunction contextFromKeyCodes(event: Event): string|undefined {\n  if (!(event instanceof KeyboardEvent)) {\n    return undefined;\n  }\n  const components = [];\n  if (event.shiftKey) {\n    components.push('shift');\n  }\n  if (event.ctrlKey) {\n    components.push('ctrl');\n  }\n  if (event.altKey) {\n    components.push('alt');\n  }\n  if (event.metaKey) {\n    components.push('meta');\n  }\n  components.push(event.key.toLowerCase());\n  return components.join('-');\n}\n\nasync function contextAsNumber(context: string|undefined): Promise<number|undefined> {\n  if (typeof context === 'undefined') {\n    return undefined;\n  }\n  const number = parseInt(context, 10);\n  if (!isNaN(number)) {\n    return number;\n  }\n  if (!crypto.subtle) {\n    // Layout tests run in an insecure context where crypto.subtle is not available.\n    return 0xDEADBEEF;\n  }\n  const encoder = new TextEncoder();\n  const data = encoder.encode(context);\n  const digest = await crypto.subtle.digest('SHA-1', data);\n  return new DataView(digest).getUint32(0, true);\n}\n"]}