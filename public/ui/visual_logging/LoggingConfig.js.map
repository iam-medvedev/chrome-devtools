{"version":3,"file":"LoggingConfig.js","sourceRoot":"","sources":["../../../../../../front_end/ui/visual_logging/LoggingConfig.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright 2023 The Chromium Authors. All rights reserved.\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nconst LOGGING_ATTRIBUTE = 'jslog';\n\nexport interface LoggingConfig {\n  ve: number;\n  track?: Map<string, string|undefined>;\n  context?: string;\n  parent?: string;\n}\n\nexport function needsLogging(element: Element): boolean {\n  return element.hasAttribute(LOGGING_ATTRIBUTE);\n}\n\nexport function getLoggingConfig(element: Element): LoggingConfig {\n  return parseJsLog(element.getAttribute(LOGGING_ATTRIBUTE) || '');\n}\n\nenum VisualElements {\n  TreeItem = 1,\n  /* 2 used to be AriaAttributes, but free to grab now */\n  /* 3 used to be AccessibilityComputedProperties, but free to grab now */\n  /* 4 used to be AccessibilityPane, but free to grab now */\n  /* 5 used to be AccessibilitySourceOrder, but free to grab now */\n  Toggle = 6,\n  Tree = 7,\n  TextField = 8,\n  /* 9 used to be ShowAllStyleProperties, but free to grab now */\n  Section = 10,\n  StylePropertiesSectionSeparator = 11,\n  /* 12 used to be StylesPane, but free to grab now */\n  StylesSelector = 13,\n  TreeItemExpand = 14,\n  ToggleSubpane = 15,\n  /* 16 used to be ElementClassesPane, but free to grab now */\n  /* 17 used to be AddElementClassPrompt, but free to grab now */\n  /* 18 used to be ElementStatesPan, but free to grab now */\n  /* 19 used to be CssLayersPane, but free to grab now */\n  DropDown = 20,\n  /* 21 used to be StylesMetricsPane, but free to grab now */\n  /* 22 used to be JumpToSource, but free to grab now */\n  MetricsBox = 23,\n  MetricsBoxPart = 24,\n  /* 25 used to be DOMBreakpointsPane, but free to grab now */\n  DOMBreakpoint = 26,\n  /* 27 used to be ElementPropertiesPane, but free to grab now */\n  /* 28 used to be EventListenersPane, but free to grab now */\n  Action = 29,\n  FilterDropdown = 30,\n  InfoBar = 31,\n  BezierCurveEditor = 32,\n  BezierEditor = 33,\n  BezierPresetCategory = 34,\n  Preview = 35,\n  Canvas = 36,\n  ColorEyeDropper = 37,\n  ColorPicker = 38,\n  /* 39 used to be CopyColor, but free to grab now */\n  CssAngleEditor = 40,\n  CssFlexboxEditor = 41,\n  CssGridEditor = 42,\n  CssShadowEditor = 43,\n  Link = 44,\n  /* 45 used to be Next, but free to grab now */\n  Item = 46,\n  PaletteColorShades = 47,\n  Panel = 48,\n  /* 49 used to be Previous, but free to grab now */\n  ShowStyleEditor = 50,\n  Slider = 51,\n  CssColorMix = 52,\n  Value = 53,\n  Key = 54,\n  /* 55 used to be GridSettings, but free to grab now */\n  /* 56 used to be FlexboxOverlays, but free to grab now */\n  /* 57 used to be GridOverlays, but free to grab now */\n  /* 58 used to be JumpToElement, but free to grab now */\n  PieChart = 59,\n  PieChartSlice = 60,\n  PieChartTotal = 61,\n  ElementsBreadcrumbs = 62,\n  /* 63 used to be FullAccessibilityTree, but free to grab now */\n  /* 64 used to be ToggleDeviceMode, but free to grab now */\n  /* 65 used to be ToggleElementSearch, but free to grab now */\n  PanelTabHeader = 66,\n  Menu = 67,\n  /* 68 used to be DeveloperResourcesPanel, but free to grab now */\n  TableHeader = 69,\n  TableCell = 70,\n  /* 71 used to be StylesComputedPane, but free to grab now */\n  Pane = 72,\n  ResponsivePresets = 73,\n  DeviceModeRuler = 74,\n  MediaInspectorView = 75,\n}\n\nexport type VisualElementName = keyof typeof VisualElements;\n\nfunction resolveVe(ve: string): number {\n  return VisualElements[ve as VisualElementName] ?? 0;\n}\n\nexport function parseJsLog(jslog: string): LoggingConfig {\n  const components = jslog.replace(/ /g, '').split(';');\n  const getComponent = (name: string): string|undefined =>\n      components.find(c => c.startsWith(name))?.substr(name.length);\n  const ve = resolveVe(components[0]);\n  if (ve === 0) {\n    throw new Error('Unkown VE: ' + jslog);\n  }\n  const config: LoggingConfig = {ve};\n  const context = getComponent('context:');\n  if (context) {\n    config.context = context;\n  }\n\n  const parent = getComponent('parent:');\n  if (parent) {\n    config.parent = parent;\n  }\n\n  const trackString = getComponent('track:');\n  if (trackString) {\n    config.track = new Map<string, string>(trackString.split(',').map(t => t.split(':') as [string, string]));\n  }\n\n  return config;\n}\n\nexport function debugString(config: LoggingConfig): string {\n  const components = [VisualElements[config.ve]];\n  if (config.context) {\n    components.push(`context: ${config.context}`);\n  }\n  if (config.parent) {\n    components.push(`parent: ${config.parent}`);\n  }\n  if (config.track?.size) {\n    components.push(`track: ${\n            [...config.track?.entries()].map(([key, value]) => `${key}${value ? `: ${value}` : ''}`).join(', ')}`);\n  }\n  return components.join('; ');\n}\n\nexport interface ConfigStringBuilder {\n  /**\n   * Specifies an optional context for the visual element. For string contexts\n   * the convention is to use kebap case (e.g. `foo-bar`).\n   *\n   * @param value Optional context, which can be either a string or a number.\n   * @returns The builder itself.\n   */\n  context: (value: string|number|undefined) => ConfigStringBuilder;\n\n  /**\n   * Speficies the name of a `ParentProvider` used to lookup the parent visual element.\n   *\n   * @param value The name of a previously registered `ParentProvider`.\n   * @returns The builder itself.\n   */\n  parent: (value: string) => ConfigStringBuilder;\n\n  /**\n   * Specifies which DOM events to track for this visual element.\n   *\n   * @param options The set of DOM events to track.\n   * @returns The builder itself.\n   */\n  track: (options: {\n    click?: boolean,\n    dblclick?: boolean,\n    hover?: boolean,\n    drag?: boolean,\n    change?: boolean,\n    keydown?: boolean|string,\n  }) => ConfigStringBuilder;\n\n  /**\n   * Serializes the configuration into a `jslog` string.\n   *\n   * @returns The serialized string value to put on a DOM element via the `jslog` attribute.\n   */\n  toString: () => string;\n}\n\nexport function makeConfigStringBuilder(veName: VisualElementName): ConfigStringBuilder {\n  const components: string[] = [veName];\n  return {\n    context: function(value: string|number|undefined): ConfigStringBuilder {\n      if (typeof value !== 'undefined') {\n        components.push(`context: ${value}`);\n      }\n      return this;\n    },\n    parent: function(value: string): ConfigStringBuilder {\n      components.push(`parent: ${value}`);\n      return this;\n    },\n    track: function(options: {\n      click?: boolean,\n      dblclick?: boolean,\n      hover?: boolean,\n      drag?: boolean,\n      change?: boolean,\n      keydown?: boolean|string,\n    }): ConfigStringBuilder {\n      components.push(`track: ${\n          Object.entries(options).map(([key, value]) => value !== true ? `${key}: ${value}` : key).join(', ')}`);\n      return this;\n    },\n    toString: function(): string {\n      return components.join('; ');\n    },\n  };\n}\n"]}