{"version":3,"file":"SettingRegistration.test.js","sourceRoot":"","sources":["../../../../../../front_end/core/common/SettingRegistration.test.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright 2020 The Chromium Authors\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport {\n  updateHostConfig,\n} from '../../testing/EnvironmentHelpers.js';\nimport {setupSettings} from '../../testing/SettingsHelpers.js';\nimport * as i18n from '../i18n/i18n.js';\n\nimport * as Common from './common.js';\n\nconst settingName = 'mock-setting';\nconst settingTitle = 'Mock setting';\nconst enableTitle = 'Enable mock setting';\nconst disableTitle = 'Disable mock setting';\n\ndescribe('SettingRegistration', () => {\n  // const enum `SettingCategory` not available in top level scope, thats why\n  // its initialized here.\n  const settingCategory = Common.Settings.SettingCategory.CONSOLE;\n\n  beforeEach(() => {\n    Common.Settings.registerSettingsForTest(\n        [{\n          category: settingCategory,\n          title: i18n.i18n.lockedLazyString(settingTitle),\n          settingType: Common.Settings.SettingType.BOOLEAN,\n          settingName,\n          defaultValue: false,\n          options: [\n            {\n              value: true,\n              title: i18n.i18n.lockedLazyString(enableTitle),\n            },\n            {\n              value: false,\n              title: i18n.i18n.lockedLazyString(disableTitle),\n            },\n          ],\n        }],\n        true);\n\n    setupSettings(false);\n  });\n\n  it('retrieves a registered setting', () => {\n    const preRegisteredSetting = Common.Settings.Settings.instance().moduleSetting(settingName);\n    assert.strictEqual(preRegisteredSetting.title(), settingTitle, 'Setting title is not returned correctly');\n    assert.strictEqual(preRegisteredSetting.category(), settingCategory, 'Setting category is not returned correctly');\n    assert.isNotTrue(preRegisteredSetting.get(), 'Setting value is not returned correctly');\n  });\n\n  it('triggers a setting\\'s change listener when a setting is set', () => {\n    const preRegisteredSetting = Common.Settings.Settings.instance().moduleSetting(settingName);\n    let settingChanged = false;\n    preRegisteredSetting.addChangeListener(() => {\n      settingChanged = true;\n    });\n    preRegisteredSetting.set(true);\n    assert.isTrue(settingChanged, 'Setting\\'s change listener was not triggered after the setting was set');\n  });\n\n  it('throws an error when trying to register a duplicated setting name', () => {\n    assert.throws(() => {\n      Common.Settings.registerSettingExtension({\n        settingName,\n        settingType: Common.Settings.SettingType.BOOLEAN,\n        defaultValue: false,\n      });\n    });\n  });\n\n  it('deletes a registered setting using its name', () => {\n    const removalResult = Common.Settings.maybeRemoveSettingExtension(settingName);\n    assert.isTrue(removalResult);\n    assert.doesNotThrow(() => {\n      Common.Settings.registerSettingExtension({\n        settingName,\n        settingType: Common.Settings.SettingType.BOOLEAN,\n        defaultValue: false,\n      });\n    });\n  });\n\n  it('can handle settings with condition which depends on host config', () => {\n    const configSettingName = 'mock-setting-with-host-config';\n    updateHostConfig({\n      devToolsConsoleInsights: {\n        modelId: 'mockModel',\n        temperature: -1,\n        enabled: true,\n      },\n    });\n    Common.Settings.registerSettingExtension({\n      settingName: configSettingName,\n      settingType: Common.Settings.SettingType.BOOLEAN,\n      defaultValue: false,\n      condition: config => {\n        return config?.devToolsConsoleInsights?.enabled === true;\n      },\n    });\n    assert.throws(() => Common.Settings.Settings.instance().moduleSetting(configSettingName));\n\n    const dummyStorage = new Common.Settings.SettingsStorage({});\n    Common.Settings.Settings.instance({\n      forceNew: true,\n      syncedStorage: dummyStorage,\n      globalStorage: dummyStorage,\n      localStorage: dummyStorage,\n    });\n    const setting = Common.Settings.Settings.instance().moduleSetting(configSettingName);\n    assert.isNotNull(setting);\n    assert.isFalse(setting.get());\n  });\n});\n"]}