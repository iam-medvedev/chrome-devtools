{"version":3,"file":"i18n.test.js","sourceRoot":"","sources":["../../../../../../front_end/core/i18n/i18n.test.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright 2021 The Chromium Authors\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport * as i18nRaw from '../../third_party/i18n/i18n.js';\n\nimport * as i18n from './i18n.js';\n\ndescribe('serializeUIString', () => {\n  it('serializes strings without placeholders', () => {\n    const output = i18n.i18n.serializeUIString('foo');\n    assert.deepEqual(output, JSON.stringify({\n      string: 'foo',\n      values: {},\n    }));\n  });\n\n  it('serializes strings with placeholder values', () => {\n    const output = i18n.i18n.serializeUIString('a string', {PH1: 'value1', PH2: 'value2'});\n    assert.deepEqual(output, JSON.stringify({\n      string: 'a string',\n      values: {PH1: 'value1', PH2: 'value2'},\n    }));\n  });\n});\n\ndescribe('deserializeUIString', () => {\n  it('returns an empty object for an empty string input', () => {\n    const output = i18n.i18n.deserializeUIString('');\n    assert.deepEqual(output, {string: '', values: {}});\n  });\n\n  it('deserializes correctly for a string with no placeholders', () => {\n    const output = i18n.i18n.deserializeUIString('{\"string\":\"foo\", \"values\":{}}');\n    assert.deepEqual(output, {string: 'foo', values: {}});\n  });\n\n  it('deserializes correctly for a string with placeholders', () => {\n    const output = i18n.i18n.deserializeUIString('{\"string\":\"foo\", \"values\":{\"PH1\": \"value1\"}}');\n    assert.deepEqual(output, {string: 'foo', values: {PH1: 'value1'}});\n  });\n});\n\ndescribe('serialize/deserialize round-trip', () => {\n  it('returns a matching input/output', () => {\n    const inputString = 'a string';\n    const serializedString = i18n.i18n.serializeUIString(inputString);\n    const deserializedString = i18n.i18n.deserializeUIString(serializedString);\n    assert.deepEqual(deserializedString, {\n      string: inputString,\n      values: {},\n    });\n  });\n});\n\ndescribe('getLocalizedLanguageRegion', () => {\n  function createMockDevToolsLocale(locale: string): i18n.DevToolsLocale.DevToolsLocale {\n    return {locale, forceFallbackLocale: () => {}} as i18n.DevToolsLocale.DevToolsLocale;\n  }\n\n  it('build the correct language/region string', () => {\n    assert.strictEqual(\n        i18n.i18n.getLocalizedLanguageRegion('de-AT', createMockDevToolsLocale('en-US')),\n        'German (Austria) - Deutsch (Österreich)');\n    assert.strictEqual(\n        i18n.i18n.getLocalizedLanguageRegion('de', createMockDevToolsLocale('en-US')), 'German - Deutsch');\n    assert.strictEqual(\n        i18n.i18n.getLocalizedLanguageRegion('en-US', createMockDevToolsLocale('de')), 'Englisch (USA) - English (US)');\n  });\n\n  it('uses english for the target locale if the languages match', () => {\n    assert.strictEqual(\n        i18n.i18n.getLocalizedLanguageRegion('de-AT', createMockDevToolsLocale('de')),\n        'Deutsch (Österreich) - German (Austria)');\n    assert.strictEqual(i18n.i18n.getLocalizedLanguageRegion('de', createMockDevToolsLocale('de')), 'Deutsch - German');\n  });\n});\n\ndescribe('falling back when a locale errors', () => {\n  it('reverts to using the UIStrings directly', async () => {\n    i18n.DevToolsLocale.DevToolsLocale.instance({\n      create: true,\n      data: {\n        // Create the locale and set en-GB to default. This test is going to\n        // assert that when there is an error with the en-GB string that we\n        // fallback.\n        navigatorLanguage: 'en-GB',\n        settingLanguage: 'en-GB',\n        lookupClosestDevToolsLocale: () => 'en-GB',\n      },\n    });\n    const i18nInstance = new i18nRaw.I18n.I18n(['en-GB', 'en-US'], 'en-US');\n\n    // Recreate the bug that can happen in Canary: the en-US translation is up\n    // to date (no PH1 placeholder), but the en-GB translation is out of date.\n    // We expect that in this instance we should fallback to en-US.\n    i18nInstance.registerLocaleData('en-US', {\n      'test.ts | placeholder': {message: 'US: hello world'},\n    });\n    // Register the (outdated) en-GB string.\n    i18nInstance.registerLocaleData('en-GB', {\n      'test.ts | placeholder': {message: 'GB: hello {PH1}'},\n    });\n\n    const uiStrings = {placeholder: 'US: hello world'};\n    const registeredStrings = i18nInstance.registerFileStrings('test.ts', uiStrings);\n\n    // We should see \"hello world\" because we don't pass the placeholder value,\n    // and that means the en-GB translations are invalid, and we fallback to\n    // the UIStrings.\n    const output = i18n.i18n.getLocalizedString(registeredStrings, uiStrings.placeholder);\n    assert.strictEqual(output, 'US: hello world');\n  });\n});\n"]}