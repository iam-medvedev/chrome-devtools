{"version":3,"file":"MainImpl.test.js","sourceRoot":"","sources":["../../../../../../front_end/entrypoints/main/MainImpl.test.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright 2022 The Chromium Authors. All rights reserved.\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport * as Host from '../../core/host/host.js';\nimport * as SDK from '../../core/sdk/sdk.js';\nimport * as AiAssistanceModel from '../../models/ai_assistance/ai_assistance.js';\nimport {getMenuForToolbarButton} from '../../testing/ContextMenuHelpers.js';\nimport {createTarget, stubNoopSettings} from '../../testing/EnvironmentHelpers.js';\nimport {\n  describeWithMockConnection,\n} from '../../testing/MockConnection.js';\nimport * as UI from '../../ui/legacy/legacy.js';\n\nimport * as Main from './main.js';\n\ndescribeWithMockConnection('MainMenuItem', () => {\n  beforeEach(async () => {\n    stubNoopSettings();\n    sinon.stub(UI.ShortcutRegistry.ShortcutRegistry, 'instance').returns({\n      keyAndModifiersForAction: () => {},\n      shortcutTitleForAction: () => {},\n      shortcutsForAction: () => [],\n    } as unknown as UI.ShortcutRegistry.ShortcutRegistry);\n    const tabTaget = createTarget({type: SDK.Target.Type.TAB});\n    createTarget({parentTarget: tabTaget, subtype: 'prerender'});\n    createTarget({parentTarget: tabTaget});\n\n    sinon.stub(UI.ActionRegistry.ActionRegistry.instance(), 'hasAction')\n        .withArgs(sinon.match(/inspector-main.focus-debuggee|main.toggle-drawer|freestyler.main-menu/))\n        .returns(true);\n    sinon.stub(UI.ActionRegistry.ActionRegistry.instance(), 'getAction')\n        .withArgs(sinon.match(/inspector-main.focus-debuggee|main.toggle-drawer|freestyler.main-menu/))\n        .returns(sinon.createStubInstance(UI.ActionRegistration.Action));\n  });\n\n  it('includes focus debuggee item when undocked', async () => {\n    UI.DockController.DockController.instance().setDockSide(UI.DockController.DockState.UNDOCKED);\n\n    const item = Main.MainImpl.MainMenuItem.instance({forceNew: true}).item() as UI.Toolbar.ToolbarMenuButton;\n    const menu = getMenuForToolbarButton(item);\n    assert.exists(\n        menu.defaultSection().items.find((item: UI.ContextMenu.Item) => item.buildDescriptor().label === 'Focus page'));\n  });\n\n  it('does not include focus debuggee item when docked', async () => {\n    UI.DockController.DockController.instance().setDockSide(UI.DockController.DockState.BOTTOM);\n\n    const item = Main.MainImpl.MainMenuItem.instance({forceNew: true}).item() as UI.Toolbar.ToolbarMenuButton;\n    assert.exists(item);\n\n    const contextMenuShow = sinon.stub(UI.ContextMenu.ContextMenu.prototype, 'show').resolves();\n    item.clicked(new MouseEvent('click', {\n      bubbles: true,\n      cancelable: true,\n    }));\n\n    sinon.assert.calledOnce(contextMenuShow);\n    assert.notExists(contextMenuShow.thisValues[0].defaultSection().items.find(\n        (item: UI.ContextMenu.Item) => item.buildDescriptor().label === 'Focus page'));\n  });\n\n  describe('handleExternalRequest', () => {\n    const {handleExternalRequestGenerator} = Main.MainImpl;\n\n    it('calls into the AiAssistanceModel ConversationHandler for LIVE_STYLE_DEBUGGER', async () => {\n      const handler = AiAssistanceModel.ConversationHandler.instance({\n        aidaClient: new Host.AidaClient.AidaClient(),\n        aidaAvailability: Host.AidaClient.AidaAccessPreconditions.AVAILABLE,\n      });\n      const spy = sinon.spy(handler, 'handleExternalRequest');\n\n      await handleExternalRequestGenerator({kind: 'LIVE_STYLE_DEBUGGER', args: {prompt: 'test', selector: '#test'}});\n      sinon.assert.calledOnceWithExactly(\n          spy, {prompt: 'test', conversationType: AiAssistanceModel.ConversationType.STYLING, selector: '#test'});\n    });\n\n    it('returns an error for file assistance requests', async () => {\n      // @ts-expect-error\n      const generator = await handleExternalRequestGenerator({kind: 'FILE_DEBUGGER', args: {prompt: 'test'}});\n      const iteratorResponse = await generator.next();\n      assert.strictEqual(iteratorResponse.value.type, 'error');\n      assert.strictEqual(\n          iteratorResponse.value.message, 'Debugging with an agent of type \\'FILE_DEBUGGER\\' is not implemented yet.');\n    });\n  });\n});\n"]}