{"version":3,"file":"MainImpl.test.js","sourceRoot":"","sources":["../../../../../../front_end/entrypoints/main/MainImpl.test.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright 2022 The Chromium Authors. All rights reserved.\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nconst {assert} = chai;\n\nimport {createTarget, stubNoopSettings} from '../../../test/unittests/front_end/helpers/EnvironmentHelpers.js';\nimport * as Host from '../../core/host/host.js';\nimport {assertNotNullOrUndefined} from '../../core/platform/platform.js';\nimport * as SDK from '../../core/sdk/sdk.js';\nimport * as UI from '../../ui/legacy/legacy.js';\nimport * as ThemeSupport from '../../ui/legacy/theme_support/theme_support.js';\nimport * as Main from './main.js';\n\nimport {\n  describeWithMockConnection,\n} from '../../../test/unittests/front_end/helpers/MockConnection.js';\nimport {describeWithRealConnection} from '../../../test/unittests/front_end/helpers/RealConnection.js';\n\ndescribeWithMockConnection('MainMenuItem', () => {\n  const focusDebuggee = (targetFactory: () => SDK.Target.Target) => {\n    beforeEach(async () => {\n      stubNoopSettings();\n      sinon.stub(UI.ShortcutRegistry.ShortcutRegistry, 'instance').returns({\n        shortcutTitleForAction: () => {},\n        shortcutsForAction: () => [],\n      } as unknown as UI.ShortcutRegistry.ShortcutRegistry);\n      targetFactory();\n\n      sinon.stub(UI.ActionRegistry.ActionRegistry.instance(), 'hasAction')\n          .withArgs(sinon.match(/inspector-main.focus-debuggee|main.toggle-drawer/))\n          .returns(true);\n      sinon.stub(UI.ActionRegistry.ActionRegistry.instance(), 'getAction')\n          .withArgs(sinon.match(/inspector-main.focus-debuggee|main.toggle-drawer/))\n          .returns(sinon.createStubInstance(UI.ActionRegistration.Action));\n    });\n\n    it('includes focus debuggee item when undocked', async () => {\n      UI.DockController.DockController.instance().setDockSide(UI.DockController.DockState.UNDOCKED);\n\n      const item = Main.MainImpl.MainMenuItem.instance({forceNew: true}).item() as UI.Toolbar.ToolbarMenuButton;\n      assertNotNullOrUndefined(item);\n\n      const contextMenuShow = sinon.stub(UI.ContextMenu.ContextMenu.prototype, 'show').resolves();\n      item.clicked(new MouseEvent('click', {\n        bubbles: true,\n        cancelable: true,\n      }));\n\n      assert.isTrue(contextMenuShow.calledOnce);\n      assert.exists(contextMenuShow.thisValues[0].defaultSection().items.find(\n          (item: UI.ContextMenu.Item) => item.buildDescriptor().label === 'Focus page'));\n    });\n\n    it('does not include focus debuggee item when docked', async () => {\n      UI.DockController.DockController.instance().setDockSide(UI.DockController.DockState.BOTTOM);\n\n      const item = Main.MainImpl.MainMenuItem.instance({forceNew: true}).item() as UI.Toolbar.ToolbarMenuButton;\n      assertNotNullOrUndefined(item);\n\n      const contextMenuShow = sinon.stub(UI.ContextMenu.ContextMenu.prototype, 'show').resolves();\n      item.clicked(new MouseEvent('click', {\n        bubbles: true,\n        cancelable: true,\n      }));\n\n      assert.isTrue(contextMenuShow.calledOnce);\n      assert.notExists(contextMenuShow.thisValues[0].defaultSection().items.find(\n          (item: UI.ContextMenu.Item) => item.buildDescriptor().label === 'Focus page'));\n    });\n  };\n  describe('without tab target', () => focusDebuggee(() => createTarget()));\n  describe('with tab target', () => focusDebuggee(() => {\n                                const tabTaget = createTarget({type: SDK.Target.Type.Tab});\n                                createTarget({parentTarget: tabTaget, subtype: 'prerender'});\n                                return createTarget({parentTarget: tabTaget});\n                              }));\n});\n\ndescribeWithRealConnection('MainImpl', () => {\n  it('calls fetchColors on ColorThemeChanged', async () => {\n    const colorFetchSpy = sinon.spy(ThemeSupport.ThemeSupport, 'fetchColors');\n\n    Host.InspectorFrontendHost.InspectorFrontendHostInstance.events.dispatchEventToListeners(\n        Host.InspectorFrontendHostAPI.Events.ColorThemeChanged);\n\n    assert.isTrue(colorFetchSpy.called);\n  });\n});\n"]}