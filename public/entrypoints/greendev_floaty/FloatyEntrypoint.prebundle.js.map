{"version":3,"file":"FloatyEntrypoint.prebundle.js","sourceRoot":"","sources":["FloatyEntrypoint.prebundle.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright 2026 The Chromium Authors\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n/* eslint-disable @devtools/no-imperative-dom-api */\n\nimport '../../core/sdk/sdk-meta.js';\nimport '../../models/workspace/workspace-meta.js';\nimport '../../panels/sensors/sensors-meta.js';\nimport '../../entrypoints/inspector_main/inspector_main-meta.js';\nimport '../../entrypoints/main/main-meta.js';\n\nimport * as Common from '../../core/common/common.js';\nimport * as Host from '../../core/host/host.js';\nimport * as i18n from '../../core/i18n/i18n.js';\nimport type * as Platform from '../../core/platform/platform.js';\nimport type * as ExperimentNames from '../../core/root/ExperimentNames.js';\nimport * as Root from '../../core/root/root.js';\nimport * as SDK from '../../core/sdk/sdk.js';\nimport * as Foundation from '../../foundation/foundation.js';\nimport type * as Protocol from '../../generated/protocol.js';\nimport * as AiAssistance from '../../models/ai_assistance/ai_assistance.js';\nimport type {SyncMessage} from '../../panels/greendev/GreenDevShared.js';\nimport * as UI from '../../ui/legacy/legacy.js';\nimport * as ThemeSupport from '../../ui/legacy/theme_support/theme_support.js';\n\nconst {AidaClient} = Host.AidaClient;\nconst {ResponseType} = AiAssistance.AiAgent;\n\nlet pendingActivationSessionId: number|null = null;\n\nclass GreenDevFloaty {\n  #chatContainer!: HTMLDivElement;\n  #textField!: HTMLInputElement;\n  #playButton!: HTMLButtonElement;\n  #node?: SDK.DOMModel.DOMNode;\n  #agent?: AiAssistance.StylingAgent.StylingAgent;\n  #nodeContext?: AiAssistance.StylingAgent.NodeContext;\n  #backendNodeId?: Protocol.DOM.BackendNodeId;\n  #syncChannel: BroadcastChannel;\n  #isFloatyWindow: boolean;\n\n  constructor(document: Document) {\n    const params = new URLSearchParams(window.location.hash.substring(1));\n    this.#backendNodeId = parseInt(params.get('backendNodeId') || '0', 10) as Protocol.DOM.BackendNodeId;\n    this.#isFloatyWindow = !!this.#backendNodeId;\n\n    this.#syncChannel = new BroadcastChannel('green-dev-sync');\n    this.#syncChannel.onmessage = event => {\n      this.#onSyncMessage(event.data);\n    };\n\n    this.#initFloatyMode(document);\n  }\n\n  #initFloatyMode(doc: Document): void {\n    this.#chatContainer = doc.getElementById('chat-container') as HTMLDivElement;\n    this.#textField = doc.querySelector('.green-dev-floaty-dialog-text-field') as HTMLInputElement;\n    this.#playButton = doc.querySelector('.green-dev-floaty-dialog-play-button') as HTMLButtonElement;\n\n    this.#playButton?.addEventListener('click', () => {\n      if (this.#node) {\n        void this.runConversation();\n      }\n    });\n\n    const contextText = doc.querySelector('.green-dev-floaty-dialog-context-text') as HTMLSpanElement;\n    if (contextText) {\n      contextText.style.cursor = 'pointer';\n      contextText.title = 'Click to show in DevTools Panel';\n      contextText.addEventListener('click', () => {\n        this.#broadcastFullState();\n      });\n    }\n\n    const learnMoreLink = doc.querySelector('.learn-more-link');\n    if (learnMoreLink) {\n      learnMoreLink.addEventListener('click', event => {\n        event.preventDefault();\n        Host.InspectorFrontendHost.InspectorFrontendHostInstance.openInNewTab(\n            'https://developer.chrome.com/docs/devtools/ai-assistance' as Platform.DevToolsPath.UrlString);\n      });\n    }\n\n    const nodeDescriptionElement = doc.querySelector('.green-dev-floaty-dialog-node-description') as HTMLDivElement;\n    nodeDescriptionElement?.addEventListener('mousemove', () => {\n      if (this.#node) {\n        this.#node.highlight();\n      }\n    });\n    nodeDescriptionElement?.addEventListener('mouseleave', () => {\n      if (this.#node && this.#backendNodeId) {\n        const msg = JSON.stringify({\n          id: 9999,\n          method: 'Overlay.setShowInspectedElementAnchor',\n          params: {inspectedElementAnchorConfig: {backendNodeId: this.#backendNodeId}}\n        });\n        Host.InspectorFrontendHost.InspectorFrontendHostInstance.sendMessageToBackend(msg);\n      }\n    });\n\n    this.#textField?.addEventListener('keydown', event => {\n      if (event.key === 'Enter' && this.#node) {\n        void this.runConversation();\n      }\n    });\n\n    this.#textField?.focus();\n  }\n\n  #broadcastFullState(): void {\n    const state = {\n      type: 'full-state',\n      messages: this.#getMessages(),\n      sessionId: this.#backendNodeId,\n      nodeDescription: document.querySelector('.green-dev-floaty-dialog-node-description')?.textContent\n    };\n    this.#syncChannel.postMessage(state);\n  }\n\n  #onSyncMessage(data: SyncMessage): void {\n    if (data.type === 'main-window-alive') {\n      if (pendingActivationSessionId) {\n        const syncChannel = new BroadcastChannel('green-dev-sync');\n        syncChannel.postMessage({type: 'activate-panel', sessionId: pendingActivationSessionId});\n        syncChannel.close();\n      }\n    } else if (data.type === 'request-session-state') {\n      this.#broadcastFullState();\n\n      if (pendingActivationSessionId) {\n        this.#syncChannel.postMessage({type: 'select-tab', sessionId: pendingActivationSessionId});\n        pendingActivationSessionId = null;\n      }\n    } else if (data.type === 'user-input' && data.sessionId === this.#backendNodeId) {\n      if (this.#textField) {\n        this.#textField.value = data.text ?? '';\n        void this.runConversation();\n      }\n    } else if (data.type === 'restore-floaty' && data.sessionId === this.#backendNodeId) {\n      // The main DevTools window will bring the floaty to the front,\n      // so the floaty window itself doesn't need to do it.\n      Host.InspectorFrontendHost.InspectorFrontendHostInstance.bringToFront();\n    }\n  }\n\n  static instance(opts: {\n    forceNew: boolean|null,\n    document: Document,\n  } = {forceNew: null, document}): GreenDevFloaty {\n    const {forceNew, document} = opts;\n    if (!greenDevFloatyInstance || forceNew) {\n      greenDevFloatyInstance = new GreenDevFloaty(document);\n    }\n    return greenDevFloatyInstance;\n  }\n\n  handlePanelRequest = (event: Common.EventTarget.EventTargetEvent<number>): void => {\n    pendingActivationSessionId = event.data;\n    this.#sendActivatePanelMessage(pendingActivationSessionId, 0);\n    Host.InspectorFrontendHost.InspectorFrontendHostInstance.openInNewTab(\n        'magic:open-devtools' as Platform.DevToolsPath.UrlString);\n  };\n\n  readonly #maxActivationRetries = 10;\n  readonly #activationRetryDelayMs = 200;\n\n  #sendActivatePanelMessage(sessionId: number, retryCount: number): void {\n    if (retryCount >= this.#maxActivationRetries) {\n      return;\n    }\n\n    const syncChannel = new BroadcastChannel('green-dev-sync');\n    syncChannel.postMessage({type: 'activate-panel', sessionId});\n    syncChannel.close();\n\n    // To ensure the activate-panel is always received, let's add a small delay and retry.\n    // This is a pragmatic fix for the prototype given the existing async message flow.\n    setTimeout(() => {\n      // Check if pendingActivationSessionId is still set. If it is, it means\n      // the panel hasn't been activated yet (or the confirmation message\n      // hasn't arrived), so we retry.\n      if (pendingActivationSessionId === sessionId) {\n        this.#sendActivatePanelMessage(sessionId, retryCount + 1);\n      }\n    }, this.#activationRetryDelayMs);\n  }\n\n  handleRestoreEvent(event: Common.EventTarget.EventTargetEvent<number>): void {\n    const sessionId = event.data;\n    // Only the main DevTools window (which is NOT a floaty window) should broadcast the restore request.\n    if (!this.#isFloatyWindow) {\n      this.#syncChannel.postMessage({type: 'restore-floaty', sessionId});\n    } else if (this.#backendNodeId === sessionId) {\n      // If a floaty window receives a restore request for its own session,\n      // it should bring itself to the front.\n      console.error('[GreenDev] Calling bringToFront for session ' + sessionId);\n      Host.InspectorFrontendHost.InspectorFrontendHostInstance.bringToFront();\n    }\n  }\n\n  setNode(node: SDK.DOMModel.DOMNode): void {\n    if (this.#node) {\n      this.#node.domModel().overlayModel().removeEventListener(\n          SDK.OverlayModel.Events.INSPECT_PANEL_SHOW_REQUESTED, this.handlePanelRequest);\n    }\n    if (this.#node === node) {\n      return;\n    }\n    this.#node = node;\n    this.#node.domModel().overlayModel().addEventListener(\n        SDK.OverlayModel.Events.INSPECT_PANEL_SHOW_REQUESTED, this.handlePanelRequest);\n    this.#backendNodeId = node.backendNodeId();\n\n    void node.domModel().overlayModel().clearHighlight();\n    this.#textField?.focus();\n    this.#agent = undefined;\n    this.#nodeContext = undefined;\n\n    const nodeDescriptionElement = document.querySelector('.green-dev-floaty-dialog-node-description');\n    let description = '';\n    if (nodeDescriptionElement) {\n      const id = node.getAttribute('id');\n      if (id) {\n        description = `#${id}`;\n      } else {\n        const classes = node.classNames().join('.');\n        description = node.nodeName().toLowerCase() + (classes ? `.${classes}` : '');\n      }\n      nodeDescriptionElement.textContent = description;\n    }\n\n    this.#syncChannel.postMessage({type: 'node-changed', sessionId: this.#backendNodeId, nodeDescription: description});\n\n    if (this.#backendNodeId) {\n      const msg = JSON.stringify({\n        id: 9999,\n        method: 'Overlay.setShowInspectedElementAnchor',\n        params: {inspectedElementAnchorConfig: {backendNodeId: this.#backendNodeId}}\n      });\n      Host.InspectorFrontendHost.InspectorFrontendHostInstance.sendMessageToBackend(msg);\n    }\n  }\n\n  #getMessages(): Array<{text: string, isUser: boolean}> {\n    const messages = [];\n    if (this.#chatContainer) {\n      const messageElements = this.#chatContainer.querySelectorAll('.message');\n      for (const el of messageElements) {\n        const isUser = el.classList.contains('user-message');\n        const content = el.querySelector('.message-content')?.textContent || '';\n        messages.push({text: content, isUser});\n      }\n    }\n    return messages;\n  }\n\n  #formatError(errorMessage: string): string {\n    return `Error: '${errorMessage}' - Protip: to use AI features you need to be signed in.`;\n  }\n\n  runConversation = async(): Promise<void> => {\n    if (!this.#textField || !this.#node) {\n      return;\n    }\n    const query = this.#textField.value || this.#textField.placeholder;\n    this.#textField.value = '';\n\n    if (!this.#agent) {\n      const aidaClient = new AidaClient();\n      this.#agent = new AiAssistance.StylingAgent.StylingAgent({aidaClient});\n      this.#nodeContext = new AiAssistance.StylingAgent.NodeContext(this.#node);\n    }\n\n    this.#addMessageInternal(query, true);\n    this.#syncChannel.postMessage({\n      type: 'new-message',\n      text: query,\n      isUser: true,\n      sessionId: this.#backendNodeId,\n      nodeDescription: document.querySelector('.green-dev-floaty-dialog-node-description')?.textContent,\n    });\n\n    const aiContent = this.#addMessageInternal('Thinking...', false);\n    this.#syncChannel.postMessage({\n      type: 'new-message',\n      text: 'Thinking...',\n      isUser: false,\n      sessionId: this.#backendNodeId,\n      nodeDescription: document.querySelector('.green-dev-floaty-dialog-node-description')?.textContent,\n    });\n\n    try {\n      if (!this.#nodeContext) {\n        throw new Error('Node context not found.');\n      }\n      for await (const result of this.#agent.run(query, {selected: this.#nodeContext})) {\n        switch (result.type) {\n          case ResponseType.ANSWER:\n            aiContent.textContent = result.text;\n            this.#syncChannel.postMessage(\n                {type: 'update-last-message', text: result.text, sessionId: this.#backendNodeId});\n            break;\n          case ResponseType.ERROR:\n            aiContent.textContent = this.#formatError(result.error);\n            this.#syncChannel.postMessage(\n                {type: 'update-last-message', text: this.#formatError(result.error), sessionId: this.#backendNodeId});\n            break;\n          case ResponseType.SIDE_EFFECT:\n            result.confirm(true);\n            break;\n          default:\n            break;\n        }\n        if (this.#chatContainer) {\n          this.#chatContainer.scrollTop = this.#chatContainer.scrollHeight;\n        }\n      }\n    } catch (e) {\n      aiContent.textContent = `Exception: ${e instanceof Error ? e.message : String(e)}`;\n    }\n  };\n\n  #addMessageInternal(text: string, isUser: boolean): HTMLDivElement {\n    const messageElement = document.createElement('div');\n    messageElement.className = `message ${isUser ? 'user-message' : 'ai-message'}`;\n\n    const content = document.createElement('div');\n    content.className = 'message-content';\n    content.textContent = text;\n    messageElement.appendChild(content);\n\n    if (this.#chatContainer) {\n      this.#chatContainer.appendChild(messageElement);\n      this.#chatContainer.scrollTop = this.#chatContainer.scrollHeight;\n    }\n    return content;\n  }\n}\n\nlet greenDevFloatyInstance: GreenDevFloaty;\n\nfunction safeRegisterExperiment(name: string, title: string): void {\n  try {\n    Root.Runtime.experiments.register(name as ExperimentNames.ExperimentName, title);\n  } catch (e) {\n    console.error('Unable to register experiment ', name, title, e);\n  }\n}\n\nasync function init(): Promise<void> {\n  try {\n    Root.Runtime.Runtime.setPlatform(Host.Platform.platform());\n    const [config, prefs] = await Promise.all([\n      new Promise<Root.Runtime.HostConfig>(\n          resolve => Host.InspectorFrontendHost.InspectorFrontendHostInstance.getHostConfig(resolve)),\n      new Promise<Record<string, string>>(\n          resolve => Host.InspectorFrontendHost.InspectorFrontendHostInstance.getPreferences(resolve)),\n    ]);\n    Object.assign(Root.Runtime.hostConfig, config);\n\n    safeRegisterExperiment(\n        Root.ExperimentNames.ExperimentName.CAPTURE_NODE_CREATION_STACKS, 'Capture node creation stacks');\n    safeRegisterExperiment(\n        Root.ExperimentNames.ExperimentName.INSTRUMENTATION_BREAKPOINTS, 'Enable instrumentation breakpoints');\n    safeRegisterExperiment(\n        Root.ExperimentNames.ExperimentName.USE_SOURCE_MAP_SCOPES, 'Use scope information from source maps');\n    safeRegisterExperiment(Root.ExperimentNames.ExperimentName.LIVE_HEAP_PROFILE, 'Live heap profile');\n    safeRegisterExperiment(Root.ExperimentNames.ExperimentName.PROTOCOL_MONITOR, 'Protocol Monitor');\n    safeRegisterExperiment(\n        Root.ExperimentNames.ExperimentName.SAMPLING_HEAP_PROFILER_TIMELINE, 'Sampling heap profiler timeline');\n    safeRegisterExperiment(Root.ExperimentNames.ExperimentName.APCA, 'APCA');\n\n    const hostUnsyncedStorage: Common.Settings.SettingsBackingStore = {\n      register: (name: string) =>\n          Host.InspectorFrontendHost.InspectorFrontendHostInstance.registerPreference(name, {synced: false}),\n      set: Host.InspectorFrontendHost.InspectorFrontendHostInstance.setPreference,\n      get: (name: string) =>\n          new Promise(resolve => Host.InspectorFrontendHost.InspectorFrontendHostInstance.getPreference(name, resolve)),\n      remove: Host.InspectorFrontendHost.InspectorFrontendHostInstance.removePreference,\n      clear: Host.InspectorFrontendHost.InspectorFrontendHostInstance.clearPreferences,\n    };\n    const syncedStorage = new Common.Settings.SettingsStorage(prefs, hostUnsyncedStorage, '');\n    const globalStorage = new Common.Settings.SettingsStorage(prefs, hostUnsyncedStorage, '');\n    const localStorage = new Common.Settings.SettingsStorage(\n        window.localStorage, {\n          register(_setting: string): void{},\n          async get(setting: string): Promise<string> {\n            return window.localStorage.getItem(setting) as unknown as string;\n          },\n          set(setting: string, value: string): void {\n            window.localStorage.setItem(setting, value);\n          },\n          remove(setting: string): void {\n            window.localStorage.removeItem(setting);\n          },\n          clear: () => window.localStorage.clear(),\n        },\n        '');\n\n    Common.Settings.Settings.instance({\n      forceNew: true,\n      syncedStorage,\n      globalStorage,\n      localStorage,\n      settingRegistrations: Common.SettingRegistration.getRegisteredSettings(),\n    });\n\n    UI.UIUtils.initializeUIUtils(document);\n    ThemeSupport.ThemeSupport.instance({\n      forceNew: true,\n      setting: Common.Settings.Settings.instance().moduleSetting('ui-theme'),\n    });\n    UI.ZoomManager.ZoomManager.instance(\n        {forceNew: true, win: window, frontendHost: Host.InspectorFrontendHost.InspectorFrontendHostInstance});\n\n    const settingLanguage = Common.Settings.Settings.instance().moduleSetting<string>('language').get();\n    i18n.DevToolsLocale.DevToolsLocale.instance({\n      create: true,\n      data: {\n        navigatorLanguage: navigator.language,\n        settingLanguage,\n        lookupClosestDevToolsLocale: i18n.i18n.lookupClosestSupportedDevToolsLocale,\n      },\n    });\n\n    const universe = new Foundation.Universe.Universe({\n      settingsCreationOptions: {\n        syncedStorage,\n        globalStorage,\n        localStorage,\n        settingRegistrations: Common.SettingRegistration.getRegisteredSettings(),\n      }\n    });\n    Root.DevToolsContext.setGlobalInstance(universe.context);\n\n    await i18n.i18n.fetchAndRegisterLocaleData('en-US');\n    Host.InspectorFrontendHost.InspectorFrontendHostInstance.connectionReady();\n\n    const hash = window.location.hash.substring(1);\n    const params = new URLSearchParams(hash);\n    const backendNodeId = parseInt(params.get('backendNodeId') || '0', 10);\n\n    const floaty = GreenDevFloaty.instance({forceNew: null, document});\n\n    if (backendNodeId) {\n      await SDK.Connections.initMainConnection(async () => {\n        const targetManager = SDK.TargetManager.TargetManager.instance();\n        targetManager.createTarget('main', 'Main', SDK.Target.Type.FRAME, null);\n        const mainTarget = await new Promise<SDK.Target.Target|null>(resolve => {\n          const t = targetManager.primaryPageTarget();\n          if (t) {\n            resolve(t);\n            return;\n          }\n          const observer = {\n            targetAdded: (target: SDK.Target.Target) => {\n              if (target === targetManager.primaryPageTarget()) {\n                targetManager.unobserveTargets(observer);\n                resolve(target);\n              }\n            },\n            targetRemoved: () => {},\n          };\n          targetManager.observeTargets(observer);\n        });\n        if (!mainTarget) {\n          return;\n        }\n        const domModel = mainTarget.model(SDK.DOMModel.DOMModel);\n        if (!domModel) {\n          return;\n        }\n\n        // Add listener for floaty restore events\n        const overlayModel = mainTarget.model(SDK.OverlayModel.OverlayModel);\n        if (overlayModel) {\n          overlayModel.addEventListener(\n              SDK.OverlayModel.Events.INSPECTED_ELEMENT_WINDOW_RESTORED, floaty.handleRestoreEvent, floaty);\n        }\n\n        const nodesMap =\n            await domModel.pushNodesByBackendIdsToFrontend(new Set([backendNodeId as Protocol.DOM.BackendNodeId]));\n        const node = nodesMap?.get(backendNodeId as Protocol.DOM.BackendNodeId) || null;\n        if (node) {\n          floaty.setNode(node);\n        }\n      }, () => {});\n    } else {\n      const targetManager = SDK.TargetManager.TargetManager.instance();\n      const observer = {\n        targetAdded: (target: SDK.Target.Target) => {\n          if (target.type() === SDK.Target.Type.FRAME) {\n            const overlayModel = target.model(SDK.OverlayModel.OverlayModel);\n            if (overlayModel) {\n              overlayModel.addEventListener(\n                  SDK.OverlayModel.Events.INSPECTED_ELEMENT_WINDOW_RESTORED, floaty.handleRestoreEvent, floaty);\n              overlayModel.addEventListener(\n                  SDK.OverlayModel.Events.INSPECT_PANEL_SHOW_REQUESTED, floaty.handlePanelRequest);\n            }\n          }\n        },\n        targetRemoved: (target: SDK.Target.Target) => {\n          if (target.type() === SDK.Target.Type.FRAME) {\n            const overlayModel = target.model(SDK.OverlayModel.OverlayModel);\n            if (overlayModel) {\n              overlayModel.removeEventListener(\n                  SDK.OverlayModel.Events.INSPECTED_ELEMENT_WINDOW_RESTORED, floaty.handleRestoreEvent, floaty);\n              overlayModel.removeEventListener(\n                  SDK.OverlayModel.Events.INSPECT_PANEL_SHOW_REQUESTED, floaty.handlePanelRequest);\n            }\n          }\n        },\n      };\n      targetManager.observeTargets(observer);\n    }\n  } catch (err) {\n    console.error('[GreenDev] FATAL ERROR during init():', err);\n  }\n}\n\nvoid init();\n"]}