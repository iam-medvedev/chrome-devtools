{"version":3,"file":"SourceMapEncoder.js","sourceRoot":"","sources":["../../../../../front_end/testing/SourceMapEncoder.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright 2021 The Chromium Authors\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport type * as SDK from '../core/sdk/sdk.js';\n\nconst base64Digits = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/';\n\nexport function encodeVlq(n: number): string {\n  // Set the sign bit as the least significant bit.\n  n = n >= 0 ? 2 * n : 1 - 2 * n;\n  // Encode into a base64 run.\n  let result = '';\n  while (true) {\n    // Extract the lowest 5 bits and remove them from the number.\n    const digit = n & 0x1f;\n    n >>= 5;\n    // Is there anything more left to encode?\n    if (n === 0) {\n      // We are done encoding, finish the run.\n      result += base64Digits[digit];\n      break;\n    } else {\n      // There is still more encode, so add the digit and the continuation bit.\n      result += base64Digits[0x20 + digit];\n    }\n  }\n  return result;\n}\n\nexport function encodeVlqList(list: number[]) {\n  return list.map(encodeVlq).join('');\n}\n\n// Encode array mappings of the form \"compiledLine:compiledColumn => srcFile:srcLine:srcColumn@name\"\n// as a source map.\nexport function encodeSourceMap(textMap: string[], sourceRoot?: string): SDK.SourceMap.SourceMapV3Object {\n  let mappings = '';\n  const sources: string[] = [];\n  const names: string[] = [];\n  let sourcesContent: Array<null|string>|undefined;\n\n  const state = {\n    line: -1,\n    column: 0,\n    srcFile: 0,\n    srcLine: 0,\n    srcColumn: 0,\n    srcName: 0,\n  };\n\n  for (const mapping of textMap) {\n    let match = mapping.match(/^(\\d+):(\\d+)(?:\\s*=>\\s*([^:]+):(\\d+):(\\d+)(?:@(\\S+))?)?$/);\n    if (!match) {\n      match = mapping.match(/^([^:]+):\\s*(.+)$/);\n      if (!match) {\n        throw new Error(`Cannot parse mapping \"${mapping}\"`);\n      }\n      (sourcesContent = sourcesContent ?? [])[getOrAddString(sources, match[1])] = match[2];\n      continue;\n    }\n\n    const lastState = Object.assign({}, state);\n    state.line = Number(match[1]);\n    state.column = Number(match[2]);\n    const hasSource = match[3] !== undefined;\n    const hasName = hasSource && (match[6] !== undefined);\n    if (hasSource) {\n      state.srcFile = getOrAddString(sources, match[3]);\n      state.srcLine = Number(match[4]);\n      state.srcColumn = Number(match[5]);\n      if (hasName) {\n        state.srcName = getOrAddString(names, match[6]);\n      }\n    }\n\n    if (state.line < lastState.line) {\n      throw new Error('Line numbers must be increasing');\n    }\n\n    const isNewLine = state.line !== lastState.line;\n\n    if (isNewLine) {\n      // Fixup for the first line mapping.\n      if (lastState.line === -1) {\n        lastState.line = 0;\n      }\n      // Insert semicolons for all the new lines.\n      mappings += ';'.repeat(state.line - lastState.line);\n      // Reset the compiled code column counter.\n      lastState.column = 0;\n    } else {\n      mappings += ',';\n    }\n\n    // Encode the mapping and add it to the list of mappings.\n    const toEncode = [state.column - lastState.column];\n    if (hasSource) {\n      toEncode.push(\n          state.srcFile - lastState.srcFile, state.srcLine - lastState.srcLine, state.srcColumn - lastState.srcColumn);\n      if (hasName) {\n        toEncode.push(state.srcName - lastState.srcName);\n      }\n    }\n    mappings += encodeVlqList(toEncode);\n  }\n\n  const sourceMapV3: SDK.SourceMap.SourceMapV3 = {version: 3, mappings, sources, names};\n  if (sourceRoot !== undefined) {\n    sourceMapV3.sourceRoot = sourceRoot;\n  }\n  if (sourcesContent !== undefined) {\n    for (let i = 0; i < sources.length; ++i) {\n      if (typeof sourcesContent[i] !== 'string') {\n        sourcesContent[i] = null;\n      }\n    }\n    sourceMapV3.sourcesContent = sourcesContent;\n  }\n  return sourceMapV3;\n\n  function getOrAddString(array: string[], s: string) {\n    const index = array.indexOf(s);\n    if (index >= 0) {\n      return index;\n    }\n    array.push(s);\n    return array.length - 1;\n  }\n}\n"]}