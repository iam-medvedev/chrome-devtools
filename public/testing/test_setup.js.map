{"version":3,"file":"test_setup.js","sourceRoot":"","sources":["../../../../../front_end/testing/test_setup.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright 2020 The Chromium Authors\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\n/*\n * This file is automatically loaded and run by Karma because it automatically\n * loads and injects all *.js files it finds.\n */\n\nimport * as Common from '../core/common/common.js';\nimport * as Host from '../core/host/host.js';\nimport * as Trace from '../models/trace/trace.js';\nimport * as TraceSourceMapsResolver from '../models/trace_source_maps_resolver/trace_source_maps_resolver.js';\nimport * as ThemeSupport from '../ui/legacy/theme_support/theme_support.js';\n\nimport {cleanTestDOM, setupTestDOM} from './DOMHooks.js';\nimport {createFakeSetting, resetHostConfig} from './EnvironmentHelpers.js';\nimport {TraceLoader} from './TraceLoader.js';\nimport {\n  checkForPendingActivity,\n  startTrackingAsyncActivity,\n  stopTrackingAsyncActivity,\n} from './TrackAsyncOperations.js';\n\nasync function setupTestFont() {\n  document.documentElement.classList.add('platform-screenshot-test');\n\n  await new Promise(r => {\n    const link = document.createElement('link');\n    link.rel = 'stylesheet';\n    link.href = 'https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100..900;1,100..900&display=swap';\n    link.onload = r;\n    document.head.appendChild(link);\n  });\n\n  await Promise.all([\n    document.fonts.load('400 16px \"Roboto\"'),  // Normal\n    document.fonts.load('500 16px \"Roboto\"'),  // Medium\n    document.fonts.load('700 16px \"Roboto\"'),  // Bold\n    document.fonts.load('italic 400 16px \"Roboto\"'),\n    document.fonts.load('italic 500 16px \"Roboto\"'),\n    document.fonts.load('italic 700 16px \"Roboto\"'),\n  ]);\n  await document.fonts.ready;\n}\n\nbefore(async function() {\n  await setupTestFont();\n\n  // There is no way to provide after each file run via a test set up file.\n  // What we do instead is add and after all in all global test suits\n  // This is as close as we can get to after each file.\n  this.test?.parent?.suites.forEach(function(suite) {\n    suite.afterAll(function() {\n      TraceLoader.resetCache();\n    });\n  });\n});\n\nbeforeEach(async () => {\n  stopTrackingAsyncActivity();\n  resetHostConfig();\n  // Clear out any Sinon stubs or spies between individual tests.\n  sinon.restore();\n  await setupTestDOM();\n\n  // Ensure that no trace data leaks between tests when testing the trace engine.\n  for (const handler of Object.values(Trace.Handlers.ModelHandlers)) {\n    handler.reset();\n  }\n  Trace.Helpers.SyntheticEvents.SyntheticEventsManager.reset();\n  TraceSourceMapsResolver.SourceMapsResolver.clearResolvedNodeNames();\n\n  // Don't retain host binding listeners across tests. Set this up before initializing ThemeSupport as\n  // ThemeSupport adds a host binding listener.\n  Host.InspectorFrontendHost.InspectorFrontendHostInstance.events = new Common.ObjectWrapper.ObjectWrapper();\n\n  // Some unit tests exercise code that assumes a ThemeSupport instance is available.\n  // Run this in a beforeEach in case an individual test overrides it.\n  const setting = createFakeSetting('ui-theme', 'default');\n  ThemeSupport.ThemeSupport.instance({forceNew: true, setting});\n\n  startTrackingAsyncActivity();\n});\n\nafterEach(async function() {\n  cleanTestDOM(this.currentTest?.fullTitle());\n  await checkForPendingActivity(this.currentTest?.fullTitle());\n  stopTrackingAsyncActivity();\n  // Clear out any Sinon stubs or spies between individual tests.\n  sinon.clock?.runToLast();\n  sinon.restore();\n});\n"]}