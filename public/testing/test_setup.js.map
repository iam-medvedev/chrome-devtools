{"version":3,"file":"test_setup.js","sourceRoot":"","sources":["../../../../../front_end/testing/test_setup.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright 2020 The Chromium Authors. All rights reserved.\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\n/*\n * This file is automatically loaded and run by Karma because it automatically\n * loads and injects all *.js files it finds.\n */\n\nimport * as Common from '../core/common/common.js';\nimport * as Host from '../core/host/host.js';\nimport * as Root from '../core/root/root.js';\nimport * as Trace from '../models/trace/trace.js';\nimport * as Timeline from '../panels/timeline/timeline.js';\nimport * as UI from '../ui/legacy/legacy.js';\nimport * as ThemeSupport from '../ui/legacy/theme_support/theme_support.js';\n\nimport {cleanTestDOM, raf, setupTestDOM} from './DOMHelpers.js';\nimport {createFakeSetting, resetHostConfig} from './EnvironmentHelpers.js';\nimport {\n  checkForPendingActivity,\n  startTrackingAsyncActivity,\n  stopTrackingAsyncActivity,\n} from './TrackAsyncOperations.js';\n\nconst style = document.createElement('style');\nstyle.innerText =\n    '@import url(\\'https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100..900;1,100..900&display=swap\\');';\ndocument.head.append(style);\ndocument.documentElement.classList.add('platform-screenshot-test');\n\nconst documentBodyElements = new Set<Element>();\n\n// Warm-up fonts to be readily available.\nbefore(async () => {\n  const div = document.createElement('div');\n  div.style.fontFamily = 'roboto';\n  // Some latin characters to trigger the latin font file to be loaded.\n  // Additional non-lating characters can be included if needed.\n  div.innerText = 'abc';\n  // eslint-disable-next-line rulesdir/no-document-body-mutation\n  document.body.append(div);\n  await document.fonts.ready;\n  div.remove();\n});\n\nbeforeEach(async () => {\n  resetHostConfig();\n  for (const child of document.body.children) {\n    documentBodyElements.add(child);\n  }\n  await setupTestDOM();\n\n  // Ensure that no trace data leaks between tests when testing the trace engine.\n  for (const handler of Object.values(Trace.Handlers.ModelHandlers)) {\n    handler.reset();\n  }\n  Trace.Helpers.SyntheticEvents.SyntheticEventsManager.reset();\n  Timeline.Utils.SourceMapsResolver.SourceMapsResolver.clearResolvedNodeNames();\n\n  // Don't retain host binding listeners across tests. Set this up before initializing ThemeSupport as\n  // ThemeSupport adds a host binding listener.\n  Host.InspectorFrontendHost.InspectorFrontendHostInstance.events = new Common.ObjectWrapper.ObjectWrapper();\n\n  // Some unit tests exercise code that assumes a ThemeSupport instance is available.\n  // Run this in a beforeEach in case an individual test overrides it.\n  const setting = createFakeSetting('theme', 'default');\n  ThemeSupport.ThemeSupport.instance({forceNew: true, setting});\n\n  startTrackingAsyncActivity();\n});\n\n/**\n * If a widget creates a glass pane, it can get orphaned and not cleaned up correctly.\n */\nasync function removeGlassPanes() {\n  for (const pane of document.body.querySelectorAll('[data-devtools-glass-pane]')) {\n    document.body.removeChild(pane);\n  }\n  await raf();\n}\n/**\n * If a text editor is created we create a special parent for the tooltip\n * This does not get cleared after render, but it's internals do.\n * So we need to manually remove it\n */\nasync function removeTextEditorTooltip() {\n  // Found in front_end/ui/components/text_editor/config.ts\n  for (const pane of document.body.querySelectorAll('.editor-tooltip-host')) {\n    document.body.removeChild(pane);\n  }\n  await raf();\n}\n\nafterEach(async function() {\n  await cleanTestDOM();\n\n  await removeGlassPanes();\n  await removeTextEditorTooltip();\n\n  UI.ARIAUtils.LiveAnnouncer.removeAnnouncerElements(document.body);\n\n  for (const child of document.body.children) {\n    if (!documentBodyElements.has(child)) {\n      console.error(`Test \"${this.currentTest?.fullTitle()}\" left DOM in document.body:`);\n      console.error(child);\n    }\n  }\n  for (const key of Object.keys(Root.Runtime.hostConfig)) {\n    // @ts-expect-error\n    delete Root.Runtime.hostConfig[key];\n  }\n  await cleanTestDOM();\n  await checkForPendingActivity();\n  resetHostConfig();\n  sinon.restore();\n  stopTrackingAsyncActivity();\n\n  // Clear out any Sinon stubs or spies between individual tests.\n});\n"]}