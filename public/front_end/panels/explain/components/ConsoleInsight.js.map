{"version":3,"file":"ConsoleInsight.js","sourceRoot":"","sources":["../../../../../../../front_end/panels/explain/components/ConsoleInsight.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright 2023 The Chromium Authors. All rights reserved.\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport * as Host from '../../../core/host/host.js';\nimport * as i18n from '../../../core/i18n/i18n.js';\nimport type * as Platform from '../../../core/platform/platform.js';\nimport * as Marked from '../../../third_party/marked/marked.js';\nimport * as Buttons from '../../../ui/components/buttons/buttons.js';\nimport * as ComponentHelpers from '../../../ui/components/helpers/helpers.js';\nimport * as IconButton from '../../../ui/components/icon_button/icon_button.js';\nimport * as MarkdownView from '../../../ui/components/markdown_view/markdown_view.js';\nimport * as UI from '../../../ui/legacy/legacy.js';\nimport * as LitHtml from '../../../ui/lit-html/lit-html.js';\nimport {type InsightProvider} from '../InsightProvider.js';\nimport {type PromptBuilder, type Source, SourceType} from '../PromptBuilder.js';\n\nimport styles from './consoleInsight.css.js';\nimport listStyles from './consoleInsightSourcesList.css.js';\n\nconst UIStrings = {\n  /**\n   * @description The title of the button that allows providing the feebdack that a\n   * console message insight was inaccruate.\n   */\n  inaccurate: 'Inaccurate',\n  /**\n   * @description The title of the button that allows providing the feebdack that a\n   *console message insight was irrelevant.\n   */\n  irrelevant: 'Irrelevant',\n  /**\n   * @description The title of the button that allows providing the feebdack that a\n   *console message insight was inappropriate.\n   */\n  inappropriate: 'Inappropriate',\n  /**\n   * @description The title of the button that allows providing the feebdack that a\n   *console message insight was helpful.\n   */\n  notHelpful: 'Not helpful',\n  /**\n   * @description The title of the button that allows providing the feebdack that a\n   *console message insight was not good for an unknown \"other\" reason.\n   */\n  other: 'Other',\n  /**\n   * @description The title of the insight source \"Console message\".\n   */\n  consoleMessage: 'Console message',\n  /**\n   * @description The title of the insight source \"Stacktrace\".\n   */\n  stackTrace: 'Stacktrace',\n  /**\n   * @description The title of the insight source \"Network request\".\n   */\n  networkRequest: 'Network request',\n  /**\n   * @description The title of the insight source \"Related code\".\n   */\n  relatedCode: 'Related code',\n  /**\n   * @description The title of the insight source \"Google search answers\".\n   */\n  searchAnswers: '`Google` search answers',\n  /**\n   * @description The text appearing before the list of sources that DevTools\n   * could collect based on a console message. If the user clicks the button\n   * related to the text, these sources will be used to generate insights.\n   */\n  refineButtonHint:\n      'Click this button to send the following data to the AI model running on `Google`\\'s servers, so it can generate a more accurate and relevant response:',\n  /**\n   * @description The title that is shown while the insight is being generated.\n   */\n  generating: 'Generating…',\n  /**\n   * @description The header that indicates that the content shown is a console\n   * insight.\n   */\n  insight: 'Insight',\n  /**\n   * @description The title of the a button that closes the rating form.\n   */\n  close: 'Close',\n  /**\n   * @description The title of the a button that closes the insight pane.\n   */\n  closeInsight: 'Close insight',\n  /**\n   * @description The title of the list of source data that was used to generate the insight.\n   */\n  sources: 'Sources',\n  /**\n   * @description The title of the button that allows the user to include more\n   * sources for the generation of the console insight.\n   */\n  refine: 'Give context to personalize insight',\n  /**\n   * @description The title of the button that is shown while the console\n   * insight is being re-generated.\n   */\n  refining: 'Personalizing insight…',\n  /**\n   * @description The title of the button that allows submitting positive\n   * feedback about the console insight.\n   */\n  thumbUp: 'Thumb up',\n  /**\n   * @description The title of the button that allows submitting negative\n   * feedback about the console insight.\n   */\n  thumbDown: 'Thumb down',\n  /**\n   * @description The title of the link that allows submitting more feedback.\n   */\n  submitFeedback: 'Submit feedback',\n  /**\n   * @description The title indicating the dogfood phase of the feature.\n   */\n  dogfood: 'Dogfood',\n  /**\n   * @description The title of the rating form that asks for the reason for the rating.\n   */\n  reason: 'Why did you choose this rating? (optional)',\n  /**\n   * @description The placeholder for the textarea for providing additional\n   * feedback.\n   */\n  additionalFeedback: 'Provide additional feedback (optional)',\n  /**\n   * @description The title of the button that submits the feedback.\n   */\n  submit: 'Submit',\n  /**\n   * @description The text of the header inside the console insight pane when there was an error generating an insight.\n   */\n  error: 'Something went wrong…',\n};\nconst str_ = i18n.i18n.registerUIStrings('panels/explain/components/ConsoleInsight.ts', UIStrings);\nconst i18nString = i18n.i18n.getLocalizedString.bind(undefined, str_);\nconst i18nLazyString = i18n.i18n.getLazilyComputedLocalizedString.bind(undefined, str_);\n\nconst {render, html, Directives} = LitHtml;\n\nexport class CloseEvent extends Event {\n  static readonly eventName = 'close';\n\n  constructor() {\n    super(CloseEvent.eventName, {composed: true, bubbles: true});\n  }\n}\n\ntype PublicPromptBuilder = Pick<PromptBuilder, 'buildPrompt'>;\ntype PublicInsightProvider = Pick<InsightProvider, 'getInsights'>;\n\n// key => localized string.\nconst negativeRatingReasons: Array<[string, () => Platform.UIString.LocalizedString]> = [\n  ['inaccurate', i18nLazyString(UIStrings.inaccurate)],\n  ['irrelevant', i18nLazyString(UIStrings.irrelevant)],\n  ['inapproprate', i18nLazyString(UIStrings.inappropriate)],\n  ['not-helpful', i18nLazyString(UIStrings.notHelpful)],\n  ['other', i18nLazyString(UIStrings.other)],\n];\n\nfunction localizeType(sourceType: SourceType): string {\n  switch (sourceType) {\n    case SourceType.MESSAGE:\n      return i18nString(UIStrings.consoleMessage);\n    case SourceType.STACKTRACE:\n      return i18nString(UIStrings.stackTrace);\n    case SourceType.NETWORK_REQUEST:\n      return i18nString(UIStrings.networkRequest);\n    case SourceType.RELATED_CODE:\n      return i18nString(UIStrings.relatedCode);\n    case SourceType.SEARCH_ANSWERS:\n      return i18nString(UIStrings.searchAnswers);\n  }\n}\n\nconst DOGFOODFEEDBACK_URL = 'http://go/console-insights-experiment-general-feedback';\n\nfunction buildRatingFormLink(\n    rating: 'Positive'|'Negative', comment: string, explanation: string, consoleMessage: string, stackTrace: string,\n    relatedCode: string, networkData: string): Platform.DevToolsPath.UrlString {\n  return `https://docs.google.com/forms/d/e/1FAIpQLSen1K-Uli0CSvlsNkI-L0Wq5iJ0FO9zFv0_mjM-3m5I8AKQGg/viewform?usp=pp_url&entry.1465663861=${\n             encodeURIComponent(rating)}&entry.109342357=${encodeURIComponent(comment)}&entry.1805879004=${\n             encodeURIComponent(explanation)}&entry.623054399=${encodeURIComponent(consoleMessage)}&entry.720239045=${\n             encodeURIComponent(stackTrace)}&entry.1520357991=${encodeURIComponent(relatedCode)}&entry.1966708581=${\n             encodeURIComponent(networkData)}` as Platform.DevToolsPath.UrlString;\n}\n\n// TODO(crbug.com/1167717): Make this a const enum again\n// eslint-disable-next-line rulesdir/const_enum\nenum State {\n  INSIGHT = 'insight',\n  LOADING = 'loading',\n  REFINING = 'refining',\n  ERROR = 'error',\n}\n\ntype StateData = {\n  type: State.LOADING,\n}|{\n  type: State.REFINING | State.INSIGHT,\n  explanation: string,\n  tokens: MarkdownView.MarkdownView.MarkdownViewData['tokens'],\n  sources: Source[],\n  refined: boolean,\n}|{\n  type: State.ERROR,\n  error: string,\n};\n\nexport class ConsoleInsight extends HTMLElement {\n  static readonly litTagName = LitHtml.literal`devtools-console-insight`;\n  readonly #shadow = this.attachShadow({mode: 'open'});\n\n  // Flip to false to enable non-dogfood branding. Note that rating is not\n  // implemented.\n  #dogfood = true;\n  // Flip to false to enable a refine button.\n  readonly #refinedByDefault = false;\n\n  #promptBuilder: PublicPromptBuilder;\n  #insightProvider: PublicInsightProvider;\n  #renderer = new MarkdownRenderer();\n\n  // Main state.\n  #state: StateData = {\n    type: State.LOADING,\n  };\n\n  // Rating sub-form state.\n  #ratingFormOpened = false;\n  #selectedRating?: boolean;\n  #selectedRatingReasons = new Set<string>();\n\n  #popover: UI.PopoverHelper.PopoverHelper;\n\n  constructor(promptBuilder: PublicPromptBuilder, insightProvider: PublicInsightProvider) {\n    super();\n    this.#promptBuilder = promptBuilder;\n    this.#insightProvider = insightProvider;\n    this.#render();\n    // Stop keyboard event propagation to avoid Console acting on the events\n    // inside the insight component.\n    this.addEventListener('keydown', e => {\n      e.stopPropagation();\n    });\n    this.addEventListener('keyup', e => {\n      e.stopPropagation();\n    });\n    this.addEventListener('keypress', e => {\n      e.stopPropagation();\n    });\n    this.tabIndex = 0;\n    this.focus();\n    this.#popover = new UI.PopoverHelper.PopoverHelper(this, event => {\n      const hoveredNode = event.composedPath()[0] as Element;\n      if (!hoveredNode || !hoveredNode.parentElementOrShadowHost()?.matches('.info')) {\n        return null;\n      }\n\n      return {\n        box: hoveredNode.boxInWindow(),\n        show: async(popover: UI.GlassPane.GlassPane): Promise<boolean> => {\n          const {sources} = await this.#promptBuilder.buildPrompt();\n          const container = document.createElement('div');\n          container.style.display = 'flex';\n          container.style.flexDirection = 'column';\n          container.style.fontSize = '13px';\n          const text = document.createElement('p');\n          text.innerText = i18nString(UIStrings.refineButtonHint);\n          text.style.margin = '0';\n          const list = document.createElement('devtools-console-insight-sources-list');\n          list.sources = sources;\n          container.append(text);\n          container.append(list);\n          popover.contentElement.append(container);\n          popover.setAnchorBehavior(UI.GlassPane.AnchorBehavior.PreferBottom);\n          return true;\n        },\n      };\n    });\n    this.#popover.setTimeout(300);\n    this.#popover.setHasPadding(true);\n    // Measure the height of the element after an animation. `--actual-height` can\n    // be used as the `from` value for the subsequent animation.\n    this.addEventListener('animationend', () => {\n      this.style.setProperty('--actual-height', `${this.offsetHeight}px`);\n    });\n  }\n\n  connectedCallback(): void {\n    this.#shadow.adoptedStyleSheets = [styles];\n    this.classList.add('opening');\n  }\n\n  set dogfood(value: boolean) {\n    this.#dogfood = value;\n    this.#render();\n  }\n\n  get dogfood(): boolean {\n    return this.#dogfood;\n  }\n\n  #transitionTo(newState: StateData): void {\n    const previousState = this.#state;\n    this.#state = newState;\n    if (newState.type !== previousState.type && previousState.type === State.LOADING) {\n      this.classList.add('loaded');\n    }\n    this.#render();\n  }\n\n  async update(includeContext = this.#refinedByDefault): Promise<void> {\n    this.#transitionTo(\n        this.#state.type === State.INSIGHT ? {\n          ...this.#state,\n          type: State.REFINING,\n        } :\n                                             {\n                                               type: State.LOADING,\n                                             });\n    try {\n      const requestedSources = includeContext ? undefined : [SourceType.MESSAGE];\n      const {prompt, sources} = await this.#promptBuilder.buildPrompt(requestedSources);\n      const explanation = await this.#insightProvider.getInsights(prompt);\n      this.#transitionTo({\n        type: State.INSIGHT,\n        tokens: Marked.Marked.lexer(explanation),\n        explanation,\n        sources,\n        refined: includeContext,\n      });\n    } catch (err) {\n      Host.userMetrics.actionTaken(Host.UserMetrics.Action.InsightErrored);\n      this.#transitionTo({\n        type: State.ERROR,\n        error: err.message,\n      });\n    }\n  }\n\n  #onClose(): void {\n    this.dispatchEvent(new CloseEvent());\n    this.classList.add('closing');\n  }\n\n  #onCloseRating(): void {\n    this.#ratingFormOpened = false;\n    this.#selectedRating = undefined;\n    this.#selectedRatingReasons.clear();\n    this.#render();\n  }\n\n  #onSubmit(): void {\n    if (this.#dogfood) {\n      this.#openFeedbackFrom();\n    }\n    this.#onCloseRating();\n  }\n\n  #openFeedbackFrom(): void {\n    if (this.#state.type !== State.INSIGHT) {\n      throw new Error('Unexpected state');\n    }\n    const link = buildRatingFormLink(\n        this.#selectedRating ? 'Positive' : 'Negative', this.#shadow.querySelector('textarea')?.value || '',\n        this.#state.explanation,\n        this.#state.sources.filter(s => s.type === SourceType.MESSAGE).map(s => s.value).join('\\n'),\n        this.#state.sources.filter(s => s.type === SourceType.STACKTRACE).map(s => s.value).join('\\n'),\n        this.#state.sources.filter(s => s.type === SourceType.RELATED_CODE).map(s => s.value).join('\\n'),\n        this.#state.sources.filter(s => s.type === SourceType.NETWORK_REQUEST).map(s => s.value).join('\\n'));\n    Host.InspectorFrontendHost.InspectorFrontendHostInstance.openInNewTab(link);\n  }\n\n  #onRating(event: Event): void {\n    this.#selectedRating = (event.target as HTMLElement).dataset.rating === 'true';\n    if (this.#selectedRating) {\n      Host.userMetrics.actionTaken(Host.UserMetrics.Action.InsightRatedPositive);\n    } else {\n      Host.userMetrics.actionTaken(Host.UserMetrics.Action.InsightRatedNegative);\n    }\n    if (this.#dogfood) {\n      this.#openFeedbackFrom();\n      return;\n    }\n    this.#ratingFormOpened = true;\n\n    this.#render();\n  }\n\n  #onReason(event: Event): void {\n    const target = event.target as Buttons.Button.Button;\n    if (!target.active) {\n      this.#selectedRatingReasons.add(target.dataset.reason as string);\n    } else {\n      this.#selectedRatingReasons.delete(target.dataset.reason as string);\n    }\n    this.#render();\n  }\n\n  #onRefine(): void {\n    if (this.#state.type !== State.INSIGHT) {\n      throw new Error('Unexpected state');\n    }\n    Host.userMetrics.actionTaken(Host.UserMetrics.Action.InsightRefined);\n    void this.update(true);\n  }\n\n  #renderMain(): LitHtml.TemplateResult {\n    // clang-format off\n    switch (this.#state.type) {\n      case State.LOADING:\n        return html`<main>\n            <div role=\"presentation\" class=\"loader\" style=\"clip-path: url('#clipPath');\">\n              <svg width=\"100%\" height=\"64\">\n                <clipPath id=\"clipPath\">\n                  <rect x=\"0\" y=\"0\" width=\"100%\" height=\"16\" rx=\"8\"></rect>\n                  <rect x=\"0\" y=\"24\" width=\"100%\" height=\"16\" rx=\"8\"></rect>\n                  <rect x=\"0\" y=\"48\" width=\"100%\" height=\"16\" rx=\"8\"></rect>\n                </clipPath>\n              </svg>\n            </div>\n          </main>`;\n      case State.REFINING:\n      case State.INSIGHT:\n        return html`\n        <main>\n          <${MarkdownView.MarkdownView.MarkdownView.litTagName}\n            .data=${{tokens: this.#state.tokens, renderer: this.#renderer} as MarkdownView.MarkdownView.MarkdownViewData}>\n          </${MarkdownView.MarkdownView.MarkdownView.litTagName}>\n          <details style=\"--list-height: ${this.#state.sources.length * 20}px;\">\n            <summary>${i18nString(UIStrings.sources)}</summary>\n            <${ConsoleInsightSourcesList.litTagName} .sources=${this.#state.sources}>\n            </${ConsoleInsightSourcesList.litTagName}>\n          </details>\n          ${!this.#state.refined ? html`<div class=\"refine-container\">\n            <${Buttons.Button.Button.litTagName}\n                class=\"refine-button\"\n                .data=${\n                  {\n                    variant: Buttons.Button.Variant.TONAL,\n                    size: Buttons.Button.Size.MEDIUM,\n                    iconName: 'spark',\n                  } as Buttons.Button.ButtonData\n                }\n                @click=${this.#onRefine}\n              >\n              ${this.#state.type === State.REFINING ? i18nString(UIStrings.refining) : i18nString(UIStrings.refine)}\n            </${Buttons.Button.Button.litTagName}>\n            <${IconButton.Icon.Icon.litTagName}\n              class=\"info\"\n              tabindex=\"0\"\n              .data=${\n                {\n                  iconName: 'info',\n                  color: 'var(--icon-default)',\n                  width: '16px',\n                  height: '16px',\n                } as IconButton.Icon.IconData\n              }>\n            </${IconButton.Icon.Icon.litTagName}>\n          </div>\n          ` : ''}\n        </main>`;\n      case State.ERROR:\n        return html`\n        <main>\n          <div class=\"error\">${this.#state.error}</div>\n        </main>`;\n    }\n    // clang-format on\n  }\n\n  #renderFooter(): LitHtml.LitTemplate {\n    // clang-format off\n    switch (this.#state.type) {\n      case State.LOADING:\n      case State.ERROR:\n        return LitHtml.nothing;\n      case State.INSIGHT:\n      case State.REFINING:\n        return html`<footer>\n        <div>\n          <${Buttons.Button.Button.litTagName}\n            data-rating=${'true'}\n            .data=${\n              {\n                variant: Buttons.Button.Variant.ROUND,\n                size: Buttons.Button.Size.SMALL,\n                iconName: 'thumb-up',\n                active: this.#selectedRating,\n                title: i18nString(UIStrings.thumbUp),\n              } as Buttons.Button.ButtonData\n            }\n            @click=${this.#onRating}\n          ></${Buttons.Button.Button.litTagName}>\n          <${Buttons.Button.Button.litTagName}\n            data-rating=${'false'}\n            .data=${\n              {\n                variant: Buttons.Button.Variant.ROUND,\n                size: Buttons.Button.Size.SMALL,\n                iconName: 'thumb-down',\n                active: this.#selectedRating !== undefined && !this.#selectedRating,\n                title: i18nString(UIStrings.thumbDown),\n              } as Buttons.Button.ButtonData\n            }\n            @click=${this.#onRating}\n          ></${Buttons.Button.Button.litTagName}>\n        </div>\n        <div class=\"filler\"></div>\n        ${this.#dogfood ? html`<div class=\"dogfood-feedback\">\n            <${IconButton.Icon.Icon.litTagName}\n              role=\"presentation\"\n              .data=${\n                {\n                  iconName: 'dog-paw',\n                  color: 'var(--icon-default)',\n                  width: '16px',\n                  height: '16px',\n                } as IconButton.Icon.IconData\n              }>\n            </${IconButton.Icon.Icon.litTagName}>\n            <span>${i18nString(UIStrings.dogfood)} - </span>\n            <x-link href=${DOGFOODFEEDBACK_URL} class=\"link\">${i18nString(UIStrings.submitFeedback)}</x-link>\n        </div>`: ''}\n      </footer>`;\n    }\n    // clang-format on\n  }\n\n  #getHeader(): string {\n    switch (this.#state.type) {\n      case State.LOADING:\n        return i18nString(UIStrings.generating);\n      case State.INSIGHT:\n      case State.REFINING:\n        return i18nString(UIStrings.insight);\n      case State.ERROR:\n        return i18nString(UIStrings.error);\n    }\n  }\n\n  #render(): void {\n    const topWrapper = Directives.classMap({\n      wrapper: true,\n      top: this.#ratingFormOpened,\n    });\n    const bottomWrapper = Directives.classMap({\n      wrapper: true,\n      bottom: this.#ratingFormOpened,\n    });\n    // clang-format off\n    render(html`\n      <div class=${topWrapper}>\n        <header>\n          <div>\n            <${IconButton.Icon.Icon.litTagName}\n              role=\"presentation\"\n              .data=${\n                {\n                  iconName: 'spark',\n                  color: 'var(--sys-color-primary-bright)',\n                  width: '20px',\n                  height: '20px',\n                } as IconButton.Icon.IconData\n              }>\n            </${IconButton.Icon.Icon.litTagName}>\n          </div>\n          <div class=\"filler\">\n            <h2>\n              ${this.#getHeader()}\n            </h2>\n          </div>\n          <div>\n            <${Buttons.Button.Button.litTagName}\n              .data=${\n                {\n                  variant: Buttons.Button.Variant.ROUND,\n                  size: Buttons.Button.Size.SMALL,\n                  iconName: 'cross',\n                  title: i18nString(UIStrings.closeInsight),\n                } as Buttons.Button.ButtonData\n              }\n              @click=${this.#onClose}\n            ></${Buttons.Button.Button.litTagName}>\n          </div>\n        </header>\n        ${this.#renderMain()}\n        ${this.#renderFooter()}\n      </div>\n      ${this.#ratingFormOpened ? html`\n        <div class=${bottomWrapper}>\n          <header>\n            <div class=\"filler\">${i18nString(UIStrings.reason)}</div>\n            <div>\n              <${Buttons.Button.Button.litTagName}\n                .data=${\n                  {\n                    variant: Buttons.Button.Variant.ROUND,\n                    size: Buttons.Button.Size.SMALL,\n                    iconName: 'cross',\n                    title: i18nString(UIStrings.close),\n                  } as Buttons.Button.ButtonData\n                }\n                @click=${this.#onCloseRating}\n              ></${Buttons.Button.Button.litTagName}>\n            </div>\n          </header>\n          <main>\n            ${!this.#selectedRating ? html`\n                <div class=\"buttons\">\n                  ${Directives.repeat(negativeRatingReasons, ([key, label]) => {\n                    return html`\n                      <${Buttons.Button.Button.litTagName}\n                        data-reason=${key}\n                        @click=${this.#onReason}\n                        .data=${\n                          {\n                            variant: Buttons.Button.Variant.SECONDARY,\n                            size: Buttons.Button.Size.MEDIUM,\n                            active: this.#selectedRatingReasons.has(key),\n                          } as Buttons.Button.ButtonData\n                        }\n                      >\n                        ${label()}\n                      </${Buttons.Button.Button.litTagName}>\n                    `;\n                  })}\n                </div>\n            ` : ''}\n            <textarea placeholder=${i18nString(UIStrings.additionalFeedback)}></textarea>\n          </main>\n          <footer>\n            <div class=\"filler\"></div>\n            <div>\n              <${Buttons.Button.Button.litTagName}\n                .data=${\n                  {\n                    variant: Buttons.Button.Variant.PRIMARY,\n                    size: Buttons.Button.Size.MEDIUM,\n                    title: i18nString(UIStrings.submit),\n                  } as Buttons.Button.ButtonData\n                }\n                @click=${this.#onSubmit}\n              >\n                ${i18nString(UIStrings.submit)}\n              </${Buttons.Button.Button.litTagName}>\n            </div>\n          </footer>\n        </div>\n      ` : ''}\n    `, this.#shadow, {\n      host: this,\n    });\n    // clang-format on\n  }\n}\n\nclass ConsoleInsightSourcesList extends HTMLElement {\n  static readonly litTagName = LitHtml.literal`devtools-console-insight-sources-list`;\n  readonly #shadow = this.attachShadow({mode: 'open'});\n  #sources: Source[] = [];\n\n  constructor() {\n    super();\n    this.#shadow.adoptedStyleSheets = [listStyles];\n  }\n\n  #render(): void {\n    // clang-format off\n     render(html`\n      <ul>\n        ${Directives.repeat(this.#sources, item => item.value, item => {\n          const icon = new IconButton.Icon.Icon();\n          icon.data = {iconName: 'open-externally', color: 'var(--sys-color-primary)', width: '14px', height: '14px'};\n          return html`<li><x-link class=\"link\" href=${`data:text/plain,${encodeURIComponent(item.value)}`}>${localizeType(item.type)}${icon}</x-link></li>`;\n        })}\n      </ul>\n    `, this.#shadow, {\n      host: this,\n    });\n    // clang-format on\n  }\n\n  set sources(values: Source[]) {\n    this.#sources = values;\n    this.#render();\n  }\n}\n\nComponentHelpers.CustomElements.defineComponent('devtools-console-insight', ConsoleInsight);\nComponentHelpers.CustomElements.defineComponent('devtools-console-insight-sources-list', ConsoleInsightSourcesList);\n\ndeclare global {\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\n  interface HTMLElementTagNameMap {\n    'devtools-console-insight': ConsoleInsight;\n    'devtools-console-insight-sources-list': ConsoleInsightSourcesList;\n  }\n}\n\nexport class MarkdownRenderer extends MarkdownView.MarkdownView.MarkdownLitRenderer {\n  override renderToken(token: Marked.Marked.Token): LitHtml.TemplateResult {\n    const template = this.templateForToken(token);\n    if (template === null) {\n      console.warn(`Markdown token type '${token.type}' not supported.`);\n      return LitHtml.html``;\n    }\n    return template;\n  }\n\n  override templateForToken(token: Marked.Marked.Token): LitHtml.TemplateResult|null {\n    switch (token.type) {\n      case 'heading':\n        return html`<strong>${this.renderText(token)}</strong>`;\n      case 'link':\n      case 'image':\n        return LitHtml.html`${UI.XLink.XLink.create(token.href, token.text)}`;\n    }\n    return super.templateForToken(token);\n  }\n}\n"]}